{"version":3,"sources":["assets/gifs/ajax-loader--gray.gif","assets/icons/svgs/add-square.svg","assets/icons/svgs/chevron.svg","assets/icons/svgs/close.svg","assets/icons/svgs/property.svg","assets/gifs/ajax-loader--blue.gif","assets/icons/svgs/chevron-blue.svg","assets/images/tagging-tracker-logo.PNG","assets/icons/svgs/location.svg","assets/icons/svgs/upload.svg","assets/icons/svgs/switch.svg","assets/icons/svgs/text-document.svg","assets/icons/svgs/delete.svg","assets/icons/svgs/pencil.svg","assets/icons/svgs/photo.svg","assets/icons/svgs/calendar.svg","utils/date.js","utils/delete.js","utils/misc.js","components/navbar/Navbar.js","components/login/Login.js","components/addresses/Addresses.js","utils/image.js","components/view-address/ViewAddress.js","utils/tagFields.js","components/events/eventUtils.js","components/tag-info/TagInfo.js","components/owner-info/OwnerInfo.js","utils/sync/syncUp.js","utils/sync/syncDown.js","utils/sync/sync.js","components/bottom-navbar/BottomNavbar.js","pages/page404/Page404.js","components/add-tag/AddTag.js","components/edit-tags/EditTags.js","App.js","components/events/Events.js","components/event-tags/EventTags.js","serviceWorker.js","index.js"],"names":["module","exports","getDateTime","format","process","TZ","date_ob","Date","date","getDate","slice","month","getMonth","year","getFullYear","hours","getHours","minutes","getMinutes","seconds","getSeconds","formatTimeStr","timeStr","indexOf","split","join","flipDateFormat","yyyyMmDd","useHyphens","divider","dateParts","deleteAddress","props","addressObj","finishedDeletingAddress","backupDelFailTimer","db","offlineStorage","addressId","doneDeleting","clearTimeout","alert","deleteAddressTagInfo","dbOpened","tagInfo","where","equals","count","then","delete","console","log","deleteAddressTags","catch","err","tags","deleteAddressRow","addresses","open","ownerInfo","deleteAddressOwnerInfo","setTimeout","getCurEvents","Promise","resolve","reject","events","toArray","deleteEventRow","tagInfoId","a","async","event","deleteEventTags","deleteEventRelatedData","checkIOS","returnString","iOS","test","navigator","userAgent","isChrome","window","chrome","document","querySelector","classList","add","location","href","truncateText","text","length","ellipsis","substr","Navbar","searchAddressInput","useRef","history","useHistory","useState","showSettings","setShowSettings","deletingAddress","setDeletingAddress","spreadsheetDownloading","setSpreadsheetDownloading","editSaveOwnerInfo","toggleModifyOwnerInfo","modifyOwnerInfo","editTagInfo","modifyTagInfo","push","pathname","state","eventTitle","toggleModifyTagInfo","Object","keys","tmpArr","deletedAddresses","address","setDeletedAddresses","deleteAddressCallback","confirm","toggleSettings","generateSettingsMenu","show","className","onClick","spreadsheetPath","axios","get","params","token","responseType","response","status","blob","Blob","data","link","createElement","URL","createObjectURL","download","body","appendChild","click","remove","error","finally","downloadSpreadsheet","type","updateSoftware","useEffect","showAddressModal","current","value","focus","checkOnlineStatus","routeLocation","path","baseDir","replace","toggleAddressModal","searchedAddress","placeholder","ref","onChange","e","searchStr","target","searchAddress","to","clearSearch","src","backArrow","alt","addressOutput","substring","getBackButtonTitle","getNavTitle","isEditTagsPath","isAddTagPath","disabled","deletingEvents","generateEditBtn","renderNavbar","Login","usernameInput","passwordInput","loginBtn","loginProcessing","setLoginProcessing","taggingTrackerLogo","autoCorrect","autoCapitalize","name","postUrl","username","password","post","res","updateToken","Addresses","autoComplete","newAddressInput","cancelAddAddressBtn","createAddressBtn","addAddressProcessing","setAddAddressProcessing","recentAddresses","activeAddresses","setActiveAddresses","revGeocodedAdresses","setRevGeocodedAddresses","pdfClickable","setPdfClickable","checkAddressExists","autoCompleteAddress","addressStr","saveAddress","transaction","lat","lng","created","updated","insertedId","newRowId","concat","setShowAddressModal","generateAddressStr","revGeocodedAddressObj","addressComponents","address_components","long_name","short_name","pdfIcon","addressName","pdfPath","prevState","getAddressPdf","suggestedAddressPicked","getPlace","clearSearchAddress","addressesFormatted","regex","RegExp","filter","map","id","tag","tagText","searchAddresses","splice","google","maps","places","Autocomplete","addListener","index","key","rightArrow","geolocation","getCurrentPosition","position","navLat","coords","latitude","navLong","longitude","geocoder","Geocoder","latlng","parseFloat","geocode","results","getImagePreviewAspectRatioClass","loadedPhoto","meta","width","imageMeta","height","ViewAddress","localImages","setLocalImages","sort","b","datetime","tagsGroupedByDate","forEach","image","dispDate","groupDate","Fragment","subIndex","style","backgroundImage","thumbnail_src","ajaxLoaderGray","renderTags","tagInfoFields","options","yes","no","other","commercial","residential","public","brick","concrete","wood","glass","painted","buildingDisrepair","weeds","trash","illegalDumping","addNewTagInfo","setAddingEvent","eventId","formData","checkEventExistsByDate","checkDate","some","addNewEvent","todaysDate","tagIds","updateTagInfoEventId","modify","updatedId","getTagInfoObjById","TagInfo","setTagInfo","setTagInfoId","nameValueMap","tagInfoInputElements","fieldKey","fieldType","createRef","subFields","subRefs","subFieldKey","updateDone","updateTagInfo","mappedFieldValues","element","elementType","Array","isArray","subElement","checked","existingTagInfoId","modifyClassWrapper","field","fieldGroup","mainIndex","defaultValue","onKeyUp","onBlur","min","optionKeys","optionKey","htmlFor","generateInputType","OwnerInfo","setOwnerInfo","formLabels","fieldKeys","inputElements","updateInfo","inputValue","ownerInfoValues","input","put","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer","getOwnerInfo","formField","readOnly","subGroup","subGroupIndex","getLocalAddresses","localStorage","getEvents","getLocalTags","getLocalOwnerInfo","ownerInfos","getTagInfo","tagInfos","bundleData","bundledData","timeLog","syncUp","headers","Authorization","msg","syncDown","isLocalStorageEmpty","syncUserData","updateLocalStorageFromSync","updateLocalAddresses","remoteData","addressRow","updateLocalEvents","eventRow","address_id","tag_info_id","JSON","parse","tag_ids","date_time","updateLocalTags","tagRow","tagMeta","event_id","fileName","filename","updateLocalOwnerInfo","ownerInfoRow","form_data","updateLocalTagInfo","tagInfoRow","deleteLocalData","BottomNavbar","syncBtn","logoutBtn","cameraBtn","uploadBtn","deletingEvent","setDeletingEvent","logout","updateLoggingOut","saveToDevice","sync","appOnline","syncApp","setSyncApp","synced","uploadImages","triggerFileUpload","directCameraClick","getElementById","confirmDeleteEvent","callback","deleteEventCallBack","curEvents","deleteEvent","doneDeletingEvent","remainingEvents","routePath","tagInfoPath","eventsPath","eventTagsPath","syncIcon","loggingOut","logoutIcon","property","edit","addSquare","loadedPhotos","uploadInProgress","ajaxLoaderBlue","savingToDevice","deleteIcon","textDocument","photo","renderBottomNavbar","Page404","getBase64","file","reader","FileReader","onload","ev","result","readAsDataURL","fileListToBase64","fileList","promises","i","len","all","fileNameOfImageToDelete","prevToken","AddTag","fileInput","loadCamera","triggerLoadCamera","fileUpload","setLoadedPhotos","setSavingToDevice","setUploadInProgress","createThumbnailSrc","img","Image","newImageWidth","newImageHeight","canvas","ctx","getContext","drawImage","toDataURL","scaleImage","onerror","thumbnailSrc","oldCanvas","previewPhotos","files","filesLength","base64s","newLoadedPhotos","maxFileSize","currentFile","size","thumbanil_src","setLoadedImageMeta","loadedImage","loopIndex","loadedPhotosClone","tagInfoObj","getEventId","images","setBodyClass","cameraCallback","multiple","onLoad","EditTags","deletePrompt","toggleDeletePrompt","setDeleteInProgress","setEventId","closeIcon","deleteCount","deleteImage","Events","setEvents","renderNoEvents","renderEvents","reverse","deleteEventsMode","EventTags","App","setToken","updateSearchedAddress","setAppOnline","setOfflineStorage","bodyClass","setDeleteEventsMode","clearSearchedAddress","storage","tokens","tokenId","updateAppOnlineState","online","addEventListener","removeEventListener","checkForNewVersion","verChecked","getItem","setItem","now","frontEndBasePath","Error","caches","names","reload","Dexie","version","stores","setupOfflineStorage","ttBody","isSafari","vendor","contains","standalone","matchMedia","matches","basename","component","exact","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","origin","fetch","contentType","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.6b6966d4.chunk.js","sourcesContent":["module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/add-square.00e36f36.svg\";","module.exports = __webpack_public_path__ + \"static/media/chevron.f829e185.svg\";","module.exports = __webpack_public_path__ + \"static/media/close.3287d96e.svg\";","module.exports = __webpack_public_path__ + \"static/media/property.8673af4c.svg\";","module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/chevron-blue.f91338b6.svg\";","module.exports = __webpack_public_path__ + \"static/media/tagging-tracker-logo.4295bb0d.PNG\";","module.exports = __webpack_public_path__ + \"static/media/location.57fefe5e.svg\";","module.exports = __webpack_public_path__ + \"static/media/upload.d4af3f99.svg\";","module.exports = __webpack_public_path__ + \"static/media/switch.56cc5584.svg\";","module.exports = __webpack_public_path__ + \"static/media/text-document.cec5da5d.svg\";","module.exports = __webpack_public_path__ + \"static/media/delete.89314c06.svg\";","module.exports = __webpack_public_path__ + \"static/media/pencil.03181e6a.svg\";","module.exports = __webpack_public_path__ + \"static/media/photo.0f212d8a.svg\";","module.exports = __webpack_public_path__ + \"static/media/calendar.fc231d9c.svg\";","export const getDateTime = (format = \"\") => {\n    // from https://stackoverflow.com/questions/8083410/how-can-i-set-the-default-timezone-in-node-js\n    process.env.TZ = \"America/Chicago\";\n    let date_ob = new Date();\n\n    // current date\n    // adjust 0 before single digit date\n    let date = (\"0\" + date_ob.getDate()).slice(-2);\n\n    // current month\n    let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\n\n    // current year\n    let year = date_ob.getFullYear();\n\n    // current hours\n    let hours = date_ob.getHours();\n\n    // current minutes\n    let minutes = date_ob.getMinutes();\n\n    // current seconds\n    let seconds = date_ob.getSeconds();\n    \n    if (format === \"YYYY-MM-DD\") {\n        return `${year}-${month}-${date}`;\n    }\n\n    if (format === \"MM-DD-YYYY\") {\n        return `${month}-${date}-${year}`;\n    }\n\n    // prints date & time in YYYY-MM-DD HH:MM:SS format\n    return `${year}-${month}-${date} ${hours}:${minutes}:${seconds}`;\n}\n\nexport const formatTimeStr = (timeStr) => {\n    if (timeStr.indexOf('T') !== -1) {\n        timeStr = timeStr.split('T').join(' ').split('.000Z').join('');\n    }\n\n    return timeStr;\n}\n\nexport const getTimeStamp = () => {\n    return Date.now();\n}\n\n// expectes hyphenated YYYY-MM-DD string\nexport const flipDateFormat = ( yyyyMmDd, useHyphens ) => {\n    const divider = useHyphens ? \"-\" : \"/\";\n    const dateParts = yyyyMmDd.split('-');\n    return dateParts[1] + divider + dateParts[2] + divider + dateParts[0];\n}","export const deleteAddress = (props, addressObj, finishedDeletingAddress) => {\n    const db = props.offlineStorage;\n    const addressId = addressObj.addressId;\n    let backupDelFailTimer;\n\n    const doneDeleting = () => {\n        clearTimeout(backupDelFailTimer);\n        alert('Address deleted! Redirecting...');\n        finishedDeletingAddress(addressObj);\n    }\n\n    // these are asynchronous events so when one finishes it calls the next\n    const deleteAddressOwnerInfo = (dbOpened) => {\n        const ownerInfo = dbOpened.ownerInfo.where(\"addressId\").equals(addressId);\n        ownerInfo.count()\n            .then((count) => {\n                if (count) {\n                    ownerInfo.delete()\n                        .then(() => {\n                            console.log('owner info deleted');\n                            deleteAddressTagInfo(dbOpened);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete owner info');\n                            console.log('delete owner info', err);\n                        });\n                } else {\n                    deleteAddressTagInfo(dbOpened); // next step\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete owner info');\n                console.log('delete owner info', err);\n            });\n    }\n\n    const deleteAddressTagInfo = (dbOpened) => {\n        const tagInfo = dbOpened.tagInfo.where(\"addressId\").equals(addressId);\n        tagInfo.count()\n            .then((count) => {\n                if (count) {\n                    tagInfo.delete()\n                        .then(() => {\n                            console.log('tag info deleted');\n                            deleteAddressTags(dbOpened);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete tag info');\n                            console.log('delete tags', err);\n                        });\n                } else {\n                    deleteAddressTags(dbOpened);\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete tag info');\n                console.log('delete tag info', err);\n            });\n    }\n\n    const deleteAddressTags = (dbOpened) => {\n        const tags = dbOpened.tags.where(\"addressId\").equals(addressId);\n        tags.count()\n            .then((count) => {\n                if (count) {\n                    tags.delete()\n                        .then(() => {\n                            console.log('tags deleted');\n                            deleteAddressRow(dbOpened);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete tags');\n                            console.log('delete tags', err);\n                        });\n                } else {\n                    deleteAddressRow(dbOpened);\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete tags');\n                console.log('delete tags', err);\n            });\n    }\n\n    const deleteAddressRow = (dbOpened) => {\n        const addresses = dbOpened.addresses.where(\"id\").equals(addressId);\n        addresses.count()\n            .then((count) => {\n                if (count) {\n                    addresses.delete() // should only be one\n                        .then(() => {\n                            console.log('address deleted');\n                            doneDeleting();\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete address');\n                            console.log('delete address', err);\n                        });\n                } else {\n                    doneDeleting();\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete address');\n                console.log('delete address', err);\n            });\n    }\n\n    if (db) {\n        // this is not ideal with how it handles partial failures\n        db.open().then(function (dbOpened) {\n            deleteAddressOwnerInfo(dbOpened);\n\n            // backup timer if all fails\n            backupDelFailTimer = setTimeout(() => {\n                alert('Failed to delete address or taking longer than usual'); // what\n                finishedDeletingAddress(addressObj);\n            }, 60000); // 1 min long\n        }).catch (function (err) {\n            // handle this failure correctly\n            alert('failed to open local storage', err);\n            finishedDeletingAddress(addressObj);\n        });\n    } else {\n        alert('Failed to delete address');\n        finishedDeletingAddress(addressObj);\n    }\n}\n\nconst getCurEvents = (db, addressId) => {\n    return new Promise((resolve, reject) => {\n        db.events.where(\"addressId\").equals(addressId).toArray()\n            .then((tags) => {\n                resolve(tags);\n            })\n            .catch(() => {\n                resolve(null);\n            });\n    });\n}\n\nconst deleteEventRow = async (db, tagInfoId) => {\n    const event = db.events.where(\"tagInfoId\").equals(tagInfoId);\n    return new Promise((resolve, reject) => {\n        event.count()\n            .then((count) => {\n                if (count) {\n                    event.delete()\n                        .then(() => {\n                            resolve(true);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete data related to event');\n                            resolve(false);\n                        });\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete data related to event');\n                resolve(false);\n            });\n    });\n}\n\nconst deleteEventTags = async (db, tagInfoId) => {\n    const tags = db.tags.where(\"eventId\").equals(tagInfoId);\n    return new Promise((resolve, reject) => {\n        tags.count()\n            .then((count) => {\n                if (count) {\n                    tags.delete()\n                        .then(() => {\n                            resolve(true);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete data related to event');\n                            resolve(false);\n                        });\n                }\n            })\n            .catch((err) => {\n                alert('Failed to delete data related to event');\n                resolve(false);\n            });\n    });\n}\n\n// deletes tags/event tied to tagInfoId\nconst deleteEventRelatedData = async (db, tagInfoId) => {\n    return new Promise(async (resolve, reject) => {\n        if (!await deleteEventRow(db, tagInfoId)) {\n            resolve(false);\n        }\n\n        if (!await deleteEventTags(db, tagInfoId)) {\n            resolve(false);\n        }\n\n        resolve(true);\n    });\n}\n\nexport const deleteEvent = (db, addressId, tagInfoId, deleteEventCallBack) => {\n    const tagInfo = db.tagInfo.where(\"eventId\").equals(tagInfoId);\n    tagInfo.count()\n        .then(async (count) => {\n            if (count) {\n                if (await deleteEventRelatedData(db, tagInfoId)) {\n                    tagInfo.delete()\n                        .then(async () => {\n                            return getCurEvents(db, addressId);\n                        })\n                        .then((curEvents) => {\n                            console.log('finished deleting');\n                            deleteEventCallBack(curEvents);\n                        })\n                        .catch((err) => {\n                            alert('Failed to delete event');\n                            deleteEventCallBack(); // so many of these\n                        });\n                }\n            }\n        })\n        .catch((err) => {\n            alert('Failed to delete event');\n            deleteEventCallBack();\n        });\n}","// this is trying to detect browser by user agent not really great\n// but this particular app has a fixed, bottom navbar which is problematic with Safari\n// since the Safari bottom menu bar overlaps the browser\n// the Safari menu bar height changes though so the magic number 44px is a best guess pulled from some site\n// initially I saw that when you scroll down the Safari bottom menu goes away/comes back scrolling up\n// but it seems if you don't have overflow/shorter in height then the bottom navbar will be ontop of the Safari bottom menu\n// I guess Mac has this issue too? That's what I see in Sauce Labs simulator\n\n// update on this problem:\n// There are three environments to consider: Chrome, Safari, PWA Standalone in iOS Safari\n// the two related things are the dynamically-added iOS class and CSS feature detection for standalone\n// anyway our primary target is iPhone PWA Standalone anyway with Safari but it would be nice\n// if the app still looks okay in Chrome, you'll notice something is wrong right away if the height\n// is missing 30% of the available viewport\nimport axios from 'axios';\n\nexport const checkIOS = (returnString) => {\n    const iOS = /(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent);\n    const isChrome = !!window.chrome;\n\n    if (iOS) {\n        if (returnString) {\n            // means Chrome\n            // https://stackoverflow.com/questions/16935955/javascript-to-detect-safari-and-chrome-on-mac\n            if (isChrome) {\n                return \"\";\n            } else {\n                return \"iOS\";\n            }\n        } else {\n            document.querySelector('.tagging-tracker__body').classList = 'tagging-tracker__body'; // clear state\n            document.querySelector('.tagging-tracker__bottom-navbar').classList.add('iOS');\n            document.querySelector('.tagging-tracker__body').classList.add('iOS');\n        }\n\n        if (window.location.href.indexOf('events') !== -1 || window.location.href.indexOf('event-tags') !== -1) {\n            document.querySelector('.tagging-tracker__body').classList.add('less');\n        }\n\n        if (window.location.href.indexOf('tag-info') !== -1) {\n            document.querySelector('.tagging-tracker__body').classList.add('toggled-navbar');\n        }\n\n        if (window.location.href.indexOf('add-tag') !== -1) {\n            document.querySelector('.tagging-tracker__body').classList.add('add-tag');\n        }\n    } else {\n        if (returnString) {\n            return \"\";\n        }\n    }\n}\n\nexport const resizeAdjustHeight = () => {\n    document.querySelector('.tagging-tracker').style.height = window.innerHeight + \"px\";\n}\n\n// TODO this is not great magic number is from the bottom navbar\n// mainly it's bad due to that JS render flash jank\nexport const addPathClassToBody = (props) => {\n    const curPath = props.location.pathname;\n\n    // this is bad direct dom manipulation\n    // if (curPath === \"/tag-info\") {\n    //     if (!document.querySelector('.tagging-tracker__body').classList.contains('full-body-height')) {\n    //         document.querySelector('.tagging-tracker__body').classList += \" full-body-height\";\n    //     }\n    // }\n\n    // if (curPath !== \"/addresses\" || curPath !== \"/\") {\n    //     document.querySelector('.tagging-tracker__body').style.maxHeight = (window.innerHeight - 52) + \"px\";\n    // }\n}\n\nexport const truncateText = (text, length, ellipsis) => {\n    if (!text) {\n        return \"undefined string\";\n    }\n\n    return text.substr(0, length) + ((ellipsis && text.length > length) ? '...' : '');\n}\n\nexport const downloadSpreadsheet = (props, setSpreadsheetDownloading) => {\n    setSpreadsheetDownloading(true);\n    const spreadsheetPath = window.location.href.indexOf('local') !== -1\n        ? process.env.REACT_APP_API_SPREADSHEET_ROUTE_LOCAL\n        : process.env.REACT_APP_API_SPREADSHEET_ROUTE;\n\n    axios.get(spreadsheetPath, {\n        params: {\n            token: props.token,\n        },\n        responseType: 'blob',\n    })\n        .then((response) => {\n            if (response.status === 200) {\n                const data = new Blob([response.data]);\n                const blob = data;\n                const link = document.createElement('a');\n                link.href = window.URL.createObjectURL(blob);\n                link.download = `Tagging Tracker Event Data.xlsx`;\n                document.body.appendChild(link);\n                link.click(); // create an <a> element and simulate the click operation.\n                link.remove();\n            } else if (response.status === 403) {\n                alert('Please login');\n            }\n            else {\n                alert('Spreadsheet failed to download');\n            }\n        })\n        .catch((error) => {\n            console.log('pdf download err', error);\n            alert('Spreadsheet failed to download');\n        })\n        .finally(() => {\n            setSpreadsheetDownloading(false);\n        });\n}","import React, { useRef, useEffect, useState } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport './Navbar.scss';\nimport { deleteAddress } from '../../utils/delete';\n\nimport backArrow from './../../assets/icons/svgs/chevron-blue.svg'; // rotated by CSS\nimport { truncateText, downloadSpreadsheet } from '../../utils/misc';\n\nconst Navbar = (props) => {\n    const searchAddressInput = useRef(null);\n    const history = useHistory();\n    const [showSettings, setShowSettings] = useState(false);\n    const [deletingAddress, setDeletingAddress] = useState(false);\n    const [spreadsheetDownloading, setSpreadsheetDownloading] = useState(false);\n\n    const searchAddresses = (searchStr) => {\n        props.searchAddress(searchStr);\n    }\n\n    const getNavTitle = (path, address) => {\n        let navTitle = \"\";\n\n        if (path === \"/tag-info\") {\n            navTitle = props.location.state.eventTitle ? props.location.state.eventTitle : \"Create event\";\n        } else if (path === \"/owner-info\") {\n            navTitle = \"Owner Information\";\n        } else if (path === \"/events\") {\n            navTitle = `${truncateText(address,40,true)} Events`;\n        } else if (path === \"/event-tags\" || path === \"/add-tag\" || path === \"/edit-tags\") {\n             navTitle = props.location.state.eventTitle;\n        } else {\n            navTitle = address;\n        }\n\n        return navTitle;\n    }\n\n    const getBackButtonTitle = (path, address) => {\n        const matchPaths = [\n            \"/events\",\n            \"/event-tags\"\n        ];\n\n        const pathMatches = matchPaths.indexOf(path) !== -1; // what path\n        const notEventTags = path !== \"/event-tags\";\n\n        if (pathMatches) {\n            let addressOutput;\n\n            if (address && notEventTags) {\n                addressOutput = address.substring(0, 10);\n\n                if (address.length > 10) {\n                    addressOutput += \"...\";\n                }\n            } else {\n                addressOutput = \"Events\";\n            }\n\n            return addressOutput;\n        } else if (path === \"/event-tags\" || path === \"/owner-info\" || path === \"/tag-info\") {\n            return \"Events\";\n        } else if (path.indexOf('tag') !== -1) {\n            return \"Event\";\n        } else {\n            return \"Addresses\";\n        }\n    }\n\n    const getBackPathname = (path) => {\n        if (path === \"/owner-info\") {\n            return \"/events\";\n        } else if (path.indexOf('tag') !== -1) {\n            return \"/events\";\n        } else {\n            return \"/addresses\"\n        }\n    }\n\n    const getBackState = (path, address) => { // address is extra/new due to events workflow\n        return {\n            clearSearch: true,\n            address,\n            addressId: props.location.state.addressId,\n            tagInfoId: props.location.state.tagInfoId,\n            eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\n                ? props.location.state.eventTitle : null)\n        };\n    }\n\n    const editSaveOwnerInfo = () => {\n        props.toggleModifyOwnerInfo(!props.modifyOwnerInfo);\n    }\n\n    const editTagInfo = () => {\n        if (props.modifyTagInfo) {\n            history.push({\n                pathname: \"/events\",\n                state: {\n                    ...props.location.state,\n                    eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\n                        ? props.location.state.eventTitle : null)\n                }\n            });\n        }\n        props.toggleModifyTagInfo(!props.modifyTagInfo);\n    }\n\n    const generateEditBtn = () => {\n        const pathname = props.location.pathname;\n        const isEditTagsPath = pathname.indexOf('edit') !== -1;\n        const isAddTagPath = pathname.indexOf('add-tag') !== -1;\n\n        if (pathname === \"/owner-info\") {\n            return (\n                <button\n                    type=\"button\"\n                    className=\"manage-address__edit-cancel\"\n                    onClick={ editSaveOwnerInfo }\n                >{ props.modifyOwnerInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\n            );\n        } else if (pathname === \"/tag-info\") {\n            return (\n                <button\n                    type=\"button\"\n                    className=\"manage-address__edit-cancel\"\n                    onClick={ editTagInfo }\n                >{ props.modifyTagInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\n            );\n        } else if (pathname === \"/events\") {\n            return <button\n                type=\"button\"\n                className=\"manage-address__edit-cancel\"\n                onClick={ () => {setDeletingAddress(!deletingAddress)} }\n                disabled={ props.deletingEvents ? true : false }>\n                    Delete\n            </button>;\n        } else {\n            return isEditTagsPath\n                ? (\n                    <button\n                        type=\"button\"\n                        className=\"manage-address__edit-cancel\"\n                        onClick={ deleteAddressCallback }\n                        disabled={ deletingAddress ? true : false }\n                    >Delete</button>\n                )\n                : (\n                <Link to={{ pathname: \"/edit-tags\", state: {\n                    address: props.location.state.address,\n                    addressId: props.location.state.addressId,\n                    tagInfoId: props.location.state.tagInfoId,\n                    eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\n                    ? props.location.state.eventTitle : null)\n                }}} className=\"manage-address__edit-cancel\">{\n                    isAddTagPath ? \"\" : (isEditTagsPath ? \"Delete\" : \"Edit\")\n                }</Link>\n            );\n        }\n    }\n\n    const finishedDeletingAddress = (addressObj) => {\n        // finished deleting, go back to main addresses view\n        setDeletingAddress(false);\n        if (Object.keys(addressObj).length) {\n            const tmpArr = props.deletedAddresses;\n            tmpArr.push(addressObj.address); // the primary \"key\" is the address string\n            props.setDeletedAddresses(tmpArr);\n        }\n        history.push(\"/addresses\");\n    }\n\n    const deleteAddressCallback = () => {\n        const addressObj = props.location.state;\n        const shouldDeleteAddress = window.confirm(\"Delete address \" + addressObj.address + \" ?\");\n        if (shouldDeleteAddress) {\n            setDeletingAddress(true);\n            deleteAddress(props, addressObj, finishedDeletingAddress);\n        }\n    }\n\n    const toggleSettings = () => {\n        setShowSettings(!showSettings);\n    }\n\n    const generateSettingsMenu = (show) => {\n        if (!show) {\n            return null;\n        }\n\n        return <div className=\"navbar-top__settings-menu\">\n            <div onClick={() => { downloadSpreadsheet(props, setSpreadsheetDownloading); }} className={`navbar-top__settings-menu-xlsx ${spreadsheetDownloading ? 'processing' : ''}`}>\n                Download <span>spreadsheet</span>\n            </div>\n            <button type=\"button\" onClick={ props.updateSoftware }>Update Software</button>{/* LOL */}\n        </div>;\n    }\n\n    const renderNavbar = (routeLocation) => {\n        const routePath = props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\n        switch(routePath) {\n            case '/':\n            case '/addresses':\n                return <>\n                    <div className=\"tagging-tracker__navbar-top addresses\">\n                        <button className=\"add\" onClick={  () => {props.toggleAddressModal(true)}  } />\n                        <h2>Addresses</h2>\n                        <div className=\"navbar-top__settings\">\n                            <button className=\"gear-icon\" type=\"button\" onClick={ toggleSettings }></button>\n                            { generateSettingsMenu(showSettings) }\n                        </div>\n                    </div>\n                    <input type=\"text\" value={props.searchedAddress} placeholder=\"search\" ref={ searchAddressInput } onChange={ (e) => { searchAddresses(e.target.value)} }></input>\n                </>;\n            case '/view-address':\n            case '/edit-tags':\n            case '/tag-info':\n            case '/owner-info':\n            case '/events':\n            case '/event-tags':\n            case '/tags':\n            case '/add-tag':\n                return <>\n                    <div className=\"tagging-tracker__navbar-top view-address edit-tags add-tags\">\n                        <Link to={{ pathname: getBackPathname(routeLocation.pathname), state: getBackState(routeLocation.pathname, props.location.state.address)}} className=\"manage-address__back\">\n                            <img src={ backArrow } alt=\"back arrow\" />\n                            <h4>{ getBackButtonTitle(routeLocation.pathname, props.location.state.address) }</h4>\n                        </Link>\n                        <h2 className=\"manage-address__name\">\n                            { getNavTitle(routeLocation.pathname, props.location.state.address) }\n                        </h2>\n                        { generateEditBtn() }\n                    </div>\n                </>;\n            default:\n                return \"\";\n        }\n    };\n\n    // focus\n    useEffect(() => {\n        if (!props.showAddressModal && props.location.pathname === \"/addresses\" && searchAddressInput.current.value.length > 0) {\n            searchAddressInput.current.focus();\n        }\n\n        // update online/offline status\n        props.checkOnlineStatus();\n    });\n\n    // delete address\n    useEffect(() => {\n        if (deletingAddress) {\n            deleteAddressCallback();\n        }\n    }, [deletingAddress]);\n\n    return(\n        <div className=\"tagging-tracker__navbar\">\n            { renderNavbar(props.location) }\n        </div>\n    )\n}\n\nexport default Navbar;","import React, { useRef, useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport './Login.scss';\nimport taggingTrackerLogo from './../../assets/images/tagging-tracker-logo.PNG';\nimport axios from 'axios';\n\nconst Login = (props) => {\n    const usernameInput = useRef(null);\n    const passwordInput = useRef(null);\n    const loginBtn = useRef(null);\n    const history = useHistory();\n    const [loginProcessing, setLoginProcessing] = useState(false);\n\n    const login = () => {\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\n                ? process.env.REACT_APP_API_BASE_LOCAL\n                : process.env.REACT_APP_API_BASE;\n        const postUrl = baseApiPath + '/login-user';\n        const username = usernameInput.current.value;\n        const password = passwordInput.current.value;\n\n        if (!username || !password) {\n            alert('Please fill in both username and password to login');\n            return;\n        }\n\n        setLoginProcessing(true);\n\n        axios.post(postUrl, {\n            username,\n            password\n        })\n        .then((res) => {\n            if (typeof res.data.token !== \"undefined\" && res.data.token) {\n                props.updateToken(props.offlineStorage, res.data.token);\n            }\n        })\n        .catch((err) => {\n            alert('failed to login'); // 401 goes through here too\n            setLoginProcessing(false);\n        });\n    }\n\n    useEffect(() => {\n        if (props.token) {\n            history.push(\"/addresses\");\n        }\n    });\n\n    return(\n        <div className=\"tagging-tracker__login\">\n            <img alt=\"tagging tracker logo\" className=\"tagging-tracker__login-logo\" src={ taggingTrackerLogo } />\n            <div className=\"tagging-tracker__login-fields\">\n                <input type=\"text\" autoCorrect=\"off\" autoCapitalize=\"none\" name=\"username\" placeholder=\"username\" ref={ usernameInput } />\n                <input type=\"password\" name=\"password\" placeholder=\"password\" ref={ passwordInput } />\n                <button type=\"button\" onClick={ login } ref={ loginBtn } disabled={ loginProcessing ? true : false }>Login</button>\n            </div>\n        </div>\n    )\n}\n\nexport default Login;","import React, { useRef, useEffect, useState } from 'react';\nimport axios from 'axios';\n/* global google */\nimport { Link } from 'react-router-dom';\nimport './Addresses.scss';\nimport rightArrow from './../../assets/icons/svgs/chevron.svg';\nimport location from './../../assets/icons/svgs/location.svg';\n\nconst Addresses = (props) => {\n    const newAddressInput = useRef(null);\n    const cancelAddAddressBtn = useRef(null);\n    const createAddressBtn = useRef(null);\n    const [addAddressProcessing, setAddAddressProcessing] = useState(false);\n    const [recentAddresses] = useState([]); // what is the difference between this and activeAddresses\n    const [activeAddresses, setActiveAddresses] = useState(null);\n    const [revGeocodedAdresses, setRevGeocodedAddresses] = useState(null);\n    const [pdfClickable, setPdfClickable] = useState({});\n    const { token } = props;\n    let autoComplete;\n    \n    // this search may need to get restructured depending on what's available/important to search against\n    // versus the obvious address field, but tag search is something based on the tag text\n    // I will implement an address-first then tag search, this is not going to be as optimized/fast as plain SQL\n    // also I have not done any indexing this is just using regular tables/main parent\n    // more info here:\n    // https://dexie.org/docs/WhereClause/WhereClause, https://dexie.org/docs/Table/Table.filter(), https://dexie.org/docs/Table/Table.where()\n    const searchAddresses = (searchStr) => {\n        const offlineStorage = props.offlineStorage;\n\n        if (!offlineStorage) {\n            return; // offline storage not ready yet\n        }\n\n        // the /string/ pattern is a regex, can't make one from concatenating plain strings\n        const regex = new RegExp(searchStr, \"i\"); // case insensitive\n\n        // this is similar to a LIKE search https://github.com/dfahlander/Dexie.js/issues/146\n        // other alternatives like .where(\"address\").startsWith(searchStr)\n        let addressesFormatted;\n        offlineStorage.addresses.filter(address => regex.test(address.address))\n            .toArray().then((addresses) => {\n                if (!addresses.length) {\n                    // try searching by tags\n                    offlineStorage.tagInfo.filter(tag => regex.test(tag.tagText)).toArray().then((tags) => {\n                        addressesFormatted = tags.map((tag) => {\n                            return {\n                                // not sure if this will work\n                                address: offlineStorage.addresses.where(\"id\").equals(tag.addressId).toArray().then((addresses) => {\n                                        return addresses[0].id\n                                    }),\n                                addressId: tag.addressId\n                            };\n                        });\n                    });\n                } else {\n                    addressesFormatted = addresses.map((address) => {\n                        return {\n                            address: address.address,\n                            addressId: address.id\n                        };\n                    });\n                }\n\n\t\t\t\tsetActiveAddresses(addressesFormatted);\n            });\n    }\n\n    const checkAddressExists = (autoCompleteAddress) => {\n        // this is here because the address from autocomplete in the input field has the full address eg. includes city/state\n        const addressStr = autoCompleteAddress ? autoCompleteAddress : newAddressInput.current.value;\n        const offlineStorage = props.offlineStorage;\n\n        offlineStorage.open().then((offlineStorage) => {\n            offlineStorage.addresses.toArray().then((addresses) => {\n                !addresses.length\n                    ? saveAddress(addressStr)\n                    :  offlineStorage.addresses\n                        .where(\"address\").equals(addressStr)\n                        .toArray().then((addresses) => {\n                            addresses.length ? alert('Address exists') : saveAddress(addressStr);\n                        });\n            });\n        }).catch (function (err) {\n            // handle this failure correctly\n            alert('failed to open local storage');\n        });\n    }\n\n    const saveAddress = async (addressStr) => {\n        const offlineStorage = props.offlineStorage;\n\n        if (!addressStr) {\n            alert('Please enter an address');\n            return;\n        }\n\n        setAddAddressProcessing(true);\n\n        // check if address is in table already\n        offlineStorage.transaction('rw', offlineStorage.addresses, async() => {\n            let newRowId;\n\n            if (\n                await offlineStorage.addresses.add({\n                    address: addressStr,\n                    lat: \"0.0\", // turn to float when uploaded\n                    lng: \"0.0\", // turn to float when uploaded\n                    created: props.getDateTime(),\n                    updated: props.getDateTime()\n                }).then((insertedId) => {\n                    newRowId = insertedId;\n                    return true;\n                })\n            ) {\n                setActiveAddresses(recentAddresses.concat({\n                    address: addressStr,\n                    addressId: newRowId\n                }));\n                setAddAddressProcessing(false);\n                props.setShowAddressModal(false);\n            } else {\n                alert('Failed to save address');\n            }\n        })\n        .catch(e => {\n            alert('Failed to save address');\n        });\n    }\n\n    const loadRecentAddresses = () => {\n        // returns last 10 addresses used by updated date sorted descending\n        if (!recentAddresses.length && props.offlineStorage) {\n            props.offlineStorage.addresses.toArray().then((addresses) => {\n                // format data\n                const addressesFormatted = addresses.splice(0, 15).map((address) => {\n                    return {\n                        address: address.address,\n                        addressId: address.id\n                    };\n                });\n\n\t\t\t\tsetActiveAddresses(addressesFormatted);\n\t\t\t});\n        }\n    }\n\n    const reverseGeocode = () => {\n        // https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\n        // https://developers.google.com/maps/documentation/javascript/geocoding\n        const success = (position) => {\n            const navLat = position.coords.latitude;\n            const navLong = position.coords.longitude;\n            const geocoder = new google.maps.Geocoder;\n            const latlng = {lat: parseFloat(navLat), lng: parseFloat(navLong)};\n            geocoder.geocode({'location': latlng}, function(results, status) {\n              if (status === 'OK') {\n                if (results[0]) {\n                  setRevGeocodedAddresses(results);\n                } else {\n                  alert('No address found');\n                }\n              } else {\n                alert('Failed to find an address');\n              }\n            });\n        }\n\n        const error = () => {\n            alert('Failed to determine your location');\n        }\n\n        if (navigator.geolocation) {\n            navigator.geolocation.getCurrentPosition(success, error);\n        } else {\n            alert('Geolocation not supported on your browser');\n        }\n    }\n\n    const generateAddressStr = (revGeocodedAddressObj) => {\n        // should type check this eg. basic exists\n        const addressComponents = revGeocodedAddressObj.address_components;\n        return `${addressComponents[0] ? addressComponents[0].long_name : \"\"}\n             ${addressComponents[1] ? addressComponents[1].short_name : \"\"}`;\n    }\n\n    const pickRevGeocodedAddress = (addressStr) => {\n        checkAddressExists(addressStr);\n        setRevGeocodedAddresses(null);\n    }\n\n    const addNewAddressModal = (showModal) => {\n        return showModal ? (\n            <div className=\"tagging-tracker__address-input-modal\">\n                <h3>{ revGeocodedAdresses ? 'Select Address' : 'Create New Address' }</h3>\n                <p>{ revGeocodedAdresses ? null : 'Please enter a new address that you want to create' }</p>\n                { token ? null :\n                    <p className=\"disclaimer-text\">Note: login required for address autocomplete</p> }\n                { revGeocodedAdresses\n                    ? <div className=\"tagging-tracker__reverse-geocoded-address-set\">\n                        <div className=\"tagging-tracker__reverse-geocoded-addresses\">\n                            {\n                                revGeocodedAdresses.map((address) => {\n                                    return <div\n                                        className=\"tagging-tracker__reverse-geocoded-address\"\n                                        onClick={ () => pickRevGeocodedAddress(generateAddressStr(address)) }>\n                                        {\n                                            generateAddressStr(address)\n                                        }\n                                    </div>\n                                })\n                            }\n                        </div>\n                        <button className=\"tagging-tracker__reverse-geocode-back-btn\" type=\"button\" onClick={ () => setRevGeocodedAddresses(null) }>Back</button>\n                    </div>\n                    : <><div className=\"tagging-tracker__address-input-row\">\n                        { !token\n                            ? null\n                            : <img\n                                className=\"address-input-row___location-icon\"\n                                src={ location }\n                                alt=\"location icon\"\n                                onClick={ () => reverseGeocode() } /> }\n                        <input type=\"text\" ref={ newAddressInput } id=\"autocomplete\" />\n                    </div>\n                    <div className=\"tagging-tracker__address-input-modal-btns\">\n                        <button type=\"button\" ref={ cancelAddAddressBtn } onClick={ () => {props.toggleAddressModal(false)} } >CANCEL</button>\n                        <button type=\"button\" ref={ createAddressBtn } onClick={ () => checkAddressExists() } disabled={ addAddressProcessing ? true : false }>CREATE</button>\n                    </div></>\n                }\n            </div>\n        ) : null;\n    }\n\n    const getAddressPdf = (addressName) => {\n        const isDev = window.location.href.indexOf('localhost') !== -1; // should just have global prop\n        const pdfPath = isDev ? process.env.REACT_APP_API_PDF_ROUTE_LOCAL : process.env.REACT_APP_API_PDF_ROUTE;\n\n        setPdfClickable(prevState => ({\n            ...prevState,\n            [addressName]: false,\n        }));\n\n        axios.get(pdfPath, {\n            params: {\n                address: addressName,\n                token: props.token,\n            },\n            responseType: 'blob',\n        })\n            .then((response) => {\n                if (response.status === 200) {\n                    // ehh this is not how this was supposed to work, made it with a GET request but later realized will use POST\n                    // also viewing in app vs. viewing generator link directly\n                    // https://stackoverflow.com/a/56660805\n                    const data = new Blob([response.data]);\n                    const blob = data;\n                    const link = document.createElement('a');\n                    link.href = window.URL.createObjectURL(blob);\n                    link.download = `Tagging Tracker - ${addressName}.pdf`;\n                    document.body.appendChild(link);\n                    link.click(); // create an <a> element and simulate the click operation.\n                    link.remove();\n                } else if (response.status === 403) {\n                    alert('Please login');\n                }\n                else {\n                    alert('PDF failed to download');\n                }\n            })\n            .catch((error) => {\n                console.log('pdf download err', error);\n                alert('PDF failed to download');\n            })\n            .finally(() => {\n                setPdfClickable(prevState => ({\n                    ...prevState,\n                    [addressName]: true,\n                }));\n            });\n    }\n\n    const pdfIcon = (addressName) => (\n        <div\n            className={`tagging-tracker__address-pdf-icon ${(!(addressName in pdfClickable) || pdfClickable[addressName]) ? '' : 'in-progress'}`}\n            onClick={() => { getAddressPdf(addressName); }}\n        >\n            <span>PDF</span>\n        </div>\n    )\n\n    const renderActiveAddresses = () => {\n        if (!activeAddresses) {\n            return \"\";\n        } else {\n            return (activeAddresses.map((address, index) => {\n                return <div className=\"tagging-tracker__address-wrapper\">\n                    { pdfIcon(address.address) }\n                    <Link\n                        key={index}\n                        to={{ pathname: \"/events\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className=\"tagging-tracker__address\">\n                            <h4>{ address.address }</h4>\n                            <img src={ rightArrow } alt=\"right arrow\" />\n                    </Link>\n                </div>}));\n        }\n    }\n\n    const suggestedAddressPicked = () => {\n        const addressObj = autoComplete.getPlace();\n        if ('name' in addressObj) {\n            checkAddressExists(addressObj.name);\n        }\n    }\n\n    // focus\n    useEffect(() => {\n        if (props.showAddressModal) {\n            newAddressInput.current.focus();\n        }\n\n        // this detects when route changed from a single address back to addresses and clears the search input\n        // there are no hard routes eg. using Link so the parent state does not change\n        if (typeof props.location.state !== \"undefined\" &&\n            typeof props.location.state.clearSearch !== \"undefined\") {\n            delete props.location.state.clearSearch; // lol without this non-ending loop\n            props.clearSearchAddress();\n        }\n\n        if (recentAddresses) {\n            setAddAddressProcessing(false);\n        }\n    }, [props, recentAddresses]);\n\n    useEffect(() => {\n        if (props.searchedAddress.length) {\n            searchAddresses(props.searchedAddress);\n        } else if (props.offlineStorage && (!recentAddresses || !activeAddresses)) {\n            loadRecentAddresses(); // TODO unmounted state issue\n        }\n\n        // Google address autocomplete\n        if (props.showAddressModal && token) {\n            autoComplete = new google.maps.places.Autocomplete(newAddressInput.current, {\"types\": [\"geocode\"]})\n            autoComplete.addListener('place_changed', suggestedAddressPicked);\n        }\n    });\n\n    return(\n        <div className=\"tagging-tracker__addresses\">\n            { renderActiveAddresses() }\n            { addNewAddressModal((props.showAddressModal || revGeocodedAdresses)) }\n        </div>\n    )\n}\n\nexport default Addresses;","// skipping this for now, using CSS contain to fit image, does the same thing\n// TODO: investigate issue with state and image meta not getting set\n// this works in delete mode eg. EditTags.js as the meta dimentions exist\nexport const getImagePreviewAspectRatioClass = (loadedPhoto) => {\n    const imageMetaSet = Object.keys(loadedPhoto.meta).length;\n\n    if (imageMetaSet && typeof loadedPhoto.meta.width !== \"undefined\") {\n        const imageMeta = loadedPhoto.meta;\n        return (imageMeta.width >= imageMeta.height) // flipped\n            ? \"landscape\"\n            : \"portrait\";\t\n    } else {\n        return \"\";\n    }\n}","import React, { useState  } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport './ViewAddress.scss';\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\nimport { flipDateFormat } from './../../utils/date';\n\nconst ViewAddress = (props) => {\n    const history = useHistory();\n    const [localImages, setLocalImages] = useState(null);\n    \n    if (typeof props.location.state === \"undefined\") {\n        history.push(\"/addresses\");\n    }\n\n    const renderDateRow = ( dispDate ) => {\n        return <h3\n            className=\"tagging-tracker__view-address-tag-date-group\">\n            <span>Event</span> { flipDateFormat(dispDate, false) }\n        </h3>;\n    }\n\n    const renderTags = () => {\n        const db = props.offlineStorage;\n\n        if (db && !localImages) {\n            db.open().then(function (db) {\n                db.tags.toArray().then((tags) => {\n                    !tags.length\n                        ? setLocalImages({})\n                        :  db.tags\n                        .where(\"addressId\").equals(props.location.state.addressId)\n                        .toArray().then((tags) => {\n                            // sort tags by descending date\n                            // straight outta SO: https://stackoverflow.com/questions/10123953/how-to-sort-an-array-by-a-date-property\n                            tags.sort((a, b) => {\n                                return new Date(b.datetime) - new Date(a.datetime);\n                            });\n                            setLocalImages(tags);\n                        });\n                });\n            }).catch (function (err) {\n                // handle this failure correctly\n                alert('failed to open local storage');\n            });\n        }\n        \n        if (localImages && Object.keys(localImages).length) {\n            // I was contemplating where to do this but the tags have to get grouped by date\n            const tagsGroupedByDate = {};\n            \n            localImages.forEach((image) => {\n                if (image.datetime in tagsGroupedByDate) {\n                    tagsGroupedByDate[image.datetime].push(image);\n                } else {\n                    tagsGroupedByDate[image.datetime] = [image];\n                }\n            });\n\n            return Object.keys(tagsGroupedByDate).map((date, index) => {\n                const groupDate = date.indexOf(\"T\") !== -1 ? date.split(\"T\")[0] : date.split(\" \")[0];\n\n                return <React.Fragment key={ index }>\n                    { renderDateRow(groupDate) }\n                    { tagsGroupedByDate[date].map((image, subIndex) => {\n                        return <div\n                            key={ subIndex }\n                            style={{\n                                backgroundImage: `url(${image.thumbnail_src})`\n                            }}\n                            alt=\"address thumbnail\"\n                            className={ \"address__tag-image \" + getImagePreviewAspectRatioClass(localImages[index]) } />\n                    })}\n                </React.Fragment>\n            });\n        } else {\n            return(localImages && Object(localImages).length)\n                ? <div className=\"tagging-tracker__view-address-loading css-delayed-fade-in\">\n                    <span>Loading tags...</span>\n                    <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\n                </div>\n                : <div className=\"tagging-tracker__view-address-no-tags\">\n                    <h4>No Tags</h4>\n                </div>;\n        }\n    }\n\n    return(\n        <div className=\"tagging-tracker__view-address\">\n            { renderTags() }\n        </div>\n    )\n}\n\nexport default ViewAddress;","export const tagInfoFields = {\n    \"Date of entry:\": { // TODO: these should be date time with date pickers\n        type: \"date\"\n    },\n    \"Date of abatement:\": { // TODO: these should be date time with date pickers\n        type: \"date\"\n    },\n    \"Number of tags:\": {\n        type: \"number\"\n    },\n    \"Tag text (separated by commas):\": {\n        type: \"input\"\n    },\n    \"Small tag text (separated by commas):\": {\n        type: \"input\"\n    },\n    \"Square footage covered:\": {\n        type: \"number\"\n    },\n    \"Racial or hate tone?\": {\n        type: \"radio\",\n        options: {\n            yes: \"Yes\",\n            no: \"No\",\n            other: \"Other\"\n        }\n    },\n    \"Gang related:\": {\n        type: \"radio\",\n        options: {\n            yes: \"Yes\",\n            no: \"No\",\n            other: \"Other\"\n        }\n    },\n    \"Crossed out tag:\": {\n        type: \"radio\",\n        options: {\n            yes: \"Yes\",\n            no: \"No\",\n            other: \"Other\"\n        }\n    },\n    \"Type of property:\": {\n        type: \"radio\",\n        options: {\n            commercial: \"Commercial\",\n            residential: \"Residential\",\n            public: \"Public\"\n        }\n    },\n    \"Vacant property:\": {\n        type: \"radio\",\n        options: {\n            yes: \"Yes\",\n            no: \"No\",\n            other: \"unknown\"\n        }\n    },\n    \"Land bank property:\": {\n        type: \"radio\",\n        options: {\n            yes: \"Yes\",\n            no: \"No\",\n            other: \"unknown\"\n        }\n    },\n    \"Surface:\": {\n        type: \"checkbox\",\n        options: {\n            brick: \"Brick or Stone\",\n            concrete: \"Concrete\",\n            wood: \"Wood\",\n            glass: \"Glass\",\n            painted: \"Painted\",\n            other: \"other\"\n        }\n    },\n    \"Surface other:\": {\n        type: \"input\"\n    },\n    \"Need other code enforcement?\": {\n        type: \"checkbox\",\n        options: {\n            buildingDisrepair: \"Building disrepair\",\n            weeds: \"Weeds\",\n            trash: \"Trash\",\n            illegalDumping: \"Illegal dumping\",\n            other: \"other\"\n        }\n    },\n    \"Other code enforcement:\": {\n        type: \"input\"\n    }\n};","export const addNewTagInfo = async ( addressId, offlineStorage, setAddingEvent, formData = {} ) => {\n    // this is dumb, I can't explain this, the transaction is a promise\n    // so you shouldn't need a promise around a promise\n    // but it seems to be the only way to force these to execute in order\n    return new Promise((resolve, reject) => {\n        offlineStorage.transaction('rw', offlineStorage.tagInfo, async () => {\n            offlineStorage.tagInfo.add({\n                addressId,\n                eventId: null,\n                formData: {}\n            }).then((tagInfoId) => {\n                resolve(tagInfoId);\n            })\n        })\n        .catch(e => {\n            console.log('failed to create tag info for event', e);\n            alert('Failed to create tag info for event');\n            setAddingEvent(false);\n            reject();\n        });\n    });\n}\n\n// this is pretty much using a contains check since the stored datetime string has hour:minutes:seconds\n// but it's still pulling all entries by address as it's not too many\nconst checkEventExistsByDate = async ( offlineStorage, addressId, checkDate ) => {\n    return new Promise((resolve, reject) => {\n        offlineStorage.transaction('rw', offlineStorage.events, () => {\n            offlineStorage.events.where(\"addressId\").equals(addressId).toArray()\n            .then((events) => {\n                if (events.length) {\n                    // if true means already exists, reject add event\n                    resolve(events.some(event => event.datetime.indexOf(checkDate) !== -1));\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch((err) => {\n                console.log('failed checking for event duplicate', err);\n                alert('failed check for adding new event');\n                reject(false);\n            });\n        });\n    });\n}\n\nexport const addNewEvent = async ( tagInfoId, addressId, offlineStorage, formatTimeStr, getDateTime, setAddingEvent = false ) => {\n    const todaysDate = formatTimeStr(getDateTime()) // makes YYYY-MM-DD HH:MM:SS format for MySQL DateTime;\n    const eventExists = await checkEventExistsByDate(offlineStorage, addressId, todaysDate.split(\" \")[0]);\n    if (eventExists) {\n        alert('Error: Event date already exists');\n        return;\n    };\n\n    return new Promise((resolve, reject) => {\n        offlineStorage.transaction('rw', offlineStorage.events, async () => {\n            offlineStorage.events.add({\n                addressId,\n                tagInfoId,\n                tagIds: [],\n                datetime: todaysDate\n            }).then((eventId) => {\n                resolve(eventId);\n            });\n        })\n        .catch(e => {\n            console.log('failed to create event', e);\n            alert('Failed to create event');\n            setAddingEvent(false);\n            reject();\n        });\n    });\n}\n\nexport const updateTagInfoEventId = ( tagInfoId, eventId, offlineStorage, setAddingEvent = false ) => {\n    return new Promise((resolve, reject) => {\n        offlineStorage.transaction('rw', offlineStorage.tagInfo, () => {\n            offlineStorage.tagInfo.where(\":id\").equals(tagInfoId).modify({ // should only be one match\n                eventId\n            }).then((updatedId) => {\n                resolve(updatedId);\n            })\n            .catch(e => {\n                console.log('failed to update tag info with event id', e);\n                alert('failed to update tag info with event id');\n                setAddingEvent(false);\n                reject(false);\n            });\n        });\n    });\n}\n\nexport const getTagInfoObjById = async ( offlineStorage, tagInfoId ) => {\n    return new Promise((resolve, reject) => {\n        offlineStorage.tagInfo.get(tagInfoId)\n            .then((tagInfo) => {\n                resolve(tagInfo);\n            })\n            .catch((err) => {\n                console.log('error getting tag info obj');\n                reject();\n            });\n    });\n}\n\n// actually returning matching primaryKey(s) in Dexie\nexport const getEventIdByTagInfoId = async ( offlineStorage, tagInfoId ) => {\n    return new Promise((resolve, reject) => {\n        offlineStorage.transaction('rw', offlineStorage.events, async () => {\n            const keys = await offlineStorage.events.where(\"tagInfoId\").equals(tagInfoId).primaryKeys();\n        })\n        .catch(e => {\n            console.log('failed to get event primary key', e);\n        });\n    });\n}","import React, { createRef, useState, useRef, useEffect } from 'react';\nimport './TagInfo.scss';\n\nimport { getDateTime, formatTimeStr, nameValueMap } from './../../utils/date';\nimport { tagInfoFields } from './../../utils/tagFields';\nimport { addNewTagInfo, addNewEvent, updateTagInfoEventId } from './../events/eventUtils';\n\n// TODO: there is this functionality of \"Others: type here\" but that will take some work to make a dynamic input field\n\n/**\n * So this is probably pretty confusing I get that, I was trying to make dynamic forms which it does work pretty well but has verbose code\n * The field types and values are defined in a util file called tagFields.js\n * The tagInfoFieldKeys below are used to map the refs so the inputs can be selected(for getting current value)\n * The nameValueMap is used to map the values for render\n * The main things to keep in mind is your tagFields.js structure has to match the structures here\n * Note the option-#-# when nested values are inside an input group eg. radio/checkbox you increment the sub group vs. incrementing a new level\n * OwnerInfo is built similarly but it's much simpler since it has no depth and just text input\n * @param {Object} props \n */\nconst TagInfo = (props) => {\n    const [tagInfo, setTagInfo] = useState(null);\n    const [tagInfoId, setTagInfoId] = useState(null);\n    const { modifyTagInfo } = props;\n\n    // these have to match the order of the keys in tagFields.js\n    const tagInfoFieldKeys = {\n        \"Date of entry:\": \"\", // TODO - change to type date\n        \"Date of abatement:\": \"\", // TODO - change to type date, picker is extra but format guarding would be good\n        \"Number of tags:\": \"\",\n        \"Tag text (separated by commas):\": \"\",\n        \"Small tag text (separated by commas):\": \"\",\n        \"Square footage covered:\": \"\",\n        \"Racial or hate tone?\": \"\",\n        \"Gang related:\": \"\",\n        \"Crossed out tag:\": \"\",\n        \"Type of property:\": \"\",\n        \"Vacant property:\": \"\",\n        \"Land bank property:\": \"\",\n        \"Surface:\": \"\",\n        \"Surface other:\": \"\",\n        \"Need other code enforcement?\": \"\",\n        \"Other code enforcement:\": \"\"\n    }\n\n    // note these options have to line up with what are in tagFields.js\n    // eg. 5 options here, 5 options there\n    // and these fields in general map with above by group\n    const nameValueMap = {\n        \"option-0\": \"dateOfPicture\",\n        \"option-1\": \"dateOfAbatement\",\n        \"option-2\": \"numberOfTags\",\n        \"option-3\": \"tagText\",\n        \"option-4\": \"smallTagText\",\n        \"option-5\": \"squareFootageCovered\",\n        \"option-6-0\": \"racialOrHateTone\",\n        \"option-6-1\": \"racialOrHateTone\",\n        \"option-6-2\": \"racialOrHateTone\",\n        \"option-7-0\": \"gangRelated\",\n        \"option-7-1\": \"gangRelated\",\n        \"option-7-2\": \"gangRelated\",\n        \"option-8-0\": \"crossedOutTag\",\n        \"option-8-1\": \"crossedOutTag\",\n        \"option-8-2\": \"crossedOutTag\",\n        \"option-9-0\": \"typeOfProperty\",\n        \"option-9-1\": \"typeOfProperty\",\n        \"option-9-2\": \"typeOfProperty\",\n        \"option-10-0\": \"vacantProperty\",\n        \"option-10-1\": \"vacantProperty\",\n        \"option-10-2\": \"vacantProperty\",\n        \"option-11-0\": \"landBankProperty\",\n        \"option-11-1\": \"landBankProperty\",\n        \"option-11-2\": \"landBankProperty\",\n        \"option-12-0\": \"surface\",\n        \"option-12-1\": \"surface\",\n        \"option-12-2\": \"surface\",\n        \"option-12-3\": \"surface\",\n        \"option-12-4\": \"surface\",\n        \"option-12-5\": \"surface\",\n        \"option-13-0\": \"otherSurface\",\n        \"option-14-0\": \"needOtherCodeEnforcement\",\n        \"option-14-1\": \"needOtherCodeEnforcement\",\n        \"option-14-2\": \"needOtherCodeEnforcement\",\n        \"option-14-3\": \"needOtherCodeEnforcement\",\n        \"option-14-4\": \"needOtherCodeEnforcement\",\n        \"option-15-0\": \"otherCodeEnforcement\"\n    };\n\n    const tagInfoInputElements = useRef(Object.keys(tagInfoFieldKeys).map(\n        // these are manually mapped based on tagFields.js not great, mainly for the nested inputs eg. radio/checkbox\n        (fieldKey) => {\n            const fieldType = tagInfoFields[fieldKey].type;\n            if (fieldType === \"input\" || fieldType === \"number\" || fieldType === \"date\") {\n                return createRef();\n            } else {\n                const subFields = tagInfoFields[fieldKey].options;\n\n                return {subRefs: \n                    Object.keys(subFields).map((subFieldKey) => {\n                        return createRef();\n                    })\n                };\n            }\n        }\n    ));\n\n    let updateDone = true; // bad\n\n    const updateTagInfo = async () => {\n        const offlineStorage = props.offlineStorage;\n        const mappedFieldValues = {}\n\n        tagInfoInputElements.current.forEach((element) => {\n            let elementType = \"\";\n\n            if (typeof element.current !== \"undefined\" && typeof element.current.type !== \"undefined\") {\n                elementType = element.current.type;\n            }\n\n            if (typeof element.subRefs !== \"undefined\" && Array.isArray(element.subRefs)) {\n                element.subRefs.forEach((subElement) => {\n                    mappedFieldValues[subElement.current.id] = subElement.current.checked;\n                });\n            } else if (elementType === \"text\" || elementType === \"number\" || elementType === \"date\") {\n                mappedFieldValues[element.current.name] = element.current.value;\n            } else {\n                mappedFieldValues[element.current.name] = element.current.checked;\n            }\n        });\n\n        if (updateDone) {\n            updateDone = false;\n            const existingTagInfoId = props.location.state.tagInfoId || tagInfoId; // first one has precedence\n\n            if (existingTagInfoId) {\n                offlineStorage.transaction('rw', offlineStorage.tagInfo, async() => {\n                    if (\n                        await offlineStorage.tagInfo.where(\":id\").equals(existingTagInfoId).modify({\n                            formData: mappedFieldValues\n                        }, props.location.state.addressId).then((insertedId) => {\n                            return true;\n                        })\n                    ) {\n                        setTagInfo(mappedFieldValues);\n                        updateDone = true;\n                    } else {\n                        alert('Failed to update tag information');\n                    }\n                })\n                .catch(e => {\n                    alert('Failed to update tag information');\n                    console.log('tag info', e);\n                });\n            } else {\n                const addressId = props.location.state.addressId;\n                const tagInfoId = await addNewTagInfo(addressId, offlineStorage, false, mappedFieldValues);\n                const eventId = await addNewEvent(tagInfoId, addressId, offlineStorage, formatTimeStr, getDateTime);\n                await updateTagInfoEventId(tagInfoId, eventId, offlineStorage);\n                setTagInfo(mappedFieldValues);\n                setTagInfoId(tagInfoId);\n            }\n        }\n    }\n\n    const generateInputType = (fieldGroup, mainIndex, field) => {\n        const fieldType = fieldGroup.type;\n\n        if (fieldType === \"input\") {\n            nameValueMap[`option-${mainIndex}`] = null;\n            return (\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"text\" disabled={ modifyTagInfo ? false : true } />\n            )\n        } else if (fieldType === \"number\") {\n            nameValueMap[`option-${mainIndex}`] = null;\n            return (\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } placeholder=\"0\" onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"number\" min=\"0\" disabled={ modifyTagInfo ? false : true } />\n            )\n        } else if (fieldType === \"date\") {\n            return (\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"date\" min={getDateTime('MM-DD-YYYY')} disabled={ modifyTagInfo ? false : true } />\n            )\n        } else if (fieldType === \"radio\" || fieldType === \"checkbox\") {\n            const optionKeys = Object.keys(fieldGroup.options);\n\n            if (optionKeys.length) {\n                // TODO: redundant code here\n                if (fieldType === \"checkbox\") {\n                    return (\n                        <div className=\"padding-left\">\n                            {\n                                optionKeys.map((optionKey, index) => {\n                                    return (\n                                        <span key={index} className=\"option-group\">\n                                            <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } onKeyUp={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex].subRefs[index]} id={`option-${mainIndex}-${index}`}\n                                                name={ `option-${mainIndex}-${index}`} type={ fieldType } disabled={ modifyTagInfo ? false : true } />\n                                            <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\n                                        </span>\n                                    )\n                                })\n                            }\n                        </div>\n                    )\n                } else {\n                    return optionKeys.map((optionKey, index) => {\n                        return (\n                            <span key={index} className=\"option-group\">\n                                <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } onKeyUp={ updateTagInfo } id={`option-${mainIndex}-${index}`} name={ nameValueMap[`option-${mainIndex}-${index}`]}\n                                    ref={tagInfoInputElements.current[mainIndex].subRefs[index]} type={ fieldType } disabled={ modifyTagInfo ? false : true } />\n                                <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\n                            </span>\n                        )\n                    });\n                }\n            }\n        } else {\n            return \"[unknown field type]\";\n        }\n    }\n\n    const getSpanClass = (fieldType) => {\n        if (fieldType === \"radio\") {\n            return \"option-group-label\";\n        }\n        if (fieldType === \"checkbox\") {\n            return \"full\";\n        } else {\n            return \"input-label\";\n        }\n    }\n\n    const modifyClassWrapper = (field) => {\n        if (\n            field === \"Type of property:\" ||\n            field === \"Vacant property:\" ||\n            field === \"Land bank property:\" ||\n            field === \"Tag text (separated by commas):\" ||\n            field === \"Small tag text (separated by commas):\" // super jank I know\n        ) {\n            return \" full-column-left\";\n        }\n\n        return \"\";\n    }\n\n    const renderTagInfo = () => {\n        return Object.keys(tagInfoFields).map((field, index) => {\n            return (\n                // bad\n                <div key={index} className={\"tag-info-field-row\" + (tagInfoFields[field].type === \"checkbox\" ? \" checkbox\" : \" box\") + modifyClassWrapper(field) }>\n                    <span className={ getSpanClass(tagInfoFields[field].type) }>{ field }</span>\n                    { generateInputType(tagInfoFields[field], index, field) }\n                </div>\n            )\n        });\n    };\n\n    // this loads tag info by id in local store(Dexie/IndexedDB)\n    useEffect(() => {\n        if (!tagInfo) {\n            const tagInfoId = props.location.state.tagInfoId;\n            const offlineStorage = props.offlineStorage;\n\n            if (tagInfoId && offlineStorage) {\n                offlineStorage.tagInfo.get(tagInfoId, (tagInfo) => {\n                    if (tagInfo) {\n                        setTagInfo(tagInfo.formData);\n                    }\n                }).catch (function (err) {\n                    alert('failed to load tagInfo');\n                    console.log('tag info', err);\n                });\n            }\n        }\n    }, [props, tagInfo]);\n\n    return(\n        <div className=\"tagging-tracker__tag-info\">\n            { renderTagInfo() }\n        </div>\n    )\n}\n\nexport default TagInfo;","import React, { createRef, useState, useRef, useEffect } from 'react';\nimport './OwnerInfo.scss';\n\nconst OwnerInfo = (props) => {\n    const [ownerInfo, setOwnerInfo] = useState(null);\n    // TODO: this will need to be reworked the striping in particular, it's just coincidence\n    // it works regarding the sub-group variant\n    // this is mapped to match the rendered input count regarding refs\n    // the name:value assigning comes from fieldKeys\n    const formLabels = [\n        \"Name\",\n        \"Phone\",\n        \"Email\",\n        \"Tenant Name\",\n        \"Tenant Contact Number\",\n        \"Waiver Completed\",\n        \"Need To Follow Up\",\n        {\n            \"Building Survey\": [\n                \"Would you continue service if you had to pay for it?\"\n            ]\n        }\n    ];\n\n    // from Dexie structure\n    const fieldKeys = [\n        \"name\",\n        \"phone\",\n        \"email\",\n        \"tenantName\",\n        \"tenantPhoneNumber\",\n        \"waiverCompleted\",\n        \"needFollowUp\",\n        \"buildingSurveyQuestionAnswer\"\n    ];\n\n    const inputElements = useRef(formLabels.map(() => createRef()));\n    let updateDone = true; // bad\n\n    const updateInfo = (inputValue) => {\n        // these match Dexie store\n        const offlineStorage = props.offlineStorage;\n        const ownerInfoValues = {\n            addressId: props.location.state.addressId,\n            formData: {}\n        };\n\n        if (inputValue) {\n            inputElements.current.forEach((input, index) => {\n                // this is terrible should have been part of way the content is generated so it's set in the input names\n                ownerInfoValues.formData[fieldKeys[index]] = input.current.value;\n            });\n        }\n\n        if (updateDone) {\n            updateDone = false;\n        \n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, async() => {\n \n                if (\n                    await offlineStorage.ownerInfo.put({\n                        addressId: ownerInfoValues.addressId,\n                        formData: {\n                            name: ownerInfoValues.formData.name,\n                            phone: ownerInfoValues.formData.phone,\n                            email: ownerInfoValues.formData.email,\n                            tenantName: ownerInfoValues.formData.tenantName,\n                            tenantPhoneNumber: ownerInfoValues.formData.tenantPhoneNumber,\n                            waiverCompleted: ownerInfoValues.formData.waiverCompleted,\n                            needFollowUp: ownerInfoValues.formData.needFollowUp,\n                            buildingSurveyQuestionAnswer: ownerInfoValues.formData.buildingSurveyQuestionAnswer\n                        }\n                    }, ownerInfoValues.addressId).then(() => {\n                        return true;\n                    })\n                ) {\n                    updateDone = true;\n                    setOwnerInfo(ownerInfoValues);\n                } else {\n                    alert('Failed to update owner information');\n                }\n            })\n            .catch(e => {\n                alert('Failed to update owner information');\n                console.log('owner info', e);\n            });\n        }\n    }\n\n    const renderOwnerInfoFormFields = () => {\n        return formLabels.map((formField, index) => {\n            const isString = typeof formField === \"string\";\n            return (isString\n                ? <div key={index} className=\"owner-info-form__row\">\n                        <span>{ formField }:</span>\n                        <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } onBlur={ (e) => updateInfo(e.target.value) } ref={inputElements.current[index]} type=\"text\" readOnly={ props.modifyOwnerInfo ? false : true } />\n                    </div>\n                : <div className=\"owner-info-form__row group\" key={index}>\n                    <div className=\"owner-info-form__row white\">\n                        <span>{ Object.keys(formField) }:</span>\n                    </div>\n                    {\n                        Object.keys(formField).map((subGroup, subGroupIndex) => {\n                            return (\n                                <div key={subGroupIndex} className=\"owner-info-form__sub-row\">\n                                    <span>{ formField[subGroup] }</span>\n                                    <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } id=\"target-me\" onChange={ updateInfo } ref={inputElements.current[index]} type=\"text\" className=\"full\" readOnly={ props.modifyOwnerInfo ? false : true } />\n                                </div>\n                            );\n                        })\n                    }\n                </div>\n            );\n        });\n    }\n\n    useEffect(() => {\n        // TODO again this code shouldn't be here but eslint\n        const getOwnerInfo = async () => {\n            const addressId = props.location.state.addressId;\n            const offlineStorage = props.offlineStorage;\n    \n            if (addressId && offlineStorage) {\n                await offlineStorage.ownerInfo.get(addressId, (ownerInfo) => {\n                    setOwnerInfo(ownerInfo);\n                }).catch (function (err) {\n                    // handle this failure correctly\n                    alert('failed to open local storage');\n                });\n            }\n        }\n\n        getOwnerInfo();\n    }, [props, ownerInfo]);\n\n    // TODO: fix the communication between navbar save and saving here so saving isn't based on onblur\n    // eg. get all fields at once one time, not every time you change inputs\n    // useEffect(() => {\n    //     // get all fields\n    // }, [props.modifyOwnerInfo]);\n\n    return(\n        <div className=\"tagging-tracker__owner-info\">\n            <div className=\"tagging-tracker__owner-info-form\">\n                { renderOwnerInfoFormFields() }\n            </div>\n        </div>\n    )\n}\n\nexport default OwnerInfo;","import axios from 'axios';\n\n/**\n * The sync works by a sync id, so a sync table keeps track of when a user synced\n * This sync id is used to find the synced rows throughout the tables which have the matching sync id\n * Using most recent for what to use for pulling down, then pushing up doesn't replace data\n * Just adds more, it is arguable that this is a waste/the same as just deleting stuff on remote side\n * But maybe a diff/look back is nice too in case you didn't want to delete something(address)\n * though currently not possible(no UI/methods)\n */\n\nconst getLocalAddresses = async (localStorage) => {\n    return new Promise(resolve => {\n        localStorage.addresses.toArray().then((addresses) => {\n            if (addresses.length) {\n                resolve(addresses);\n            } else {\n                resolve(false);\n            }\n        })\n        .catch((err) => {\n            console.log('sync addresses err', err);\n            resolve(false);\n        });\n    });\n}\n\nconst getEvents = async (localStorage) => {\n    return new Promise(resolve => {\n        localStorage.events.toArray().then((events) => {\n            if (events.length) {\n                resolve(events);\n            } else {\n                resolve(false);\n            }\n        })\n        .catch((err) => {\n            console.log('sync events err', err);\n            resolve(false);\n        });\n    });\n}\n\nconst getLocalTags = async (localStorage) => {\n    return new Promise(resolve => {\n        localStorage.tags.toArray().then((tags) => {\n            if (tags.length) {\n                resolve(tags);\n            } else {\n                resolve(false);\n            }\n        })\n        .catch((err) => {\n            console.log('sync tags err', err);\n            resolve(false);\n        });\n    });\n}\n\nconst getLocalOwnerInfo = async (localStorage) => {\n    return new Promise(resolve => {\n        localStorage.ownerInfo.toArray().then((ownerInfos) => {\n            if (ownerInfos.length) {\n                resolve(ownerInfos);\n            } else {\n                resolve(false);\n            }\n        })\n        .catch((err) => {\n            console.log('sync ownerInfo err', err);\n            resolve(false);\n        });\n    });\n}\n\nconst getTagInfo = async (localStorage) => {\n    return new Promise(resolve => {\n        localStorage.tagInfo.toArray().then((tagInfos) => {\n            if (tagInfos.length) {\n                resolve(tagInfos);\n            } else {\n                resolve(false);\n            }\n        })\n        .catch((err) => {\n            console.log('sync tagInfos err', err);\n            resolve(false);\n        });\n    });\n}\n\nconst bundleData = async (props) => {\n    const localStorage = props.offlineStorage;\n    const bundledData = {};\n\n    return new Promise(resolve => {\n        // addresses\n        localStorage.addresses.count().then(async (count) => {\n            if (count > 0) {\n                const addresses = await getLocalAddresses(localStorage);\n                const events = await getEvents(localStorage);\n                const tags = await getLocalTags(localStorage);\n                const ownerInfo = await getLocalOwnerInfo(localStorage);\n                const tagInfo = await getTagInfo(localStorage);\n                const deletedAddresses = props.deletedAddresses;\n\n                if (addresses) {\n                    bundledData['addresses'] = addresses;\n                }\n\n                if (events) {\n                    bundledData['events'] = events;\n                }\n\n                if (tags) {\n                    bundledData['tags'] = tags;\n                }\n\n                if (ownerInfo) {\n                    bundledData['ownerInfo'] = ownerInfo;\n                }\n\n                if (tagInfo) {\n                    bundledData['tagInfo'] = tagInfo;\n                }\n\n                if (deletedAddresses) {\n                    bundledData['deletedAddresses'] = deletedAddresses;\n                }\n\n                resolve(bundledData);\n            } else {\n                resolve(bundledData);\n            }\n        })\n        .catch((err) => {\n            console.timeLog('sync bundle data err', err);\n            resolve(false);\n        });\n    });\n}\n\nexport const syncUp = async (props) => {\n    const bundledData = await bundleData(props);\n\n    return new Promise(resolve => {\n        if ((Object.keys(bundledData).length === 0 || !bundledData) && !props.deletedAddresses.length) {\n            resolve({msg: 'No data to sync'});\n        } else {\n            // sync to remote server\n            const baseApiPath = window.location.href.indexOf('localhost') !== -1\n                ? process.env.REACT_APP_API_BASE_LOCAL\n                : process.env.REACT_APP_API_BASE;\n            const postUrl = baseApiPath + '/sync-up';\n\n            axios.post(postUrl, {\n                headers: { Authorization: `Bearer ${props.token}` },\n                bundledData\n            }).then((res) => {\n                if (res.status === 200 || res.status === 201) {\n                    resolve(true);\n                } else {\n                    if (res.status === 403) {\n                        alert(\"Your session has expired, please login again\");\n                        window.location.href = \"/login\"; // flush app state\n                    } else {\n                        resolve(false);\n                    }\n                }\n            })\n            .catch((err) => {\n                console.log('sync err', err);\n                console.log(err.response);\n\n                if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\n                    resolve({msg: 403});\n                }\n\n                resolve(false);\n            });\n        }\n    });\n}","import axios from 'axios';\n\nexport const syncDown = (props) => {\n    return new Promise(resolve => {\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\n            ? process.env.REACT_APP_API_BASE_LOCAL\n            : process.env.REACT_APP_API_BASE;\n        const postUrl = baseApiPath + '/sync-down';\n\n        axios.post(postUrl, {\n            headers: { Authorization: `Bearer ${props.token}` }\n        }).then((res) => {\n            if (res.status === 200) {\n                resolve(res.data);\n            } else {\n                if (res.status === 403) {\n                    alert(\"Your session has expired, please login again\");\n                    window.location.href = \"/login\"; // flush app state\n                } else {\n                    resolve(false);\n                }\n            }\n        })\n        .catch((err) => {\n            console.log('sync err', err);\n            \n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\n                resolve({msg: 403});\n            }\n\n            resolve(false);\n        });\n    });\n}","import { syncUp } from './syncUp';\nimport { syncDown } from './syncDown';\nimport { formatTimeStr } from '../../utils/date';\n\nconst isLocalStorageEmpty = async (props) => {\n    const localStorage = props.offlineStorage;\n\n    if (!localStorage) {\n        return;\n    }\n\n    // you should only have to check addresses because every other table is tied to an address\n    // so an address has to exist before you can add photos/owner/tag info\n    return new Promise(resolve => {\n        localStorage.addresses.count().then((count) => {\n            if ((props.deletedAddresses && props.deletedAddresses.length) || count > 0) {\n                resolve(false);\n            } else {\n                resolve(true);\n            }\n        })\n        .catch((err) => {\n            console.log('sync addresses err', err);\n            resolve(true); // technically could be an error not empty\n        });\n    });\n}\n\nexport const syncUserData = async (props) => {\n    const localStorageEmpty = await isLocalStorageEmpty(props);\n    if (localStorageEmpty) {\n        // pull down\n        const bundledData = await syncDown(props);\n        if (bundledData) {\n            updateLocalStorageFromSync(props, bundledData);\n            return true;\n        } else {\n            return({msg: 'No data to sync'});\n        }\n    } else {\n        // push up\n        return await syncUp(props);\n    }\n}\n\nconst updateLocalAddresses = (props, remoteData) => {\n    const offlineStorage = props.offlineStorage;\n    return new Promise(resolve => {\n\n        if (!remoteData.addresses) {\n            resolve(true);\n        }\n\n        remoteData.addresses.forEach((addressRow, index) => {\n            offlineStorage.transaction('rw', offlineStorage.addresses, () => {\n                if (\n                    offlineStorage.addresses.add({\n                        address: addressRow.address,\n                        lat: addressRow.lat,\n                        lng: addressRow.lng,\n                        created: addressRow.created,\n                        updated: addressRow.updated\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === remoteData.addresses.length - 1) {\n                        resolve(true);\n                    }\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch(e => {\n                resolve(false);\n            });\n        });\n    });\n}\n\nconst updateLocalEvents = (props, remoteData) => {\n    const offlineStorage = props.offlineStorage;\n    return new Promise(resolve => {\n        if (!remoteData.events) {\n            resolve(true);\n        }\n\n        remoteData.events.forEach((eventRow, index) => {\n            offlineStorage.transaction('rw', offlineStorage.events, () => {\n                if (\n                    offlineStorage.events.add({\n                        addressId: eventRow.address_id,\n                        tagInfoId: eventRow.tag_info_id,\n                        tagIds: JSON.parse(eventRow.tag_ids),\n                        datetime: formatTimeStr(eventRow.date_time)\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === remoteData.events.length - 1) {\n                        resolve(true);\n                    }\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch(e => {\n                resolve(false);\n            });\n        });\n    });\n}\n\nconst updateLocalTags = (props, remoteData) => {\n    const offlineStorage = props.offlineStorage;\n    return new Promise(resolve => {\n        if (!remoteData.tags) {\n            resolve(true);\n        }\n\n        remoteData.tags.forEach((tagRow, index) => {\n            offlineStorage.transaction('rw', offlineStorage.tags, () => {\n                const tagMeta = JSON.parse(tagRow.meta);\n                if (\n                    offlineStorage.tags.add({\n                        addressId: tagRow.address_id,\n                        eventId: tagRow.event_id,\n                        fileName: tagRow.filename,\n                        thumbnail_src: tagRow.thumbnail_src,\n                        meta: tagMeta,\n                        datetime: tagRow.datetime\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === remoteData.tags.length - 1) {\n                        resolve(true);\n                    }\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch(e => {\n                resolve(false);\n            });\n        });\n    });\n}\n\nconst updateLocalOwnerInfo = (props, remoteData) => {\n    const offlineStorage = props.offlineStorage;\n    return new Promise(resolve => {\n        if (!remoteData.ownerInfo) {\n            resolve(true);\n        }\n\n        remoteData.ownerInfo.forEach((ownerInfoRow, index) => {\n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, () => {\n                if (\n                    offlineStorage.ownerInfo.add({\n                        addressId: ownerInfoRow.address_id,\n                        formData: JSON.parse(ownerInfoRow.form_data)\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === remoteData.ownerInfo.length - 1) {\n                        resolve(true);\n                    }\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch(e => {\n                resolve(false);\n            });\n        });\n    });\n}\n\nconst updateLocalTagInfo = (props, remoteData) => {\n    const offlineStorage = props.offlineStorage;\n    return new Promise(resolve => {\n        if (!remoteData.tagInfo) {\n            resolve(true);\n        }\n\n        remoteData.tagInfo.forEach((tagInfoRow, index) => {\n            offlineStorage.transaction('rw', offlineStorage.tagInfo, () => {\n                if (\n                    offlineStorage.tagInfo.add({\n                        addressId: tagInfoRow.address_id,\n                        eventId: tagInfoRow.event_id,\n                        formData: JSON.parse(tagInfoRow.form_data)\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === remoteData.tagInfo.length - 1) {\n                        resolve(true);\n                    }\n                } else {\n                    resolve(false);\n                }\n            })\n            .catch(e => {\n                resolve(false);\n            });\n        });\n    });\n}\n\nexport const updateLocalStorageFromSync = async (props, remoteData) => {\n    let noUpdateErr = true;\n    noUpdateErr = await updateLocalAddresses(props, remoteData); // these if successful/not empty return true\n    noUpdateErr = await updateLocalEvents(props, remoteData);\n    noUpdateErr = await updateLocalTags(props, remoteData);\n    noUpdateErr = await updateLocalOwnerInfo(props, remoteData);\n    noUpdateErr = await updateLocalTagInfo(props, remoteData);\n\n    if (noUpdateErr) {\n        return true;\n    } else {\n        return false;\n    }\n}\n\n// TODO: actually this probably shouldn't be here\n\n// this will only delete Dexie for now, need to figure out about caching static files/service workers\n// primarily this is for sync so you pull down after logging out\nexport const deleteLocalData = (offlineStorage) => {\n    return new Promise(resolve => {\n        offlineStorage.delete().then(() => {\n            resolve(true);\n        })\n        .catch((err) => {\n            resolve(false);\n        })\n    });\n}","import React, { useRef, useEffect, useState } from 'react';\nimport { Link, useHistory } from 'react-router-dom';\nimport './BottomNavbar.scss';\nimport { deleteEvent } from '../../utils/delete'; // probably bad to do this, add delete logic to a navbar should be global\n\nimport syncIcon from './../../assets/icons/svgs/upload.svg';\nimport logoutIcon from './../../assets/icons/svgs/switch.svg';\nimport property from './../../assets/icons/svgs/property.svg';\nimport textDocument from './../../assets/icons/svgs/text-document.svg';\nimport calendar from './../../assets/icons/svgs/calendar.svg';\nimport addSquare from './../../assets/icons/svgs/add-square.svg';\nimport deleteIcon from './../../assets/icons/svgs/delete.svg';\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\nimport ajaxLoaderBlue from './../../assets/gifs/ajax-loader--blue.gif';\nimport edit from './../../assets/icons/svgs/pencil.svg';\nimport photo from './../../assets/icons/svgs/photo.svg';\n\nimport { syncUserData, deleteLocalData } from '../../utils/sync/sync';\nimport { checkIOS } from '../../utils/misc';\n\nconst BottomNavbar = (props) => {\n    const syncBtn = useRef(null);\n    const logoutBtn = useRef(null);\n    const cameraBtn = useRef(null);\n    const uploadBtn = useRef(null);\n    const history = useHistory();\n    const { token } = props;\n\n    const [deletingEvent, setDeletingEvent] = useState(false);\n\n    const logout = async () => {\n        props.updateLoggingOut(true);\n        const localStorageCleared = await deleteLocalData(props.offlineStorage);\n        if (!localStorageCleared) {\n            alert('failed to clear local data');\n        }\n        window.location.href = \"/\"; // token is wiped out as it's set by state not in storage\n    }\n\n    const saveToDevice = () => {\n        props.saveToDevice();\n    }\n\n    // this probably shouldn't be here but just an initializer\n    const sync = async () => {\n        if (!props.appOnline) { // shouldn't be needed disabled buttons\n            alert('Unable to sync, you are offline');\n            return;\n        }\n\n        if (!props.token) {\n            history.push(\"/login\");\n            return;\n        }\n\n        if (!props.syncApp) {\n            props.setSyncApp(true);\n            const synced = await syncUserData(props);\n\n            if (Object.keys(synced).length) {\n                if (synced.msg !== \"undefined\") {\n                    if (synced.msg === 403) {\n                        alert('You have been logged out, please login to sync');\n                    } else {\n                        alert(synced.msg);\n                    }\n                }\n            } else if (synced) {\n                // synced\n            } else {\n                alert('Failed to sync');\n            }\n\n            props.setSyncApp(false);\n        }\n    }\n\n    const uploadImages = () => {\n        if (!props.appOnline) {\n            alert('Unable to upload, you are offline');\n            return;\n        }\n\n        if (!props.token) {\n            const loginDecision = window.confirm('You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.');\n            if (loginDecision) {\n                history.push(\"/login\");\n            }\n            return;\n        }\n\n        props.triggerFileUpload(true);\n    }\n\n    // this is for Safari, since the prop method that is propagated up into AddTag\n    // doesn't work in Safari \"not a direct action by user\" file input wasn't working\n    const directCameraClick = () => {\n        document.getElementById('add-tag-file-input').click();\n    }\n\n    // bad naming\n    const confirmDeleteEvent = ( eventTitle, addressId, tagInfoId, callback ) => {\n        const shouldDeleteEvent = window.confirm(\"Delete \" + eventTitle + \" ?\");\n        if (shouldDeleteEvent) {\n            setDeletingEvent(true);\n            deleteEvent(props.offlineStorage, addressId, tagInfoId, callback);\n        }\n    }\n\n    // this is only here because callback doesn't have params\n    const doneDeletingEvent = (remainingEvents) => {\n        setDeletingEvent(false);\n        history.push({\n            pathname: \"/events\",\n            state: {\n                ...props.location.state,\n                remainingEvents\n            }\n        });\n    }\n\n    const renderBottomNavbar = (routeLocation) => {\n        const address = props.location.state;\n        const routePath =  props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\n        const tagInfoPath = props.location.pathname === \"/tag-info\";\n        const eventsPath = props.location.pathname === \"/events\";\n        const tagsPath = props.location.pathname === \"/event-tags\";\n        const eventTagsPath = props.location.pathname === \"/event-tags\";\n\n        switch(routePath) {\n            case \"/\":\n            case \"/addresses\":\n                return <>\n                    <button onClick= { sync } ref={ syncBtn } className=\"bottom-navbar__btn half sync\"\n                    type=\"button\" disabled={ props.appOnline ? false : true }>\n                        {props.syncApp\n                            ? <>\n                                <span>Syncing...</span>\n                                <img src={ ajaxLoaderGray } alt=\"syncing spinner\" />\n                            </>\n                            : <>\n                                { token ? <img src={ syncIcon } alt=\"sync button icon\" /> : null }\n                                <span>{ token ? \"Sync\" : \"Login\" }</span>\n                            </>\n                        }\n                    </button>\n                    {token ? <button ref={ logoutBtn } onClick={ logout } className=\"bottom-navbar__btn half\" type=\"button\">\n                        {props.loggingOut\n                            ? <>\n                                <span>Logging out...</span>\n                                <img src={ ajaxLoaderGray } alt=\"logging out spinner\" />\n                            </>\n                            : <>\n                                <img src={ logoutIcon } alt=\"logout button icon\" />\n                                <span>Logout</span>\n                            </>\n                        }\n                    </button> : null}\n                    \n                </>\n            case \"/view-address\":\n            case \"/edit-tags\":\n                return <>\n                    <Link\n                        to={{ pathname: \"/owner-info\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className=\"bottom-navbar__btn fourth\">\n                        <img src={ property } alt=\"home owner button icon\" />\n                        <span>Owner Info</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/events\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className=\"bottom-navbar__btn fourth\">\n                        <img src={ edit } alt=\"edit event button icon\" />\n                        <span>Edit Event</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/tag-info\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className=\"bottom-navbar__btn fourth\">\n                        <img src={ addSquare } alt=\"add event button icon\" />\n                        <span>Add Event</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/add-tag\", state: {\n                            address: address.address,\n                            addressId: address.addressId,\n                            tagInfoId: routeLocation.state.tagInfoId\n                        }}}\n                        className=\"bottom-navbar__btn fourth\">\n                        <img src={ addSquare } alt=\"add tag icon\" />\n                        <span>Add Tag</span>\n                    </Link>\n                </>\n            case \"/add-tag\":\n                return <>\n                    <button ref={ cameraBtn } onClick={ directCameraClick } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\">\n                        <span>Camera</span>\n                    </button>\n                    <button ref={ uploadBtn } onClick={ uploadImages } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\" disabled={ props.loadedPhotos.length ? false : true }>\n                        {props.uploadInProgress\n                            ? <>\n                                <span>Uploading...</span>\n                                <img src={ ajaxLoaderBlue } alt=\"uploading spinner\" />\n                            </>\n                            : <>\n                                <span>Upload</span>\n                            </>\n                        }\n                    </button>\n                    <button onClick={ saveToDevice }\n                        className=\"bottom-navbar__btn quarter caps-blue border small-font\"\n                        type=\"button\"\n                        disabled={ (props.savingToDevice || !props.loadedPhotos.length) ? true : false }>\n                            {props.savingToDevice\n                                ? <>\n                                    <span>Saving...</span>\n                                    <img src={ ajaxLoaderBlue } alt=\"saving spinner\" />\n                                </>\n                                : <>\n                                    <span>On Device</span>\n                                </>\n                            }\n                    </button>\n                    <Link\n                        to={{ pathname: \"/event-tags\", state: {\n                            address: address.address,\n                            addressId: address.addressId,\n                            tagInfoId: routeLocation.state.tagInfoId\n                        }}}\n                        className=\"bottom-navbar__btn quarter caps-blue small-font\">\n                            <span>Cancel</span>\n                    </Link>\n                </>\n            case \"/events\":\n                return <>\n                    <Link\n                        to={{ pathname: \"/owner-info\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className={\"bottom-navbar__btn toggled third \" + (!(tagInfoPath || eventsPath) ? \"active\" : \"\") }>\n                            <img src={ property } alt=\"home owner button icon\" />\n                            <span>Owner Info</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/tag-info\", state: {\n                                address: address.address,\n                                addressId: address.addressId // used for lookup\n                        }}}\n                        className={ \"bottom-navbar__btn toggled third \" + (!(eventsPath || tagInfoPath) ? \"active\" : \"\") }>\n                        <img src={ addSquare } alt=\"add event button icon\" />\n                        <span>Add Event</span>\n                    </Link>\n                </>\n            case\"/event-tags\":\n            case\"/tag-info\":\n                const eventTitle = props.location.state.eventTitle;\n                const tagInfoId = props.location.state.tagInfoId;\n                return <>\n                    <button\n                        onClick= { () => confirmDeleteEvent(eventTitle, address.addressId, tagInfoId, doneDeletingEvent) }\n                        ref={ syncBtn }\n                        className=\"bottom-navbar__btn fourth\"\n                        type=\"button\"\n                        disabled={ tagInfoId ? false : true }>\n                        {deletingEvent\n                            ? <>\n                                <span>Deleting...</span>\n                                <img src={ ajaxLoaderGray } alt=\"deleting event spinner\" />\n                            </>\n                            : <>\n                                <img src={ deleteIcon } alt=\"delete button icon\" />\n                                <span>Delete</span>\n                            </>\n                        }\n                    </button>\n                    <Link\n                        to={{ pathname: \"/tag-info\", state: {\n                            address: address.address,\n                            addressId: address.addressId, // used for lookup\n                            tagInfoId: props.location.state.tagInfoId,\n                            eventTitle\n                        }}}\n                        className={\"bottom-navbar__btn fourth \" + (tagInfoPath ? \"active\" : \"\")}>\n                        <img src={ textDocument } alt=\"tag info button icon\" />\n                        <span>Info</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/event-tags\", state: {\n                            address: address.address,\n                            addressId: address.addressId, // used for lookup\n                            tagInfoId, // unique per event\n                            eventTitle\n                        }}}\n                        className={\"bottom-navbar__btn fourth \" + (eventTagsPath ? \"active\" : \"\") + (tagInfoId ? \"\" : \"disabled\")}\n                        disabled={ tagInfoId ? false : true }>\n                            <img src={ photo } alt=\"events button icon\" />\n                            <span>Tags</span>\n                    </Link>\n                    <Link\n                        to={{ pathname: \"/add-tag\", state: {\n                            address: address.address,\n                            addressId: address.addressId, // used for lookup\n                            tagInfoId, // unique per event\n                            eventTitle\n                        }}}\n                        className={\"bottom-navbar__btn fourth \"  + (tagInfoId ? \"\" : \"disabled\")}>\n                        <img src={ addSquare } alt=\"add tag icon\" />\n                        <span>Add Tag</span>\n                    </Link>\n                </>\n            default:\n                return null;\n        }\n    }\n\n    const getBottomNavbarClasses = () => {\n        const floatingBtnPaths = [\n            \"/owner-info\"\n        ];\n\n        const floatingBtns = floatingBtnPaths.indexOf(props.location.pathname) !== -1;\n\n        if (floatingBtns) {\n            return \"tagging-tracker__bottom-navbar floating-btns\";\n        }\n\n        return \"tagging-tracker__bottom-navbar\";\n    }\n\n    // disabling scaling need to test on iOS\n    useEffect(() => {\n        checkIOS();\n    });\n\n    return(\n        <div className={ getBottomNavbarClasses() }>\n            { renderBottomNavbar(props.location) }\n        </div>\n    )\n}\n\nexport default BottomNavbar;","import React from 'react';\nimport { Link } from 'react-router-dom';\nimport './Page404.scss';\n\nconst Page404 = (props) => {\n    return (\n        <div className=\"tagging-tracker__page-404\">\n            <h2>You've entered an invalid path</h2>\n            <p>Try the page(s) below to return to the app</p>\n            <Link to=\"/\">Login</Link>\n        </div>\n    )\n}\n\nexport default Page404;","import React, { useRef, useState, useEffect } from 'react';\nimport './AddTag.scss';\nimport BottomNavbar from './../../components/bottom-navbar/BottomNavbar';\nimport axios from 'axios';\nimport { getDateTime, formatTimeStr } from './../../utils/date';\nimport { getTagInfoObjById } from './../events/eventUtils';\n\n/**\n * Brief explanation how this works it's kind of confusing since everything is a callback of a callback\n * The bottomNavbar starts it off by setting loadCamera to true\n * Then that clicks on fileInput which if a device has a camera prompts to open the camera or show file upload(pc)\n * Then when the fileInput changes, cameraCallback is called and the previewPhoto function is called\n * That actually renders it on page, then when the rendered image load, it has a callback to update image meta eg. width/height\n * which can only be taken from a loaded <img />\n * I'm going to resize the photo with canvas for the thumbnail and potentially save storage by capping files\n * @param {*} props \n */\n\n// bad quick hack\nlet eventId = null;\n\n// create function which returns resolved promise\n// with data:base64 string\nfunction getBase64(file) {\n    const reader = new FileReader();\n\n    return new Promise(resolve => {\n        reader.onload = ev => {\n            resolve(ev.target.result);\n        };\n\n        reader.readAsDataURL(file);\n    });\n}\n\n// Taken from here: https://stackoverflow.com/a/54559514/3341620\nasync function fileListToBase64(fileList) {\n    // here will be array of promisified functions\n    const promises = [];\n\n    // loop through fileList with for loop\n    for (let i = 0, len = fileList.length; i < len; i++) {\n        promises.push(getBase64(fileList[i]));\n    }\n\n    // array with base64 strings\n    return await Promise.all(promises);\n}\n\nconst AddTag = (props) => {\n    const fileInput = useRef(null);\n    const [loadCamera, triggerLoadCamera] = useState(false);\n    const [fileUpload, triggerFileUpload] = useState(false);\n    const [loadedPhotos, setLoadedPhotos] = useState([]);\n    const [savingToDevice, setSavingToDevice] = useState(false);\n    const [uploadInProgress, setUploadInProgress] = useState(false);\n\n    // https://hacks.mozilla.org/2011/01/how-to-develop-a-html5-image-uploader/\n    const scaleImage = (resolve, img) => {\n        // figure out canvas height based on desired resize dimensions\n        let newImageWidth = 300;\n        let newImageHeight = 300;\n\n        if (img.width / img.height >= 1) {\n            newImageHeight = ((newImageWidth * img.height) / img.width); // round?\n        } else {\n            newImageWidth = ((newImageHeight * img.width) / img.height); // round?\n        }\n        \n        const canvas = document.createElement(\"canvas\");\n        canvas.id = \"resize-canvas\";\n        const ctx = canvas.getContext(\"2d\");\n        canvas.width = newImageWidth;\n        canvas.height = newImageHeight;\n        ctx.drawImage(img, 0, 0, newImageWidth, newImageHeight);\n        resolve(canvas.toDataURL(\"image/png\"));\n        // fail case?\n    }\n\n    const createThumbnailSrc = (src) => {\n        return new Promise((resolve, reject) => {\n            const img = new Image();\n            img.src = src;\n\n            img.onload = () => {\n                if (img.width <= 300) {\n                    resolve(src);\n                }\n                scaleImage(resolve, img);\n            };\n\n            img.onerror = (err) => {\n                reject(err);\n            }\n        });\n    }\n\n    const saveToDevice = async () => {\n        setSavingToDevice(true);\n\n        const offlineStorage = props.offlineStorage;\n        const address = props.location.state;     \n\n        // not going to add duplicate logic here because you can delete them somewhere else\n        // the loaded photos are deleted after upload so duplicate issue doesn't happen unless the file is selected again\n        for (let i = 0; i < loadedPhotos.length; i++) {\n            const loadedPhoto = loadedPhotos[i];\n            const index = i;\n            const thumbnailSrc = await createThumbnailSrc(loadedPhoto.src);\n            const oldCanvas = document.getElementById('resize-canvas');\n            if (oldCanvas) {\n                oldCanvas.remove();\n            }\n\n            offlineStorage.transaction('rw', offlineStorage.tags, async () => {\n                if (\n                    await offlineStorage.tags.add({\n                        eventId,\n                        addressId: address.addressId,\n                        fileName: loadedPhoto.meta.name,\n                        src: loadedPhoto.src,\n                        thumbnail_src: thumbnailSrc,\n                        meta: loadedPhoto.meta,\n                        datetime: formatTimeStr(getDateTime()) // makes YYYY-MM-DD HH:MM:SS format for MySQL DateTime\n                    }).then((insertedId) => {\n                        return true;\n                    })\n                ) {\n                    if (index === loadedPhotos.length - 1) {\n                        alert('Photos saved');\n                        setLoadedPhotos([]);\n                        setSavingToDevice(false);\n                    }\n                } else {\n                    alert('Failed to save photos to device');\n                }\n            })\n            .catch(e => {\n                console.log('failed to save photos', e);\n                alert('Failed to save photos to device');\n            });\n        }\n    }\n\n    const uploadImages = () => {\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\n            ? process.env.REACT_APP_API_BASE_LOCAL\n            : process.env.REACT_APP_API_BASE;\n        const postUrl = baseApiPath + '/upload-tag';\n        \n        axios.post(postUrl, {\n            headers: { Authorization: `Bearer ${props.token}` },\n            images: loadedPhotos\n        }).then((res) => {\n            if (res.status === 200) {\n                saveToDevice(); // because don't want to bridge remote sync from upload here\n            } else {\n                if (res.status === 403) {\n                    alert(\"Your session has expired, please login again\");\n                    window.location.href = \"/login\"; // flush app state\n                } else {\n                    alert('Failed to upload');\n                }\n            }\n            triggerFileUpload(false);\n            setUploadInProgress(false);\n        })\n        .catch((err) => {\n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\n                alert('You have been logged out, please log back in to upload.');\n                window.location.href = \"/login\"; // flush app state\n            } else {\n                console.log('upload err', err);\n                triggerFileUpload(false);\n                setUploadInProgress(false);\n            }\n        });\n    }\n\n    // Step 2: when file input changes, check if file/photo selected\n    const cameraCallback = (fileInput) => {\n        if (fileInput.files.length) {\n\t\t\tpreviewPhotos(fileInput);\n\t\t} else {\n            alert('No image selected');\n        }\n    }\n\n    // Step 3: read the photo and get src plus other data like size\n    const previewPhotos = async (fileInput) => {\n        const files = fileInput.files; // I guess multi-select upload is special, I tried it doesn't work with current code\n        const filesLength = files.length;\n\n        const base64s = await fileListToBase64(files);\n\n        const newLoadedPhotos = [];\n\n        const maxFileSize = 16_000_000;\n\n        for (let i = 0; i < filesLength; i++) {\n            const currentFile = files[i];\n\n            if (currentFile.size >= maxFileSize) {\n                alert(\"Selected file \\\"\" + currentFile.name + \"\\\" is too large, must be smaller than 16mb\");\n                continue;\n            }\n\n            newLoadedPhotos.push({\n                addressId: props.location.state.addressId,\n                fileName: currentFile.name,\n                src: base64s[i],\n                thumbanil_src: \"\",\n                meta: {\n                    name: currentFile.name,\n                    size: currentFile.size\n                }\n            });\n        }\n\n        setLoadedPhotos(loadedPhotos.concat(newLoadedPhotos));\n    }\n\n    // Step 4: this runs anytime the page loads but when photos are available they will get rendered as <img />\n    const renderPhotoPreviews = () => {\n        return loadedPhotos.map((loadedPhoto, index) => {\n            return (\n                <div style={{\n                    backgroundImage: 'url(' + loadedPhoto.src + ')'\n                }} key={index} className=\"tagging-tracker__address-tag\" >\n                    <img alt={ loadedPhoto.meta.name } src={loadedPhoto.src} onLoad={ (e) => setLoadedImageMeta(e.target, index) } />\n                </div>\n            )\n        })\n    }\n\n    // Step 5: this is a callback when the new <img />'s load to get additional meta\n    // the meta's collected in different stages, the file itself(previewPhoto) has the name, size\n    // the image that loads has the width/height\n    const setLoadedImageMeta = (loadedImage, loopIndex) => {\n        const loadedPhotosClone = loadedPhotos;\n\t\tloadedPhotos.filter((loadedPhoto, index) => { // eslint-disable-line\n            if (loopIndex === index && typeof loadedPhotos[index].meta.width === \"undefined\") {\n                loadedPhotosClone[index].meta['width'] = loadedImage.width;\n                loadedPhotosClone[index].meta['height'] = loadedImage.height;\n                setLoadedPhotos(loadedPhotosClone);\n            }\n        });\n    }\n\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\n        eventId = tagInfoObj ? tagInfoObj.eventId : null;\n    }\n\n    // set eventId so tags are saved against that in new structure not just saved under address\n    useEffect(() => {\n        if (props.offlineStorage && props.location.state.tagInfoId) {\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\n        }\n    }, [props.location.state.tagInfoId, props.offlineStorage]);\n\n    // Step 1: Click on file input when clicking on Use Camera button\n    useEffect(() => {\n        if (loadCamera) {\n            // handled in BottomNavbar directly\n        } else {\n            triggerLoadCamera(false);\n        }\n    }, [loadCamera]);\n\n    // callback to toggle/make Use Camera useable again\n    useEffect(() => {\n        triggerLoadCamera(false);\n    }, [loadedPhotos]);\n\n    useEffect(() => {\n        if (fileUpload && !uploadInProgress) {\n            setUploadInProgress(true);\n            uploadImages();\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [fileUpload, uploadInProgress]); // TODO ugly fix above, eslint disable but not trying to put the upload code in here\n\n    // TODO this is not staying eg. ugly flash\n    useEffect(() => {\n        props.setBodyClass(\"tagging-tracker__body increase-height\");\n    }, [props]);\n\n    return (\n        <>\n            <div className=\"tagging-tracker__add-tag move-bottom-navbar-down\">\n                <input type=\"file\" ref={fileInput} name=\"image\" onChange={ () => { cameraCallback(fileInput.current) } } id=\"add-tag-file-input\" multiple />\n                { renderPhotoPreviews() }\n            </div>\n            <BottomNavbar\n                {...props}\n                triggerLoadCamera={triggerLoadCamera}\n                loadCamera={loadCamera}\n                triggerFileUpload={triggerFileUpload}\n                fileUpload={fileUpload}\n                saveToDevice={saveToDevice}\n                savingToDevice={savingToDevice}\n                uploadInProgress={uploadInProgress}\n                setUploadInProgress={setUploadInProgress}\n                loadedPhotos={loadedPhotos}\n                appOnline={props.appOnline}\n                token={props.token}\n            />\n        </>\n    );\n}\n\nexport default AddTag;","import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport './EditTags.scss';\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\nimport closeIcon from './../../assets/icons/svgs/close.svg';\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\nimport { truncateText } from '../../utils/misc';\nimport { getTagInfoObjById } from './../events/eventUtils';\n\n// TODO this is bad but poor design\nlet fileNameOfImageToDelete;\n\nconst EditTags = (props) => {\n    const offlineStorage = props.offlineStorage;\n    const history = useHistory();\n    const [localImages, setLocalImages] = useState(null);\n    const [deletePrompt, toggleDeletePrompt] = useState(false);\n    const [deleteInProgress, setDeleteInProgress] = useState(false); // eslint-disable-line\n    const [eventId, setEventId] = useState(null);\n    \n    if (typeof props.location.state === \"undefined\") {\n        history.push(\"/addresses\");\n    }\n\n    const deleteImage = (addressId, fileName) => {\n        offlineStorage.transaction('rw', offlineStorage.tags, () => {\n            if (\n                offlineStorage.tags.where(\"addressId\").equals(addressId).toArray()\n                    .then((images) => {\n                        images.some((image) => { // eslint-disable-line\n                            if (image.fileName && fileName === image.fileName) {\n                                offlineStorage.tags.where(\"fileName\").equals(fileName).delete().then((deleteCount) => {\n                                    if (deleteCount) {\n                                        offlineStorage.tags\n                                            .where(\"addressId\").equals(props.location.state.addressId)\n                                            .toArray().then((tags) => {\n                                                setLocalImages(tags);\n                                            });\n                                    }\n                                })\n                            }\n                        })\n                    })\n                    .catch((e) => {\n                        console.log('deleted tag', e);\n                        return false;\n                    })\n            ) {\n                setDeleteInProgress(true);\n            } else {\n                alert('Failed to delete tag');\n            }\n        })\n        .catch(e => {\n            alert('Failed to delete tag');\n            console.log('delete tag', e);\n        });\n    }\n\n    const showDeletePrompt = (fileName) => {\n        fileNameOfImageToDelete = fileName;\n        toggleDeletePrompt(true);\n    }\n\n    const renderDeletePrompt = (addressId, fileName) => {\n        return (\n            <div className={\"tagging-tracker__edit-tags-delete-prompt\" + (deletePrompt ? \"\" : \" hidden\")}>\n                <h4>Delete Tag {truncateText(fileName,40,true)}</h4>\n                <p>This will delete all information and photos of the tag</p>\n                <div className=\"edit-tags-delete-prompt__delete-btns\">\n                    <button onClick={() => { deleteImage(addressId, fileName) }} className=\"delete-btns__delete\" type=\"button\">Delete</button>\n                    <button onClick={() => { toggleDeletePrompt(false) }} className=\"delete-btns__cancel\" type=\"button\">Cancel</button>\n                </div>\n            </div>\n        )\n    }\n\n    const renderTags = () => {\n        const tagInfoId = typeof props.location.state.tagInfoId !== \"undefined\";\n\n        // if tagInfoId exists filter the pictures out\n        // have to save the pictures with tagInfoId first\n\n        if (offlineStorage && !localImages && eventId) {\n            offlineStorage.open().then(function (offlineStorage) {\n                offlineStorage.tags.toArray().then((tags) => {\n                    !tags.length\n                        ? setLocalImages([])\n                        :  offlineStorage.tags\n                            .where(\"eventId\").equals(eventId)\n                            .toArray().then((tags) => {\n                                setLocalImages(tags);\n                            });\n                });\n            }).catch (function (err) {\n                // handle this failure correctly\n                alert('failed to open local storage');\n            });\n        }\n        \n        if (Array.isArray(localImages)) {\n            return localImages.map((image, index) => {\n                return <div key={ index }\n                    style={{\n                        backgroundImage: `url(${image.thumbnail_src})`\n                    }} alt=\"address thumbnail\"\n                    onClick={ () => { showDeletePrompt(image.meta.name) } }\n                    className={ \"address__tag-image delete \" + getImagePreviewAspectRatioClass(localImages[index]) }>\n                    <div style={{ backgroundImage: `url(${closeIcon})` }} className=\"tagging-tracker__edit-tags-close-btn\"></div>\n                </div>\n            });\n        } else {\n            return <div className=\"tagging-tracker__edit-tags-loading css-delayed-fade-in\">\n                <span>Loading tags...</span>\n                <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\n            </div>;\n        }\n    }\n\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\n        const eventId = tagInfoObj ? tagInfoObj.eventId : null;\n\n        if (eventId) {\n            setEventId(eventId);\n        }\n    }\n\n    useEffect(() => {\n        if (props.offlineStorage && props.location.state.tagInfoId) {\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\n        }\n    }, []);\n\n    useEffect(() => {\n        if (fileNameOfImageToDelete) {\n            fileNameOfImageToDelete = \"\";\n        }\n        toggleDeletePrompt(false);\n    }, [localImages]);\n    \n    // TODO this code is almost an exact copy of ViewAddress may have flexed states\n    // I used same class to steal styling\n    return(\n        <div className=\"tagging-tracker__edit-tags tagging-tracker__view-address\">\n            { renderTags() }\n            { renderDeletePrompt(props.location.state.addressId, fileNameOfImageToDelete) }\n        </div>\n    )\n}\n\nexport default EditTags;","import React, { useState, useEffect } from 'react';\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\nimport './App.scss';\nimport Dexie from 'dexie';\nimport axios from 'axios';\n\n// misc utils\nimport { getDateTime } from './utils/date';\n\n// components and pages\nimport Navbar from './components/navbar/Navbar';\nimport Login from './components/login/Login';\nimport Addresses from './components/addresses/Addresses';\nimport ViewAddress from './components/view-address/ViewAddress';\nimport TagInfo from './components/tag-info/TagInfo';\nimport OwnerInfo from './components/owner-info/OwnerInfo';\nimport BottomNavbar from './components/bottom-navbar/BottomNavbar';\nimport Page404 from './pages/page404/Page404';\nimport AddTag from './components/add-tag/AddTag';\nimport DeleteTag from './components/edit-tags/EditTags';\nimport Events from './components/events/Events';\nimport EventTags from './components/event-tags/EventTags';\nimport { checkIOS } from './utils/misc';\n\n// yeah this is bad\n// this is here because the entire states below are wiped on app re-render at app level\nlet prevToken;\n\nconst App = () => {\n\tconst [token, setToken] = useState(prevToken);\n\tconst [searchedAddress, updateSearchedAddress] = useState(\"\");\n\tconst [showAddressModal, setShowAddressModal] = useState(false);\n\tconst [appOnline, setAppOnline] = useState(true);\n\tconst [offlineStorage, setOfflineStorage] = useState(null);\n\tconst [modifyOwnerInfo, toggleModifyOwnerInfo] = useState(false);\n\tconst [modifyTagInfo, toggleModifyTagInfo] = useState(false);\n\tconst [bodyClass, setBodyClass] = useState(\"tagging-tracker__body\"); // this will be removed when UI is updated, it's for AddTag BottomNavbar\n\tconst [syncApp, setSyncApp] = useState(false);\n\tconst [loggingOut, updateLoggingOut] = useState(false);\n\tconst [deletedAddresses, setDeletedAddresses] = useState([]); // I only later realized you can have a whole state object vs individual lines like this\n\tconst [deleteEventsMode, setDeleteEventsMode] = useState(false);\n\tconst [deletingEvent, setDeletingEvent] = useState(false);\n\n\t/**\n\t  * if deploying to a example.com/target with subdirectories, baseName should be updated below\n\t  * otherwise leave it blank\n\t  * it should match what's after the example.com/ of the build-dev domain in package.json\n\t  * example: example.com/tagging-tracker -> tagging-tracker\n\t  * example: example.com/sub-folder/tagging-tracker -> sub-folder/tagging-tracker\n\t  * make sure package.json's build dev has the example.com/ path\n\t  * \n\t  * update: for the package.json homepage path I had to set the /path-from-domain\n\t  * for the software updater to work, update the .env path for the BASE path which is used for cache sync\n\t  */\n\tconst baseName = \"\";\n\n\tconst searchAddress = (searchStr) => {\n\t\tupdateSearchedAddress(searchStr);\n\t}\n\n\tconst toggleAddressModal = (show) => {\n\t\tsetShowAddressModal(show);\n\t}\n\n\tconst clearSearchedAddress = () => {\n\t\tupdateSearchedAddress(\"\");\n\t}\n\n\tconst getTokenFromStorage = (storage) => {\n\t\t// I'll do one good one\n\t\tstorage\n\t\t\t.tokens\n\t\t\t.where('tokenId')\n\t\t\t.equals(1)\n\t\t\t.toArray()\n\t\t\t.then((tokens) => {\n\t\t\t\tif (tokens.length) {\n\t\t\t\t\tprevToken = tokens[0]?.token; // should only be one, ooh fancy optional chaining\n\t\t\t\t\tsetToken(prevToken);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\talert('failed to get previous login, please login again'); // ehh bad handle\n\t\t\t});\n\t}\n\n\t// this will just wipe whatever is in the db if it even exists\n\tconst updateToken = (storage, token) => {\n\t\tconst currentTokens = storage.tokens.where('tokenId').equals(1);\n\t\tcurrentTokens\n\t\t\t.count()\n\t\t\t.then((count) => {\n\t\t\t\tif (!count) {\n\t\t\t\t\tstorage.tokens.add({\n\t\t\t\t\t\ttokenId: 1,\n\t\t\t\t\t\ttoken\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tsetToken(token);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\talert('failed to login'); // not true\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tstorage.tokens.where('tokenId').equals(1).modify({ // chaining madness\n\t\t\t\t\t\ttoken\n\t\t\t\t\t})\n\t\t\t\t\t.then(() => {\n\t\t\t\t\t\tsetToken(token);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(() => {\n\t\t\t\t\t\talert('failed to login'); // aye caramba\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tconsole.log(err);\n\t\t\t\talert('failed to login'); // not true\n\t\t\t});\n\t}\n\n\tconst updateAppOnlineState = (event) => {\n\t\tconst online = event.type === \"online\";\n\t\tif (appOnline !== online) {\n\t\t\tsetAppOnline(!appOnline);\n\t\t}\n\t}\n\n\tconst checkOnlineStatus = () => {\n\t\twindow.addEventListener('online', updateAppOnlineState);\n\t\twindow.addEventListener('offline', updateAppOnlineState);\n\t\treturn () => {\n\t\t\twindow.removeEventListener('online', updateAppOnlineState);\n\t\t\twindow.removeEventListener('offline', updateAppOnlineState);\n\t\t};\n\t}\n\n\tconst setupOfflineStorage = () => {\n\t\tconst db = new Dexie(\"LocalImageDatabase\");\n\t\tdb.version(4).stores({\n\t\t\taddresses: \"++id,address,lat,lng,created,updated\",\n\t\t\tevents: \"++,addressId,tagInfoId,tagIds,datetime\",\n\t\t\ttags: \"++,fileName,addressId,eventId,meta,datetime,src,thumbnail_src\",\n\t\t\townerInfo: \"++,addressId,formData\",\n\t\t\ttagInfo: \"++,addressId,eventId,formData\",\n\t\t\ttokens: \"++,tokenId,token\" // this implementation doesn't make sense eg. only need one but it's a persistent local store\n\t\t});\n\t\tsetOfflineStorage(db);\n\t};\n\n\t// this is for making sure the remote side is not empty eg. in the middle of a build\n\t// this does throw an Uncaught promise error, haven't figured out why but it doesn't break code\n\t// does its job of preventing overwriting client code with nothing\n\tconst checkRemoteNotEmpty = () => {\n\t\treturn new Promise((resolve, reject) => {\n\t\t\tconst frontEndBasePath = window.location.href.indexOf('localhost') === -1\n\t\t\t\t? process.env.REACT_APP_BASE\n\t\t\t\t: false;\n\n\t\t\tif (!frontEndBasePath) {\n\t\t\t\tresolve(false);\n\t\t\t} else {\n\t\t\t\taxios.get(frontEndBasePath + '/?' + Date.now()) // this is just \"cache busting\" as the PWA caches requests\n\t\t\t\t\t.then((response) => {\n\t\t\t\t\t\tif (response.status === 200 && response.data) {\n\t\t\t\t\t\t\tresolve(true);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresolve(false); // case of 403, 404\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\tconsole.log('remote cache clear test', error);\n\t\t\t\t\t\treject(new Error('no content'));\n\t\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tconst checkForNewVersion = async () => {\n\t\t// https://stackoverflow.com/questions/45467842/how-to-clear-cache-of-service-worker\n\t\t// using the caches.delete() method\n\t\t// check if checked within 5 minutes\n\t\t// window.localStorage is primarily used here to avoid confusion from\n\t\t// treating Dexie(IndexedDB) as localStorage by name\n\t\t// also using localStorage because App re-renders and wipes self state\n\t\t// I didn't think this needed to be in Dexie\n\t\tconst verChecked = window.localStorage.getItem('verChecked');\n\t\tif (!verChecked) {\n\t\t\twindow.localStorage.setItem('verChecked', Date.now());\n\t\t} else if (Date.now() - verChecked > 300000) { // 5 minutes\n\t\t\tconst hasRemoteContent = await checkRemoteNotEmpty();\n\t\t\tif (!hasRemoteContent || !window.caches) return; // if no remote code, don't pull down or no cache\n\t\t\tcaches.keys().then(function(names) {\n\t\t\t\tfor (let name of names)\n\t\t\t\t\tcaches.delete(name);\n\t\t\t});\n\t\t}\n\t}\n\n\tconst updateSoftware = () => {\n\t\twindow.localStorage.setItem('verChecked', Date.now() - 360000); // 6 mins in the past\n\t\tcheckForNewVersion();\n\t\twindow.location.reload();\n\t}\n\n\tuseEffect(() => {\n\t\tcheckOnlineStatus();\n\n\t\tif (!offlineStorage) {\n\t\t\tsetupOfflineStorage();\n\t\t}\n\n\t\tcheckForNewVersion();\n\n\t\twindow.addEventListener('load', () => {\n\t\t\tconst ttBody = document.querySelector('.tagging-tracker');\n\n\t\t\t// I'm aware shouldn't try to detect user agent due to unreliability\n\t\t\t// this is tough to meet all the criteria\n\t\t\t// iOS PWA doesn't have the bottom Safari bar but the browser does\n\t\t\t// desktop doesn't include the url bar in its height\n\t\t\t// mobile Android includes the url bar, standalone Android needs full height unlike Safari\n\t\t\t// https://stackoverflow.com/questions/7944460/detect-safari-browser\n\n\t\t\tconst isSafari = navigator.vendor && navigator.vendor.indexOf('Apple') > -1 &&\n               navigator.userAgent &&\n               navigator.userAgent.indexOf('CriOS') == -1 &&\n               navigator.userAgent.indexOf('FxiOS') == -1;\n\n\t\t\t// keep these changes, will look bad in regular safari\n\t\t\t// but xcode simulator iPhone is the target\n\t\t\tif (\n\t\t\t\tttBody\n\t\t\t\t&& !ttBody.classList.contains('safari-mod')\n\t\t\t\t&& isSafari\n\t\t\t\t&& !(navigator.standalone === true || (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches))\n\t\t\t) {\n\t\t\t\tttBody.classList = ttBody.classList + ' safari-mod';\n\t\t\t}\n\n\t\t\twindow.removeEventListener('load', () => {});\n\t\t});\n\t});\n\n\t// try to get old token when local storage loads\n\tuseEffect(() => {\n\t\tif (offlineStorage) {\n\t\t\tgetTokenFromStorage(offlineStorage);\n\t\t}\n\t}, [offlineStorage]);\n\n\treturn (\n\t\t<div className={ `tagging-tracker ${checkIOS(true)}` }>\n\t\t\t<Router basename={ baseName }>\n\t\t\t\t<Route component={ (props) =>\n\t\t\t\t\t<Navbar\n\t\t\t\t\t\t{...props}\n\t\t\t\t\t\tbaseDir={ baseName }\n\t\t\t\t\t\tsearchAddress={searchAddress}\n\t\t\t\t\t\tsearchedAddress={searchedAddress}\n\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\n\t\t\t\t\t\tcheckOnlineStatus={checkOnlineStatus}\n\t\t\t\t\t\ttoggleModifyOwnerInfo={toggleModifyOwnerInfo}\n\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\n\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\n\t\t\t\t\t\ttoggleModifyTagInfo={toggleModifyTagInfo}\n\t\t\t\t\t\tupdateSoftware={updateSoftware}\n\t\t\t\t\t\tdeletedAddresses={deletedAddresses}\n\t\t\t\t\t\tsetDeletedAddresses={setDeletedAddresses}\n\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\tdeleteEventsMode={deleteEventsMode}\n\t\t\t\t\t\tsetDeleteEventsMode={setDeleteEventsMode}\n\t\t\t\t\t\ttoken={token} />\n\t\t\t\t}/> {/* put this break here since it confused me having it against the line before */}\n\t\t\t\t<div className={ `${bodyClass} ${checkIOS(true)}` }>\n\t\t\t\t\t<Switch>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\texact\n\t\t\t\t\t\t\tpath=\"/login\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttoken\n\t\t\t\t\t\t\t\t\t? <Redirect to=\"/addresses\" />\n\t\t\t\t\t\t\t\t\t: <Login\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\t\t\t\t\tupdateToken={updateToken}\n\t\t\t\t\t\t\t\t\t\ttoken={token} />\n\t\t\t\t\t\t} />\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath={\"/view-address\"}\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t? <ViewAddress\n\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\n\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/owner-info\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <OwnerInfo\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/tag-info\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <TagInfo\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/add-tag\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <AddTag\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\t\t\t\t\tsetBodyClass={setBodyClass}\n\t\t\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\t\t\tappOnline={appOnline}\n\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/edit-tags\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <DeleteTag\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/events\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <Events\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\t\t\t\t\tdeleteEventsMode={deleteEventsMode}\n\t\t\t\t\t\t\t\t\t\tdeletingEvent={deletingEvent}\n\t\t\t\t\t\t\t\t\t\tsetDeletingEvent={setDeletingEvent} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath=\"/event-tags\"\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t\t\t\t? <EventTags\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\n\t\t\t\t\t\t<Route\n\t\t\t\t\t\t\tpath={[\"/\",\"/addresses\"]}\n\t\t\t\t\t\t\tcomponent={ (props) =>\n\t\t\t\t\t\t\t\ttrue \n\t\t\t\t\t\t\t\t\t? <Addresses\n\t\t\t\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\t\t\t\tsearchedAddress={searchedAddress}\n\t\t\t\t\t\t\t\t\t\tsetShowAddressModal={setShowAddressModal}\n\t\t\t\t\t\t\t\t\t\tshowAddressModal={showAddressModal}\n\t\t\t\t\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\n\t\t\t\t\t\t\t\t\t\tclearSearchAddress={clearSearchedAddress}\n\t\t\t\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\t\t\t\t\tgetDateTime={getDateTime} />\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\n\t\t\t\t\t\t<Route>\n\t\t\t\t\t\t\t<Page404 />\n\t\t\t\t\t\t</Route>\n\t\t\t\t\t</Switch>\n\t\t\t\t</div>\n\t\t\t\t{/* The explanation here is the AddTag needs to keep its own state so it doesn't\n\t\t\t\t\tre-render while adding more images since the initial bridge between bottomNavbar\n\t\t\t\t\tand AddTag body was causing the entire app to re-render */}\n\t\t\t\t<Route component={ (props) =>\n\t\t\t\t\t(props.location.pathname !== \"/login\" && props.location.pathname !== \"/add-tag\")\n\t\t\t\t\t\t? <BottomNavbar\n\t\t\t\t\t\t\t{...props}\n\t\t\t\t\t\t\tbaseDir={ baseName }\n\t\t\t\t\t\t\tappOnline={appOnline}\n\t\t\t\t\t\t\ttoken={token}\n\t\t\t\t\t\t\tsyncApp={syncApp}\n\t\t\t\t\t\t\tsetSyncApp={setSyncApp}\n\t\t\t\t\t\t\tofflineStorage={offlineStorage}\n\t\t\t\t\t\t\tloggingOut={loggingOut}\n\t\t\t\t\t\t\tupdateLoggingOut={updateLoggingOut}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t: null\n\t\t\t\t\t} />\n\t\t\t</Router>\n\t\t</div>\n\t)\n}\n\nexport default App;\n","import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport './Events.scss';\nimport { getDateTime, formatTimeStr, flipDateFormat } from '../../utils/date';\nimport { addNewTagInfo, addNewEvent, updateTagInfoEventId } from './eventUtils';\nimport { deleteEvent } from '../../utils/delete';\n\nimport closeIcon from './../../assets/icons/svgs/close.svg';\nimport rightArrow from './../../assets/icons/svgs/chevron.svg';\n\nconst Events = (props) => {\n    const offlineStorage = props.offlineStorage;\n    const address = props.location.state;\n    const addressId = props.location.state.addressId;\n    const [events, setEvents] = useState([]);\n\n    const renderNoEvents = (\n        <div className=\"tagging-tracker__events-add-event\">\n            No Events\n        </div>\n    )\n\n    const renderEvents = (\n        <div className=\"tagging-tracker__events\">\n            {\n                events.reverse().map((event, id) => {\n                    return (\n                        <Link\n                            key={ id }\n                            to={{ pathname: \"/tag-info\", state: {\n                                addressId: event.addressId,\n                                address: props.location.state.address,\n                                tagInfoId: event.tagInfoId, // used for lookup\n                                eventTitle: `Event ${ event.datetime ? flipDateFormat(event.datetime.split(\" \")[0], true) : \"\" }` \n                            }}}\n                            className=\"tagging-tracker__event\">\n                            { props.deleteEventsMode ? <button type=\"button\" id=\"event-delete-btn\">\n                                <img src={ closeIcon } alt=\"delete event icon\" />\n                            </button> : null }\n                            <div id=\"event-text\">\n                                <span className=\"text\">Event</span>\n                                <span className=\"date\">{ event.datetime.split(\" \")[0] }</span>\n                            </div>\n                            <img id=\"event-view-icon\" src={ rightArrow } alt=\"open event icon\" />\n                        </Link>\n                    )\n                })\n            }\n        </div>\n    )\n\n    // check if delete event show update rendered events with remaining events\n    useEffect(() => {\n        if (offlineStorage) { // wait for offlineStorage to be ready\n            const remainingEvents = typeof props.location.state.remainingEvents !== \"undefined\" ?\n                props.location.state.remainingEvents : null;\n            if (remainingEvents) {\n                setEvents(remainingEvents);\n            }\n        }\n    }, []);\n\n    // check set any events\n    useEffect(() => {\n        if (offlineStorage) { // wait for offlineStorage to be ready\n            offlineStorage.events.where(\"addressId\").equals(addressId).toArray().then((events) => {\n                setEvents(events);\n            });\n        }\n    }, [offlineStorage]);\n\n    return ( events.length ? renderEvents : renderNoEvents )\n}\n\nexport default Events;","import React, { useState, useEffect } from 'react';\nimport { useHistory } from 'react-router-dom';\nimport './EventTags.scss';\nimport './../view-address/ViewAddress.scss';\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\nimport { flipDateFormat } from './../../utils/date';\nimport { getTagInfoObjById } from './../events/eventUtils';\n\nconst EventTags = (props) => {\n    const history = useHistory();\n    const [localImages, setLocalImages] = useState(null);\n    const [eventId, setEventId] = useState(null);\n\n    if (typeof props.location.state === \"undefined\") {\n        history.push(\"/addresses\");\n    }\n\n    const renderDateRow = ( dispDate ) => {\n        return null;\n    }\n\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\n        const eventId = tagInfoObj ? tagInfoObj.eventId : null;\n\n        if (eventId) {\n            setEventId(eventId);\n        }\n    }\n\n    const renderTags = () => {\n        const db = props.offlineStorage;\n        const tagInfoId = props.location.state.tagInfoId;\n\n        if (db && eventId && !localImages) {\n            db.open().then(function (db) {\n                db.tags.toArray().then((tags) => {\n                    !tags.length\n                        ? setLocalImages({})\n                        :  db.tags\n                        .where(\"eventId\").equals(eventId)\n                        .toArray().then((tags) => {\n                            // sort tags by descending date\n                            // straight outta SO: https://stackoverflow.com/questions/10123953/how-to-sort-an-array-by-a-date-property\n                            tags.sort((a, b) => {\n                                return new Date(b.datetime) - new Date(a.datetime);\n                            });\n                            setLocalImages(tags);\n                        });\n                });\n            }).catch (function (err) {\n                // handle this failure correctly\n                alert('failed to open local storage');\n            });\n        }\n        \n        if (localImages && Object.keys(localImages).length) {\n            // I was contemplating where to do this but the tags have to get grouped by date\n            const tagsGroupedByDate = {};\n            \n            localImages.forEach((image) => {\n                if (image.datetime in tagsGroupedByDate) {\n                    tagsGroupedByDate[image.datetime].push(image);\n                } else {\n                    tagsGroupedByDate[image.datetime] = [image];\n                }\n            });\n\n            return Object.keys(tagsGroupedByDate).map((date, index) => {\n                const groupDate = date.indexOf(\"T\") !== -1 ? date.split(\"T\")[0] : date.split(\" \")[0];\n\n                return <React.Fragment key={ index }>\n                    { renderDateRow(groupDate) }\n                    { tagsGroupedByDate[date].map((image, subIndex) => {\n                        return <div\n                            key={ subIndex }\n                            style={{\n                                backgroundImage: `url(${image.thumbnail_src})`\n                            }}\n                            alt=\"address thumbnail\"\n                            className={ \"address__tag-image \" + getImagePreviewAspectRatioClass(localImages[index]) } />\n                    })}\n                </React.Fragment>\n            });\n        } else {\n            return(localImages && Object(localImages).length)\n                ? <div className=\"tagging-tracker__view-address-loading css-delayed-fade-in\">\n                    <span>Loading tags...</span>\n                    <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\n                </div>\n                : <div className=\"tagging-tracker__view-address-no-tags\">\n                    <h4>No Tags</h4>\n                </div>;\n        }\n    }\n\n    useEffect(() => {\n        if (props.offlineStorage && props.location.state.tagInfoId) {\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\n        }\n    }, []);\n\n    return(\n        <div className=\"tagging-tracker__event-tags tagging-tracker__view-address\">\n            { renderTags() }\n        </div>\n    )\n}\n\nexport default EventTags;","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './css-reset.css';\nimport './index.scss';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.register();\n"],"sourceRoot":""}