(this["webpackJsonptagging-tracker-pwa"]=this["webpackJsonptagging-tracker-pwa"]||[]).push([[0],[,,,,,,,,,function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,function(e,t,n){e.exports=n.p+"static/media/add-square.00e36f36.svg"},,function(e,t,n){e.exports=n.p+"static/media/chevron.8417a1be.svg"},function(e,t,n){e.exports=n.p+"static/media/close.db093ba0.svg"},,,,,function(e,t,n){e.exports=n.p+"static/media/property.8673af4c.svg"},function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,,,,,,,,function(e,t,n){},,,function(e,t,n){e.exports=n.p+"static/media/chevron-blue.f48ced71.svg"},,,function(e,t,n){e.exports=n.p+"static/media/tagging-tracker-logo.4295bb0d.PNG"},function(e,t,n){e.exports=n.p+"static/media/location.57fefe5e.svg"},function(e,t,n){e.exports=n.p+"static/media/upload.d4af3f99.svg"},function(e,t,n){e.exports=n.p+"static/media/switch.e4b4aac4.svg"},function(e,t,n){e.exports=n.p+"static/media/text-document.e93f329b.svg"},function(e,t,n){e.exports=n.p+"static/media/delete.89314c06.svg"},function(e,t,n){e.exports=n.p+"static/media/pencil.af8b5189.svg"},function(e,t,n){e.exports=n.p+"static/media/photo.0f212d8a.svg"},function(e,t,n){e.exports=n(92)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,,,,,,,,,,,,,,function(e,t,n){},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/calendar.0897f518.svg"},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a,r=n(0),o=n.n(r),s=n(36),c=n.n(s),i=(n(54),n(55),n(1)),l=n.n(i),d=n(2),u=n(3),f=n(11),g=(n(57),n(37)),m=n(8),p=n.n(m),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_API_BASE:"https://api.byx1a2gixtvvnjwxde5y.com",REACT_APP_API_BASE_LOCAL:"http://localhost:5000",REACT_APP_BASE:"https://taggingtracker.org",REACT_APP_MAPS_API:"AIzaSyAvo80HRW33hW8T_4J3z-T0jA-9phQWUtA"}).TZ="America/Chicago";var t=new Date,n=("0"+t.getDate()).slice(-2),a=("0"+(t.getMonth()+1)).slice(-2),r=t.getFullYear(),o=t.getHours(),s=t.getMinutes(),c=t.getSeconds();return"YYYY-MM-DD"===e?"".concat(r,"-").concat(a,"-").concat(n):"MM-DD-YYYY"===e?"".concat(a,"-").concat(n,"-").concat(r):"".concat(r,"-").concat(a,"-").concat(n," ").concat(o,":").concat(s,":").concat(c)},A=function(e){return-1!==e.indexOf("T")&&(e=e.split("T").join(" ").split(".000Z").join("")),e},b=function(e,t){var n=t?"-":"/",a=e.split("-");return a[1]+n+a[2]+n+a[0]},v=n(18),w=(n(76),function(e,t,n){var a,r=e.offlineStorage,o=t.addressId,s=function(){clearTimeout(a),alert("Address deleted! Redirecting..."),n(t)},c=function(e){var t=e.tagInfo.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("tag info deleted"),i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tags",e)})):i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tag info",e)}))},i=function(e){var t=e.tags.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("tags deleted"),l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)})):l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)}))},l=function(e){var t=e.addresses.where("id").equals(o);t.count().then((function(e){e?t.delete().then((function(){console.log("address deleted"),s()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)})):s()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)}))};r?r.open().then((function(e){!function(e){var t=e.ownerInfo.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("owner info deleted"),c(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)})):c(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)}))}(e),a=setTimeout((function(){alert("Failed to delete address or taking longer than usual"),n(t)}),6e4)})).catch((function(e){alert("failed to open local storage",e),n(t)})):(alert("Failed to delete address"),n(t))}),E=function(e,t){return new Promise((function(n,a){e.events.where("addressId").equals(t).toArray().then((function(e){n(e)})).catch((function(){n(null)}))}))},y=function(e,t){var n;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.events.where("tagInfoId").equals(t),a.abrupt("return",new Promise((function(e,t){n.count().then((function(t){t&&n.delete().then((function(){e(!0)})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})));case 2:case"end":return a.stop()}}))},I=function(e,t){var n;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.tags.where("eventId").equals(t),a.abrupt("return",new Promise((function(e,t){n.count().then((function(t){t&&n.delete().then((function(){e(!0)})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})));case 2:case"end":return a.stop()}}))},k=function(e,t){return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(y(e,t));case 2:if(a.sent){a.next=4;break}n(!1);case 4:return a.next=6,l.a.awrap(I(e,t));case 6:if(a.sent){a.next=8;break}n(!1);case 8:n(!0);case 9:case"end":return a.stop()}}))})));case 1:case"end":return n.stop()}}))},O=n(38),x=n.n(O),_=function(e,t,n){return e?e.substr(0,t)+(n&&e.length>t?"...":""):"undefined string"},j=function(e){var t=Object(r.useRef)(null),n=Object(f.g)(),a=Object(r.useState)(!1),s=Object(d.a)(a,2),c=s[0],i=s[1],l=Object(r.useState)(!1),g=Object(d.a)(l,2),m=g[0],p=g[1],h=function(){e.toggleModifyOwnerInfo(!e.modifyOwnerInfo)},A=function(){e.modifyTagInfo&&n.push({pathname:"/events",state:Object(v.a)({},e.location.state,{eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null})}),e.toggleModifyTagInfo(!e.modifyTagInfo)},b=function(t){if(p(!1),Object.keys(t).length){var a=e.deletedAddresses;a.push(t.address),e.setDeletedAddresses(a)}n.push("/addresses")},E=function(){var t=e.location.state;window.confirm("Delete address "+t.address+" ?")&&(p(!0),w(e,t,b))},y=function(){i(!c)};return Object(r.useEffect)((function(){!e.showAddressModal&&"/addresses"===e.location.pathname&&t.current.value.length>0&&t.current.focus(),e.checkOnlineStatus()})),Object(r.useEffect)((function(){m&&E()}),[m]),o.a.createElement("div",{className:"tagging-tracker__navbar"},function(n){var a,r;switch(e.baseDir?n.pathname.replace(e.baseDir+"/",""):n.pathname){case"/":case"/addresses":return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"tagging-tracker__navbar-top addresses"},o.a.createElement("button",{className:"add",onClick:function(){e.toggleAddressModal(!0)}}),o.a.createElement("h2",null,"Addresses"),o.a.createElement("div",{className:"navbar-top__settings"},o.a.createElement("button",{className:"gear-icon",type:"button",onClick:y}),c?o.a.createElement("div",{className:"navbar-top__settings-menu"},o.a.createElement("button",{onClick:e.updateSoftware,type:"button"},"Update Software")):null)),o.a.createElement("input",{type:"text",value:e.searchedAddress,placeholder:"search",ref:t,onChange:function(t){var n;n=t.target.value,e.searchAddress(n)}}));case"/view-address":case"/edit-tags":case"/tag-info":case"/owner-info":case"/events":case"/event-tags":case"/tags":case"/add-tag":return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"tagging-tracker__navbar-top view-address edit-tags add-tags"},o.a.createElement(u.b,{to:{pathname:(r=n.pathname,"/owner-info"===r?"/events":-1!==r.indexOf("tag")?"/events":"/addresses"),state:(n.pathname,a=e.location.state.address,{clearSearch:!0,address:a,addressId:e.location.state.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null})},className:"manage-address__back"},o.a.createElement("img",{src:x.a,alt:"back arrow"}),o.a.createElement("h4",null,function(e,t){var n;return-1!==["/events","/event-tags"].indexOf(e)?(t&&"/event-tags"!==e?(n=t.substring(0,10),t.length>10&&(n+="...")):n="Events",n):"/event-tags"===e||"/owner-info"===e||"/tag-info"===e?"Events":-1!==e.indexOf("tag")?"Event":"Addresses"}(n.pathname,e.location.state.address))),o.a.createElement("h2",{className:"manage-address__name"},function(t,n){return"/tag-info"===t?e.location.state.eventTitle?e.location.state.eventTitle:"Create event":"/owner-info"===t?"Owner Information":"/events"===t?"".concat(_(n,40,!0)," Events"):"/event-tags"===t||"/add-tag"===t||"/edit-tags"===t?e.location.state.eventTitle:n}(n.pathname,e.location.state.address)),function(){var t=e.location.pathname,n=-1!==t.indexOf("edit"),a=-1!==t.indexOf("add-tag");return"/owner-info"===t?o.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:h},e.modifyOwnerInfo?"SAVE":"EDIT"):"/tag-info"===t?o.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:A},e.modifyTagInfo?"SAVE":"EDIT"):"/events"===t?o.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:function(){p(!m)},disabled:!!e.deletingEvents},"Delete"):n?o.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:E,disabled:!!m},"Delete"):o.a.createElement(u.b,{to:{pathname:"/edit-tags",state:{address:e.location.state.address,addressId:e.location.state.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null}},className:"manage-address__edit-cancel"},a?"":n?"Delete":"Edit")}()));default:return""}}(e.location))},S=(n(81),n(41)),N=n.n(S),C=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=Object(r.useRef)(null),s=Object(f.g)(),c=Object(r.useState)(!1),i=Object(d.a)(c,2),l=i[0],u=i[1];return Object(r.useEffect)((function(){e.token&&s.push("/addresses")})),o.a.createElement("div",{className:"tagging-tracker__login"},o.a.createElement("img",{alt:"tagging tracker logo",className:"tagging-tracker__login-logo",src:N.a}),o.a.createElement("div",{className:"tagging-tracker__login-fields"},o.a.createElement("input",{type:"text",name:"username",placeholder:"username",ref:t}),o.a.createElement("input",{type:"password",name:"password",placeholder:"password",ref:n}),o.a.createElement("button",{type:"button",onClick:function(){var a=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/login-user",r=t.current.value,o=n.current.value;r&&o?(u(!0),p.a.post(a,{username:r,password:o}).then((function(t){"undefined"!==typeof t.data.token&&t.data.token&&e.updateToken(t.data.token)})).catch((function(e){alert("failed to login"),u(!1)}))):alert("Please fill in both username and password to login")},ref:a,disabled:!!l},"Login")))},D=(n(82),n(16)),F=n.n(D),T=n(42),B=n.n(T),P=function(e){var t,n=Object(r.useRef)(null),a=Object(r.useRef)(null),s=Object(r.useRef)(null),c=Object(r.useState)(!1),i=Object(d.a)(c,2),f=i[0],g=i[1],m=Object(r.useState)([]),p=Object(d.a)(m,1)[0],h=Object(r.useState)(null),A=Object(d.a)(h,2),b=A[0],v=A[1],w=Object(r.useState)(null),E=Object(d.a)(w,2),y=E[0],I=E[1],k=e.token,O=function(t){var a=t||n.current.value;e.offlineStorage.open().then((function(e){e.addresses.toArray().then((function(t){t.length?e.addresses.where("address").equals(a).toArray().then((function(e){e.length?alert("Address exists"):x(a)})):x(a)}))})).catch((function(e){alert("failed to open local storage")}))},x=function(t){var n;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.offlineStorage,t){a.next=4;break}return alert("Please enter an address"),a.abrupt("return");case 4:g(!0),n.transaction("rw",n.addresses,(function(){var a;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(n.addresses.add({address:t,lat:"0.0",lng:"0.0",created:e.getDateTime(),updated:e.getDateTime()}).then((function(e){return a=e,!0})));case 2:if(!r.sent){r.next=8;break}v(p.concat({address:t,addressId:a})),g(!1),e.setShowAddressModal(!1),r.next=9;break;case 8:alert("Failed to save address");case 9:case"end":return r.stop()}}))})).catch((function(e){alert("Failed to save address")}));case 6:case"end":return a.stop()}}))},_=function(e){var t=e.address_components;return"".concat(t[0]?t[0].long_name:"","\n             ").concat(t[1]?t[1].short_name:"",",\n              ").concat(t[2]?t[2].long_name:"")},j=function(){var e=t.getPlace();"name"in e&&O(e.name)};return Object(r.useEffect)((function(){e.showAddressModal&&n.current.focus(),"undefined"!==typeof e.location.state&&"undefined"!==typeof e.location.state.clearSearch&&(delete e.location.state.clearSearch,e.clearSearchAddress()),p&&g(!1)}),[e,p]),Object(r.useEffect)((function(){e.searchedAddress.length?function(t){var n=e.offlineStorage;if(n){var a,r=new RegExp(t,"i");n.addresses.filter((function(e){return r.test(e.address)})).toArray().then((function(e){e.length?a=e.map((function(e){return{address:e.address,addressId:e.id}})):n.tagInfo.filter((function(e){return r.test(e.tagText)})).toArray().then((function(e){a=e.map((function(e){return{address:n.addresses.where("id").equals(e.addressId).toArray().then((function(e){return e[0].id})),addressId:e.addressId}}))})),v(a)}))}}(e.searchedAddress):!e.offlineStorage||p&&b||!p.length&&e.offlineStorage&&e.offlineStorage.addresses.toArray().then((function(e){var t=e.splice(0,15).map((function(e){return{address:e.address,addressId:e.id}}));v(t)})),e.showAddressModal&&k&&(t=new google.maps.places.Autocomplete(n.current,{types:["geocode"]})).addListener("place_changed",j)})),o.a.createElement("div",{className:"tagging-tracker__addresses"},b?b.map((function(e,t){return o.a.createElement(u.b,{key:t,to:{pathname:"/events",state:{address:e.address,addressId:e.addressId}},className:"tagging-tracker__address"},o.a.createElement("h4",null,e.address),o.a.createElement("img",{src:F.a,alt:"right arrow"}))})):"",e.showAddressModal||y?o.a.createElement("div",{className:"tagging-tracker__address-input-modal"},o.a.createElement("h3",null,y?"Select Address":"Create New Address"),o.a.createElement("p",null,y?null:"Please enter a new address that you want to create"),k?null:o.a.createElement("p",{className:"disclaimer-text"},"Note: login required for address autocomplete"),y?o.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-address-set"},o.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-addresses"},y.map((function(e){return o.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-address",onClick:function(){return t=_(e),O(t),void I(null);var t}},_(e))}))),o.a.createElement("button",{className:"tagging-tracker__reverse-geocode-back-btn",type:"button",onClick:function(){return I(null)}},"Back")):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"tagging-tracker__address-input-row"},k?o.a.createElement("img",{className:"address-input-row___location-icon",src:B.a,alt:"location icon",onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,n=e.coords.longitude,a=new google.maps.Geocoder,r={lat:parseFloat(t),lng:parseFloat(n)};a.geocode({location:r},(function(e,t){"OK"===t?e[0]?I(e):alert("No address found"):alert("Failed to find an address")}))}),(function(){alert("Failed to determine your location")})):alert("Geolocation not supported on your browser")}}):null,o.a.createElement("input",{type:"text",ref:n,id:"autocomplete"})),o.a.createElement("div",{className:"tagging-tracker__address-input-modal-btns"},o.a.createElement("button",{type:"button",ref:a,onClick:function(){e.toggleAddressModal(!1)}},"CANCEL"),o.a.createElement("button",{type:"button",ref:s,onClick:function(){return O()},disabled:!!f},"CREATE")))):null)},Q=(n(35),function(e){if(Object.keys(e.meta).length&&"undefined"!==typeof e.meta.width){var t=e.meta;return t.width>=t.height?"landscape":"portrait"}return""}),R=n(9),L=n.n(R),U=function(e){var t=Object(f.g)(),n=Object(r.useState)(null),a=Object(d.a)(n,2),s=a[0],c=a[1];"undefined"===typeof e.location.state&&t.push("/addresses");return o.a.createElement("div",{className:"tagging-tracker__view-address"},function(){var t=e.offlineStorage;if(t&&!s&&t.open().then((function(t){t.tags.toArray().then((function(n){n.length?t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){e.sort((function(e,t){return new Date(t.datetime)-new Date(e.datetime)})),c(e)})):c({})}))})).catch((function(e){alert("failed to open local storage")})),s&&Object.keys(s).length){var n={};return s.forEach((function(e){e.datetime in n?n[e.datetime].push(e):n[e.datetime]=[e]})),Object.keys(n).map((function(e,t){var a,r=-1!==e.indexOf("T")?e.split("T")[0]:e.split(" ")[0];return o.a.createElement(o.a.Fragment,{key:t},(a=r,o.a.createElement("h3",{className:"tagging-tracker__view-address-tag-date-group"},o.a.createElement("span",null,"Event")," ",b(a,!1))),n[e].map((function(e,n){return o.a.createElement("div",{key:n,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",className:"address__tag-image "+Q(s[t])})})))}))}return s&&Object(s).length?o.a.createElement("div",{className:"tagging-tracker__view-address-loading css-delayed-fade-in"},o.a.createElement("span",null,"Loading tags..."),o.a.createElement("img",{src:L.a,alt:"loading tags spinner"})):o.a.createElement("div",{className:"tagging-tracker__view-address-no-tags"},o.a.createElement("h4",null,"No Tags"))}())},Y=(n(83),{"Date of entry:":{type:"date"},"Date of abatement:":{type:"date"},"Number of tags:":{type:"number"},"Tag text (separated by commas):":{type:"input"},"Small tag text (separated by commas):":{type:"input"},"Square footage covered:":{type:"number"},"Racial or hate tone?":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Gang related:":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Crossed out tag:":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Type of property:":{type:"radio",options:{commercial:"Commercial",residential:"Residential",public:"Public"}},"Vacant property:":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Land bank property:":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Surface:":{type:"checkbox",options:{brick:"Brick or Stone",concrete:"Concrete",wood:"Wood",glass:"Glass",painted:"Painted",others:"other"}},"Surface other:":{type:"input"},"Need other code enforcement?":{type:"checkbox",options:{buildingDisrepair:"Building disrepair",weeds:"Weeds",trash:"Trash",illegalDumping:"Illegal dumping",others:"other"}},"Other code enforcement:":{type:"input"}}),q=function(e,t,n){var a=arguments;return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a.length>3&&void 0!==a[3]?a[3]:{},r.abrupt("return",new Promise((function(a,r){t.transaction("rw",t.tagInfo,(function(){return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:t.tagInfo.add({addressId:e,eventId:null,formData:{}}).then((function(e){a(e)}));case 1:case"end":return n.stop()}}))})).catch((function(e){console.log("failed to create tag info for event",e),alert("Failed to create tag info for event"),n(!1),r()}))})));case 2:case"end":return r.stop()}}))},M=function(e,t,n){return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise((function(a,r){e.transaction("rw",e.events,(function(){e.events.where("addressId").equals(t).toArray().then((function(e){e.length?a(e.some((function(e){return-1!==e.datetime.indexOf(n)}))):a(!1)})).catch((function(e){console.log("failed checking for event duplicate",e),alert("failed check for adding new event"),r(!1)}))}))})));case 1:case"end":return a.stop()}}))},K=function(e,t,n,a,r){var o,s,c=arguments;return l.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:return o=c.length>5&&void 0!==c[5]&&c[5],s=a(r()),i.next=4,l.a.awrap(M(n,t,s.split(" ")[0]));case 4:if(!i.sent){i.next=8;break}return alert("Error: Event date already exists"),i.abrupt("return");case 8:return i.abrupt("return",new Promise((function(a,r){n.transaction("rw",n.events,(function(){return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:n.events.add({addressId:t,tagInfoId:e,tagIds:[],datetime:s}).then((function(e){a(e)}));case 1:case"end":return r.stop()}}))})).catch((function(e){console.log("failed to create event",e),alert("Failed to create event"),o(!1),r()}))})));case 10:case"end":return i.stop()}}))},W=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(r,o){n.transaction("rw",n.tagInfo,(function(){n.tagInfo.where(":id").equals(e).modify({eventId:t}).then((function(e){r(e)})).catch((function(e){console.log("failed to update tag info with event id",e),alert("failed to update tag info with event id"),a(!1),o(!1)}))}))}))},V=function(e,t){return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){e.tagInfo.get(t).then((function(e){n(e)})).catch((function(e){console.log("error getting tag info obj"),a()}))})));case 1:case"end":return n.stop()}}))},G=function(e){var t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],s=n[1],c=Object(r.useState)(null),i=Object(d.a)(c,2),u=i[0],f=i[1],g=e.modifyTagInfo,m={"option-0":"dateOfPicture","option-1":"dateOfAbatement","option-2":"numberOfTags","option-3":"tagText","option-4":"smallTagText","option-5":"squareFootageCovered","option-6-0":"racialOrHateTone","option-6-1":"racialOrHateTone","option-6-2":"racialOrHateTone","option-7-0":"gangRelated","option-7-1":"gangRelated","option-7-2":"gangRelated","option-8-0":"crossedOutTag","option-8-1":"crossedOutTag","option-8-2":"crossedOutTag","option-9-0":"typeOfProperty","option-9-1":"typeOfProperty","option-9-2":"typeOfProperty","option-10-0":"vacantProperty","option-10-1":"vacantProperty","option-10-2":"vacantProperty","option-11-0":"landBankProperty","option-11-1":"landBankProperty","option-11-2":"landBankProperty","option-12-0":"surface","option-12-1":"surface","option-12-2":"surface","option-12-3":"surface","option-12-4":"surface","option-12-5":"surface","option-13-0":"otherSurface","option-14-0":"needOtherCodeEnforcement","option-14-1":"needOtherCodeEnforcement","option-14-2":"needOtherCodeEnforcement","option-14-3":"needOtherCodeEnforcement","option-14-4":"needOtherCodeEnforcement","option-15-0":"otherCodeEnforcement"},p=Object(r.useRef)(Object.keys({"Date of entry:":"","Date of abatement:":"","Number of tags:":"","Tag text (separated by commas):":"","Small tag text (separated by commas):":"","Square footage covered:":"","Racial or hate tone?":"","Gang related:":"","Crossed out tag:":"","Type of property:":"","Vacant property:":"","Land bank property:":"","Surface:":"","Surface other:":"","Need other code enforcement?":"","Other code enforcement:":""}).map((function(e){var t=Y[e].type;if("input"===t||"number"===t||"date"===t)return Object(r.createRef)();var n=Y[e].options;return{subRefs:Object.keys(n).map((function(e){return Object(r.createRef)()}))}}))),b=!0,v=function(){var t,n,a,r,o,c;return l.a.async((function(i){for(;;)switch(i.prev=i.next){case 0:if(t=e.offlineStorage,n={},p.current.forEach((function(e){var t="";"undefined"!==typeof e.current&&"undefined"!==typeof e.current.type&&(t=e.current.type),"undefined"!==typeof e.subRefs&&Array.isArray(e.subRefs)?e.subRefs.forEach((function(e){n[e.current.id]=e.current.checked})):n[e.current.name]="text"===t||"number"===t||"date"===t?e.current.value:e.current.checked})),!b){i.next=21;break}if(b=!1,!(a=e.location.state.tagInfoId||u)){i.next=10;break}t.transaction("rw",t.tagInfo,(function(){return l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(t.tagInfo.where(":id").equals(a).modify({formData:n},e.location.state.addressId).then((function(e){return!0})));case 2:if(!r.sent){r.next=7;break}s(n),b=!0,r.next=8;break;case 7:alert("Failed to update tag information");case 8:case"end":return r.stop()}}))})).catch((function(e){alert("Failed to update tag information"),console.log("tag info",e)})),i.next=21;break;case 10:return r=e.location.state.addressId,i.next=13,l.a.awrap(q(r,t,!1,n));case 13:return o=i.sent,i.next=16,l.a.awrap(K(o,r,t,A,h));case 16:return c=i.sent,i.next=19,l.a.awrap(W(o,c,t));case 19:s(n),f(o);case 21:case"end":return i.stop()}}))},w=function(e){return"Type of property:"===e||"Vacant property:"===e||"Land bank property:"===e||"Tag text (separated by commas):"===e||"Small tag text (separated by commas):"===e?" full-column-left":""};return Object(r.useEffect)((function(){if(!a){var t=e.location.state.tagInfoId,n=e.offlineStorage;t&&n&&n.tagInfo.get(t,(function(e){e&&s(e.formData)})).catch((function(e){alert("failed to load tagInfo"),console.log("tag info",e)}))}}),[e,a]),o.a.createElement("div",{className:"tagging-tracker__tag-info"},Object.keys(Y).map((function(e,t){return o.a.createElement("div",{key:t,className:"tag-info-field-row"+("checkbox"===Y[e].type?" checkbox":" box")+w(e)},o.a.createElement("span",{className:(n=Y[e].type,"radio"===n?"option-group-label":"checkbox"===n?"full":"input-label")},e),function(e,t,n){var r=e.type;if("input"===r)return m["option-".concat(t)]=null,o.a.createElement("input",{defaultValue:a?a["option-".concat(t)]:"",name:"option-".concat(t),onKeyUp:v,onBlur:v,ref:p.current[t],className:"grow",type:"text",disabled:!g});if("number"===r)return m["option-".concat(t)]=null,o.a.createElement("input",{defaultValue:a?a["option-".concat(t)]:"",name:"option-".concat(t),placeholder:"0",onKeyUp:v,onBlur:v,ref:p.current[t],className:"grow",type:"number",min:"0",disabled:!g});if("date"===r)return o.a.createElement("input",{defaultValue:a?a["option-".concat(t)]:"",name:"option-".concat(t),onKeyUp:v,onBlur:v,ref:p.current[t],className:"grow",type:"date",min:h("MM-DD-YYYY"),disabled:!g});if("radio"!==r&&"checkbox"!==r)return"[unknown field type]";var s=Object.keys(e.options);return s.length?"checkbox"===r?o.a.createElement("div",{className:"padding-left"},s.map((function(n,s){return o.a.createElement("span",{key:s,className:"option-group"},o.a.createElement("input",{checked:!!a&&a["option-".concat(t,"-").concat(s)],onChange:v,onKeyUp:v,ref:p.current[t].subRefs[s],id:"option-".concat(t,"-").concat(s),name:"option-".concat(t,"-").concat(s),type:r,disabled:!g}),o.a.createElement("label",{htmlFor:"option-".concat(t,"-").concat(s)},e.options[n]))}))):s.map((function(n,s){return o.a.createElement("span",{key:s,className:"option-group"},o.a.createElement("input",{checked:!!a&&a["option-".concat(t,"-").concat(s)],onChange:v,onKeyUp:v,id:"option-".concat(t,"-").concat(s),name:m["option-".concat(t,"-").concat(s)],ref:p.current[t].subRefs[s],type:r,disabled:!g}),o.a.createElement("label",{htmlFor:"option-".concat(t,"-").concat(s)},e.options[n]))})):void 0}(Y[e],t));var n})))},J=(n(84),function(e){var t=Object(r.useState)(null),n=Object(d.a)(t,2),a=n[0],s=n[1],c=["Name","Phone","Email","Tenant Name","Tenant Contact Number","Waiver Completed","Need To Follow Up",{"Building Survey":["Would you continue service if you had to pay for it?"]}],i=["name","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer"],u=Object(r.useRef)(c.map((function(){return Object(r.createRef)()}))),f=!0,g=function(t){var n=e.offlineStorage,a={addressId:e.location.state.addressId,formData:{}};t&&u.current.forEach((function(e,t){a.formData[i[t]]=e.current.value})),f&&(f=!1,n.transaction("rw",n.ownerInfo,(function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(n.ownerInfo.put({addressId:a.addressId,formData:{name:a.formData.name,phone:a.formData.phone,email:a.formData.email,tenantName:a.formData.tenantName,tenantPhoneNumber:a.formData.tenantPhoneNumber,waiverCompleted:a.formData.waiverCompleted,needFollowUp:a.formData.needFollowUp,buildingSurveyQuestionAnswer:a.formData.buildingSurveyQuestionAnswer}},a.addressId).then((function(){return!0})));case 2:if(!e.sent){e.next=7;break}f=!0,s(a),e.next=8;break;case 7:alert("Failed to update owner information");case 8:case"end":return e.stop()}}))})).catch((function(e){alert("Failed to update owner information"),console.log("owner info",e)})))};return Object(r.useEffect)((function(){!function(){var t,n;l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=e.location.state.addressId,n=e.offlineStorage,!t||!n){a.next=5;break}return a.next=5,l.a.awrap(n.ownerInfo.get(t,(function(e){s(e)})).catch((function(e){alert("failed to open local storage")})));case 5:case"end":return a.stop()}}))}()}),[e,a]),o.a.createElement("div",{className:"tagging-tracker__owner-info"},o.a.createElement("div",{className:"tagging-tracker__owner-info-form"},c.map((function(t,n){return"string"===typeof t?o.a.createElement("div",{key:n,className:"owner-info-form__row"},o.a.createElement("span",null,t,":"),o.a.createElement("input",{defaultValue:a?a.formData[i[n]]:"",onBlur:function(e){return g(e.target.value)},ref:u.current[n],type:"text",readOnly:!e.modifyOwnerInfo})):o.a.createElement("div",{className:"owner-info-form__row group",key:n},o.a.createElement("div",{className:"owner-info-form__row white"},o.a.createElement("span",null,Object.keys(t),":")),Object.keys(t).map((function(r,s){return o.a.createElement("div",{key:s,className:"owner-info-form__sub-row"},o.a.createElement("span",null,t[r]),o.a.createElement("input",{defaultValue:a?a.formData[i[n]]:"",id:"target-me",onChange:g,ref:u.current[n],type:"text",className:"full",readOnly:!e.modifyOwnerInfo}))})))}))))}),H=(n(85),n(43)),Z=n.n(H),z=n(44),X=n.n(z),$=n(22),ee=n.n($),te=n(45),ne=n.n(te),ae=(n(86),n(14)),re=n.n(ae),oe=n(46),se=n.n(oe),ce=n(23),ie=n.n(ce),le=n(47),de=n.n(le),ue=n(48),fe=n.n(ue),ge=function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.addresses.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync addresses err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},me=function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.events.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync events err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},pe=function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tags.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tags err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},he=function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.ownerInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync ownerInfo err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},Ae=function(e){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tagInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tagInfos err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},be=function(e){var t,n;return l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.offlineStorage,n={},a.abrupt("return",new Promise((function(a){t.addresses.count().then((function(r){var o,s,c,i,d,u;return l.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:if(!(r>0)){f.next=26;break}return f.next=3,l.a.awrap(ge(t));case 3:return o=f.sent,f.next=6,l.a.awrap(me(t));case 6:return s=f.sent,f.next=9,l.a.awrap(pe(t));case 9:return c=f.sent,f.next=12,l.a.awrap(he(t));case 12:return i=f.sent,f.next=15,l.a.awrap(Ae(t));case 15:d=f.sent,u=e.deletedAddresses,o&&(n.addresses=o),s&&(n.events=s),c&&(n.tags=c),i&&(n.ownerInfo=i),d&&(n.tagInfo=d),u&&(n.deletedAddresses=u),a(n),f.next=27;break;case 26:a(n);case 27:case"end":return f.stop()}}))})).catch((function(e){console.timeLog("sync bundle data err",e),a(!1)}))})));case 3:case"end":return a.stop()}}))},ve=function(e){var t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(be(e));case 2:return t=n.sent,n.abrupt("return",new Promise((function(n){if(0!==Object.keys(t).length&&t||e.deletedAddresses.length){var a=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-up";p.a.post(a,{headers:{Authorization:"Bearer ".concat(e.token)},bundledData:t}).then((function(e){201===e.status?n(!0):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):n(!1)})).catch((function(e){console.log("sync err",e),console.log(e.response),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&n({msg:403}),n(!1)}))}else n({msg:"No data to sync"})})));case 4:case"end":return n.stop()}}))},we=function(e){return new Promise((function(t){var n=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-down";p.a.post(n,{headers:{Authorization:"Bearer ".concat(e.token)}}).then((function(e){200===e.status?t(e.data):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):t(!1)})).catch((function(e){console.log("sync err",e),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&t({msg:403}),t(!1)}))}))},Ee=function(e){var t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.offlineStorage){n.next=3;break}return n.abrupt("return");case 3:return n.abrupt("return",new Promise((function(n){t.addresses.count().then((function(t){e.deletedAddresses&&e.deletedAddresses.length||t>0?n(!1):n(!0)})).catch((function(e){console.log("sync addresses err",e),n(!0)}))})));case 4:case"end":return n.stop()}}))},ye=function(e){var t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,l.a.awrap(Ee(e));case 2:if(!n.sent){n.next=15;break}return n.next=6,l.a.awrap(we(e));case 6:if(!(t=n.sent)){n.next=12;break}return je(e,t),n.abrupt("return",!0);case 12:return n.abrupt("return",{msg:"No data to sync"});case 13:n.next=18;break;case 15:return n.next=17,l.a.awrap(ve(e));case 17:return n.abrupt("return",n.sent);case 18:case"end":return n.stop()}}))},Ie=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.addresses||e(!0),t.addresses.forEach((function(a,r){n.transaction("rw",n.addresses,(function(){n.addresses.add({address:a.address,lat:a.lat,lng:a.lng,created:a.created,updated:a.updated}).then((function(e){return!0}))?r===t.addresses.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},ke=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.events||e(!0),t.events.forEach((function(a,r){n.transaction("rw",n.events,(function(){n.events.add({addressId:a.address_id,tagInfoId:a.tag_info_id,tagIds:JSON.parse(a.tag_ids),datetime:A(a.date_time)}).then((function(e){return!0}))?r===t.events.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},Oe=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.tags||e(!0),t.tags.forEach((function(a,r){n.transaction("rw",n.tags,(function(){var o=JSON.parse(a.meta);n.tags.add({addressId:a.address_id,eventId:a.event_id,fileName:a.filename,thumbnail_src:a.thumbnail_src,meta:o,datetime:a.datetime}).then((function(e){return!0}))?r===t.tags.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},xe=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.ownerInfo||e(!0),t.ownerInfo.forEach((function(a,r){n.transaction("rw",n.ownerInfo,(function(){n.ownerInfo.add({addressId:a.address_id,formData:JSON.parse(a.form_data)}).then((function(e){return!0}))?r===t.ownerInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},_e=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.tagInfo||e(!0),t.tagInfo.forEach((function(a,r){n.transaction("rw",n.tagInfo,(function(){n.tagInfo.add({addressId:a.address_id,eventId:a.event_id,formData:JSON.parse(a.form_data)}).then((function(e){return!0}))?r===t.tagInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},je=function(e,t){return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return!0,n.next=3,l.a.awrap(Ie(e,t));case 3:return n.sent,n.next=6,l.a.awrap(ke(e,t));case 6:return n.sent,n.next=9,l.a.awrap(Oe(e,t));case 9:return n.sent,n.next=12,l.a.awrap(xe(e,t));case 12:return n.sent,n.next=15,l.a.awrap(_e(e,t));case 15:if(!n.sent){n.next=20;break}return n.abrupt("return",!0);case 20:return n.abrupt("return",!1);case 21:case"end":return n.stop()}}))},Se=function(e){return new Promise((function(t){e.delete().then((function(){t(!0)})).catch((function(e){t(!1)}))}))},Ne=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=Object(r.useRef)(null),s=Object(r.useRef)(null),c=Object(f.g)(),i=e.token,g=Object(r.useState)(!1),m=Object(d.a)(g,2),p=m[0],h=m[1],A=function(){return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateLoggingOut(!0),t.next=3,l.a.awrap(Se(e.offlineStorage));case 3:t.sent||alert("failed to clear local data"),window.location.href="/";case 6:case"end":return t.stop()}}))},b=function(){e.saveToDevice()},w=function(){var t;return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.appOnline){n.next=3;break}return alert("Unable to sync, you are offline"),n.abrupt("return");case 3:if(e.token){n.next=6;break}return c.push("/login"),n.abrupt("return");case 6:if(e.syncApp){n.next=13;break}return e.setSyncApp(!0),n.next=10,l.a.awrap(ye(e));case 10:t=n.sent,Object.keys(t).length?"undefined"!==t.msg&&(403===t.msg?alert("You have been logged out, please login to sync"):alert(t.msg)):t||alert("Failed to sync"),e.setSyncApp(!1);case 13:case"end":return n.stop()}}))},y=function(){e.appOnline?e.token?e.triggerFileUpload(!0):window.confirm("You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.")&&c.push("/login"):alert("Unable to upload, you are offline")},I=function(){document.getElementById("add-tag-file-input").click()},O=function(t,n,a,r){window.confirm("Delete "+t+" ?")&&(h(!0),function(e,t,n,a){var r=e.tagInfo.where("eventId").equals(n);r.count().then((function(o){return l.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(!o){s.next=5;break}return s.next=3,l.a.awrap(k(e,n));case 3:if(!s.sent){s.next=5;break}r.delete().then((function(){return l.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",E(e,t));case 1:case"end":return n.stop()}}))})).then((function(e){console.log("finished deleting"),a(e)})).catch((function(e){alert("Failed to delete event"),a()}));case 5:case"end":return s.stop()}}))})).catch((function(e){alert("Failed to delete event"),a()}))}(e.offlineStorage,n,a,r))},x=function(t){h(!1),c.push({pathname:"/events",state:Object(v.a)({},e.location.state,{remainingEvents:t})})};return Object(r.useEffect)((function(){/(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent)&&(document.querySelector(".tagging-tracker__body").classList="tagging-tracker__body",document.querySelector(".tagging-tracker__bottom-navbar").classList.add("iOS"),document.querySelector(".tagging-tracker__body").classList.add("iOS"),-1===window.location.href.indexOf("events")&&-1===window.location.href.indexOf("event-tags")||document.querySelector(".tagging-tracker__body").classList.add("less"),-1!==window.location.href.indexOf("tag-info")&&document.querySelector(".tagging-tracker__body").classList.add("toggled-navbar"),-1!==window.location.href.indexOf("add-tag")&&document.querySelector(".tagging-tracker__body").classList.add("add-tag"))})),o.a.createElement("div",{className:-1!==["/owner-info"].indexOf(e.location.pathname)?"tagging-tracker__bottom-navbar floating-btns":"tagging-tracker__bottom-navbar"},function(r){var c=e.location.state,l=e.baseDir?r.pathname.replace(e.baseDir+"/",""):r.pathname,d="/tag-info"===e.location.pathname,f="/events"===e.location.pathname,g=(e.location.pathname,"/event-tags"===e.location.pathname);switch(l){case"/":case"/addresses":return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{onClick:w,ref:t,className:"bottom-navbar__btn half sync",type:"button",disabled:!e.appOnline},e.syncApp?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Syncing..."),o.a.createElement("img",{src:L.a,alt:"syncing spinner"})):o.a.createElement(o.a.Fragment,null,i?o.a.createElement("img",{src:Z.a,alt:"sync button icon"}):null,o.a.createElement("span",null,i?"Sync":"Login"))),o.a.createElement("button",{ref:n,onClick:A,className:"bottom-navbar__btn half",type:"button"},e.loggingOut?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Logging out..."),o.a.createElement("img",{src:L.a,alt:"logging out spinner"})):o.a.createElement(o.a.Fragment,null,o.a.createElement("img",{src:X.a,alt:"logout button icon"}),o.a.createElement("span",null,"Logout"))));case"/view-address":case"/edit-tags":return o.a.createElement(o.a.Fragment,null,o.a.createElement(u.b,{to:{pathname:"/owner-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},o.a.createElement("img",{src:ee.a,alt:"home owner button icon"}),o.a.createElement("span",null,"Owner Info")),o.a.createElement(u.b,{to:{pathname:"/events",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},o.a.createElement("img",{src:de.a,alt:"edit event button icon"}),o.a.createElement("span",null,"Edit Event")),o.a.createElement(u.b,{to:{pathname:"/tag-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},o.a.createElement("img",{src:re.a,alt:"add event button icon"}),o.a.createElement("span",null,"Add Event")),o.a.createElement(u.b,{to:{pathname:"/add-tag",state:{address:c.address,addressId:c.addressId,tagInfoId:r.state.tagInfoId}},className:"bottom-navbar__btn fourth"},o.a.createElement("img",{src:re.a,alt:"add tag icon"}),o.a.createElement("span",null,"Add Tag")));case"/add-tag":return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{ref:a,onClick:I,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button"},o.a.createElement("span",null,"Use Camera")),o.a.createElement("button",{ref:s,onClick:y,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!e.loadedPhotos.length},e.uploadInProgress?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Uploading..."),o.a.createElement("img",{src:ie.a,alt:"uploading spinner"})):o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Upload"))),o.a.createElement("button",{onClick:b,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!(!e.savingToDevice&&e.loadedPhotos.length)},e.savingToDevice?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Saving..."),o.a.createElement("img",{src:ie.a,alt:"saving spinner"})):o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Save To Device"))),o.a.createElement(u.b,{to:{pathname:"/event-tags",state:{address:c.address,addressId:c.addressId,tagInfoId:r.state.tagInfoId}},className:"bottom-navbar__btn quarter caps-blue small-font"},o.a.createElement("span",null,"Cancel")));case"/events":return o.a.createElement(o.a.Fragment,null,o.a.createElement(u.b,{to:{pathname:"/owner-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn toggled third "+(d||f?"":"active")},o.a.createElement("img",{src:ee.a,alt:"home owner button icon"}),o.a.createElement("span",null,"Owner Info")),o.a.createElement(u.b,{to:{pathname:"/tag-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn toggled third "+(f||d?"":"active")},o.a.createElement("img",{src:re.a,alt:"add event button icon"}),o.a.createElement("span",null,"Add Event")));case"/event-tags":case"/tag-info":var m=e.location.state.eventTitle,h=e.location.state.tagInfoId;return o.a.createElement(o.a.Fragment,null,o.a.createElement("button",{onClick:function(){return O(m,c.addressId,h,x)},ref:t,className:"bottom-navbar__btn fourth",type:"button",disabled:!h},p?o.a.createElement(o.a.Fragment,null,o.a.createElement("span",null,"Deleting..."),o.a.createElement("img",{src:L.a,alt:"deleting event spinner"})):o.a.createElement(o.a.Fragment,null,o.a.createElement("img",{src:se.a,alt:"delete button icon"}),o.a.createElement("span",null,"Delete"))),o.a.createElement(u.b,{to:{pathname:"/tag-info",state:{address:c.address,addressId:c.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:m}},className:"bottom-navbar__btn fourth "+(d?"active":"")},o.a.createElement("img",{src:ne.a,alt:"tag info button icon"}),o.a.createElement("span",null,"Event Info")),o.a.createElement(u.b,{to:{pathname:"/event-tags",state:{address:c.address,addressId:c.addressId,tagInfoId:h,eventTitle:m}},className:"bottom-navbar__btn fourth "+(g?"active":"")+(h?"":"disabled"),disabled:!h},o.a.createElement("img",{src:fe.a,alt:"events button icon"}),o.a.createElement("span",null,"Pictures")),o.a.createElement(u.b,{to:{pathname:"/add-tag",state:{address:c.address,addressId:c.addressId,tagInfoId:h,eventTitle:m}},className:"bottom-navbar__btn fourth "+(h?"":"disabled")},o.a.createElement("img",{src:re.a,alt:"add tag icon"}),o.a.createElement("span",null,"Add Picture")));default:return null}}(e.location))},Ce=(n(87),function(e){return o.a.createElement("div",{className:"tagging-tracker__page-404"},o.a.createElement("h2",null,"You've entered an invalid path"),o.a.createElement("p",null,"Try the page(s) below to return to the app"),o.a.createElement(u.b,{to:"/"},"Login"))}),De=(n(88),null),Fe=function(e){var t=Object(r.useRef)(null),n=Object(r.useState)(!1),a=Object(d.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(!1),u=Object(d.a)(i,2),f=u[0],g=u[1],m=Object(r.useState)([]),b=Object(d.a)(m,2),v=b[0],w=b[1],E=Object(r.useState)(!1),y=Object(d.a)(E,2),I=y[0],k=y[1],O=Object(r.useState)(!1),x=Object(d.a)(O,2),_=x[0],j=x[1],S=function(e){return new Promise((function(t,n){var a=new Image;a.src=e,a.onload=function(){a.width<=300&&t(e),function(e,t){var n=300,a=300;if("landscape"===(t.width/t.height>=1?"landscape":"portrait")){a=300*t.height/t.width}else{n=300*t.width/t.height}var r=document.createElement("canvas");r.id="resize-canvas";var o=r.getContext("2d");r.width=n,r.height=a,o.drawImage(t,0,0,n,a),e(r.toDataURL("image/png"))}(t,a)},a.onerror=function(e){n(e)}}))},N=function(){var t,n,a,r;return l.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:k(!0),t=e.offlineStorage,n=e.location.state,a=function(e){var a,r,o,s;return l.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=v[e],r=e,c.next=4,l.a.awrap(S(a.src));case 4:o=c.sent,(s=document.getElementById("resize-canvas"))&&s.remove(),t.transaction("rw",t.tags,(function(){return l.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.awrap(t.tags.add({eventId:De,addressId:n.addressId,fileName:a.meta.name,src:a.src,thumbnail_src:o,meta:a.meta,datetime:A(h())}).then((function(e){return!0})));case 2:if(!e.sent){e.next=6;break}r===v.length-1&&(alert("Photos saved"),w([]),k(!1)),e.next=7;break;case 6:alert("Failed to save photos to device");case 7:case"end":return e.stop()}}))})).catch((function(e){console.log("failed to save photos",e),alert("Failed to save photos to device")}));case 8:case"end":return c.stop()}}))},r=0;case 5:if(!(r<v.length)){o.next=11;break}return o.next=8,l.a.awrap(a(r));case 8:r++,o.next=5;break;case 11:case"end":return o.stop()}}))},C=function(t){var n=new FileReader,a=t.files[0];n.onload=function(t){w(v.concat({addressId:e.location.state.addressId,fileName:a.name,src:t.target.result,thumbanil_src:"",meta:{name:a.name,size:a.size}}))},n.readAsDataURL(a)},D=function(e,t){var n=v;v.filter((function(a,r){t===r&&"undefined"===typeof v[r].meta.width&&(n[r].meta.width=e.width,n[r].meta.height=e.height,w(n))}))};return Object(r.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n;l.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,l.a.awrap(V(e,t));case 2:n=a.sent,De=n?n.eventId:null;case 4:case"end":return a.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[]),Object(r.useEffect)((function(){s||c(!1)}),[s]),Object(r.useEffect)((function(){c(!1)}),[v]),Object(r.useEffect)((function(){f&&!_&&(j(!0),function(){var t=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/upload-tag";p.a.post(t,{headers:{Authorization:"Bearer ".concat(e.token)},images:v}).then((function(e){200===e.status?N():403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):alert("Failed to upload"),g(!1),j(!1)})).catch((function(e){"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status?(alert("You have been logged out, please log back in to upload."),window.location.href="/login"):(console.log("upload err",e),g(!1),j(!1))}))}())}),[f,_]),Object(r.useEffect)((function(){e.setBodyClass("tagging-tracker__body increase-height")}),[e]),o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"tagging-tracker__add-tag move-bottom-navbar-down"},o.a.createElement("input",{type:"file",ref:t,name:"image",onChange:function(){!function(e){e.files.length?C(e):alert("No image selected")}(t.current)},id:"add-tag-file-input"}),v.map((function(e,t){return o.a.createElement("div",{style:{backgroundImage:"url("+e.src+")"},key:t,className:"tagging-tracker__address-tag"},o.a.createElement("img",{alt:e.meta.name,src:e.src,onLoad:function(e){return D(e.target,t)}}))}))),o.a.createElement(Ne,Object.assign({},e,{triggerLoadCamera:c,loadCamera:s,triggerFileUpload:g,fileUpload:f,saveToDevice:N,savingToDevice:I,uploadInProgress:_,setUploadInProgress:j,loadedPhotos:v,appOnline:e.appOnline,token:e.token})))},Te=(n(89),n(17)),Be=n.n(Te),Pe=function(e){var t=e.offlineStorage,n=Object(f.g)(),s=Object(r.useState)(null),c=Object(d.a)(s,2),i=c[0],u=c[1],g=Object(r.useState)(!1),m=Object(d.a)(g,2),p=m[0],h=m[1],A=Object(r.useState)(!1),b=Object(d.a)(A,2),v=(b[0],b[1]),w=Object(r.useState)(null),E=Object(d.a)(w,2),y=E[0],I=E[1];"undefined"===typeof e.location.state&&n.push("/addresses");var k,O;return Object(r.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n,a;l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(V(e,t));case 2:n=r.sent,(a=n?n.eventId:null)&&I(a);case 5:case"end":return r.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[]),Object(r.useEffect)((function(){a&&(a=""),h(!1)}),[i]),o.a.createElement("div",{className:"tagging-tracker__edit-tags tagging-tracker__view-address"},function(){e.location.state.tagInfoId;return t&&!i&&y&&t.open().then((function(e){e.tags.toArray().then((function(t){t.length?e.tags.where("eventId").equals(y).toArray().then((function(e){u(e)})):u([])}))})).catch((function(e){alert("failed to open local storage")})),Array.isArray(i)?i.map((function(e,t){return o.a.createElement("div",{key:t,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",onClick:function(){var t;t=e.meta.name,a=t,h(!0)},className:"address__tag-image delete "+Q(i[t])},o.a.createElement("div",{style:{backgroundImage:"url(".concat(Be.a,")")},className:"tagging-tracker__edit-tags-close-btn"}))})):o.a.createElement("div",{className:"tagging-tracker__edit-tags-loading css-delayed-fade-in"},o.a.createElement("span",null,"Loading tags..."),o.a.createElement("img",{src:L.a,alt:"loading tags spinner"}))}(),(k=e.location.state.addressId,O=a,o.a.createElement("div",{className:"tagging-tracker__edit-tags-delete-prompt"+(p?"":" hidden")},o.a.createElement("h4",null,"Delete Tag ",_(O,40,!0)),o.a.createElement("p",null,"This will delete all information and photos of the tag"),o.a.createElement("div",{className:"edit-tags-delete-prompt__delete-btns"},o.a.createElement("button",{onClick:function(){!function(n,a){t.transaction("rw",t.tags,(function(){t.tags.where("addressId").equals(n).toArray().then((function(n){n.some((function(n){n.fileName&&a===n.fileName&&t.tags.where("fileName").equals(a).delete().then((function(n){n&&t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){u(e)}))}))}))})).catch((function(e){return console.log("deleted tag",e),!1}))?v(!0):alert("Failed to delete tag")})).catch((function(e){alert("Failed to delete tag"),console.log("delete tag",e)}))}(k,O)},className:"delete-btns__delete",type:"button"},"Delete"),o.a.createElement("button",{onClick:function(){h(!1)},className:"delete-btns__cancel",type:"button"},"Cancel")))))},Qe=(n(90),function(e){var t=e.offlineStorage,n=(e.location.state,e.location.state.addressId),a=Object(r.useState)([]),s=Object(d.a)(a,2),c=s[0],i=s[1],l=o.a.createElement("div",{className:"tagging-tracker__events-add-event"},"No Events"),f=o.a.createElement("div",{className:"tagging-tracker__events"},c.reverse().map((function(t,n){return o.a.createElement(u.b,{key:n,to:{pathname:"/tag-info",state:{addressId:t.addressId,address:e.location.state.address,tagInfoId:t.tagInfoId,eventTitle:"Event ".concat(t.datetime?b(t.datetime.split(" ")[0],!0):"")}},className:"tagging-tracker__event"},e.deleteEventsMode?o.a.createElement("button",{type:"button",id:"event-delete-btn"},o.a.createElement("img",{src:Be.a,alt:"delete event icon"})):null,o.a.createElement("div",{id:"event-text"},o.a.createElement("span",{className:"text"},"Event"),o.a.createElement("span",{className:"date"},t.datetime.split(" ")[0])),o.a.createElement("img",{id:"event-view-icon",src:F.a,alt:"open event icon"}))})));return Object(r.useEffect)((function(){if(t){var n="undefined"!==typeof e.location.state.remainingEvents?e.location.state.remainingEvents:null;n&&i(n)}}),[]),Object(r.useEffect)((function(){t&&t.events.where("addressId").equals(n).toArray().then((function(e){i(e)}))}),[t]),c.length?f:l}),Re=(n(91),function(e){var t=Object(f.g)(),n=Object(r.useState)(null),a=Object(d.a)(n,2),s=a[0],c=a[1],i=Object(r.useState)(null),u=Object(d.a)(i,2),g=u[0],m=u[1];"undefined"===typeof e.location.state&&t.push("/addresses");return Object(r.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n,a;l.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,l.a.awrap(V(e,t));case 2:n=r.sent,(a=n?n.eventId:null)&&m(a);case 5:case"end":return r.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[]),o.a.createElement("div",{className:"tagging-tracker__event-tags tagging-tracker__view-address"},function(){var t=e.offlineStorage;e.location.state.tagInfoId;if(t&&g&&!s&&t.open().then((function(e){e.tags.toArray().then((function(t){t.length?e.tags.where("eventId").equals(g).toArray().then((function(e){e.sort((function(e,t){return new Date(t.datetime)-new Date(e.datetime)})),c(e)})):c({})}))})).catch((function(e){alert("failed to open local storage")})),s&&Object.keys(s).length){var n={};return s.forEach((function(e){e.datetime in n?n[e.datetime].push(e):n[e.datetime]=[e]})),Object.keys(n).map((function(e,t){-1!==e.indexOf("T")?e.split("T")[0]:e.split(" ")[0];return o.a.createElement(o.a.Fragment,{key:t},null,n[e].map((function(e,n){return o.a.createElement("div",{key:n,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",className:"address__tag-image "+Q(s[t])})})))}))}return s&&Object(s).length?o.a.createElement("div",{className:"tagging-tracker__view-address-loading css-delayed-fade-in"},o.a.createElement("span",null,"Loading tags..."),o.a.createElement("img",{src:L.a,alt:"loading tags spinner"})):o.a.createElement("div",{className:"tagging-tracker__view-address-no-tags"},o.a.createElement("h4",null,"No Tags"))}())}),Le=function(){var e=Object(r.useState)(""),t=Object(d.a)(e,2),n=t[0],a=t[1],s=Object(r.useState)(""),c=Object(d.a)(s,2),i=c[0],m=c[1],A=Object(r.useState)(!1),b=Object(d.a)(A,2),v=b[0],w=b[1],E=Object(r.useState)(!0),y=Object(d.a)(E,2),I=y[0],k=y[1],O=Object(r.useState)(null),x=Object(d.a)(O,2),_=x[0],S=x[1],N=Object(r.useState)(!1),D=Object(d.a)(N,2),F=D[0],T=D[1],B=Object(r.useState)(!1),Q=Object(d.a)(B,2),R=Q[0],L=Q[1],Y=Object(r.useState)("tagging-tracker__body"),q=Object(d.a)(Y,2),M=q[0],K=q[1],W=Object(r.useState)(!1),V=Object(d.a)(W,2),H=V[0],Z=V[1],z=Object(r.useState)(!1),X=Object(d.a)(z,2),$=X[0],ee=X[1],te=Object(r.useState)([]),ne=Object(d.a)(te,2),ae=ne[0],re=ne[1],oe=Object(r.useState)(!1),se=Object(d.a)(oe,2),ce=se[0],ie=se[1],le=Object(r.useState)(!1),de=Object(d.a)(le,2),ue=de[0],fe=de[1],ge=function(e){m(e)},me=function(e){w(e)},pe=function(){m("")},he=function(e){a(e)},Ae=function(e){var t="online"===e.type;I!==t&&k(!I)},be=function(){return window.addEventListener("online",Ae),window.addEventListener("offline",Ae),function(){window.removeEventListener("online",Ae),window.removeEventListener("offline",Ae)}},ve=function(){var e;return l.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.localStorage.getItem("verChecked")){t.next=5;break}window.localStorage.setItem("verChecked",Date.now()),t.next=12;break;case 5:if(!(Date.now()-e>3e5)){t.next=12;break}return t.next=8,l.a.awrap(new Promise((function(e,t){var n=-1===window.location.href.indexOf("localhost")&&"https://taggingtracker.org";n?p.a.get(n+"/?"+Date.now()).then((function(t){200===t.status&&t.data?e(!0):e(!1)})).catch((function(e){console.log("remote cache clear test",e),t(new Error("no content"))})):e(!1)})));case 8:if(t.sent&&window.caches){t.next=11;break}return t.abrupt("return");case 11:caches.keys().then((function(e){var t=!0,n=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;caches.delete(s)}}catch(c){n=!0,a=c}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}));case 12:case"end":return t.stop()}}))},we=function(){window.localStorage.setItem("verChecked",Date.now()-36e4),ve(),window.location.reload()};return Object(r.useEffect)((function(){be(),_||function(){var e=new g.a("LocalImageDatabase");e.version(4).stores({addresses:"++id,address,lat,lng,created,updated",events:"++,addressId,tagInfoId,tagIds,datetime",tags:"++,fileName,addressId,eventId,meta,datetime,src,thumbnail_src",ownerInfo:"++,addressId,formData",tagInfo:"++,addressId,eventId,formData"}),S(e)}(),ve()})),o.a.createElement("div",{className:"tagging-tracker"},o.a.createElement(u.a,{basename:""},o.a.createElement(f.b,{component:function(e){return o.a.createElement(j,Object.assign({},e,{baseDir:"",searchAddress:ge,searchedAddress:i,toggleAddressModal:me,checkOnlineStatus:be,toggleModifyOwnerInfo:T,modifyOwnerInfo:F,modifyTagInfo:R,toggleModifyTagInfo:L,updateSoftware:we,deletedAddresses:ae,setDeletedAddresses:re,offlineStorage:_,deleteEventsMode:ce,setDeleteEventsMode:ie}))}})," ",o.a.createElement("div",{className:M},o.a.createElement(f.d,null,o.a.createElement(f.b,{exact:!0,path:"/login",component:function(e){return n?o.a.createElement(f.a,{to:"/addresses"}):o.a.createElement(C,Object.assign({},e,{updateToken:he,token:n}))}}),o.a.createElement(f.b,{path:"/view-address",component:function(e){return o.a.createElement(U,Object.assign({},e,{offlineStorage:_}))}}),o.a.createElement(f.b,{path:"/owner-info",component:function(e){return o.a.createElement(J,Object.assign({},e,{modifyOwnerInfo:F,offlineStorage:_}))}}),o.a.createElement(f.b,{path:"/tag-info",component:function(e){return o.a.createElement(G,Object.assign({},e,{modifyTagInfo:R,offlineStorage:_}))}}),o.a.createElement(f.b,{path:"/add-tag",component:function(e){return o.a.createElement(Fe,Object.assign({},e,{offlineStorage:_,setBodyClass:K,token:n,appOnline:I}))}}),o.a.createElement(f.b,{path:"/edit-tags",component:function(e){return o.a.createElement(Pe,Object.assign({},e,{offlineStorage:_}))}}),o.a.createElement(f.b,{path:"/events",component:function(e){return o.a.createElement(Qe,Object.assign({},e,{offlineStorage:_,deleteEventsMode:ce,deletingEvent:ue,setDeletingEvent:fe}))}}),o.a.createElement(f.b,{path:"/event-tags",component:function(e){return o.a.createElement(Re,Object.assign({},e,{offlineStorage:_}))}}),o.a.createElement(f.b,{path:["/","/addresses"],component:function(e){return o.a.createElement(P,Object.assign({},e,{searchedAddress:i,setShowAddressModal:w,showAddressModal:v,toggleAddressModal:me,clearSearchAddress:pe,token:n,offlineStorage:_,getDateTime:h}))}}),o.a.createElement(f.b,null,o.a.createElement(Ce,null)))),o.a.createElement(f.b,{component:function(e){return"/login"!==e.location.pathname&&"/add-tag"!==e.location.pathname?o.a.createElement(Ne,Object.assign({},e,{baseDir:"",appOnline:I,token:n,syncApp:H,setSyncApp:Z,offlineStorage:_,loggingOut:$,updateLoggingOut:ee})):null}})))},Ue=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Ye(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(o.a.createElement(Le,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Ue?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Ye(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Ye(t,e)}))}}()}],[[49,1,2]]]);
//# sourceMappingURL=main.5c5bbae2.chunk.js.map