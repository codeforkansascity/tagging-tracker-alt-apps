(this["webpackJsonptagging-tracker-pwa"]=this["webpackJsonptagging-tracker-pwa"]||[]).push([[0],[,,,,,,,,,function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,function(e,t,n){e.exports=n.p+"static/media/add-square.00e36f36.svg"},,function(e,t,n){e.exports=n.p+"static/media/chevron.f829e185.svg"},function(e,t,n){e.exports=n.p+"static/media/close.3287d96e.svg"},,,,,function(e,t,n){e.exports=n.p+"static/media/property.8673af4c.svg"},function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,,,,,,,,function(e,t,n){},,,function(e,t,n){e.exports=n.p+"static/media/chevron-blue.f91338b6.svg"},,,function(e,t,n){e.exports=n.p+"static/media/tagging-tracker-logo.4295bb0d.PNG"},function(e,t,n){e.exports=n.p+"static/media/location.57fefe5e.svg"},function(e,t,n){e.exports=n.p+"static/media/upload.d4af3f99.svg"},function(e,t,n){e.exports=n.p+"static/media/switch.56cc5584.svg"},function(e,t,n){e.exports=n.p+"static/media/text-document.cec5da5d.svg"},function(e,t,n){e.exports=n.p+"static/media/delete.89314c06.svg"},function(e,t,n){e.exports=n.p+"static/media/pencil.03181e6a.svg"},function(e,t,n){e.exports=n.p+"static/media/photo.0f212d8a.svg"},function(e,t,n){e.exports=n(92)},,,,,function(e,t,n){},function(e,t,n){},,function(e,t,n){},,,,,,,,,,,,,,,,,,,function(e,t,n){},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){e.exports=n.p+"static/media/calendar.fc231d9c.svg"},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(36),c=n.n(o),s=(n(54),n(55),n(1)),i=n.n(s),l=n(2),d=n(3),u=n(11),f=(n(57),n(37)),g=n(8),m=n.n(g),p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_BASE:"https://taggingtracker.org",REACT_APP_API_BASE:"https://api.byx1a2gixtvvnjwxde5y.com",REACT_APP_API_BASE_LOCAL:"http://localhost:5000"}).TZ="America/Chicago";var t=new Date,n=("0"+t.getDate()).slice(-2),a=("0"+(t.getMonth()+1)).slice(-2),r=t.getFullYear(),o=t.getHours(),c=t.getMinutes(),s=t.getSeconds();return"YYYY-MM-DD"===e?"".concat(r,"-").concat(a,"-").concat(n):"MM-DD-YYYY"===e?"".concat(a,"-").concat(n,"-").concat(r):"".concat(r,"-").concat(a,"-").concat(n," ").concat(o,":").concat(c,":").concat(s)},h=function(e){return-1!==e.indexOf("T")&&(e=e.split("T").join(" ").split(".000Z").join("")),e},A=function(e,t){var n=t?"-":"/",a=e.split("-");return a[1]+n+a[2]+n+a[0]},b=n(18),v=(n(76),function(e,t,n){var a,r=e.offlineStorage,o=t.addressId,c=function(){clearTimeout(a),alert("Address deleted! Redirecting..."),n(t)},s=function(e){var t=e.tagInfo.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("tag info deleted"),i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tags",e)})):i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tag info",e)}))},i=function(e){var t=e.tags.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("tags deleted"),l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)})):l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)}))},l=function(e){var t=e.addresses.where("id").equals(o);t.count().then((function(e){e?t.delete().then((function(){console.log("address deleted"),c()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)})):c()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)}))};r?r.open().then((function(e){!function(e){var t=e.ownerInfo.where("addressId").equals(o);t.count().then((function(n){n?t.delete().then((function(){console.log("owner info deleted"),s(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)})):s(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)}))}(e),a=setTimeout((function(){alert("Failed to delete address or taking longer than usual"),n(t)}),6e4)})).catch((function(e){alert("failed to open local storage",e),n(t)})):(alert("Failed to delete address"),n(t))}),w=function(e,t){return new Promise((function(n,a){e.events.where("addressId").equals(t).toArray().then((function(e){n(e)})).catch((function(){n(null)}))}))},E=function(e,t){var n;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.events.where("tagInfoId").equals(t),a.abrupt("return",new Promise((function(e,t){n.count().then((function(t){t&&n.delete().then((function(){e(!0)})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})));case 2:case"end":return a.stop()}}))},y=function(e,t){var n;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return n=e.tags.where("eventId").equals(t),a.abrupt("return",new Promise((function(e,t){n.count().then((function(t){t&&n.delete().then((function(){e(!0)})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})).catch((function(t){alert("Failed to delete data related to event"),e(!1)}))})));case 2:case"end":return a.stop()}}))},I=function(e,t){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(E(e,t));case 2:if(a.sent){a.next=4;break}n(!1);case 4:return a.next=6,i.a.awrap(y(e,t));case 6:if(a.sent){a.next=8;break}n(!1);case 8:n(!0);case 9:case"end":return a.stop()}}))})));case 1:case"end":return n.stop()}}))},k=n(38),O=n.n(k),x=function(e){var t=/(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent),n=!!window.chrome;if(t){if(e)return n?"":"iOS";document.querySelector(".tagging-tracker__body").classList="tagging-tracker__body",document.querySelector(".tagging-tracker__bottom-navbar").classList.add("iOS"),document.querySelector(".tagging-tracker__body").classList.add("iOS"),-1===window.location.href.indexOf("events")&&-1===window.location.href.indexOf("event-tags")||document.querySelector(".tagging-tracker__body").classList.add("less"),-1!==window.location.href.indexOf("tag-info")&&document.querySelector(".tagging-tracker__body").classList.add("toggled-navbar"),-1!==window.location.href.indexOf("add-tag")&&document.querySelector(".tagging-tracker__body").classList.add("add-tag")}else if(e)return""},_=function(e,t,n){return e?e.substr(0,t)+(n&&e.length>t?"...":""):"undefined string"},j=function(e){var t=Object(a.useRef)(null),n=Object(u.g)(),o=Object(a.useState)(!1),c=Object(l.a)(o,2),s=c[0],i=c[1],f=Object(a.useState)(!1),g=Object(l.a)(f,2),m=g[0],p=g[1],h=function(){e.toggleModifyOwnerInfo(!e.modifyOwnerInfo)},A=function(){e.modifyTagInfo&&n.push({pathname:"/events",state:Object(b.a)({},e.location.state,{eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null})}),e.toggleModifyTagInfo(!e.modifyTagInfo)},w=function(t){if(p(!1),Object.keys(t).length){var a=e.deletedAddresses;a.push(t.address),e.setDeletedAddresses(a)}n.push("/addresses")},E=function(){var t=e.location.state;window.confirm("Delete address "+t.address+" ?")&&(p(!0),v(e,t,w))},y=function(){i(!s)};return Object(a.useEffect)((function(){!e.showAddressModal&&"/addresses"===e.location.pathname&&t.current.value.length>0&&t.current.focus(),e.checkOnlineStatus()})),Object(a.useEffect)((function(){m&&E()}),[m]),r.a.createElement("div",{className:"tagging-tracker__navbar"},function(n){var a,o;switch(e.baseDir?n.pathname.replace(e.baseDir+"/",""):n.pathname){case"/":case"/addresses":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tagging-tracker__navbar-top addresses"},r.a.createElement("button",{className:"add",onClick:function(){e.toggleAddressModal(!0)}}),r.a.createElement("h2",null,"Addresses"),r.a.createElement("div",{className:"navbar-top__settings"},r.a.createElement("button",{className:"gear-icon",type:"button",onClick:y}),s?r.a.createElement("div",{className:"navbar-top__settings-menu"},r.a.createElement("button",{onClick:e.updateSoftware,type:"button"},"Update Software")):null)),r.a.createElement("input",{type:"text",value:e.searchedAddress,placeholder:"search",ref:t,onChange:function(t){var n;n=t.target.value,e.searchAddress(n)}}));case"/view-address":case"/edit-tags":case"/tag-info":case"/owner-info":case"/events":case"/event-tags":case"/tags":case"/add-tag":return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tagging-tracker__navbar-top view-address edit-tags add-tags"},r.a.createElement(d.b,{to:{pathname:(o=n.pathname,"/owner-info"===o?"/events":-1!==o.indexOf("tag")?"/events":"/addresses"),state:(n.pathname,a=e.location.state.address,{clearSearch:!0,address:a,addressId:e.location.state.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null})},className:"manage-address__back"},r.a.createElement("img",{src:O.a,alt:"back arrow"}),r.a.createElement("h4",null,function(e,t){var n;return-1!==["/events","/event-tags"].indexOf(e)?(t&&"/event-tags"!==e?(n=t.substring(0,10),t.length>10&&(n+="...")):n="Events",n):"/event-tags"===e||"/owner-info"===e||"/tag-info"===e?"Events":-1!==e.indexOf("tag")?"Event":"Addresses"}(n.pathname,e.location.state.address))),r.a.createElement("h2",{className:"manage-address__name"},function(t,n){return"/tag-info"===t?e.location.state.eventTitle?e.location.state.eventTitle:"Create event":"/owner-info"===t?"Owner Information":"/events"===t?"".concat(_(n,40,!0)," Events"):"/event-tags"===t||"/add-tag"===t||"/edit-tags"===t?e.location.state.eventTitle:n}(n.pathname,e.location.state.address)),function(){var t=e.location.pathname,n=-1!==t.indexOf("edit"),a=-1!==t.indexOf("add-tag");return"/owner-info"===t?r.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:h},e.modifyOwnerInfo?"SAVE":"EDIT"):"/tag-info"===t?r.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:A},e.modifyTagInfo?"SAVE":"EDIT"):"/events"===t?r.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:function(){p(!m)},disabled:!!e.deletingEvents},"Delete"):n?r.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:E,disabled:!!m},"Delete"):r.a.createElement(d.b,{to:{pathname:"/edit-tags",state:{address:e.location.state.address,addressId:e.location.state.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:"undefined"!==typeof e.location.state.eventTitle?e.location.state.eventTitle:null}},className:"manage-address__edit-cancel"},a?"":n?"Delete":"Edit")}()));default:return""}}(e.location))},S=(n(81),n(41)),N=n.n(S),C=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null),o=Object(a.useRef)(null),c=Object(u.g)(),s=Object(a.useState)(!1),i=Object(l.a)(s,2),d=i[0],f=i[1];return Object(a.useEffect)((function(){e.token&&c.push("/addresses")})),r.a.createElement("div",{className:"tagging-tracker__login"},r.a.createElement("img",{alt:"tagging tracker logo",className:"tagging-tracker__login-logo",src:N.a}),r.a.createElement("div",{className:"tagging-tracker__login-fields"},r.a.createElement("input",{type:"text",autocorrect:"off",autocapitalize:"none",name:"username",placeholder:"username",ref:t}),r.a.createElement("input",{type:"password",name:"password",placeholder:"password",ref:n}),r.a.createElement("button",{type:"button",onClick:function(){var a=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/login-user",r=t.current.value,o=n.current.value;r&&o?(f(!0),m.a.post(a,{username:r,password:o}).then((function(t){"undefined"!==typeof t.data.token&&t.data.token&&e.updateToken(e.offlineStorage,t.data.token)})).catch((function(e){alert("failed to login"),f(!1)}))):alert("Please fill in both username and password to login")},ref:o,disabled:!!d},"Login")))},D=(n(82),n(16)),F=n.n(D),T=n(42),B=n.n(T),P=function(e){var t,n=Object(a.useRef)(null),o=Object(a.useRef)(null),c=Object(a.useRef)(null),s=Object(a.useState)(!1),u=Object(l.a)(s,2),f=u[0],g=u[1],m=Object(a.useState)([]),p=Object(l.a)(m,1)[0],h=Object(a.useState)(null),A=Object(l.a)(h,2),b=A[0],v=A[1],w=Object(a.useState)(null),E=Object(l.a)(w,2),y=E[0],I=E[1],k=e.token,O=function(t){var a=t||n.current.value;e.offlineStorage.open().then((function(e){e.addresses.toArray().then((function(t){t.length?e.addresses.where("address").equals(a).toArray().then((function(e){e.length?alert("Address exists"):x(a)})):x(a)}))})).catch((function(e){alert("failed to open local storage")}))},x=function(t){var n;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=e.offlineStorage,t){a.next=4;break}return alert("Please enter an address"),a.abrupt("return");case 4:g(!0),n.transaction("rw",n.addresses,(function(){var a;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(n.addresses.add({address:t,lat:"0.0",lng:"0.0",created:e.getDateTime(),updated:e.getDateTime()}).then((function(e){return a=e,!0})));case 2:if(!r.sent){r.next=8;break}v(p.concat({address:t,addressId:a})),g(!1),e.setShowAddressModal(!1),r.next=9;break;case 8:alert("Failed to save address");case 9:case"end":return r.stop()}}))})).catch((function(e){alert("Failed to save address")}));case 6:case"end":return a.stop()}}))},_=function(e){var t=e.address_components;return"".concat(t[0]?t[0].long_name:"","\n             ").concat(t[1]?t[1].short_name:"")},j=function(){var e=t.getPlace();"name"in e&&O(e.name)};return Object(a.useEffect)((function(){e.showAddressModal&&n.current.focus(),"undefined"!==typeof e.location.state&&"undefined"!==typeof e.location.state.clearSearch&&(delete e.location.state.clearSearch,e.clearSearchAddress()),p&&g(!1)}),[e,p]),Object(a.useEffect)((function(){e.searchedAddress.length?function(t){var n=e.offlineStorage;if(n){var a,r=new RegExp(t,"i");n.addresses.filter((function(e){return r.test(e.address)})).toArray().then((function(e){e.length?a=e.map((function(e){return{address:e.address,addressId:e.id}})):n.tagInfo.filter((function(e){return r.test(e.tagText)})).toArray().then((function(e){a=e.map((function(e){return{address:n.addresses.where("id").equals(e.addressId).toArray().then((function(e){return e[0].id})),addressId:e.addressId}}))})),v(a)}))}}(e.searchedAddress):!e.offlineStorage||p&&b||!p.length&&e.offlineStorage&&e.offlineStorage.addresses.toArray().then((function(e){var t=e.splice(0,15).map((function(e){return{address:e.address,addressId:e.id}}));v(t)})),e.showAddressModal&&k&&(t=new google.maps.places.Autocomplete(n.current,{types:["geocode"]})).addListener("place_changed",j)})),r.a.createElement("div",{className:"tagging-tracker__addresses"},b?b.map((function(e,t){return r.a.createElement(d.b,{key:t,to:{pathname:"/events",state:{address:e.address,addressId:e.addressId}},className:"tagging-tracker__address"},r.a.createElement("h4",null,e.address),r.a.createElement("img",{src:F.a,alt:"right arrow"}))})):"",e.showAddressModal||y?r.a.createElement("div",{className:"tagging-tracker__address-input-modal"},r.a.createElement("h3",null,y?"Select Address":"Create New Address"),r.a.createElement("p",null,y?null:"Please enter a new address that you want to create"),k?null:r.a.createElement("p",{className:"disclaimer-text"},"Note: login required for address autocomplete"),y?r.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-address-set"},r.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-addresses"},y.map((function(e){return r.a.createElement("div",{className:"tagging-tracker__reverse-geocoded-address",onClick:function(){return t=_(e),O(t),void I(null);var t}},_(e))}))),r.a.createElement("button",{className:"tagging-tracker__reverse-geocode-back-btn",type:"button",onClick:function(){return I(null)}},"Back")):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tagging-tracker__address-input-row"},k?r.a.createElement("img",{className:"address-input-row___location-icon",src:B.a,alt:"location icon",onClick:function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var t=e.coords.latitude,n=e.coords.longitude,a=new google.maps.Geocoder,r={lat:parseFloat(t),lng:parseFloat(n)};a.geocode({location:r},(function(e,t){"OK"===t?e[0]?I(e):alert("No address found"):alert("Failed to find an address")}))}),(function(){alert("Failed to determine your location")})):alert("Geolocation not supported on your browser")}}):null,r.a.createElement("input",{type:"text",ref:n,id:"autocomplete"})),r.a.createElement("div",{className:"tagging-tracker__address-input-modal-btns"},r.a.createElement("button",{type:"button",ref:o,onClick:function(){e.toggleAddressModal(!1)}},"CANCEL"),r.a.createElement("button",{type:"button",ref:c,onClick:function(){return O()},disabled:!!f},"CREATE")))):null)},Q=(n(35),function(e){if(Object.keys(e.meta).length&&"undefined"!==typeof e.meta.width){var t=e.meta;return t.width>=t.height?"landscape":"portrait"}return""}),R=n(9),L=n.n(R),q=function(e){var t=Object(u.g)(),n=Object(a.useState)(null),o=Object(l.a)(n,2),c=o[0],s=o[1];"undefined"===typeof e.location.state&&t.push("/addresses");return r.a.createElement("div",{className:"tagging-tracker__view-address"},function(){var t=e.offlineStorage;if(t&&!c&&t.open().then((function(t){t.tags.toArray().then((function(n){n.length?t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){e.sort((function(e,t){return new Date(t.datetime)-new Date(e.datetime)})),s(e)})):s({})}))})).catch((function(e){alert("failed to open local storage")})),c&&Object.keys(c).length){var n={};return c.forEach((function(e){e.datetime in n?n[e.datetime].push(e):n[e.datetime]=[e]})),Object.keys(n).map((function(e,t){var a,o=-1!==e.indexOf("T")?e.split("T")[0]:e.split(" ")[0];return r.a.createElement(r.a.Fragment,{key:t},(a=o,r.a.createElement("h3",{className:"tagging-tracker__view-address-tag-date-group"},r.a.createElement("span",null,"Event")," ",A(a,!1))),n[e].map((function(e,n){return r.a.createElement("div",{key:n,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",className:"address__tag-image "+Q(c[t])})})))}))}return c&&Object(c).length?r.a.createElement("div",{className:"tagging-tracker__view-address-loading css-delayed-fade-in"},r.a.createElement("span",null,"Loading tags..."),r.a.createElement("img",{src:L.a,alt:"loading tags spinner"})):r.a.createElement("div",{className:"tagging-tracker__view-address-no-tags"},r.a.createElement("h4",null,"No Tags"))}())},Y=(n(83),{"Date of entry:":{type:"date"},"Date of abatement:":{type:"date"},"Number of tags:":{type:"number"},"Tag text (separated by commas):":{type:"input"},"Small tag text (separated by commas):":{type:"input"},"Square footage covered:":{type:"number"},"Racial or hate tone?":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Gang related:":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Crossed out tag:":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Type of property:":{type:"radio",options:{commercial:"Commercial",residential:"Residential",public:"Public"}},"Vacant property:":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Land bank property:":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Surface:":{type:"checkbox",options:{brick:"Brick or Stone",concrete:"Concrete",wood:"Wood",glass:"Glass",painted:"Painted",others:"other"}},"Surface other:":{type:"input"},"Need other code enforcement?":{type:"checkbox",options:{buildingDisrepair:"Building disrepair",weeds:"Weeds",trash:"Trash",illegalDumping:"Illegal dumping",others:"other"}},"Other code enforcement:":{type:"input"}}),U=function(e,t,n){var a=arguments;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return a.length>3&&void 0!==a[3]?a[3]:{},r.abrupt("return",new Promise((function(a,r){t.transaction("rw",t.tagInfo,(function(){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:t.tagInfo.add({addressId:e,eventId:null,formData:{}}).then((function(e){a(e)}));case 1:case"end":return n.stop()}}))})).catch((function(e){console.log("failed to create tag info for event",e),alert("Failed to create tag info for event"),n(!1),r()}))})));case 2:case"end":return r.stop()}}))},M=function(e,t,n){return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise((function(a,r){e.transaction("rw",e.events,(function(){e.events.where("addressId").equals(t).toArray().then((function(e){e.length?a(e.some((function(e){return-1!==e.datetime.indexOf(n)}))):a(!1)})).catch((function(e){console.log("failed checking for event duplicate",e),alert("failed check for adding new event"),r(!1)}))}))})));case 1:case"end":return a.stop()}}))},K=function(e,t,n,a,r){var o,c,s=arguments;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return o=s.length>5&&void 0!==s[5]&&s[5],c=a(r()),l.next=4,i.a.awrap(M(n,t,c.split(" ")[0]));case 4:if(!l.sent){l.next=8;break}return alert("Error: Event date already exists"),l.abrupt("return");case 8:return l.abrupt("return",new Promise((function(a,r){n.transaction("rw",n.events,(function(){return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:n.events.add({addressId:t,tagInfoId:e,tagIds:[],datetime:c}).then((function(e){a(e)}));case 1:case"end":return r.stop()}}))})).catch((function(e){console.log("failed to create event",e),alert("Failed to create event"),o(!1),r()}))})));case 10:case"end":return l.stop()}}))},W=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Promise((function(r,o){n.transaction("rw",n.tagInfo,(function(){n.tagInfo.where(":id").equals(e).modify({eventId:t}).then((function(e){r(e)})).catch((function(e){console.log("failed to update tag info with event id",e),alert("failed to update tag info with event id"),a(!1),o(!1)}))}))}))},V=function(e,t){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",new Promise((function(n,a){e.tagInfo.get(t).then((function(e){n(e)})).catch((function(e){console.log("error getting tag info obj"),a()}))})));case 1:case"end":return n.stop()}}))},G=function(e){var t=Object(a.useState)(null),n=Object(l.a)(t,2),o=n[0],c=n[1],s=Object(a.useState)(null),d=Object(l.a)(s,2),u=d[0],f=d[1],g=e.modifyTagInfo,m={"option-0":"dateOfPicture","option-1":"dateOfAbatement","option-2":"numberOfTags","option-3":"tagText","option-4":"smallTagText","option-5":"squareFootageCovered","option-6-0":"racialOrHateTone","option-6-1":"racialOrHateTone","option-6-2":"racialOrHateTone","option-7-0":"gangRelated","option-7-1":"gangRelated","option-7-2":"gangRelated","option-8-0":"crossedOutTag","option-8-1":"crossedOutTag","option-8-2":"crossedOutTag","option-9-0":"typeOfProperty","option-9-1":"typeOfProperty","option-9-2":"typeOfProperty","option-10-0":"vacantProperty","option-10-1":"vacantProperty","option-10-2":"vacantProperty","option-11-0":"landBankProperty","option-11-1":"landBankProperty","option-11-2":"landBankProperty","option-12-0":"surface","option-12-1":"surface","option-12-2":"surface","option-12-3":"surface","option-12-4":"surface","option-12-5":"surface","option-13-0":"otherSurface","option-14-0":"needOtherCodeEnforcement","option-14-1":"needOtherCodeEnforcement","option-14-2":"needOtherCodeEnforcement","option-14-3":"needOtherCodeEnforcement","option-14-4":"needOtherCodeEnforcement","option-15-0":"otherCodeEnforcement"},A=Object(a.useRef)(Object.keys({"Date of entry:":"","Date of abatement:":"","Number of tags:":"","Tag text (separated by commas):":"","Small tag text (separated by commas):":"","Square footage covered:":"","Racial or hate tone?":"","Gang related:":"","Crossed out tag:":"","Type of property:":"","Vacant property:":"","Land bank property:":"","Surface:":"","Surface other:":"","Need other code enforcement?":"","Other code enforcement:":""}).map((function(e){var t=Y[e].type;if("input"===t||"number"===t||"date"===t)return Object(a.createRef)();var n=Y[e].options;return{subRefs:Object.keys(n).map((function(e){return Object(a.createRef)()}))}}))),b=!0,v=function(){var t,n,a,r,o,s;return i.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:if(t=e.offlineStorage,n={},A.current.forEach((function(e){var t="";"undefined"!==typeof e.current&&"undefined"!==typeof e.current.type&&(t=e.current.type),"undefined"!==typeof e.subRefs&&Array.isArray(e.subRefs)?e.subRefs.forEach((function(e){n[e.current.id]=e.current.checked})):n[e.current.name]="text"===t||"number"===t||"date"===t?e.current.value:e.current.checked})),!b){l.next=21;break}if(b=!1,!(a=e.location.state.tagInfoId||u)){l.next=10;break}t.transaction("rw",t.tagInfo,(function(){return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(t.tagInfo.where(":id").equals(a).modify({formData:n},e.location.state.addressId).then((function(e){return!0})));case 2:if(!r.sent){r.next=7;break}c(n),b=!0,r.next=8;break;case 7:alert("Failed to update tag information");case 8:case"end":return r.stop()}}))})).catch((function(e){alert("Failed to update tag information"),console.log("tag info",e)})),l.next=21;break;case 10:return r=e.location.state.addressId,l.next=13,i.a.awrap(U(r,t,!1,n));case 13:return o=l.sent,l.next=16,i.a.awrap(K(o,r,t,h,p));case 16:return s=l.sent,l.next=19,i.a.awrap(W(o,s,t));case 19:c(n),f(o);case 21:case"end":return l.stop()}}))},w=function(e){return"Type of property:"===e||"Vacant property:"===e||"Land bank property:"===e||"Tag text (separated by commas):"===e||"Small tag text (separated by commas):"===e?" full-column-left":""};return Object(a.useEffect)((function(){if(!o){var t=e.location.state.tagInfoId,n=e.offlineStorage;t&&n&&n.tagInfo.get(t,(function(e){e&&c(e.formData)})).catch((function(e){alert("failed to load tagInfo"),console.log("tag info",e)}))}}),[e,o]),r.a.createElement("div",{className:"tagging-tracker__tag-info"},Object.keys(Y).map((function(e,t){return r.a.createElement("div",{key:t,className:"tag-info-field-row"+("checkbox"===Y[e].type?" checkbox":" box")+w(e)},r.a.createElement("span",{className:(n=Y[e].type,"radio"===n?"option-group-label":"checkbox"===n?"full":"input-label")},e),function(e,t,n){var a=e.type;if("input"===a)return m["option-".concat(t)]=null,r.a.createElement("input",{defaultValue:o?o["option-".concat(t)]:"",name:"option-".concat(t),onKeyUp:v,onBlur:v,ref:A.current[t],className:"grow",type:"text",disabled:!g});if("number"===a)return m["option-".concat(t)]=null,r.a.createElement("input",{defaultValue:o?o["option-".concat(t)]:"",name:"option-".concat(t),placeholder:"0",onKeyUp:v,onBlur:v,ref:A.current[t],className:"grow",type:"number",min:"0",disabled:!g});if("date"===a)return r.a.createElement("input",{defaultValue:o?o["option-".concat(t)]:"",name:"option-".concat(t),onKeyUp:v,onBlur:v,ref:A.current[t],className:"grow",type:"date",min:p("MM-DD-YYYY"),disabled:!g});if("radio"!==a&&"checkbox"!==a)return"[unknown field type]";var c=Object.keys(e.options);return c.length?"checkbox"===a?r.a.createElement("div",{className:"padding-left"},c.map((function(n,c){return r.a.createElement("span",{key:c,className:"option-group"},r.a.createElement("input",{checked:!!o&&o["option-".concat(t,"-").concat(c)],onChange:v,onKeyUp:v,ref:A.current[t].subRefs[c],id:"option-".concat(t,"-").concat(c),name:"option-".concat(t,"-").concat(c),type:a,disabled:!g}),r.a.createElement("label",{htmlFor:"option-".concat(t,"-").concat(c)},e.options[n]))}))):c.map((function(n,c){return r.a.createElement("span",{key:c,className:"option-group"},r.a.createElement("input",{checked:!!o&&o["option-".concat(t,"-").concat(c)],onChange:v,onKeyUp:v,id:"option-".concat(t,"-").concat(c),name:m["option-".concat(t,"-").concat(c)],ref:A.current[t].subRefs[c],type:a,disabled:!g}),r.a.createElement("label",{htmlFor:"option-".concat(t,"-").concat(c)},e.options[n]))})):void 0}(Y[e],t));var n})))},J=(n(84),function(e){var t=Object(a.useState)(null),n=Object(l.a)(t,2),o=n[0],c=n[1],s=["Name","Phone","Email","Tenant Name","Tenant Contact Number","Waiver Completed","Need To Follow Up",{"Building Survey":["Would you continue service if you had to pay for it?"]}],d=["name","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer"],u=Object(a.useRef)(s.map((function(){return Object(a.createRef)()}))),f=!0,g=function(t){var n=e.offlineStorage,a={addressId:e.location.state.addressId,formData:{}};t&&u.current.forEach((function(e,t){a.formData[d[t]]=e.current.value})),f&&(f=!1,n.transaction("rw",n.ownerInfo,(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(n.ownerInfo.put({addressId:a.addressId,formData:{name:a.formData.name,phone:a.formData.phone,email:a.formData.email,tenantName:a.formData.tenantName,tenantPhoneNumber:a.formData.tenantPhoneNumber,waiverCompleted:a.formData.waiverCompleted,needFollowUp:a.formData.needFollowUp,buildingSurveyQuestionAnswer:a.formData.buildingSurveyQuestionAnswer}},a.addressId).then((function(){return!0})));case 2:if(!e.sent){e.next=7;break}f=!0,c(a),e.next=8;break;case 7:alert("Failed to update owner information");case 8:case"end":return e.stop()}}))})).catch((function(e){alert("Failed to update owner information"),console.log("owner info",e)})))};return Object(a.useEffect)((function(){!function(){var t,n;i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=e.location.state.addressId,n=e.offlineStorage,!t||!n){a.next=5;break}return a.next=5,i.a.awrap(n.ownerInfo.get(t,(function(e){c(e)})).catch((function(e){alert("failed to open local storage")})));case 5:case"end":return a.stop()}}))}()}),[e,o]),r.a.createElement("div",{className:"tagging-tracker__owner-info"},r.a.createElement("div",{className:"tagging-tracker__owner-info-form"},s.map((function(t,n){return"string"===typeof t?r.a.createElement("div",{key:n,className:"owner-info-form__row"},r.a.createElement("span",null,t,":"),r.a.createElement("input",{defaultValue:o?o.formData[d[n]]:"",onBlur:function(e){return g(e.target.value)},ref:u.current[n],type:"text",readOnly:!e.modifyOwnerInfo})):r.a.createElement("div",{className:"owner-info-form__row group",key:n},r.a.createElement("div",{className:"owner-info-form__row white"},r.a.createElement("span",null,Object.keys(t),":")),Object.keys(t).map((function(a,c){return r.a.createElement("div",{key:c,className:"owner-info-form__sub-row"},r.a.createElement("span",null,t[a]),r.a.createElement("input",{defaultValue:o?o.formData[d[n]]:"",id:"target-me",onChange:g,ref:u.current[n],type:"text",className:"full",readOnly:!e.modifyOwnerInfo}))})))}))))}),Z=(n(85),n(43)),H=n.n(Z),z=n(44),X=n.n(z),$=n(22),ee=n.n($),te=n(45),ne=n.n(te),ae=(n(86),n(14)),re=n.n(ae),oe=n(46),ce=n.n(oe),se=n(23),ie=n.n(se),le=n(47),de=n.n(le),ue=n(48),fe=n.n(ue),ge=function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.addresses.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync addresses err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},me=function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.events.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync events err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},pe=function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tags.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tags err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},he=function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.ownerInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync ownerInfo err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},Ae=function(e){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tagInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tagInfos err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},be=function(e){var t,n;return i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return t=e.offlineStorage,n={},a.abrupt("return",new Promise((function(a){t.addresses.count().then((function(r){var o,c,s,l,d,u;return i.a.async((function(f){for(;;)switch(f.prev=f.next){case 0:if(!(r>0)){f.next=26;break}return f.next=3,i.a.awrap(ge(t));case 3:return o=f.sent,f.next=6,i.a.awrap(me(t));case 6:return c=f.sent,f.next=9,i.a.awrap(pe(t));case 9:return s=f.sent,f.next=12,i.a.awrap(he(t));case 12:return l=f.sent,f.next=15,i.a.awrap(Ae(t));case 15:d=f.sent,u=e.deletedAddresses,o&&(n.addresses=o),c&&(n.events=c),s&&(n.tags=s),l&&(n.ownerInfo=l),d&&(n.tagInfo=d),u&&(n.deletedAddresses=u),a(n),f.next=27;break;case 26:a(n);case 27:case"end":return f.stop()}}))})).catch((function(e){console.timeLog("sync bundle data err",e),a(!1)}))})));case 3:case"end":return a.stop()}}))},ve=function(e){var t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(be(e));case 2:return t=n.sent,n.abrupt("return",new Promise((function(n){if(0!==Object.keys(t).length&&t||e.deletedAddresses.length){var a=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-up";m.a.post(a,{headers:{Authorization:"Bearer ".concat(e.token)},bundledData:t}).then((function(e){201===e.status?n(!0):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):n(!1)})).catch((function(e){console.log("sync err",e),console.log(e.response),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&n({msg:403}),n(!1)}))}else n({msg:"No data to sync"})})));case 4:case"end":return n.stop()}}))},we=function(e){return new Promise((function(t){var n=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-down";m.a.post(n,{headers:{Authorization:"Bearer ".concat(e.token)}}).then((function(e){200===e.status?t(e.data):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):t(!1)})).catch((function(e){console.log("sync err",e),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&t({msg:403}),t(!1)}))}))},Ee=function(e){var t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.offlineStorage){n.next=3;break}return n.abrupt("return");case 3:return n.abrupt("return",new Promise((function(n){t.addresses.count().then((function(t){e.deletedAddresses&&e.deletedAddresses.length||t>0?n(!1):n(!0)})).catch((function(e){console.log("sync addresses err",e),n(!0)}))})));case 4:case"end":return n.stop()}}))},ye=function(e){var t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.a.awrap(Ee(e));case 2:if(!n.sent){n.next=15;break}return n.next=6,i.a.awrap(we(e));case 6:if(!(t=n.sent)){n.next=12;break}return je(e,t),n.abrupt("return",!0);case 12:return n.abrupt("return",{msg:"No data to sync"});case 13:n.next=18;break;case 15:return n.next=17,i.a.awrap(ve(e));case 17:return n.abrupt("return",n.sent);case 18:case"end":return n.stop()}}))},Ie=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.addresses||e(!0),t.addresses.forEach((function(a,r){n.transaction("rw",n.addresses,(function(){n.addresses.add({address:a.address,lat:a.lat,lng:a.lng,created:a.created,updated:a.updated}).then((function(e){return!0}))?r===t.addresses.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},ke=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.events||e(!0),t.events.forEach((function(a,r){n.transaction("rw",n.events,(function(){n.events.add({addressId:a.address_id,tagInfoId:a.tag_info_id,tagIds:JSON.parse(a.tag_ids),datetime:h(a.date_time)}).then((function(e){return!0}))?r===t.events.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},Oe=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.tags||e(!0),t.tags.forEach((function(a,r){n.transaction("rw",n.tags,(function(){var o=JSON.parse(a.meta);n.tags.add({addressId:a.address_id,eventId:a.event_id,fileName:a.filename,thumbnail_src:a.thumbnail_src,meta:o,datetime:a.datetime}).then((function(e){return!0}))?r===t.tags.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},xe=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.ownerInfo||e(!0),t.ownerInfo.forEach((function(a,r){n.transaction("rw",n.ownerInfo,(function(){n.ownerInfo.add({addressId:a.address_id,formData:JSON.parse(a.form_data)}).then((function(e){return!0}))?r===t.ownerInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},_e=function(e,t){var n=e.offlineStorage;return new Promise((function(e){t.tagInfo||e(!0),t.tagInfo.forEach((function(a,r){n.transaction("rw",n.tagInfo,(function(){n.tagInfo.add({addressId:a.address_id,eventId:a.event_id,formData:JSON.parse(a.form_data)}).then((function(e){return!0}))?r===t.tagInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},je=function(e,t){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return!0,n.next=3,i.a.awrap(Ie(e,t));case 3:return n.sent,n.next=6,i.a.awrap(ke(e,t));case 6:return n.sent,n.next=9,i.a.awrap(Oe(e,t));case 9:return n.sent,n.next=12,i.a.awrap(xe(e,t));case 12:return n.sent,n.next=15,i.a.awrap(_e(e,t));case 15:if(!n.sent){n.next=20;break}return n.abrupt("return",!0);case 20:return n.abrupt("return",!1);case 21:case"end":return n.stop()}}))},Se=function(e){return new Promise((function(t){e.delete().then((function(){t(!0)})).catch((function(e){t(!1)}))}))},Ne=function(e){var t=Object(a.useRef)(null),n=Object(a.useRef)(null),o=Object(a.useRef)(null),c=Object(a.useRef)(null),s=Object(u.g)(),f=e.token,g=Object(a.useState)(!1),m=Object(l.a)(g,2),p=m[0],h=m[1],A=function(){return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateLoggingOut(!0),t.next=3,i.a.awrap(Se(e.offlineStorage));case 3:t.sent||alert("failed to clear local data"),window.location.href="/";case 6:case"end":return t.stop()}}))},v=function(){e.saveToDevice()},E=function(){var t;return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.appOnline){n.next=3;break}return alert("Unable to sync, you are offline"),n.abrupt("return");case 3:if(e.token){n.next=6;break}return s.push("/login"),n.abrupt("return");case 6:if(e.syncApp){n.next=13;break}return e.setSyncApp(!0),n.next=10,i.a.awrap(ye(e));case 10:t=n.sent,Object.keys(t).length?"undefined"!==t.msg&&(403===t.msg?alert("You have been logged out, please login to sync"):alert(t.msg)):t||alert("Failed to sync"),e.setSyncApp(!1);case 13:case"end":return n.stop()}}))},y=function(){e.appOnline?e.token?e.triggerFileUpload(!0):window.confirm("You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.")&&s.push("/login"):alert("Unable to upload, you are offline")},k=function(){document.getElementById("add-tag-file-input").click()},O=function(t,n,a,r){window.confirm("Delete "+t+" ?")&&(h(!0),function(e,t,n,a){var r=e.tagInfo.where("eventId").equals(n);r.count().then((function(o){return i.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(!o){c.next=5;break}return c.next=3,i.a.awrap(I(e,n));case 3:if(!c.sent){c.next=5;break}r.delete().then((function(){return i.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",w(e,t));case 1:case"end":return n.stop()}}))})).then((function(e){console.log("finished deleting"),a(e)})).catch((function(e){alert("Failed to delete event"),a()}));case 5:case"end":return c.stop()}}))})).catch((function(e){alert("Failed to delete event"),a()}))}(e.offlineStorage,n,a,r))},_=function(t){h(!1),s.push({pathname:"/events",state:Object(b.a)({},e.location.state,{remainingEvents:t})})};return Object(a.useEffect)((function(){x()})),r.a.createElement("div",{className:-1!==["/owner-info"].indexOf(e.location.pathname)?"tagging-tracker__bottom-navbar floating-btns":"tagging-tracker__bottom-navbar"},function(a){var s=e.location.state,i=e.baseDir?a.pathname.replace(e.baseDir+"/",""):a.pathname,l="/tag-info"===e.location.pathname,u="/events"===e.location.pathname,g=(e.location.pathname,"/event-tags"===e.location.pathname);switch(i){case"/":case"/addresses":return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:E,ref:t,className:"bottom-navbar__btn half sync",type:"button",disabled:!e.appOnline},e.syncApp?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Syncing..."),r.a.createElement("img",{src:L.a,alt:"syncing spinner"})):r.a.createElement(r.a.Fragment,null,f?r.a.createElement("img",{src:H.a,alt:"sync button icon"}):null,r.a.createElement("span",null,f?"Sync":"Login"))),f?r.a.createElement("button",{ref:n,onClick:A,className:"bottom-navbar__btn half",type:"button"},e.loggingOut?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Logging out..."),r.a.createElement("img",{src:L.a,alt:"logging out spinner"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{src:X.a,alt:"logout button icon"}),r.a.createElement("span",null,"Logout"))):null);case"/view-address":case"/edit-tags":return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{to:{pathname:"/owner-info",state:{address:s.address,addressId:s.addressId}},className:"bottom-navbar__btn fourth"},r.a.createElement("img",{src:ee.a,alt:"home owner button icon"}),r.a.createElement("span",null,"Owner Info")),r.a.createElement(d.b,{to:{pathname:"/events",state:{address:s.address,addressId:s.addressId}},className:"bottom-navbar__btn fourth"},r.a.createElement("img",{src:de.a,alt:"edit event button icon"}),r.a.createElement("span",null,"Edit Event")),r.a.createElement(d.b,{to:{pathname:"/tag-info",state:{address:s.address,addressId:s.addressId}},className:"bottom-navbar__btn fourth"},r.a.createElement("img",{src:re.a,alt:"add event button icon"}),r.a.createElement("span",null,"Add Event")),r.a.createElement(d.b,{to:{pathname:"/add-tag",state:{address:s.address,addressId:s.addressId,tagInfoId:a.state.tagInfoId}},className:"bottom-navbar__btn fourth"},r.a.createElement("img",{src:re.a,alt:"add tag icon"}),r.a.createElement("span",null,"Add Tag")));case"/add-tag":return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{ref:o,onClick:k,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button"},r.a.createElement("span",null,"Camera")),r.a.createElement("button",{ref:c,onClick:y,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!e.loadedPhotos.length},e.uploadInProgress?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Uploading..."),r.a.createElement("img",{src:ie.a,alt:"uploading spinner"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Upload"))),r.a.createElement("button",{onClick:v,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!(!e.savingToDevice&&e.loadedPhotos.length)},e.savingToDevice?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Saving..."),r.a.createElement("img",{src:ie.a,alt:"saving spinner"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"On Device"))),r.a.createElement(d.b,{to:{pathname:"/event-tags",state:{address:s.address,addressId:s.addressId,tagInfoId:a.state.tagInfoId}},className:"bottom-navbar__btn quarter caps-blue small-font"},r.a.createElement("span",null,"Cancel")));case"/events":return r.a.createElement(r.a.Fragment,null,r.a.createElement(d.b,{to:{pathname:"/owner-info",state:{address:s.address,addressId:s.addressId}},className:"bottom-navbar__btn toggled third "+(l||u?"":"active")},r.a.createElement("img",{src:ee.a,alt:"home owner button icon"}),r.a.createElement("span",null,"Owner Info")),r.a.createElement(d.b,{to:{pathname:"/tag-info",state:{address:s.address,addressId:s.addressId}},className:"bottom-navbar__btn toggled third "+(u||l?"":"active")},r.a.createElement("img",{src:re.a,alt:"add event button icon"}),r.a.createElement("span",null,"Add Event")));case"/event-tags":case"/tag-info":var m=e.location.state.eventTitle,h=e.location.state.tagInfoId;return r.a.createElement(r.a.Fragment,null,r.a.createElement("button",{onClick:function(){return O(m,s.addressId,h,_)},ref:t,className:"bottom-navbar__btn fourth",type:"button",disabled:!h},p?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"Deleting..."),r.a.createElement("img",{src:L.a,alt:"deleting event spinner"})):r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{src:ce.a,alt:"delete button icon"}),r.a.createElement("span",null,"Delete"))),r.a.createElement(d.b,{to:{pathname:"/tag-info",state:{address:s.address,addressId:s.addressId,tagInfoId:e.location.state.tagInfoId,eventTitle:m}},className:"bottom-navbar__btn fourth "+(l?"active":"")},r.a.createElement("img",{src:ne.a,alt:"tag info button icon"}),r.a.createElement("span",null,"Info")),r.a.createElement(d.b,{to:{pathname:"/event-tags",state:{address:s.address,addressId:s.addressId,tagInfoId:h,eventTitle:m}},className:"bottom-navbar__btn fourth "+(g?"active":"")+(h?"":"disabled"),disabled:!h},r.a.createElement("img",{src:fe.a,alt:"events button icon"}),r.a.createElement("span",null,"Tags")),r.a.createElement(d.b,{to:{pathname:"/add-tag",state:{address:s.address,addressId:s.addressId,tagInfoId:h,eventTitle:m}},className:"bottom-navbar__btn fourth "+(h?"":"disabled")},r.a.createElement("img",{src:re.a,alt:"add tag icon"}),r.a.createElement("span",null,"Add Tag")));default:return null}}(e.location))},Ce=(n(87),function(e){return r.a.createElement("div",{className:"tagging-tracker__page-404"},r.a.createElement("h2",null,"You've entered an invalid path"),r.a.createElement("p",null,"Try the page(s) below to return to the app"),r.a.createElement(d.b,{to:"/"},"Login"))}),De=(n(88),null);function Fe(e){var t=new FileReader;return new Promise((function(n){t.onload=function(e){n(e.target.result)},t.readAsDataURL(e)}))}function Te(e){var t,n,a;return i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:for(t=[],n=0,a=e.length;n<a;n++)t.push(Fe(e[n]));return r.next=4,i.a.awrap(Promise.all(t));case 4:return r.abrupt("return",r.sent);case 5:case"end":return r.stop()}}))}var Be,Pe,Qe=function(e){var t=Object(a.useRef)(null),n=Object(a.useState)(!1),o=Object(l.a)(n,2),c=o[0],s=o[1],d=Object(a.useState)(!1),u=Object(l.a)(d,2),f=u[0],g=u[1],A=Object(a.useState)([]),b=Object(l.a)(A,2),v=b[0],w=b[1],E=Object(a.useState)(!1),y=Object(l.a)(E,2),I=y[0],k=y[1],O=Object(a.useState)(!1),x=Object(l.a)(O,2),_=x[0],j=x[1],S=function(e){return new Promise((function(t,n){var a=new Image;a.src=e,a.onload=function(){a.width<=300&&t(e),function(e,t){var n=300,a=300;t.width/t.height>=1?a=n*t.height/t.width:n=a*t.width/t.height;var r=document.createElement("canvas");r.id="resize-canvas";var o=r.getContext("2d");r.width=n,r.height=a,o.drawImage(t,0,0,n,a),e(r.toDataURL("image/png"))}(t,a)},a.onerror=function(e){n(e)}}))},N=function(){var t,n,a,r;return i.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:k(!0),t=e.offlineStorage,n=e.location.state,a=function(e){var a,r,o,c;return i.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return a=v[e],r=e,s.next=4,i.a.awrap(S(a.src));case 4:o=s.sent,(c=document.getElementById("resize-canvas"))&&c.remove(),t.transaction("rw",t.tags,(function(){return i.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.a.awrap(t.tags.add({eventId:De,addressId:n.addressId,fileName:a.meta.name,src:a.src,thumbnail_src:o,meta:a.meta,datetime:h(p())}).then((function(e){return!0})));case 2:if(!e.sent){e.next=6;break}r===v.length-1&&(alert("Photos saved"),w([]),k(!1)),e.next=7;break;case 6:alert("Failed to save photos to device");case 7:case"end":return e.stop()}}))})).catch((function(e){console.log("failed to save photos",e),alert("Failed to save photos to device")}));case 8:case"end":return s.stop()}}))},r=0;case 5:if(!(r<v.length)){o.next=11;break}return o.next=8,i.a.awrap(a(r));case 8:r++,o.next=5;break;case 11:case"end":return o.stop()}}))},C=function(t){var n,a,r,o,c,s,l;return i.a.async((function(d){for(;;)switch(d.prev=d.next){case 0:return n=t.files,a=n.length,d.next=4,i.a.awrap(Te(n));case 4:r=d.sent,o=[],c=16e6,s=0;case 8:if(!(s<a)){d.next=17;break}if(!((l=n[s]).size>=c)){d.next=13;break}return alert('Selected file "'+l.name+'" is too large, must be smaller than 16mb'),d.abrupt("continue",14);case 13:o.push({addressId:e.location.state.addressId,fileName:l.name,src:r[s],thumbanil_src:"",meta:{name:l.name,size:l.size}});case 14:s++,d.next=8;break;case 17:w(v.concat(o));case 18:case"end":return d.stop()}}))},D=function(e,t){var n=v;v.filter((function(a,r){t===r&&"undefined"===typeof v[r].meta.width&&(n[r].meta.width=e.width,n[r].meta.height=e.height,w(n))}))};return Object(a.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n;i.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,i.a.awrap(V(e,t));case 2:n=a.sent,De=n?n.eventId:null;case 4:case"end":return a.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[e.location.state.tagInfoId,e.offlineStorage]),Object(a.useEffect)((function(){c||s(!1)}),[c]),Object(a.useEffect)((function(){s(!1)}),[v]),Object(a.useEffect)((function(){f&&!_&&(j(!0),function(){var t=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/upload-tag";m.a.post(t,{headers:{Authorization:"Bearer ".concat(e.token)},images:v}).then((function(e){200===e.status?N():403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):alert("Failed to upload"),g(!1),j(!1)})).catch((function(e){"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status?(alert("You have been logged out, please log back in to upload."),window.location.href="/login"):(console.log("upload err",e),g(!1),j(!1))}))}())}),[f,_]),Object(a.useEffect)((function(){e.setBodyClass("tagging-tracker__body increase-height")}),[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"tagging-tracker__add-tag move-bottom-navbar-down"},r.a.createElement("input",{type:"file",ref:t,name:"image",onChange:function(){!function(e){e.files.length?C(e):alert("No image selected")}(t.current)},id:"add-tag-file-input",multiple:!0}),v.map((function(e,t){return r.a.createElement("div",{style:{backgroundImage:"url("+e.src+")"},key:t,className:"tagging-tracker__address-tag"},r.a.createElement("img",{alt:e.meta.name,src:e.src,onLoad:function(e){return D(e.target,t)}}))}))),r.a.createElement(Ne,Object.assign({},e,{triggerLoadCamera:s,loadCamera:c,triggerFileUpload:g,fileUpload:f,saveToDevice:N,savingToDevice:I,uploadInProgress:_,setUploadInProgress:j,loadedPhotos:v,appOnline:e.appOnline,token:e.token})))},Re=(n(89),n(17)),Le=n.n(Re),qe=function(e){var t=e.offlineStorage,n=Object(u.g)(),o=Object(a.useState)(null),c=Object(l.a)(o,2),s=c[0],d=c[1],f=Object(a.useState)(!1),g=Object(l.a)(f,2),m=g[0],p=g[1],h=Object(a.useState)(!1),A=Object(l.a)(h,2),b=(A[0],A[1]),v=Object(a.useState)(null),w=Object(l.a)(v,2),E=w[0],y=w[1];"undefined"===typeof e.location.state&&n.push("/addresses");var I,k;return Object(a.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n,a;i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(V(e,t));case 2:n=r.sent,(a=n?n.eventId:null)&&y(a);case 5:case"end":return r.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[]),Object(a.useEffect)((function(){Be&&(Be=""),p(!1)}),[s]),r.a.createElement("div",{className:"tagging-tracker__edit-tags tagging-tracker__view-address"},function(){e.location.state.tagInfoId;return t&&!s&&E&&t.open().then((function(e){e.tags.toArray().then((function(t){t.length?e.tags.where("eventId").equals(E).toArray().then((function(e){d(e)})):d([])}))})).catch((function(e){alert("failed to open local storage")})),Array.isArray(s)?s.map((function(e,t){return r.a.createElement("div",{key:t,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",onClick:function(){var t;t=e.meta.name,Be=t,p(!0)},className:"address__tag-image delete "+Q(s[t])},r.a.createElement("div",{style:{backgroundImage:"url(".concat(Le.a,")")},className:"tagging-tracker__edit-tags-close-btn"}))})):r.a.createElement("div",{className:"tagging-tracker__edit-tags-loading css-delayed-fade-in"},r.a.createElement("span",null,"Loading tags..."),r.a.createElement("img",{src:L.a,alt:"loading tags spinner"}))}(),(I=e.location.state.addressId,k=Be,r.a.createElement("div",{className:"tagging-tracker__edit-tags-delete-prompt"+(m?"":" hidden")},r.a.createElement("h4",null,"Delete Tag ",_(k,40,!0)),r.a.createElement("p",null,"This will delete all information and photos of the tag"),r.a.createElement("div",{className:"edit-tags-delete-prompt__delete-btns"},r.a.createElement("button",{onClick:function(){!function(n,a){t.transaction("rw",t.tags,(function(){t.tags.where("addressId").equals(n).toArray().then((function(n){n.some((function(n){n.fileName&&a===n.fileName&&t.tags.where("fileName").equals(a).delete().then((function(n){n&&t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){d(e)}))}))}))})).catch((function(e){return console.log("deleted tag",e),!1}))?b(!0):alert("Failed to delete tag")})).catch((function(e){alert("Failed to delete tag"),console.log("delete tag",e)}))}(I,k)},className:"delete-btns__delete",type:"button"},"Delete"),r.a.createElement("button",{onClick:function(){p(!1)},className:"delete-btns__cancel",type:"button"},"Cancel")))))},Ye=(n(90),function(e){var t=e.offlineStorage,n=(e.location.state,e.location.state.addressId),o=Object(a.useState)([]),c=Object(l.a)(o,2),s=c[0],i=c[1],u=r.a.createElement("div",{className:"tagging-tracker__events-add-event"},"No Events"),f=r.a.createElement("div",{className:"tagging-tracker__events"},s.reverse().map((function(t,n){return r.a.createElement(d.b,{key:n,to:{pathname:"/tag-info",state:{addressId:t.addressId,address:e.location.state.address,tagInfoId:t.tagInfoId,eventTitle:"Event ".concat(t.datetime?A(t.datetime.split(" ")[0],!0):"")}},className:"tagging-tracker__event"},e.deleteEventsMode?r.a.createElement("button",{type:"button",id:"event-delete-btn"},r.a.createElement("img",{src:Le.a,alt:"delete event icon"})):null,r.a.createElement("div",{id:"event-text"},r.a.createElement("span",{className:"text"},"Event"),r.a.createElement("span",{className:"date"},t.datetime.split(" ")[0])),r.a.createElement("img",{id:"event-view-icon",src:F.a,alt:"open event icon"}))})));return Object(a.useEffect)((function(){if(t){var n="undefined"!==typeof e.location.state.remainingEvents?e.location.state.remainingEvents:null;n&&i(n)}}),[]),Object(a.useEffect)((function(){t&&t.events.where("addressId").equals(n).toArray().then((function(e){i(e)}))}),[t]),s.length?f:u}),Ue=(n(91),function(e){var t=Object(u.g)(),n=Object(a.useState)(null),o=Object(l.a)(n,2),c=o[0],s=o[1],d=Object(a.useState)(null),f=Object(l.a)(d,2),g=f[0],m=f[1];"undefined"===typeof e.location.state&&t.push("/addresses");return Object(a.useEffect)((function(){e.offlineStorage&&e.location.state.tagInfoId&&function(e,t){var n,a;i.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,i.a.awrap(V(e,t));case 2:n=r.sent,(a=n?n.eventId:null)&&m(a);case 5:case"end":return r.stop()}}))}(e.offlineStorage,e.location.state.tagInfoId)}),[]),r.a.createElement("div",{className:"tagging-tracker__event-tags tagging-tracker__view-address"},function(){var t=e.offlineStorage;e.location.state.tagInfoId;if(t&&g&&!c&&t.open().then((function(e){e.tags.toArray().then((function(t){t.length?e.tags.where("eventId").equals(g).toArray().then((function(e){e.sort((function(e,t){return new Date(t.datetime)-new Date(e.datetime)})),s(e)})):s({})}))})).catch((function(e){alert("failed to open local storage")})),c&&Object.keys(c).length){var n={};return c.forEach((function(e){e.datetime in n?n[e.datetime].push(e):n[e.datetime]=[e]})),Object.keys(n).map((function(e,t){-1!==e.indexOf("T")?e.split("T")[0]:e.split(" ")[0];return r.a.createElement(r.a.Fragment,{key:t},null,n[e].map((function(e,n){return r.a.createElement("div",{key:n,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",className:"address__tag-image "+Q(c[t])})})))}))}return c&&Object(c).length?r.a.createElement("div",{className:"tagging-tracker__view-address-loading css-delayed-fade-in"},r.a.createElement("span",null,"Loading tags..."),r.a.createElement("img",{src:L.a,alt:"loading tags spinner"})):r.a.createElement("div",{className:"tagging-tracker__view-address-no-tags"},r.a.createElement("h4",null,"No Tags"))}())}),Me=function(){var e=Object(a.useState)(Pe),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),s=Object(l.a)(c,2),g=s[0],h=s[1],A=Object(a.useState)(!1),b=Object(l.a)(A,2),v=b[0],w=b[1],E=Object(a.useState)(!0),y=Object(l.a)(E,2),I=y[0],k=y[1],O=Object(a.useState)(null),_=Object(l.a)(O,2),S=_[0],N=_[1],D=Object(a.useState)(!1),F=Object(l.a)(D,2),T=F[0],B=F[1],Q=Object(a.useState)(!1),R=Object(l.a)(Q,2),L=R[0],Y=R[1],U=Object(a.useState)("tagging-tracker__body"),M=Object(l.a)(U,2),K=M[0],W=M[1],V=Object(a.useState)(!1),Z=Object(l.a)(V,2),H=Z[0],z=Z[1],X=Object(a.useState)(!1),$=Object(l.a)(X,2),ee=$[0],te=$[1],ne=Object(a.useState)([]),ae=Object(l.a)(ne,2),re=ae[0],oe=ae[1],ce=Object(a.useState)(!1),se=Object(l.a)(ce,2),ie=se[0],le=se[1],de=Object(a.useState)(!1),ue=Object(l.a)(de,2),fe=ue[0],ge=ue[1],me=function(e){h(e)},pe=function(e){w(e)},he=function(){h("")},Ae=function(e,t){e.tokens.where("tokenId").equals(1).count().then((function(n){n?e.tokens.where("tokenId").equals(1).modify({token:t}).then((function(){o(t)})).catch((function(){alert("failed to login")})):e.tokens.add({tokenId:1,token:t}).then((function(){o(t)})).catch((function(){alert("failed to login")}))})).catch((function(e){console.log(e),alert("failed to login")}))},be=function(e){var t="online"===e.type;I!==t&&k(!I)},ve=function(){return window.addEventListener("online",be),window.addEventListener("offline",be),function(){window.removeEventListener("online",be),window.removeEventListener("offline",be)}},we=function(){var e;return i.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.localStorage.getItem("verChecked")){t.next=5;break}window.localStorage.setItem("verChecked",Date.now()),t.next=12;break;case 5:if(!(Date.now()-e>3e5)){t.next=12;break}return t.next=8,i.a.awrap(new Promise((function(e,t){var n=-1===window.location.href.indexOf("localhost")&&"https://taggingtracker.org";n?m.a.get(n+"/?"+Date.now()).then((function(t){200===t.status&&t.data?e(!0):e(!1)})).catch((function(e){console.log("remote cache clear test",e),t(new Error("no content"))})):e(!1)})));case 8:if(t.sent&&window.caches){t.next=11;break}return t.abrupt("return");case 11:caches.keys().then((function(e){var t=!0,n=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var c=r.value;caches.delete(c)}}catch(s){n=!0,a=s}finally{try{t||null==o.return||o.return()}finally{if(n)throw a}}}));case 12:case"end":return t.stop()}}))},Ee=function(){window.localStorage.setItem("verChecked",Date.now()-36e4),we(),window.location.reload()};return Object(a.useEffect)((function(){ve(),S||function(){var e=new f.a("LocalImageDatabase");e.version(4).stores({addresses:"++id,address,lat,lng,created,updated",events:"++,addressId,tagInfoId,tagIds,datetime",tags:"++,fileName,addressId,eventId,meta,datetime,src,thumbnail_src",ownerInfo:"++,addressId,formData",tagInfo:"++,addressId,eventId,formData",tokens:"++,tokenId,token"}),N(e)}(),we(),window.addEventListener("load",(function(){var e=document.querySelector(".tagging-tracker"),t=navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&-1==navigator.userAgent.indexOf("CriOS")&&-1==navigator.userAgent.indexOf("FxiOS");e&&!e.classList.contains("safari-mod")&&t&&!(!0===navigator.standalone||window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches)&&(e.classList=e.classList+" safari-mod"),window.removeEventListener("load",(function(){}))}))})),Object(a.useEffect)((function(){S&&S.tokens.where("tokenId").equals(1).toArray().then((function(e){var t;e.length&&(Pe=null===(t=e[0])||void 0===t?void 0:t.token,o(Pe))})).catch((function(e){alert("failed to get previous login, please login again")}))}),[S]),r.a.createElement("div",{className:"tagging-tracker ".concat(x(!0))},r.a.createElement(d.a,{basename:""},r.a.createElement(u.b,{component:function(e){return r.a.createElement(j,Object.assign({},e,{baseDir:"",searchAddress:me,searchedAddress:g,toggleAddressModal:pe,checkOnlineStatus:ve,toggleModifyOwnerInfo:B,modifyOwnerInfo:T,modifyTagInfo:L,toggleModifyTagInfo:Y,updateSoftware:Ee,deletedAddresses:re,setDeletedAddresses:oe,offlineStorage:S,deleteEventsMode:ie,setDeleteEventsMode:le}))}})," ",r.a.createElement("div",{className:"".concat(K," ").concat(x(!0))},r.a.createElement(u.d,null,r.a.createElement(u.b,{exact:!0,path:"/login",component:function(e){return n?r.a.createElement(u.a,{to:"/addresses"}):r.a.createElement(C,Object.assign({},e,{offlineStorage:S,updateToken:Ae,token:n}))}}),r.a.createElement(u.b,{path:"/view-address",component:function(e){return r.a.createElement(q,Object.assign({},e,{offlineStorage:S}))}}),r.a.createElement(u.b,{path:"/owner-info",component:function(e){return r.a.createElement(J,Object.assign({},e,{modifyOwnerInfo:T,offlineStorage:S}))}}),r.a.createElement(u.b,{path:"/tag-info",component:function(e){return r.a.createElement(G,Object.assign({},e,{modifyTagInfo:L,offlineStorage:S}))}}),r.a.createElement(u.b,{path:"/add-tag",component:function(e){return r.a.createElement(Qe,Object.assign({},e,{offlineStorage:S,setBodyClass:W,token:n,appOnline:I}))}}),r.a.createElement(u.b,{path:"/edit-tags",component:function(e){return r.a.createElement(qe,Object.assign({},e,{offlineStorage:S}))}}),r.a.createElement(u.b,{path:"/events",component:function(e){return r.a.createElement(Ye,Object.assign({},e,{offlineStorage:S,deleteEventsMode:ie,deletingEvent:fe,setDeletingEvent:ge}))}}),r.a.createElement(u.b,{path:"/event-tags",component:function(e){return r.a.createElement(Ue,Object.assign({},e,{offlineStorage:S}))}}),r.a.createElement(u.b,{path:["/","/addresses"],component:function(e){return r.a.createElement(P,Object.assign({},e,{searchedAddress:g,setShowAddressModal:w,showAddressModal:v,toggleAddressModal:pe,clearSearchAddress:he,token:n,offlineStorage:S,getDateTime:p}))}}),r.a.createElement(u.b,null,r.a.createElement(Ce,null)))),r.a.createElement(u.b,{component:function(e){return"/login"!==e.location.pathname&&"/add-tag"!==e.location.pathname?r.a.createElement(Ne,Object.assign({},e,{baseDir:"",appOnline:I,token:n,syncApp:H,setSyncApp:z,offlineStorage:S,loggingOut:ee,updateLoggingOut:te})):null}})))},Ke=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function We(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}c.a.render(r.a.createElement(Me,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");Ke?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):We(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):We(t,e)}))}}()}],[[49,1,2]]]);
//# sourceMappingURL=main.fac1f606.chunk.js.map