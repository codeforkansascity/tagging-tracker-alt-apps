{"version":3,"sources":["assets/gifs/ajax-loader--gray.gif","assets/icons/svgs/add-square.svg","assets/icons/svgs/chevron.svg","assets/icons/svgs/close.svg","assets/icons/svgs/property.svg","assets/gifs/ajax-loader--blue.gif","assets/icons/svgs/chevron-blue.svg","assets/images/tagging-tracker-logo.PNG","assets/icons/svgs/location.svg","assets/icons/svgs/upload.svg","assets/icons/svgs/switch.svg","assets/icons/svgs/text-document.svg","assets/icons/svgs/delete.svg","assets/icons/svgs/pencil.svg","assets/icons/svgs/photo.svg","assets/icons/svgs/calendar.svg","components/edit-tags/EditTags.js","utils/date.js","utils/delete.js","utils/misc.js","components/navbar/Navbar.js","components/login/Login.js","components/addresses/Addresses.js","utils/image.js","components/view-address/ViewAddress.js","utils/tagFields.js","components/events/eventUtils.js","components/tag-info/TagInfo.js","components/owner-info/OwnerInfo.js","utils/sync/syncUp.js","utils/sync/syncDown.js","utils/sync/sync.js","components/bottom-navbar/BottomNavbar.js","pages/page404/Page404.js","components/add-tag/AddTag.js","components/events/Events.js","components/event-tags/EventTags.js","App.js","serviceWorker.js","index.js"],"names":["module","exports","fileNameOfImageToDelete","getDateTime","format","process","TZ","date_ob","Date","date","getDate","slice","month","getMonth","year","getFullYear","hours","getHours","minutes","getMinutes","seconds","getSeconds","formatTimeStr","timeStr","indexOf","split","join","flipDateFormat","yyyyMmDd","useHyphens","divider","dateParts","deleteAddress","props","addressObj","finishedDeletingAddress","backupDelFailTimer","db","offlineStorage","addressId","doneDeleting","clearTimeout","alert","deleteAddressTagInfo","dbOpened","tagInfo","where","equals","count","then","delete","console","log","deleteAddressTags","catch","err","tags","deleteAddressRow","addresses","open","ownerInfo","deleteAddressOwnerInfo","setTimeout","getCurEvents","Promise","resolve","reject","events","toArray","deleteEventRow","tagInfoId","a","async","event","deleteEventTags","deleteEventRelatedData","truncateText","text","length","ellipsis","substr","Navbar","searchAddressInput","useRef","history","useHistory","useState","showSettings","setShowSettings","deletingAddress","setDeletingAddress","editSaveOwnerInfo","toggleModifyOwnerInfo","modifyOwnerInfo","editTagInfo","modifyTagInfo","push","pathname","state","location","eventTitle","toggleModifyTagInfo","Object","keys","tmpArr","deletedAddresses","address","setDeletedAddresses","deleteAddressCallback","window","confirm","toggleSettings","useEffect","showAddressModal","current","value","focus","checkOnlineStatus","className","routeLocation","path","baseDir","replace","onClick","toggleAddressModal","type","updateSoftware","searchedAddress","placeholder","ref","onChange","e","searchStr","target","searchAddress","to","clearSearch","src","backArrow","alt","addressOutput","substring","getBackButtonTitle","getNavTitle","isEditTagsPath","isAddTagPath","disabled","deletingEvents","generateEditBtn","renderNavbar","Login","usernameInput","passwordInput","loginBtn","loginProcessing","setLoginProcessing","token","taggingTrackerLogo","name","postUrl","href","username","password","axios","post","res","data","updateToken","Addresses","autoComplete","newAddressInput","cancelAddAddressBtn","createAddressBtn","addAddressProcessing","setAddAddressProcessing","recentAddresses","activeAddresses","setActiveAddresses","revGeocodedAdresses","setRevGeocodedAddresses","checkAddressExists","autoCompleteAddress","addressStr","saveAddress","transaction","add","lat","lng","created","updated","insertedId","newRowId","concat","setShowAddressModal","generateAddressStr","revGeocodedAddressObj","addressComponents","address_components","long_name","short_name","suggestedAddressPicked","getPlace","clearSearchAddress","addressesFormatted","regex","RegExp","filter","test","map","id","tag","tagText","searchAddresses","splice","google","maps","places","Autocomplete","addListener","index","key","rightArrow","navigator","geolocation","getCurrentPosition","position","navLat","coords","latitude","navLong","longitude","geocoder","Geocoder","latlng","parseFloat","geocode","results","status","getImagePreviewAspectRatioClass","loadedPhoto","meta","width","imageMeta","height","ViewAddress","localImages","setLocalImages","sort","b","datetime","tagsGroupedByDate","forEach","image","dispDate","groupDate","Fragment","subIndex","style","backgroundImage","thumbnail_src","ajaxLoaderGray","renderTags","tagInfoFields","options","yes","no","other","commercial","residential","public","brick","concrete","wood","glass","painted","others","buildingDisrepair","weeds","trash","illegalDumping","addNewTagInfo","setAddingEvent","eventId","formData","checkEventExistsByDate","checkDate","some","addNewEvent","todaysDate","tagIds","updateTagInfoEventId","modify","updatedId","getTagInfoObjById","get","TagInfo","setTagInfo","setTagInfoId","nameValueMap","tagInfoInputElements","fieldKey","fieldType","createRef","subFields","subRefs","subFieldKey","updateDone","updateTagInfo","mappedFieldValues","element","elementType","Array","isArray","subElement","checked","existingTagInfoId","modifyClassWrapper","field","fieldGroup","mainIndex","defaultValue","onKeyUp","onBlur","min","optionKeys","optionKey","htmlFor","generateInputType","OwnerInfo","setOwnerInfo","formLabels","fieldKeys","inputElements","updateInfo","inputValue","ownerInfoValues","input","put","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer","getOwnerInfo","formField","readOnly","subGroup","subGroupIndex","getLocalAddresses","localStorage","getEvents","getLocalTags","getLocalOwnerInfo","ownerInfos","getTagInfo","tagInfos","bundleData","bundledData","timeLog","syncUp","headers","Authorization","response","msg","syncDown","isLocalStorageEmpty","syncUserData","updateLocalStorageFromSync","updateLocalAddresses","remoteData","addressRow","updateLocalEvents","eventRow","address_id","tag_info_id","JSON","parse","tag_ids","date_time","updateLocalTags","tagRow","tagMeta","event_id","fileName","filename","updateLocalOwnerInfo","ownerInfoRow","form_data","updateLocalTagInfo","tagInfoRow","deleteLocalData","BottomNavbar","syncBtn","logoutBtn","cameraBtn","uploadBtn","deletingEvent","setDeletingEvent","logout","updateLoggingOut","saveToDevice","sync","appOnline","syncApp","setSyncApp","synced","uploadImages","triggerFileUpload","directCameraClick","document","getElementById","click","confirmDeleteEvent","callback","deleteEventCallBack","curEvents","deleteEvent","doneDeletingEvent","remainingEvents","userAgent","querySelector","classList","routePath","tagInfoPath","eventsPath","eventTagsPath","syncIcon","loggingOut","logoutIcon","property","edit","addSquare","loadedPhotos","uploadInProgress","ajaxLoaderBlue","savingToDevice","deleteIcon","textDocument","photo","renderBottomNavbar","Page404","AddTag","fileInput","loadCamera","triggerLoadCamera","fileUpload","setLoadedPhotos","setSavingToDevice","setUploadInProgress","createThumbnailSrc","img","Image","onload","newImageWidth","newImageHeight","canvas","createElement","ctx","getContext","drawImage","toDataURL","scaleImage","onerror","i","thumbnailSrc","oldCanvas","remove","previewPhoto","reader","FileReader","file","files","result","thumbanil_src","size","readAsDataURL","setLoadedImageMeta","loadedImage","loopIndex","loadedPhotosClone","tagInfoObj","getEventId","images","setBodyClass","cameraCallback","onLoad","EditTags","deletePrompt","toggleDeletePrompt","setDeleteInProgress","setEventId","closeIcon","deleteCount","deleteImage","Events","setEvents","renderNoEvents","renderEvents","reverse","deleteEventsMode","EventTags","App","setToken","updateSearchedAddress","setAppOnline","setOfflineStorage","bodyClass","setDeleteEventsMode","show","clearSearchedAddress","updateAppOnlineState","online","addEventListener","removeEventListener","checkForNewVersion","verChecked","getItem","setItem","now","frontEndBasePath","error","Error","caches","names","reload","Dexie","version","stores","setupOfflineStorage","basename","component","exact","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","URL","origin","fetch","contentType","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.5c5bbae2.chunk.js","sourcesContent":["module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/add-square.00e36f36.svg\";","module.exports = __webpack_public_path__ + \"static/media/chevron.8417a1be.svg\";","module.exports = __webpack_public_path__ + \"static/media/close.db093ba0.svg\";","module.exports = __webpack_public_path__ + \"static/media/property.8673af4c.svg\";","module.exports = \"data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==\"","module.exports = __webpack_public_path__ + \"static/media/chevron-blue.f48ced71.svg\";","module.exports = __webpack_public_path__ + \"static/media/tagging-tracker-logo.4295bb0d.PNG\";","module.exports = __webpack_public_path__ + \"static/media/location.57fefe5e.svg\";","module.exports = __webpack_public_path__ + \"static/media/upload.d4af3f99.svg\";","module.exports = __webpack_public_path__ + \"static/media/switch.e4b4aac4.svg\";","module.exports = __webpack_public_path__ + \"static/media/text-document.e93f329b.svg\";","module.exports = __webpack_public_path__ + \"static/media/delete.89314c06.svg\";","module.exports = __webpack_public_path__ + \"static/media/pencil.af8b5189.svg\";","module.exports = __webpack_public_path__ + \"static/media/photo.0f212d8a.svg\";","module.exports = __webpack_public_path__ + \"static/media/calendar.0897f518.svg\";","import React, { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './EditTags.scss';\r\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\r\nimport closeIcon from './../../assets/icons/svgs/close.svg';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\nimport { truncateText } from '../../utils/misc';\r\nimport { getTagInfoObjById } from './../events/eventUtils';\r\n\r\n// TODO this is bad but poor design\r\nlet fileNameOfImageToDelete;\r\n\r\nconst EditTags = (props) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    const history = useHistory();\r\n    const [localImages, setLocalImages] = useState(null);\r\n    const [deletePrompt, toggleDeletePrompt] = useState(false);\r\n    const [deleteInProgress, setDeleteInProgress] = useState(false); // eslint-disable-line\r\n    const [eventId, setEventId] = useState(null);\r\n    \r\n    if (typeof props.location.state === \"undefined\") {\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const deleteImage = (addressId, fileName) => {\r\n        offlineStorage.transaction('rw', offlineStorage.tags, () => {\r\n            if (\r\n                offlineStorage.tags.where(\"addressId\").equals(addressId).toArray()\r\n                    .then((images) => {\r\n                        images.some((image) => { // eslint-disable-line\r\n                            if (image.fileName && fileName === image.fileName) {\r\n                                offlineStorage.tags.where(\"fileName\").equals(fileName).delete().then((deleteCount) => {\r\n                                    if (deleteCount) {\r\n                                        offlineStorage.tags\r\n                                            .where(\"addressId\").equals(props.location.state.addressId)\r\n                                            .toArray().then((tags) => {\r\n                                                setLocalImages(tags);\r\n                                            });\r\n                                    }\r\n                                })\r\n                            }\r\n                        })\r\n                    })\r\n                    .catch((e) => {\r\n                        console.log('deleted tag', e);\r\n                        return false;\r\n                    })\r\n            ) {\r\n                setDeleteInProgress(true);\r\n            } else {\r\n                alert('Failed to delete tag');\r\n            }\r\n        })\r\n        .catch(e => {\r\n            alert('Failed to delete tag');\r\n            console.log('delete tag', e);\r\n        });\r\n    }\r\n\r\n    const showDeletePrompt = (fileName) => {\r\n        fileNameOfImageToDelete = fileName;\r\n        toggleDeletePrompt(true);\r\n    }\r\n\r\n    const renderDeletePrompt = (addressId, fileName) => {\r\n        return (\r\n            <div className={\"tagging-tracker__edit-tags-delete-prompt\" + (deletePrompt ? \"\" : \" hidden\")}>\r\n                <h4>Delete Tag {truncateText(fileName,40,true)}</h4>\r\n                <p>This will delete all information and photos of the tag</p>\r\n                <div className=\"edit-tags-delete-prompt__delete-btns\">\r\n                    <button onClick={() => { deleteImage(addressId, fileName) }} className=\"delete-btns__delete\" type=\"button\">Delete</button>\r\n                    <button onClick={() => { toggleDeletePrompt(false) }} className=\"delete-btns__cancel\" type=\"button\">Cancel</button>\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    const renderTags = () => {\r\n        const tagInfoId = typeof props.location.state.tagInfoId !== \"undefined\";\r\n\r\n        // if tagInfoId exists filter the pictures out\r\n        // have to save the pictures with tagInfoId first\r\n\r\n        if (offlineStorage && !localImages && eventId) {\r\n            offlineStorage.open().then(function (offlineStorage) {\r\n                offlineStorage.tags.toArray().then((tags) => {\r\n                    !tags.length\r\n                        ? setLocalImages([])\r\n                        :  offlineStorage.tags\r\n                            .where(\"eventId\").equals(eventId)\r\n                            .toArray().then((tags) => {\r\n                                setLocalImages(tags);\r\n                            });\r\n                });\r\n            }).catch (function (err) {\r\n                // handle this failure correctly\r\n                alert('failed to open local storage');\r\n            });\r\n        }\r\n        \r\n        if (Array.isArray(localImages)) {\r\n            return localImages.map((image, index) => {\r\n                return <div key={ index }\r\n                    style={{\r\n                        backgroundImage: `url(${image.thumbnail_src})`\r\n                    }} alt=\"address thumbnail\"\r\n                    onClick={ () => { showDeletePrompt(image.meta.name) } }\r\n                    className={ \"address__tag-image delete \" + getImagePreviewAspectRatioClass(localImages[index]) }>\r\n                    <div style={{ backgroundImage: `url(${closeIcon})` }} className=\"tagging-tracker__edit-tags-close-btn\"></div>\r\n                </div>\r\n            });\r\n        } else {\r\n            return <div className=\"tagging-tracker__edit-tags-loading css-delayed-fade-in\">\r\n                <span>Loading tags...</span>\r\n                <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\r\n            </div>;\r\n        }\r\n    }\r\n\r\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\r\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\r\n        const eventId = tagInfoObj ? tagInfoObj.eventId : null;\r\n\r\n        if (eventId) {\r\n            setEventId(eventId);\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (props.offlineStorage && props.location.state.tagInfoId) {\r\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (fileNameOfImageToDelete) {\r\n            fileNameOfImageToDelete = \"\";\r\n        }\r\n        toggleDeletePrompt(false);\r\n    }, [localImages]);\r\n    \r\n    // TODO this code is almost an exact copy of ViewAddress may have flexed states\r\n    // I used same class to steal styling\r\n    return(\r\n        <div className=\"tagging-tracker__edit-tags tagging-tracker__view-address\">\r\n            { renderTags() }\r\n            { renderDeletePrompt(props.location.state.addressId, fileNameOfImageToDelete) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default EditTags;","export const getDateTime = (format = \"\") => {\r\n    // from https://stackoverflow.com/questions/8083410/how-can-i-set-the-default-timezone-in-node-js\r\n    process.env.TZ = \"America/Chicago\";\r\n    let date_ob = new Date();\r\n\r\n    // current date\r\n    // adjust 0 before single digit date\r\n    let date = (\"0\" + date_ob.getDate()).slice(-2);\r\n\r\n    // current month\r\n    let month = (\"0\" + (date_ob.getMonth() + 1)).slice(-2);\r\n\r\n    // current year\r\n    let year = date_ob.getFullYear();\r\n\r\n    // current hours\r\n    let hours = date_ob.getHours();\r\n\r\n    // current minutes\r\n    let minutes = date_ob.getMinutes();\r\n\r\n    // current seconds\r\n    let seconds = date_ob.getSeconds();\r\n    \r\n    if (format === \"YYYY-MM-DD\") {\r\n        return `${year}-${month}-${date}`;\r\n    }\r\n\r\n    if (format === \"MM-DD-YYYY\") {\r\n        return `${month}-${date}-${year}`;\r\n    }\r\n\r\n    // prints date & time in YYYY-MM-DD HH:MM:SS format\r\n    return `${year}-${month}-${date} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nexport const formatTimeStr = (timeStr) => {\r\n    if (timeStr.indexOf('T') !== -1) {\r\n        timeStr = timeStr.split('T').join(' ').split('.000Z').join('');\r\n    }\r\n\r\n    return timeStr;\r\n}\r\n\r\nexport const getTimeStamp = () => {\r\n    return Date.now();\r\n}\r\n\r\n// expectes hyphenated YYYY-MM-DD string\r\nexport const flipDateFormat = ( yyyyMmDd, useHyphens ) => {\r\n    const divider = useHyphens ? \"-\" : \"/\";\r\n    const dateParts = yyyyMmDd.split('-');\r\n    return dateParts[1] + divider + dateParts[2] + divider + dateParts[0];\r\n}","export const deleteAddress = (props, addressObj, finishedDeletingAddress) => {\r\n    const db = props.offlineStorage;\r\n    const addressId = addressObj.addressId;\r\n    let backupDelFailTimer;\r\n\r\n    const doneDeleting = () => {\r\n        clearTimeout(backupDelFailTimer);\r\n        alert('Address deleted! Redirecting...');\r\n        finishedDeletingAddress(addressObj);\r\n    }\r\n\r\n    // these are asynchronous events so when one finishes it calls the next\r\n    const deleteAddressOwnerInfo = (dbOpened) => {\r\n        const ownerInfo = dbOpened.ownerInfo.where(\"addressId\").equals(addressId);\r\n        ownerInfo.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    ownerInfo.delete()\r\n                        .then(() => {\r\n                            console.log('owner info deleted');\r\n                            deleteAddressTagInfo(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete owner info');\r\n                            console.log('delete owner info', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressTagInfo(dbOpened); // next step\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete owner info');\r\n                console.log('delete owner info', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressTagInfo = (dbOpened) => {\r\n        const tagInfo = dbOpened.tagInfo.where(\"addressId\").equals(addressId);\r\n        tagInfo.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    tagInfo.delete()\r\n                        .then(() => {\r\n                            console.log('tag info deleted');\r\n                            deleteAddressTags(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete tag info');\r\n                            console.log('delete tags', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressTags(dbOpened);\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete tag info');\r\n                console.log('delete tag info', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressTags = (dbOpened) => {\r\n        const tags = dbOpened.tags.where(\"addressId\").equals(addressId);\r\n        tags.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    tags.delete()\r\n                        .then(() => {\r\n                            console.log('tags deleted');\r\n                            deleteAddressRow(dbOpened);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete tags');\r\n                            console.log('delete tags', err);\r\n                        });\r\n                } else {\r\n                    deleteAddressRow(dbOpened);\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete tags');\r\n                console.log('delete tags', err);\r\n            });\r\n    }\r\n\r\n    const deleteAddressRow = (dbOpened) => {\r\n        const addresses = dbOpened.addresses.where(\"id\").equals(addressId);\r\n        addresses.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    addresses.delete() // should only be one\r\n                        .then(() => {\r\n                            console.log('address deleted');\r\n                            doneDeleting();\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete address');\r\n                            console.log('delete address', err);\r\n                        });\r\n                } else {\r\n                    doneDeleting();\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete address');\r\n                console.log('delete address', err);\r\n            });\r\n    }\r\n\r\n    if (db) {\r\n        // this is not ideal with how it handles partial failures\r\n        db.open().then(function (dbOpened) {\r\n            deleteAddressOwnerInfo(dbOpened);\r\n\r\n            // backup timer if all fails\r\n            backupDelFailTimer = setTimeout(() => {\r\n                alert('Failed to delete address or taking longer than usual'); // what\r\n                finishedDeletingAddress(addressObj);\r\n            }, 60000); // 1 min long\r\n        }).catch (function (err) {\r\n            // handle this failure correctly\r\n            alert('failed to open local storage', err);\r\n            finishedDeletingAddress(addressObj);\r\n        });\r\n    } else {\r\n        alert('Failed to delete address');\r\n        finishedDeletingAddress(addressObj);\r\n    }\r\n}\r\n\r\nconst getCurEvents = (db, addressId) => {\r\n    return new Promise((resolve, reject) => {\r\n        db.events.where(\"addressId\").equals(addressId).toArray()\r\n            .then((tags) => {\r\n                resolve(tags);\r\n            })\r\n            .catch(() => {\r\n                resolve(null);\r\n            });\r\n    });\r\n}\r\n\r\nconst deleteEventRow = async (db, tagInfoId) => {\r\n    const event = db.events.where(\"tagInfoId\").equals(tagInfoId);\r\n    return new Promise((resolve, reject) => {\r\n        event.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    event.delete()\r\n                        .then(() => {\r\n                            resolve(true);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete data related to event');\r\n                            resolve(false);\r\n                        });\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete data related to event');\r\n                resolve(false);\r\n            });\r\n    });\r\n}\r\n\r\nconst deleteEventTags = async (db, tagInfoId) => {\r\n    const tags = db.tags.where(\"eventId\").equals(tagInfoId);\r\n    return new Promise((resolve, reject) => {\r\n        tags.count()\r\n            .then((count) => {\r\n                if (count) {\r\n                    tags.delete()\r\n                        .then(() => {\r\n                            resolve(true);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete data related to event');\r\n                            resolve(false);\r\n                        });\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                alert('Failed to delete data related to event');\r\n                resolve(false);\r\n            });\r\n    });\r\n}\r\n\r\n// deletes tags/event tied to tagInfoId\r\nconst deleteEventRelatedData = async (db, tagInfoId) => {\r\n    return new Promise(async (resolve, reject) => {\r\n        if (!await deleteEventRow(db, tagInfoId)) {\r\n            resolve(false);\r\n        }\r\n\r\n        if (!await deleteEventTags(db, tagInfoId)) {\r\n            resolve(false);\r\n        }\r\n\r\n        resolve(true);\r\n    });\r\n}\r\n\r\nexport const deleteEvent = (db, addressId, tagInfoId, deleteEventCallBack) => {\r\n    const tagInfo = db.tagInfo.where(\"eventId\").equals(tagInfoId);\r\n    tagInfo.count()\r\n        .then(async (count) => {\r\n            if (count) {\r\n                if (await deleteEventRelatedData(db, tagInfoId)) {\r\n                    tagInfo.delete()\r\n                        .then(async () => {\r\n                            return getCurEvents(db, addressId);\r\n                        })\r\n                        .then((curEvents) => {\r\n                            console.log('finished deleting');\r\n                            deleteEventCallBack(curEvents);\r\n                        })\r\n                        .catch((err) => {\r\n                            alert('Failed to delete event');\r\n                            deleteEventCallBack(); // so many of these\r\n                        });\r\n                }\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            alert('Failed to delete event');\r\n            deleteEventCallBack();\r\n        });\r\n}","// this is trying to detect browser by user agent not really great\r\n// but this particular app has a fixed, bottom navbar which is problematic with Safari\r\n// since the Safari menu bar overlaps the browser\r\n// the Safari menu bar height changes though so the magic number 44px is a best guess pulled from some site\r\n// initially I saw that when you scroll down the Safari bottom menu goes away/comes back scrolling up\r\n// but it seems if you don't have overflow/shorter in height then the bottom navbar will be ontop of the Safari bottom menu\r\n// I guess Mac has this issue too? That's what I see in Sauce Labs simulator\r\nexport const checkIOS = () => {\r\n    const iOS = /(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent);\r\n\r\n    if (iOS) {\r\n        document.querySelector('.tagging-tracker__body').classList = 'tagging-tracker__body'; // clear state\r\n        document.querySelector('.tagging-tracker__bottom-navbar').classList.add('iOS');\r\n        document.querySelector('.tagging-tracker__body').classList.add('iOS');\r\n\r\n        if (window.location.href.indexOf('events') !== -1 || window.location.href.indexOf('event-tags') !== -1) {\r\n            document.querySelector('.tagging-tracker__body').classList.add('less');\r\n        }\r\n\r\n        if (window.location.href.indexOf('tag-info') !== -1) {\r\n            document.querySelector('.tagging-tracker__body').classList.add('toggled-navbar');\r\n        }\r\n\r\n        if (window.location.href.indexOf('add-tag') !== -1) {\r\n            document.querySelector('.tagging-tracker__body').classList.add('add-tag');\r\n        }\r\n    }\r\n}\r\n\r\nexport const resizeAdjustHeight = () => {\r\n    document.querySelector('.tagging-tracker').style.height = window.innerHeight + \"px\";\r\n}\r\n\r\n// TODO this is not great magic number is from the bottom navbar\r\n// mainly it's bad due to that JS render flash jank\r\nexport const addPathClassToBody = (props) => {\r\n    const curPath = props.location.pathname;\r\n\r\n    // this is bad direct dom manipulation\r\n    // if (curPath === \"/tag-info\") {\r\n    //     if (!document.querySelector('.tagging-tracker__body').classList.contains('full-body-height')) {\r\n    //         document.querySelector('.tagging-tracker__body').classList += \" full-body-height\";\r\n    //     }\r\n    // }\r\n\r\n    // if (curPath !== \"/addresses\" || curPath !== \"/\") {\r\n    //     document.querySelector('.tagging-tracker__body').style.maxHeight = (window.innerHeight - 52) + \"px\";\r\n    // }\r\n}\r\n\r\nexport const truncateText = (text, length, ellipsis) => {\r\n    if (!text) {\r\n        return \"undefined string\";\r\n    }\r\n\r\n    return text.substr(0, length) + ((ellipsis && text.length > length) ? '...' : '');\r\n}","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport './Navbar.scss';\r\nimport { deleteAddress } from '../../utils/delete';\r\n\r\nimport backArrow from './../../assets/icons/svgs/chevron-blue.svg'; // rotated by CSS\r\nimport { truncateText } from '../../utils/misc';\r\n\r\nconst Navbar = (props) => {\r\n    const searchAddressInput = useRef(null);\r\n    const history = useHistory();\r\n    const [showSettings, setShowSettings] = useState(false);\r\n    const [deletingAddress, setDeletingAddress] = useState(false);\r\n\r\n    const searchAddresses = (searchStr) => {\r\n        props.searchAddress(searchStr);\r\n    }\r\n\r\n    const getNavTitle = (path, address) => {\r\n        let navTitle = \"\";\r\n\r\n        if (path === \"/tag-info\") {\r\n            navTitle = props.location.state.eventTitle ? props.location.state.eventTitle : \"Create event\";\r\n        } else if (path === \"/owner-info\") {\r\n            navTitle = \"Owner Information\";\r\n        } else if (path === \"/events\") {\r\n            navTitle = `${truncateText(address,40,true)} Events`;\r\n        } else if (path === \"/event-tags\" || path === \"/add-tag\" || path === \"/edit-tags\") {\r\n             navTitle = props.location.state.eventTitle;\r\n        } else {\r\n            navTitle = address;\r\n        }\r\n\r\n        return navTitle;\r\n    }\r\n\r\n    const getBackButtonTitle = (path, address) => {\r\n        const matchPaths = [\r\n            \"/events\",\r\n            \"/event-tags\"\r\n        ];\r\n\r\n        const pathMatches = matchPaths.indexOf(path) !== -1; // what path\r\n        const notEventTags = path !== \"/event-tags\";\r\n\r\n        if (pathMatches) {\r\n            let addressOutput;\r\n\r\n            if (address && notEventTags) {\r\n                addressOutput = address.substring(0, 10);\r\n\r\n                if (address.length > 10) {\r\n                    addressOutput += \"...\";\r\n                }\r\n            } else {\r\n                addressOutput = \"Events\";\r\n            }\r\n\r\n            return addressOutput;\r\n        } else if (path === \"/event-tags\" || path === \"/owner-info\" || path === \"/tag-info\") {\r\n            return \"Events\";\r\n        } else if (path.indexOf('tag') !== -1) {\r\n            return \"Event\";\r\n        } else {\r\n            return \"Addresses\";\r\n        }\r\n    }\r\n\r\n    const getBackPathname = (path) => {\r\n        if (path === \"/owner-info\") {\r\n            return \"/events\";\r\n        } else if (path.indexOf('tag') !== -1) {\r\n            return \"/events\";\r\n        } else {\r\n            return \"/addresses\"\r\n        }\r\n    }\r\n\r\n    const getBackState = (path, address) => { // address is extra/new due to events workflow\r\n        return {\r\n            clearSearch: true,\r\n            address,\r\n            addressId: props.location.state.addressId,\r\n            tagInfoId: props.location.state.tagInfoId,\r\n            eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\r\n                ? props.location.state.eventTitle : null)\r\n        };\r\n    }\r\n\r\n    const editSaveOwnerInfo = () => {\r\n        props.toggleModifyOwnerInfo(!props.modifyOwnerInfo);\r\n    }\r\n\r\n    const editTagInfo = () => {\r\n        if (props.modifyTagInfo) {\r\n            history.push({\r\n                pathname: \"/events\",\r\n                state: {\r\n                    ...props.location.state,\r\n                    eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\r\n                        ? props.location.state.eventTitle : null)\r\n                }\r\n            });\r\n        }\r\n        props.toggleModifyTagInfo(!props.modifyTagInfo);\r\n    }\r\n\r\n    const generateEditBtn = () => {\r\n        const pathname = props.location.pathname;\r\n        const isEditTagsPath = pathname.indexOf('edit') !== -1;\r\n        const isAddTagPath = pathname.indexOf('add-tag') !== -1;\r\n\r\n        if (pathname === \"/owner-info\") {\r\n            return (\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"manage-address__edit-cancel\"\r\n                    onClick={ editSaveOwnerInfo }\r\n                >{ props.modifyOwnerInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\r\n            );\r\n        } else if (pathname === \"/tag-info\") {\r\n            return (\r\n                <button\r\n                    type=\"button\"\r\n                    className=\"manage-address__edit-cancel\"\r\n                    onClick={ editTagInfo }\r\n                >{ props.modifyTagInfo ? \"SAVE\" : \"EDIT\" }</button> // TODO: this should flex between save/edit/cancel if changes occurred\r\n            );\r\n        } else if (pathname === \"/events\") {\r\n            return <button\r\n                type=\"button\"\r\n                className=\"manage-address__edit-cancel\"\r\n                onClick={ () => {setDeletingAddress(!deletingAddress)} }\r\n                disabled={ props.deletingEvents ? true : false }>\r\n                    Delete\r\n            </button>;\r\n        } else {\r\n            return isEditTagsPath\r\n                ? (\r\n                    <button\r\n                        type=\"button\"\r\n                        className=\"manage-address__edit-cancel\"\r\n                        onClick={ deleteAddressCallback }\r\n                        disabled={ deletingAddress ? true : false }\r\n                    >Delete</button>\r\n                )\r\n                : (\r\n                <Link to={{ pathname: \"/edit-tags\", state: {\r\n                    address: props.location.state.address,\r\n                    addressId: props.location.state.addressId,\r\n                    tagInfoId: props.location.state.tagInfoId,\r\n                    eventTitle: (typeof props.location.state.eventTitle !== \"undefined\"\r\n                    ? props.location.state.eventTitle : null)\r\n                }}} className=\"manage-address__edit-cancel\">{\r\n                    isAddTagPath ? \"\" : (isEditTagsPath ? \"Delete\" : \"Edit\")\r\n                }</Link>\r\n            );\r\n        }\r\n    }\r\n\r\n    const finishedDeletingAddress = (addressObj) => {\r\n        // finished deleting, go back to main addresses view\r\n        setDeletingAddress(false);\r\n        if (Object.keys(addressObj).length) {\r\n            const tmpArr = props.deletedAddresses;\r\n            tmpArr.push(addressObj.address); // the primary \"key\" is the address string\r\n            props.setDeletedAddresses(tmpArr);\r\n        }\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const deleteAddressCallback = () => {\r\n        const addressObj = props.location.state;\r\n        const shouldDeleteAddress = window.confirm(\"Delete address \" + addressObj.address + \" ?\");\r\n        if (shouldDeleteAddress) {\r\n            setDeletingAddress(true);\r\n            deleteAddress(props, addressObj, finishedDeletingAddress);\r\n        }\r\n    }\r\n\r\n    const toggleSettings = () => {\r\n        setShowSettings(!showSettings);\r\n    }\r\n\r\n    const generateSettingsMenu = (show) => {\r\n        if (!show) {\r\n            return null;\r\n        }\r\n\r\n        return <div className=\"navbar-top__settings-menu\">\r\n            <button onClick={ props.updateSoftware } type=\"button\">Update Software</button>{/* LOL */}\r\n        </div>;\r\n    }\r\n\r\n    const renderNavbar = (routeLocation) => {\r\n        const routePath = props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\r\n        switch(routePath) {\r\n            case '/':\r\n            case '/addresses':\r\n                return <>\r\n                    <div className=\"tagging-tracker__navbar-top addresses\">\r\n                        <button className=\"add\" onClick={  () => {props.toggleAddressModal(true)}  } />\r\n                        <h2>Addresses</h2>\r\n                        <div className=\"navbar-top__settings\">\r\n                            <button className=\"gear-icon\" type=\"button\" onClick={ toggleSettings }></button>\r\n                            { generateSettingsMenu(showSettings) }\r\n                        </div>\r\n                    </div>\r\n                    <input type=\"text\" value={props.searchedAddress} placeholder=\"search\" ref={ searchAddressInput } onChange={ (e) => { searchAddresses(e.target.value)} }></input>\r\n                </>;\r\n            case '/view-address':\r\n            case '/edit-tags':\r\n            case '/tag-info':\r\n            case '/owner-info':\r\n            case '/events':\r\n            case '/event-tags':\r\n            case '/tags':\r\n            case '/add-tag':\r\n                return <>\r\n                    <div className=\"tagging-tracker__navbar-top view-address edit-tags add-tags\">\r\n                        <Link to={{ pathname: getBackPathname(routeLocation.pathname), state: getBackState(routeLocation.pathname, props.location.state.address)}} className=\"manage-address__back\">\r\n                            <img src={ backArrow } alt=\"back arrow\" />\r\n                            <h4>{ getBackButtonTitle(routeLocation.pathname, props.location.state.address) }</h4>\r\n                        </Link>\r\n                        <h2 className=\"manage-address__name\">\r\n                            { getNavTitle(routeLocation.pathname, props.location.state.address) }\r\n                        </h2>\r\n                        { generateEditBtn() }\r\n                    </div>\r\n                </>;\r\n            default:\r\n                return \"\";\r\n        }\r\n    };\r\n\r\n    // focus\r\n    useEffect(() => {\r\n        if (!props.showAddressModal && props.location.pathname === \"/addresses\" && searchAddressInput.current.value.length > 0) {\r\n            searchAddressInput.current.focus();\r\n        }\r\n\r\n        // update online/offline status\r\n        props.checkOnlineStatus();\r\n    });\r\n\r\n    // delete address\r\n    useEffect(() => {\r\n        if (deletingAddress) {\r\n            deleteAddressCallback();\r\n        }\r\n    }, [deletingAddress]);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__navbar\">\r\n            { renderNavbar(props.location) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Navbar;","import React, { useRef, useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './Login.scss';\r\nimport taggingTrackerLogo from './../../assets/images/tagging-tracker-logo.PNG';\r\nimport axios from 'axios';\r\n\r\nconst Login = (props) => {\r\n    const usernameInput = useRef(null);\r\n    const passwordInput = useRef(null);\r\n    const loginBtn = useRef(null);\r\n    const history = useHistory();\r\n    const [loginProcessing, setLoginProcessing] = useState(false);\r\n\r\n    const login = () => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n                ? process.env.REACT_APP_API_BASE_LOCAL\r\n                : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/login-user';\r\n        const username = usernameInput.current.value;\r\n        const password = passwordInput.current.value;\r\n\r\n        if (!username || !password) {\r\n            alert('Please fill in both username and password to login');\r\n            return;\r\n        }\r\n\r\n        setLoginProcessing(true);\r\n\r\n        axios.post(postUrl, {\r\n            username,\r\n            password\r\n        })\r\n        .then((res) => {\r\n            if (typeof res.data.token !== \"undefined\" && res.data.token) {\r\n                props.updateToken(res.data.token);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            alert('failed to login'); // 401 goes through here too\r\n            setLoginProcessing(false);\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (props.token) {\r\n            history.push(\"/addresses\");\r\n        }\r\n    });\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__login\">\r\n            <img alt=\"tagging tracker logo\" className=\"tagging-tracker__login-logo\" src={ taggingTrackerLogo } />\r\n            <div className=\"tagging-tracker__login-fields\">\r\n                <input type=\"text\" name=\"username\" placeholder=\"username\" ref={ usernameInput } />\r\n                <input type=\"password\" name=\"password\" placeholder=\"password\" ref={ passwordInput } />\r\n                <button type=\"button\" onClick={ login } ref={ loginBtn } disabled={ loginProcessing ? true : false }>Login</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Login;","import React, { useRef, useEffect, useState } from 'react';\r\nimport axios from 'axios';\r\n/* global google */\r\nimport { Link } from 'react-router-dom';\r\nimport './Addresses.scss';\r\nimport rightArrow from './../../assets/icons/svgs/chevron.svg';\r\nimport location from './../../assets/icons/svgs/location.svg';\r\n\r\nconst Addresses = (props) => {\r\n    const newAddressInput = useRef(null);\r\n    const cancelAddAddressBtn = useRef(null);\r\n    const createAddressBtn = useRef(null);\r\n    const [addAddressProcessing, setAddAddressProcessing] = useState(false);\r\n    const [recentAddresses] = useState([]); // what is the difference between this and activeAddresses\r\n    const [activeAddresses, setActiveAddresses] = useState(null);\r\n    const [revGeocodedAdresses, setRevGeocodedAddresses] = useState(null);\r\n    const { token } = props;\r\n    let autoComplete;\r\n    \r\n    // this search may need to get restructured depending on what's available/important to search against\r\n    // versus the obvious address field, but tag search is something based on the tag text\r\n    // I will implement an address-first then tag search, this is not going to be as optimized/fast as plain SQL\r\n    // also I have not done any indexing this is just using regular tables/main parent\r\n    // more info here:\r\n    // https://dexie.org/docs/WhereClause/WhereClause, https://dexie.org/docs/Table/Table.filter(), https://dexie.org/docs/Table/Table.where()\r\n    const searchAddresses = (searchStr) => {\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        if (!offlineStorage) {\r\n            return; // offline storage not ready yet\r\n        }\r\n\r\n        // the /string/ pattern is a regex, can't make one from concatenating plain strings\r\n        const regex = new RegExp(searchStr, \"i\"); // case insensitive\r\n\r\n        // this is similar to a LIKE search https://github.com/dfahlander/Dexie.js/issues/146\r\n        // other alternatives like .where(\"address\").startsWith(searchStr)\r\n        let addressesFormatted;\r\n        offlineStorage.addresses.filter(address => regex.test(address.address))\r\n            .toArray().then((addresses) => {\r\n                if (!addresses.length) {\r\n                    // try searching by tags\r\n                    offlineStorage.tagInfo.filter(tag => regex.test(tag.tagText)).toArray().then((tags) => {\r\n                        addressesFormatted = tags.map((tag) => {\r\n                            return {\r\n                                // not sure if this will work\r\n                                address: offlineStorage.addresses.where(\"id\").equals(tag.addressId).toArray().then((addresses) => {\r\n                                        return addresses[0].id\r\n                                    }),\r\n                                addressId: tag.addressId\r\n                            };\r\n                        });\r\n                    });\r\n                } else {\r\n                    addressesFormatted = addresses.map((address) => {\r\n                        return {\r\n                            address: address.address,\r\n                            addressId: address.id\r\n                        };\r\n                    });\r\n                }\r\n\r\n\t\t\t\tsetActiveAddresses(addressesFormatted);\r\n            });\r\n    }\r\n\r\n    const checkAddressExists = (autoCompleteAddress) => {\r\n        // this is here because the address from autocomplete in the input field has the full address eg. includes city/state\r\n        const addressStr = autoCompleteAddress ? autoCompleteAddress : newAddressInput.current.value;\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        offlineStorage.open().then((offlineStorage) => {\r\n            offlineStorage.addresses.toArray().then((addresses) => {\r\n                !addresses.length\r\n                    ? saveAddress(addressStr)\r\n                    :  offlineStorage.addresses\r\n                        .where(\"address\").equals(addressStr)\r\n                        .toArray().then((addresses) => {\r\n                            addresses.length ? alert('Address exists') : saveAddress(addressStr);\r\n                        });\r\n            });\r\n        }).catch (function (err) {\r\n            // handle this failure correctly\r\n            alert('failed to open local storage');\r\n        });\r\n    }\r\n\r\n    const saveAddress = async (addressStr) => {\r\n        const offlineStorage = props.offlineStorage;\r\n\r\n        if (!addressStr) {\r\n            alert('Please enter an address');\r\n            return;\r\n        }\r\n\r\n        setAddAddressProcessing(true);\r\n\r\n        // check if address is in table already\r\n        offlineStorage.transaction('rw', offlineStorage.addresses, async() => {\r\n            let newRowId;\r\n\r\n            if (\r\n                await offlineStorage.addresses.add({\r\n                    address: addressStr,\r\n                    lat: \"0.0\", // turn to float when uploaded\r\n                    lng: \"0.0\", // turn to float when uploaded\r\n                    created: props.getDateTime(),\r\n                    updated: props.getDateTime()\r\n                }).then((insertedId) => {\r\n                    newRowId = insertedId;\r\n                    return true;\r\n                })\r\n            ) {\r\n                setActiveAddresses(recentAddresses.concat({\r\n                    address: addressStr,\r\n                    addressId: newRowId\r\n                }));\r\n                setAddAddressProcessing(false);\r\n                props.setShowAddressModal(false);\r\n            } else {\r\n                alert('Failed to save address');\r\n            }\r\n        })\r\n        .catch(e => {\r\n            alert('Failed to save address');\r\n        });\r\n    }\r\n\r\n    const loadRecentAddresses = () => {\r\n        // returns last 10 addresses used by updated date sorted descending\r\n        if (!recentAddresses.length && props.offlineStorage) {\r\n            props.offlineStorage.addresses.toArray().then((addresses) => {\r\n                // format data\r\n                const addressesFormatted = addresses.splice(0, 15).map((address) => {\r\n                    return {\r\n                        address: address.address,\r\n                        addressId: address.id\r\n                    };\r\n                });\r\n\r\n\t\t\t\tsetActiveAddresses(addressesFormatted);\r\n\t\t\t});\r\n        }\r\n    }\r\n\r\n    const reverseGeocode = () => {\r\n        // https://developer.mozilla.org/en-US/docs/Web/API/Geolocation_API\r\n        // https://developers.google.com/maps/documentation/javascript/geocoding\r\n        const success = (position) => {\r\n            const navLat = position.coords.latitude;\r\n            const navLong = position.coords.longitude;\r\n            const geocoder = new google.maps.Geocoder;\r\n            const latlng = {lat: parseFloat(navLat), lng: parseFloat(navLong)};\r\n            geocoder.geocode({'location': latlng}, function(results, status) {\r\n              if (status === 'OK') {\r\n                if (results[0]) {\r\n                  setRevGeocodedAddresses(results);\r\n                } else {\r\n                  alert('No address found');\r\n                }\r\n              } else {\r\n                alert('Failed to find an address');\r\n              }\r\n            });\r\n        }\r\n\r\n        const error = () => {\r\n            alert('Failed to determine your location');\r\n        }\r\n\r\n        if (navigator.geolocation) {\r\n            navigator.geolocation.getCurrentPosition(success, error);\r\n        } else {\r\n            alert('Geolocation not supported on your browser');\r\n        }\r\n    }\r\n\r\n    const generateAddressStr = (revGeocodedAddressObj) => {\r\n        // should type check this eg. basic exists\r\n        const addressComponents = revGeocodedAddressObj.address_components;\r\n        return `${addressComponents[0] ? addressComponents[0].long_name : \"\"}\r\n             ${addressComponents[1] ? addressComponents[1].short_name : \"\"},\r\n              ${addressComponents[2] ? addressComponents[2].long_name : \"\"}`;\r\n    }\r\n\r\n    const pickRevGeocodedAddress = (addressStr) => {\r\n        checkAddressExists(addressStr);\r\n        setRevGeocodedAddresses(null);\r\n    }\r\n\r\n    const addNewAddressModal = (showModal) => {\r\n        return showModal ? (\r\n            <div className=\"tagging-tracker__address-input-modal\">\r\n                <h3>{ revGeocodedAdresses ? 'Select Address' : 'Create New Address' }</h3>\r\n                <p>{ revGeocodedAdresses ? null : 'Please enter a new address that you want to create' }</p>\r\n                { token ? null :\r\n                    <p className=\"disclaimer-text\">Note: login required for address autocomplete</p> }\r\n                { revGeocodedAdresses\r\n                    ? <div className=\"tagging-tracker__reverse-geocoded-address-set\">\r\n                        <div className=\"tagging-tracker__reverse-geocoded-addresses\">\r\n                            {\r\n                                revGeocodedAdresses.map((address) => {\r\n                                    return <div\r\n                                        className=\"tagging-tracker__reverse-geocoded-address\"\r\n                                        onClick={ () => pickRevGeocodedAddress(generateAddressStr(address)) }>\r\n                                        {\r\n                                            generateAddressStr(address)\r\n                                        }\r\n                                    </div>\r\n                                })\r\n                            }\r\n                        </div>\r\n                        <button className=\"tagging-tracker__reverse-geocode-back-btn\" type=\"button\" onClick={ () => setRevGeocodedAddresses(null) }>Back</button>\r\n                    </div>\r\n                    : <><div className=\"tagging-tracker__address-input-row\">\r\n                        { !token\r\n                            ? null\r\n                            : <img\r\n                                className=\"address-input-row___location-icon\"\r\n                                src={ location }\r\n                                alt=\"location icon\"\r\n                                onClick={ () => reverseGeocode() } /> }\r\n                        <input type=\"text\" ref={ newAddressInput } id=\"autocomplete\" />\r\n                    </div>\r\n                    <div className=\"tagging-tracker__address-input-modal-btns\">\r\n                        <button type=\"button\" ref={ cancelAddAddressBtn } onClick={ () => {props.toggleAddressModal(false)} } >CANCEL</button>\r\n                        <button type=\"button\" ref={ createAddressBtn } onClick={ () => checkAddressExists() } disabled={ addAddressProcessing ? true : false }>CREATE</button>\r\n                    </div></>\r\n                }\r\n            </div>\r\n        ) : null;\r\n    }\r\n\r\n    const renderActiveAddresses = () => {\r\n        if (!activeAddresses) {\r\n            return \"\";\r\n        } else {\r\n            return (activeAddresses.map((address, index) => {\r\n                return <Link\r\n                    key={index}\r\n                    to={{ pathname: \"/events\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId // used for lookup\r\n                    }}}\r\n                    className=\"tagging-tracker__address\">\r\n                        <h4>{ address.address }</h4>\r\n                        <img src={ rightArrow } alt=\"right arrow\" />\r\n                </Link>}));\r\n        }\r\n    }\r\n\r\n    const suggestedAddressPicked = () => {\r\n        const addressObj = autoComplete.getPlace();\r\n        if ('name' in addressObj) {\r\n            checkAddressExists(addressObj.name);\r\n        }\r\n    }\r\n\r\n    // focus\r\n    useEffect(() => {\r\n        if (props.showAddressModal) {\r\n            newAddressInput.current.focus();\r\n        }\r\n\r\n        // this detects when route changed from a single address back to addresses and clears the search input\r\n        // there are no hard routes eg. using Link so the parent state does not change\r\n        if (typeof props.location.state !== \"undefined\" &&\r\n            typeof props.location.state.clearSearch !== \"undefined\") {\r\n            delete props.location.state.clearSearch; // lol without this non-ending loop\r\n            props.clearSearchAddress();\r\n        }\r\n\r\n        if (recentAddresses) {\r\n            setAddAddressProcessing(false);\r\n        }\r\n    }, [props, recentAddresses]);\r\n\r\n    useEffect(() => {\r\n        if (props.searchedAddress.length) {\r\n            searchAddresses(props.searchedAddress);\r\n        } else if (props.offlineStorage && (!recentAddresses || !activeAddresses)) {\r\n            loadRecentAddresses(); // TODO unmounted state issue\r\n        }\r\n\r\n        // Google address autocomplete\r\n        if (props.showAddressModal && token) {\r\n            autoComplete = new google.maps.places.Autocomplete(newAddressInput.current, {\"types\": [\"geocode\"]})\r\n            autoComplete.addListener('place_changed', suggestedAddressPicked);\r\n        }\r\n    });\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__addresses\">\r\n            { renderActiveAddresses() }\r\n            { addNewAddressModal((props.showAddressModal || revGeocodedAdresses)) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Addresses;","// skipping this for now, using CSS contain to fit image, does the same thing\r\n// TODO: investigate issue with state and image meta not getting set\r\n// this works in delete mode eg. EditTags.js as the meta dimentions exist\r\nexport const getImagePreviewAspectRatioClass = (loadedPhoto) => {\r\n    const imageMetaSet = Object.keys(loadedPhoto.meta).length;\r\n\r\n    if (imageMetaSet && typeof loadedPhoto.meta.width !== \"undefined\") {\r\n        const imageMeta = loadedPhoto.meta;\r\n        return (imageMeta.width >= imageMeta.height) // flipped\r\n            ? \"landscape\"\r\n            : \"portrait\";\t\r\n    } else {\r\n        return \"\";\r\n    }\r\n}","import React, { useState  } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './ViewAddress.scss';\r\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\nimport { flipDateFormat } from './../../utils/date';\r\n\r\nconst ViewAddress = (props) => {\r\n    const history = useHistory();\r\n    const [localImages, setLocalImages] = useState(null);\r\n    \r\n    if (typeof props.location.state === \"undefined\") {\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const renderDateRow = ( dispDate ) => {\r\n        return <h3\r\n            className=\"tagging-tracker__view-address-tag-date-group\">\r\n            <span>Event</span> { flipDateFormat(dispDate, false) }\r\n        </h3>;\r\n    }\r\n\r\n    const renderTags = () => {\r\n        const db = props.offlineStorage;\r\n\r\n        if (db && !localImages) {\r\n            db.open().then(function (db) {\r\n                db.tags.toArray().then((tags) => {\r\n                    !tags.length\r\n                        ? setLocalImages({})\r\n                        :  db.tags\r\n                        .where(\"addressId\").equals(props.location.state.addressId)\r\n                        .toArray().then((tags) => {\r\n                            // sort tags by descending date\r\n                            // straight outta SO: https://stackoverflow.com/questions/10123953/how-to-sort-an-array-by-a-date-property\r\n                            tags.sort((a, b) => {\r\n                                return new Date(b.datetime) - new Date(a.datetime);\r\n                            });\r\n                            setLocalImages(tags);\r\n                        });\r\n                });\r\n            }).catch (function (err) {\r\n                // handle this failure correctly\r\n                alert('failed to open local storage');\r\n            });\r\n        }\r\n        \r\n        if (localImages && Object.keys(localImages).length) {\r\n            // I was contemplating where to do this but the tags have to get grouped by date\r\n            const tagsGroupedByDate = {};\r\n            \r\n            localImages.forEach((image) => {\r\n                if (image.datetime in tagsGroupedByDate) {\r\n                    tagsGroupedByDate[image.datetime].push(image);\r\n                } else {\r\n                    tagsGroupedByDate[image.datetime] = [image];\r\n                }\r\n            });\r\n\r\n            return Object.keys(tagsGroupedByDate).map((date, index) => {\r\n                const groupDate = date.indexOf(\"T\") !== -1 ? date.split(\"T\")[0] : date.split(\" \")[0];\r\n\r\n                return <React.Fragment key={ index }>\r\n                    { renderDateRow(groupDate) }\r\n                    { tagsGroupedByDate[date].map((image, subIndex) => {\r\n                        return <div\r\n                            key={ subIndex }\r\n                            style={{\r\n                                backgroundImage: `url(${image.thumbnail_src})`\r\n                            }}\r\n                            alt=\"address thumbnail\"\r\n                            className={ \"address__tag-image \" + getImagePreviewAspectRatioClass(localImages[index]) } />\r\n                    })}\r\n                </React.Fragment>\r\n            });\r\n        } else {\r\n            return(localImages && Object(localImages).length)\r\n                ? <div className=\"tagging-tracker__view-address-loading css-delayed-fade-in\">\r\n                    <span>Loading tags...</span>\r\n                    <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\r\n                </div>\r\n                : <div className=\"tagging-tracker__view-address-no-tags\">\r\n                    <h4>No Tags</h4>\r\n                </div>;\r\n        }\r\n    }\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__view-address\">\r\n            { renderTags() }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ViewAddress;","export const tagInfoFields = {\r\n    \"Date of entry:\": { // TODO: these should be date time with date pickers\r\n        type: \"date\"\r\n    },\r\n    \"Date of abatement:\": { // TODO: these should be date time with date pickers\r\n        type: \"date\"\r\n    },\r\n    \"Number of tags:\": {\r\n        type: \"number\"\r\n    },\r\n    \"Tag text (separated by commas):\": {\r\n        type: \"input\"\r\n    },\r\n    \"Small tag text (separated by commas):\": {\r\n        type: \"input\"\r\n    },\r\n    \"Square footage covered:\": {\r\n        type: \"number\"\r\n    },\r\n    \"Racial or hate tone?\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Gang related:\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Crossed out tag:\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"Other\"\r\n        }\r\n    },\r\n    \"Type of property:\": {\r\n        type: \"radio\",\r\n        options: {\r\n            commercial: \"Commercial\",\r\n            residential: \"Residential\",\r\n            public: \"Public\"\r\n        }\r\n    },\r\n    \"Vacant property:\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"unknown\"\r\n        }\r\n    },\r\n    \"Land bank property:\": {\r\n        type: \"radio\",\r\n        options: {\r\n            yes: \"Yes\",\r\n            no: \"No\",\r\n            other: \"unknown\"\r\n        }\r\n    },\r\n    \"Surface:\": {\r\n        type: \"checkbox\",\r\n        options: {\r\n            brick: \"Brick or Stone\",\r\n            concrete: \"Concrete\",\r\n            wood: \"Wood\",\r\n            glass: \"Glass\",\r\n            painted: \"Painted\",\r\n            others: \"other\"\r\n        }\r\n    },\r\n    \"Surface other:\": {\r\n        type: \"input\"\r\n    },\r\n    \"Need other code enforcement?\": {\r\n        type: \"checkbox\",\r\n        options: {\r\n            buildingDisrepair: \"Building disrepair\",\r\n            weeds: \"Weeds\",\r\n            trash: \"Trash\",\r\n            illegalDumping: \"Illegal dumping\",\r\n            others: \"other\"\r\n        }\r\n    },\r\n    \"Other code enforcement:\": {\r\n        type: \"input\"\r\n    }\r\n};","export const addNewTagInfo = async ( addressId, offlineStorage, setAddingEvent, formData = {} ) => {\r\n    // this is dumb, I can't explain this, the transaction is a promise\r\n    // so you shouldn't need a promise around a promise\r\n    // but it seems to be the only way to force these to execute in order\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.transaction('rw', offlineStorage.tagInfo, async () => {\r\n            offlineStorage.tagInfo.add({\r\n                addressId,\r\n                eventId: null,\r\n                formData: {}\r\n            }).then((tagInfoId) => {\r\n                resolve(tagInfoId);\r\n            })\r\n        })\r\n        .catch(e => {\r\n            console.log('failed to create tag info for event', e);\r\n            alert('Failed to create tag info for event');\r\n            setAddingEvent(false);\r\n            reject();\r\n        });\r\n    });\r\n}\r\n\r\n// this is pretty much using a contains check since the stored datetime string has hour:minutes:seconds\r\n// but it's still pulling all entries by address as it's not too many\r\nconst checkEventExistsByDate = async ( offlineStorage, addressId, checkDate ) => {\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.transaction('rw', offlineStorage.events, () => {\r\n            offlineStorage.events.where(\"addressId\").equals(addressId).toArray()\r\n            .then((events) => {\r\n                if (events.length) {\r\n                    // if true means already exists, reject add event\r\n                    resolve(events.some(event => event.datetime.indexOf(checkDate) !== -1));\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                console.log('failed checking for event duplicate', err);\r\n                alert('failed check for adding new event');\r\n                reject(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nexport const addNewEvent = async ( tagInfoId, addressId, offlineStorage, formatTimeStr, getDateTime, setAddingEvent = false ) => {\r\n    const todaysDate = formatTimeStr(getDateTime()) // makes YYYY-MM-DD HH:MM:SS format for MySQL DateTime;\r\n    const eventExists = await checkEventExistsByDate(offlineStorage, addressId, todaysDate.split(\" \")[0]);\r\n    if (eventExists) {\r\n        alert('Error: Event date already exists');\r\n        return;\r\n    };\r\n\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.transaction('rw', offlineStorage.events, async () => {\r\n            offlineStorage.events.add({\r\n                addressId,\r\n                tagInfoId,\r\n                tagIds: [],\r\n                datetime: todaysDate\r\n            }).then((eventId) => {\r\n                resolve(eventId);\r\n            });\r\n        })\r\n        .catch(e => {\r\n            console.log('failed to create event', e);\r\n            alert('Failed to create event');\r\n            setAddingEvent(false);\r\n            reject();\r\n        });\r\n    });\r\n}\r\n\r\nexport const updateTagInfoEventId = ( tagInfoId, eventId, offlineStorage, setAddingEvent = false ) => {\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.transaction('rw', offlineStorage.tagInfo, () => {\r\n            offlineStorage.tagInfo.where(\":id\").equals(tagInfoId).modify({ // should only be one match\r\n                eventId\r\n            }).then((updatedId) => {\r\n                resolve(updatedId);\r\n            })\r\n            .catch(e => {\r\n                console.log('failed to update tag info with event id', e);\r\n                alert('failed to update tag info with event id');\r\n                setAddingEvent(false);\r\n                reject(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nexport const getTagInfoObjById = async ( offlineStorage, tagInfoId ) => {\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.tagInfo.get(tagInfoId)\r\n            .then((tagInfo) => {\r\n                resolve(tagInfo);\r\n            })\r\n            .catch((err) => {\r\n                console.log('error getting tag info obj');\r\n                reject();\r\n            });\r\n    });\r\n}\r\n\r\n// actually returning matching primaryKey(s) in Dexie\r\nexport const getEventIdByTagInfoId = async ( offlineStorage, tagInfoId ) => {\r\n    return new Promise((resolve, reject) => {\r\n        offlineStorage.transaction('rw', offlineStorage.events, async () => {\r\n            const keys = await offlineStorage.events.where(\"tagInfoId\").equals(tagInfoId).primaryKeys();\r\n        })\r\n        .catch(e => {\r\n            console.log('failed to get event primary key', e);\r\n        });\r\n    });\r\n}","import React, { createRef, useState, useRef, useEffect } from 'react';\r\nimport './TagInfo.scss';\r\n\r\nimport { getDateTime, formatTimeStr } from './../../utils/date';\r\nimport { tagInfoFields } from './../../utils/tagFields';\r\nimport { addNewTagInfo, addNewEvent, updateTagInfoEventId } from './../events/eventUtils';\r\n\r\n// TODO: there is this functionality of \"Others: type here\" but that will take some work to make a dynamic input field\r\n\r\n/**\r\n * So this is probably pretty confusing I get that, I was trying to make dynamic forms which it does work pretty well but has verbose code\r\n * The field types and values are defined in a util file called tagFields.js\r\n * The tagInfoFieldKeys below are used to map the refs so the inputs can be selected(for getting current value)\r\n * The nameValueMap is used to map the values for render\r\n * The main things to keep in mind is your tagFields.js structure has to match the structures here\r\n * Note the option-#-# when nested values are inside an input group eg. radio/checkbox you increment the sub group vs. incrementing a new level\r\n * OwnerInfo is built similarly but it's much simpler since it has no depth and just text input\r\n * @param {Object} props \r\n */\r\nconst TagInfo = (props) => {\r\n    const [tagInfo, setTagInfo] = useState(null);\r\n    const [tagInfoId, setTagInfoId] = useState(null);\r\n    const { modifyTagInfo } = props;\r\n\r\n    // these have to match the order of the keys in tagFields.js\r\n    const tagInfoFieldKeys = {\r\n        \"Date of entry:\": \"\", // TODO - change to type date\r\n        \"Date of abatement:\": \"\", // TODO - change to type date, picker is extra but format guarding would be good\r\n        \"Number of tags:\": \"\",\r\n        \"Tag text (separated by commas):\": \"\",\r\n        \"Small tag text (separated by commas):\": \"\",\r\n        \"Square footage covered:\": \"\",\r\n        \"Racial or hate tone?\": \"\",\r\n        \"Gang related:\": \"\",\r\n        \"Crossed out tag:\": \"\",\r\n        \"Type of property:\": \"\",\r\n        \"Vacant property:\": \"\",\r\n        \"Land bank property:\": \"\",\r\n        \"Surface:\": \"\",\r\n        \"Surface other:\": \"\",\r\n        \"Need other code enforcement?\": \"\",\r\n        \"Other code enforcement:\": \"\"\r\n    }\r\n\r\n    // note these options have to line up with what are in tagFields.js\r\n    // eg. 5 options here, 5 options there\r\n    // and these fields in general map with above by group\r\n    const nameValueMap = {\r\n        \"option-0\": \"dateOfPicture\",\r\n        \"option-1\": \"dateOfAbatement\",\r\n        \"option-2\": \"numberOfTags\",\r\n        \"option-3\": \"tagText\",\r\n        \"option-4\": \"smallTagText\",\r\n        \"option-5\": \"squareFootageCovered\",\r\n        \"option-6-0\": \"racialOrHateTone\",\r\n        \"option-6-1\": \"racialOrHateTone\",\r\n        \"option-6-2\": \"racialOrHateTone\",\r\n        \"option-7-0\": \"gangRelated\",\r\n        \"option-7-1\": \"gangRelated\",\r\n        \"option-7-2\": \"gangRelated\",\r\n        \"option-8-0\": \"crossedOutTag\",\r\n        \"option-8-1\": \"crossedOutTag\",\r\n        \"option-8-2\": \"crossedOutTag\",\r\n        \"option-9-0\": \"typeOfProperty\",\r\n        \"option-9-1\": \"typeOfProperty\",\r\n        \"option-9-2\": \"typeOfProperty\",\r\n        \"option-10-0\": \"vacantProperty\",\r\n        \"option-10-1\": \"vacantProperty\",\r\n        \"option-10-2\": \"vacantProperty\",\r\n        \"option-11-0\": \"landBankProperty\",\r\n        \"option-11-1\": \"landBankProperty\",\r\n        \"option-11-2\": \"landBankProperty\",\r\n        \"option-12-0\": \"surface\",\r\n        \"option-12-1\": \"surface\",\r\n        \"option-12-2\": \"surface\",\r\n        \"option-12-3\": \"surface\",\r\n        \"option-12-4\": \"surface\",\r\n        \"option-12-5\": \"surface\",\r\n        \"option-13-0\": \"otherSurface\",\r\n        \"option-14-0\": \"needOtherCodeEnforcement\",\r\n        \"option-14-1\": \"needOtherCodeEnforcement\",\r\n        \"option-14-2\": \"needOtherCodeEnforcement\",\r\n        \"option-14-3\": \"needOtherCodeEnforcement\",\r\n        \"option-14-4\": \"needOtherCodeEnforcement\",\r\n        \"option-15-0\": \"otherCodeEnforcement\"\r\n    };\r\n\r\n    const tagInfoInputElements = useRef(Object.keys(tagInfoFieldKeys).map(\r\n        // these are manually mapped based on tagFields.js not great, mainly for the nested inputs eg. radio/checkbox\r\n        (fieldKey) => {\r\n            const fieldType = tagInfoFields[fieldKey].type;\r\n            if (fieldType === \"input\" || fieldType === \"number\" || fieldType === \"date\") {\r\n                return createRef();\r\n            } else {\r\n                const subFields = tagInfoFields[fieldKey].options;\r\n\r\n                return {subRefs: \r\n                    Object.keys(subFields).map((subFieldKey) => {\r\n                        return createRef();\r\n                    })\r\n                };\r\n            }\r\n        }\r\n    ));\r\n\r\n    let updateDone = true; // bad\r\n\r\n    const updateTagInfo = async () => {\r\n        const offlineStorage = props.offlineStorage;\r\n        const mappedFieldValues = {}\r\n\r\n        tagInfoInputElements.current.forEach((element) => {\r\n            let elementType = \"\";\r\n\r\n            if (typeof element.current !== \"undefined\" && typeof element.current.type !== \"undefined\") {\r\n                elementType = element.current.type;\r\n            }\r\n\r\n            if (typeof element.subRefs !== \"undefined\" && Array.isArray(element.subRefs)) {\r\n                element.subRefs.forEach((subElement) => {\r\n                    mappedFieldValues[subElement.current.id] = subElement.current.checked;\r\n                });\r\n            } else if (elementType === \"text\" || elementType === \"number\" || elementType === \"date\") {\r\n                mappedFieldValues[element.current.name] = element.current.value;\r\n            } else {\r\n                mappedFieldValues[element.current.name] = element.current.checked;\r\n            }\r\n        });\r\n\r\n        if (updateDone) {\r\n            updateDone = false;\r\n            const existingTagInfoId = props.location.state.tagInfoId || tagInfoId; // first one has precedence\r\n\r\n            if (existingTagInfoId) {\r\n                offlineStorage.transaction('rw', offlineStorage.tagInfo, async() => {\r\n                    if (\r\n                        await offlineStorage.tagInfo.where(\":id\").equals(existingTagInfoId).modify({\r\n                            formData: mappedFieldValues\r\n                        }, props.location.state.addressId).then((insertedId) => {\r\n                            return true;\r\n                        })\r\n                    ) {\r\n                        setTagInfo(mappedFieldValues);\r\n                        updateDone = true;\r\n                    } else {\r\n                        alert('Failed to update tag information');\r\n                    }\r\n                })\r\n                .catch(e => {\r\n                    alert('Failed to update tag information');\r\n                    console.log('tag info', e);\r\n                });\r\n            } else {\r\n                const addressId = props.location.state.addressId;\r\n                const tagInfoId = await addNewTagInfo(addressId, offlineStorage, false, mappedFieldValues);\r\n                const eventId = await addNewEvent(tagInfoId, addressId, offlineStorage, formatTimeStr, getDateTime);\r\n                await updateTagInfoEventId(tagInfoId, eventId, offlineStorage);\r\n                setTagInfo(mappedFieldValues);\r\n                setTagInfoId(tagInfoId);\r\n            }\r\n        }\r\n    }\r\n\r\n    const generateInputType = (fieldGroup, mainIndex, field) => {\r\n        const fieldType = fieldGroup.type;\r\n\r\n        if (fieldType === \"input\") {\r\n            nameValueMap[`option-${mainIndex}`] = null;\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"text\" disabled={ modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"number\") {\r\n            nameValueMap[`option-${mainIndex}`] = null;\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } placeholder=\"0\" onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"number\" min=\"0\" disabled={ modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"date\") {\r\n            return (\r\n                <input defaultValue={ tagInfo ? tagInfo[`option-${mainIndex}`] : \"\" } name={ `option-${mainIndex}` } onKeyUp={ updateTagInfo } onBlur={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex]} className=\"grow\" type=\"date\" min={getDateTime('MM-DD-YYYY')} disabled={ modifyTagInfo ? false : true } />\r\n            )\r\n        } else if (fieldType === \"radio\" || fieldType === \"checkbox\") {\r\n            const optionKeys = Object.keys(fieldGroup.options);\r\n\r\n            if (optionKeys.length) {\r\n                // TODO: redundant code here\r\n                if (fieldType === \"checkbox\") {\r\n                    return (\r\n                        <div className=\"padding-left\">\r\n                            {\r\n                                optionKeys.map((optionKey, index) => {\r\n                                    return (\r\n                                        <span key={index} className=\"option-group\">\r\n                                            <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } onKeyUp={ updateTagInfo } ref={tagInfoInputElements.current[mainIndex].subRefs[index]} id={`option-${mainIndex}-${index}`}\r\n                                                name={ `option-${mainIndex}-${index}`} type={ fieldType } disabled={ modifyTagInfo ? false : true } />\r\n                                            <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\r\n                                        </span>\r\n                                    )\r\n                                })\r\n                            }\r\n                        </div>\r\n                    )\r\n                } else {\r\n                    return optionKeys.map((optionKey, index) => {\r\n                        return (\r\n                            <span key={index} className=\"option-group\">\r\n                                <input checked={ tagInfo ? tagInfo[`option-${mainIndex}-${index}`] : false } onChange={ updateTagInfo } onKeyUp={ updateTagInfo } id={`option-${mainIndex}-${index}`} name={ nameValueMap[`option-${mainIndex}-${index}`]}\r\n                                    ref={tagInfoInputElements.current[mainIndex].subRefs[index]} type={ fieldType } disabled={ modifyTagInfo ? false : true } />\r\n                                <label htmlFor={`option-${mainIndex}-${index}`}>{ fieldGroup.options[optionKey] }</label>\r\n                            </span>\r\n                        )\r\n                    });\r\n                }\r\n            }\r\n        } else {\r\n            return \"[unknown field type]\";\r\n        }\r\n    }\r\n\r\n    const getSpanClass = (fieldType) => {\r\n        if (fieldType === \"radio\") {\r\n            return \"option-group-label\";\r\n        }\r\n        if (fieldType === \"checkbox\") {\r\n            return \"full\";\r\n        } else {\r\n            return \"input-label\";\r\n        }\r\n    }\r\n\r\n    const modifyClassWrapper = (field) => {\r\n        if (\r\n            field === \"Type of property:\" ||\r\n            field === \"Vacant property:\" ||\r\n            field === \"Land bank property:\" ||\r\n            field === \"Tag text (separated by commas):\" ||\r\n            field === \"Small tag text (separated by commas):\" // super jank I know\r\n        ) {\r\n            return \" full-column-left\";\r\n        }\r\n\r\n        return \"\";\r\n    }\r\n\r\n    const renderTagInfo = () => {\r\n        return Object.keys(tagInfoFields).map((field, index) => {\r\n            return (\r\n                // bad\r\n                <div key={index} className={\"tag-info-field-row\" + (tagInfoFields[field].type === \"checkbox\" ? \" checkbox\" : \" box\") + modifyClassWrapper(field) }>\r\n                    <span className={ getSpanClass(tagInfoFields[field].type) }>{ field }</span>\r\n                    { generateInputType(tagInfoFields[field], index, field) }\r\n                </div>\r\n            )\r\n        });\r\n    };\r\n\r\n    // this loads tag info by id in local store(Dexie/IndexedDB)\r\n    useEffect(() => {\r\n        if (!tagInfo) {\r\n            const tagInfoId = props.location.state.tagInfoId;\r\n            const offlineStorage = props.offlineStorage;\r\n\r\n            if (tagInfoId && offlineStorage) {\r\n                offlineStorage.tagInfo.get(tagInfoId, (tagInfo) => {\r\n                    if (tagInfo) {\r\n                        setTagInfo(tagInfo.formData);\r\n                    }\r\n                }).catch (function (err) {\r\n                    alert('failed to load tagInfo');\r\n                    console.log('tag info', err);\r\n                });\r\n            }\r\n        }\r\n    }, [props, tagInfo]);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__tag-info\">\r\n            { renderTagInfo() }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TagInfo;","import React, { createRef, useState, useRef, useEffect } from 'react';\r\nimport './OwnerInfo.scss';\r\n\r\nconst OwnerInfo = (props) => {\r\n    const [ownerInfo, setOwnerInfo] = useState(null);\r\n    // TODO: this will need to be reworked the striping in particular, it's just coincidence\r\n    // it works regarding the sub-group variant\r\n    // this is mapped to match the rendered input count regarding refs\r\n    // the name:value assigning comes from fieldKeys\r\n    const formLabels = [\r\n        \"Name\",\r\n        \"Phone\",\r\n        \"Email\",\r\n        \"Tenant Name\",\r\n        \"Tenant Contact Number\",\r\n        \"Waiver Completed\",\r\n        \"Need To Follow Up\",\r\n        {\r\n            \"Building Survey\": [\r\n                \"Would you continue service if you had to pay for it?\"\r\n            ]\r\n        }\r\n    ];\r\n\r\n    // from Dexie structure\r\n    const fieldKeys = [\r\n        \"name\",\r\n        \"phone\",\r\n        \"email\",\r\n        \"tenantName\",\r\n        \"tenantPhoneNumber\",\r\n        \"waiverCompleted\",\r\n        \"needFollowUp\",\r\n        \"buildingSurveyQuestionAnswer\"\r\n    ];\r\n\r\n    const inputElements = useRef(formLabels.map(() => createRef()));\r\n    let updateDone = true; // bad\r\n\r\n    const updateInfo = (inputValue) => {\r\n        // these match Dexie store\r\n        const offlineStorage = props.offlineStorage;\r\n        const ownerInfoValues = {\r\n            addressId: props.location.state.addressId,\r\n            formData: {}\r\n        };\r\n\r\n        if (inputValue) {\r\n            inputElements.current.forEach((input, index) => {\r\n                // this is terrible should have been part of way the content is generated so it's set in the input names\r\n                ownerInfoValues.formData[fieldKeys[index]] = input.current.value;\r\n            });\r\n        }\r\n\r\n        if (updateDone) {\r\n            updateDone = false;\r\n        \r\n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, async() => {\r\n \r\n                if (\r\n                    await offlineStorage.ownerInfo.put({\r\n                        addressId: ownerInfoValues.addressId,\r\n                        formData: {\r\n                            name: ownerInfoValues.formData.name,\r\n                            phone: ownerInfoValues.formData.phone,\r\n                            email: ownerInfoValues.formData.email,\r\n                            tenantName: ownerInfoValues.formData.tenantName,\r\n                            tenantPhoneNumber: ownerInfoValues.formData.tenantPhoneNumber,\r\n                            waiverCompleted: ownerInfoValues.formData.waiverCompleted,\r\n                            needFollowUp: ownerInfoValues.formData.needFollowUp,\r\n                            buildingSurveyQuestionAnswer: ownerInfoValues.formData.buildingSurveyQuestionAnswer\r\n                        }\r\n                    }, ownerInfoValues.addressId).then(() => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    updateDone = true;\r\n                    setOwnerInfo(ownerInfoValues);\r\n                } else {\r\n                    alert('Failed to update owner information');\r\n                }\r\n            })\r\n            .catch(e => {\r\n                alert('Failed to update owner information');\r\n                console.log('owner info', e);\r\n            });\r\n        }\r\n    }\r\n\r\n    const renderOwnerInfoFormFields = () => {\r\n        return formLabels.map((formField, index) => {\r\n            const isString = typeof formField === \"string\";\r\n            return (isString\r\n                ? <div key={index} className=\"owner-info-form__row\">\r\n                        <span>{ formField }:</span>\r\n                        <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } onBlur={ (e) => updateInfo(e.target.value) } ref={inputElements.current[index]} type=\"text\" readOnly={ props.modifyOwnerInfo ? false : true } />\r\n                    </div>\r\n                : <div className=\"owner-info-form__row group\" key={index}>\r\n                    <div className=\"owner-info-form__row white\">\r\n                        <span>{ Object.keys(formField) }:</span>\r\n                    </div>\r\n                    {\r\n                        Object.keys(formField).map((subGroup, subGroupIndex) => {\r\n                            return (\r\n                                <div key={subGroupIndex} className=\"owner-info-form__sub-row\">\r\n                                    <span>{ formField[subGroup] }</span>\r\n                                    <input defaultValue={ ownerInfo ? ownerInfo.formData[fieldKeys[index]] : \"\" } id=\"target-me\" onChange={ updateInfo } ref={inputElements.current[index]} type=\"text\" className=\"full\" readOnly={ props.modifyOwnerInfo ? false : true } />\r\n                                </div>\r\n                            );\r\n                        })\r\n                    }\r\n                </div>\r\n            );\r\n        });\r\n    }\r\n\r\n    useEffect(() => {\r\n        // TODO again this code shouldn't be here but eslint\r\n        const getOwnerInfo = async () => {\r\n            const addressId = props.location.state.addressId;\r\n            const offlineStorage = props.offlineStorage;\r\n    \r\n            if (addressId && offlineStorage) {\r\n                await offlineStorage.ownerInfo.get(addressId, (ownerInfo) => {\r\n                    setOwnerInfo(ownerInfo);\r\n                }).catch (function (err) {\r\n                    // handle this failure correctly\r\n                    alert('failed to open local storage');\r\n                });\r\n            }\r\n        }\r\n\r\n        getOwnerInfo();\r\n    }, [props, ownerInfo]);\r\n\r\n    // TODO: fix the communication between navbar save and saving here so saving isn't based on onblur\r\n    // eg. get all fields at once one time, not every time you change inputs\r\n    // useEffect(() => {\r\n    //     // get all fields\r\n    // }, [props.modifyOwnerInfo]);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__owner-info\">\r\n            <div className=\"tagging-tracker__owner-info-form\">\r\n                { renderOwnerInfoFormFields() }\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default OwnerInfo;","import axios from 'axios';\r\n\r\n/**\r\n * The sync works by a sync id, so a sync table keeps track of when a user synced\r\n * This sync id is used to find the synced rows throughout the tables which have the matching sync id\r\n * Using most recent for what to use for pulling down, then pushing up doesn't replace data\r\n * Just adds more, it is arguable that this is a waste/the same as just deleting stuff on remote side\r\n * But maybe a diff/look back is nice too in case you didn't want to delete something(address)\r\n * though currently not possible(no UI/methods)\r\n */\r\n\r\nconst getLocalAddresses = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.addresses.toArray().then((addresses) => {\r\n            if (addresses.length) {\r\n                resolve(addresses);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync addresses err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getEvents = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.events.toArray().then((events) => {\r\n            if (events.length) {\r\n                resolve(events);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync events err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getLocalTags = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.tags.toArray().then((tags) => {\r\n            if (tags.length) {\r\n                resolve(tags);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync tags err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getLocalOwnerInfo = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.ownerInfo.toArray().then((ownerInfos) => {\r\n            if (ownerInfos.length) {\r\n                resolve(ownerInfos);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync ownerInfo err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst getTagInfo = async (localStorage) => {\r\n    return new Promise(resolve => {\r\n        localStorage.tagInfo.toArray().then((tagInfos) => {\r\n            if (tagInfos.length) {\r\n                resolve(tagInfos);\r\n            } else {\r\n                resolve(false);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync tagInfos err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nconst bundleData = async (props) => {\r\n    const localStorage = props.offlineStorage;\r\n    const bundledData = {};\r\n\r\n    return new Promise(resolve => {\r\n        // addresses\r\n        localStorage.addresses.count().then(async (count) => {\r\n            if (count > 0) {\r\n                const addresses = await getLocalAddresses(localStorage);\r\n                const events = await getEvents(localStorage);\r\n                const tags = await getLocalTags(localStorage);\r\n                const ownerInfo = await getLocalOwnerInfo(localStorage);\r\n                const tagInfo = await getTagInfo(localStorage);\r\n                const deletedAddresses = props.deletedAddresses;\r\n\r\n                if (addresses) {\r\n                    bundledData['addresses'] = addresses;\r\n                }\r\n\r\n                if (events) {\r\n                    bundledData['events'] = events;\r\n                }\r\n\r\n                if (tags) {\r\n                    bundledData['tags'] = tags;\r\n                }\r\n\r\n                if (ownerInfo) {\r\n                    bundledData['ownerInfo'] = ownerInfo;\r\n                }\r\n\r\n                if (tagInfo) {\r\n                    bundledData['tagInfo'] = tagInfo;\r\n                }\r\n\r\n                if (deletedAddresses) {\r\n                    bundledData['deletedAddresses'] = deletedAddresses;\r\n                }\r\n\r\n                resolve(bundledData);\r\n            } else {\r\n                resolve(bundledData);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.timeLog('sync bundle data err', err);\r\n            resolve(false);\r\n        });\r\n    });\r\n}\r\n\r\nexport const syncUp = async (props) => {\r\n    const bundledData = await bundleData(props);\r\n\r\n    return new Promise(resolve => {\r\n        if ((Object.keys(bundledData).length === 0 || !bundledData) && !props.deletedAddresses.length) {\r\n            resolve({msg: 'No data to sync'});\r\n        } else {\r\n            // sync to remote server\r\n            const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n                ? process.env.REACT_APP_API_BASE_LOCAL\r\n                : process.env.REACT_APP_API_BASE;\r\n            const postUrl = baseApiPath + '/sync-up';\r\n            \r\n            axios.post(postUrl, {\r\n                headers: { Authorization: `Bearer ${props.token}` },\r\n                bundledData\r\n            }).then((res) => {\r\n                if (res.status === 201) {\r\n                    resolve(true);\r\n                } else {\r\n                    if (res.status === 403) {\r\n                        alert(\"Your session has expired, please login again\");\r\n                        window.location.href = \"/login\"; // flush app state\r\n                    } else {\r\n                        resolve(false);\r\n                    }\r\n                }\r\n            })\r\n            .catch((err) => {\r\n                console.log('sync err', err);\r\n                console.log(err.response);\r\n\r\n                if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                    resolve({msg: 403});\r\n                }\r\n\r\n                resolve(false);\r\n            });\r\n        }\r\n    });\r\n}","import axios from 'axios';\r\n\r\nexport const syncDown = (props) => {\r\n    return new Promise(resolve => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n            ? process.env.REACT_APP_API_BASE_LOCAL\r\n            : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/sync-down';\r\n\r\n        axios.post(postUrl, {\r\n            headers: { Authorization: `Bearer ${props.token}` }\r\n        }).then((res) => {\r\n            if (res.status === 200) {\r\n                resolve(res.data);\r\n            } else {\r\n                if (res.status === 403) {\r\n                    alert(\"Your session has expired, please login again\");\r\n                    window.location.href = \"/login\"; // flush app state\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync err', err);\r\n            \r\n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                resolve({msg: 403});\r\n            }\r\n\r\n            resolve(false);\r\n        });\r\n    });\r\n}","import { syncUp } from './syncUp';\r\nimport { syncDown } from './syncDown';\r\nimport { formatTimeStr } from '../../utils/date';\r\n\r\nconst isLocalStorageEmpty = async (props) => {\r\n    const localStorage = props.offlineStorage;\r\n\r\n    if (!localStorage) {\r\n        return;\r\n    }\r\n\r\n    // you should only have to check addresses because every other table is tied to an address\r\n    // so an address has to exist before you can add photos/owner/tag info\r\n    return new Promise(resolve => {\r\n        localStorage.addresses.count().then((count) => {\r\n            if ((props.deletedAddresses && props.deletedAddresses.length) || count > 0) {\r\n                resolve(false);\r\n            } else {\r\n                resolve(true);\r\n            }\r\n        })\r\n        .catch((err) => {\r\n            console.log('sync addresses err', err);\r\n            resolve(true); // technically could be an error not empty\r\n        });\r\n    });\r\n}\r\n\r\nexport const syncUserData = async (props) => {\r\n    const localStorageEmpty = await isLocalStorageEmpty(props);\r\n    if (localStorageEmpty) {\r\n        // pull down\r\n        const bundledData = await syncDown(props);\r\n        if (bundledData) {\r\n            updateLocalStorageFromSync(props, bundledData);\r\n            return true;\r\n        } else {\r\n            return({msg: 'No data to sync'});\r\n        }\r\n    } else {\r\n        // push up\r\n        return await syncUp(props);\r\n    }\r\n}\r\n\r\nconst updateLocalAddresses = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n\r\n        if (!remoteData.addresses) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.addresses.forEach((addressRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.addresses, () => {\r\n                if (\r\n                    offlineStorage.addresses.add({\r\n                        address: addressRow.address,\r\n                        lat: addressRow.lat,\r\n                        lng: addressRow.lng,\r\n                        created: addressRow.created,\r\n                        updated: addressRow.updated\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.addresses.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalEvents = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.events) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.events.forEach((eventRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.events, () => {\r\n                if (\r\n                    offlineStorage.events.add({\r\n                        addressId: eventRow.address_id,\r\n                        tagInfoId: eventRow.tag_info_id,\r\n                        tagIds: JSON.parse(eventRow.tag_ids),\r\n                        datetime: formatTimeStr(eventRow.date_time)\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.events.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalTags = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.tags) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.tags.forEach((tagRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.tags, () => {\r\n                const tagMeta = JSON.parse(tagRow.meta);\r\n                if (\r\n                    offlineStorage.tags.add({\r\n                        addressId: tagRow.address_id,\r\n                        eventId: tagRow.event_id,\r\n                        fileName: tagRow.filename,\r\n                        thumbnail_src: tagRow.thumbnail_src,\r\n                        meta: tagMeta,\r\n                        datetime: tagRow.datetime\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.tags.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalOwnerInfo = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.ownerInfo) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.ownerInfo.forEach((ownerInfoRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.ownerInfo, () => {\r\n                if (\r\n                    offlineStorage.ownerInfo.add({\r\n                        addressId: ownerInfoRow.address_id,\r\n                        formData: JSON.parse(ownerInfoRow.form_data)\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.ownerInfo.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nconst updateLocalTagInfo = (props, remoteData) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    return new Promise(resolve => {\r\n        if (!remoteData.tagInfo) {\r\n            resolve(true);\r\n        }\r\n\r\n        remoteData.tagInfo.forEach((tagInfoRow, index) => {\r\n            offlineStorage.transaction('rw', offlineStorage.tagInfo, () => {\r\n                if (\r\n                    offlineStorage.tagInfo.add({\r\n                        addressId: tagInfoRow.address_id,\r\n                        eventId: tagInfoRow.event_id,\r\n                        formData: JSON.parse(tagInfoRow.form_data)\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === remoteData.tagInfo.length - 1) {\r\n                        resolve(true);\r\n                    }\r\n                } else {\r\n                    resolve(false);\r\n                }\r\n            })\r\n            .catch(e => {\r\n                resolve(false);\r\n            });\r\n        });\r\n    });\r\n}\r\n\r\nexport const updateLocalStorageFromSync = async (props, remoteData) => {\r\n    let noUpdateErr = true;\r\n    noUpdateErr = await updateLocalAddresses(props, remoteData); // these if successful/not empty return true\r\n    noUpdateErr = await updateLocalEvents(props, remoteData);\r\n    noUpdateErr = await updateLocalTags(props, remoteData);\r\n    noUpdateErr = await updateLocalOwnerInfo(props, remoteData);\r\n    noUpdateErr = await updateLocalTagInfo(props, remoteData);\r\n\r\n    if (noUpdateErr) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\n// TODO: actually this probably shouldn't be here\r\n\r\n// this will only delete Dexie for now, need to figure out about caching static files/service workers\r\n// primarily this is for sync so you pull down after logging out\r\nexport const deleteLocalData = (offlineStorage) => {\r\n    return new Promise(resolve => {\r\n        offlineStorage.delete().then(() => {\r\n            resolve(true);\r\n        })\r\n        .catch((err) => {\r\n            resolve(false);\r\n        })\r\n    });\r\n}","import React, { useRef, useEffect, useState } from 'react';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport './BottomNavbar.scss';\r\nimport { deleteEvent } from '../../utils/delete'; // probably bad to do this, add delete logic to a navbar should be global\r\n\r\nimport syncIcon from './../../assets/icons/svgs/upload.svg';\r\nimport logoutIcon from './../../assets/icons/svgs/switch.svg';\r\nimport property from './../../assets/icons/svgs/property.svg';\r\nimport textDocument from './../../assets/icons/svgs/text-document.svg';\r\nimport calendar from './../../assets/icons/svgs/calendar.svg';\r\nimport addSquare from './../../assets/icons/svgs/add-square.svg';\r\nimport deleteIcon from './../../assets/icons/svgs/delete.svg';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\nimport ajaxLoaderBlue from './../../assets/gifs/ajax-loader--blue.gif';\r\nimport edit from './../../assets/icons/svgs/pencil.svg';\r\nimport photo from './../../assets/icons/svgs/photo.svg';\r\n\r\nimport { syncUserData, deleteLocalData } from '../../utils/sync/sync';\r\nimport { checkIOS, resizeAdjustHeight, addPathClassToBody } from '../../utils/misc';\r\n\r\nconst BottomNavbar = (props) => {\r\n    const syncBtn = useRef(null);\r\n    const logoutBtn = useRef(null);\r\n    const cameraBtn = useRef(null);\r\n    const uploadBtn = useRef(null);\r\n    const history = useHistory();\r\n    const { token } = props;\r\n\r\n    const [deletingEvent, setDeletingEvent] = useState(false);\r\n\r\n    const logout = async () => {\r\n        props.updateLoggingOut(true);\r\n        const localStorageCleared = await deleteLocalData(props.offlineStorage);\r\n        if (!localStorageCleared) {\r\n            alert('failed to clear local data');\r\n        }\r\n        window.location.href = \"/\"; // token is wiped out as it's set by state not in storage\r\n    }\r\n\r\n    const saveToDevice = () => {\r\n        props.saveToDevice();\r\n    }\r\n\r\n    // this probably shouldn't be here but just an initializer\r\n    const sync = async () => {\r\n        if (!props.appOnline) { // shouldn't be needed disabled buttons\r\n            alert('Unable to sync, you are offline');\r\n            return;\r\n        }\r\n\r\n        if (!props.token) {\r\n            history.push(\"/login\");\r\n            return;\r\n        }\r\n\r\n        if (!props.syncApp) {\r\n            props.setSyncApp(true);\r\n            const synced = await syncUserData(props);\r\n\r\n            if (Object.keys(synced).length) {\r\n                if (synced.msg !== \"undefined\") {\r\n                    if (synced.msg === 403) {\r\n                        alert('You have been logged out, please login to sync');\r\n                    } else {\r\n                        alert(synced.msg);\r\n                    }\r\n                }\r\n            } else if (synced) {\r\n                // synced\r\n            } else {\r\n                alert('Failed to sync');\r\n            }\r\n\r\n            props.setSyncApp(false);\r\n        }\r\n    }\r\n\r\n    const uploadImages = () => {\r\n        if (!props.appOnline) {\r\n            alert('Unable to upload, you are offline');\r\n            return;\r\n        }\r\n\r\n        if (!props.token) {\r\n            const loginDecision = window.confirm('You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.');\r\n            if (loginDecision) {\r\n                history.push(\"/login\");\r\n            }\r\n            return;\r\n        }\r\n\r\n        props.triggerFileUpload(true);\r\n    }\r\n\r\n    // this is for Safari, since the prop method that is propagated up into AddTag\r\n    // doesn't work in Safari \"not a direct action by user\" file input wasn't working\r\n    const directCameraClick = () => {\r\n        document.getElementById('add-tag-file-input').click();\r\n    }\r\n\r\n    // bad naming\r\n    const confirmDeleteEvent = ( eventTitle, addressId, tagInfoId, callback ) => {\r\n        const shouldDeleteEvent = window.confirm(\"Delete \" + eventTitle + \" ?\");\r\n        if (shouldDeleteEvent) {\r\n            setDeletingEvent(true);\r\n            deleteEvent(props.offlineStorage, addressId, tagInfoId, callback);\r\n        }\r\n    }\r\n\r\n    // this is only here because callback doesn't have params\r\n    const doneDeletingEvent = (remainingEvents) => {\r\n        setDeletingEvent(false);\r\n        history.push({\r\n            pathname: \"/events\",\r\n            state: {\r\n                ...props.location.state,\r\n                remainingEvents\r\n            }\r\n        });\r\n    }\r\n\r\n    const renderBottomNavbar = (routeLocation) => {\r\n        const address = props.location.state;\r\n        const routePath =  props.baseDir ? routeLocation.pathname.replace(props.baseDir + \"/\", \"\") : routeLocation.pathname;\r\n        const tagInfoPath = props.location.pathname === \"/tag-info\";\r\n        const eventsPath = props.location.pathname === \"/events\";\r\n        const tagsPath = props.location.pathname === \"/event-tags\";\r\n        const eventTagsPath = props.location.pathname === \"/event-tags\";\r\n\r\n        switch(routePath) {\r\n            case \"/\":\r\n            case \"/addresses\":\r\n                return <>\r\n                    <button onClick= { sync } ref={ syncBtn } className=\"bottom-navbar__btn half sync\"\r\n                    type=\"button\" disabled={ props.appOnline ? false : true }>\r\n                        {props.syncApp\r\n                            ? <>\r\n                                <span>Syncing...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"syncing spinner\" />\r\n                            </>\r\n                            : <>\r\n                                { token ? <img src={ syncIcon } alt=\"sync button icon\" /> : null }\r\n                                <span>{ token ? \"Sync\" : \"Login\" }</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <button ref={ logoutBtn } onClick={ logout } className=\"bottom-navbar__btn half\" type=\"button\">\r\n                        {props.loggingOut\r\n                            ? <>\r\n                                <span>Logging out...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"logging out spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <img src={ logoutIcon } alt=\"logout button icon\" />\r\n                                <span>Logout</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                </>\r\n            case \"/view-address\":\r\n            case \"/edit-tags\":\r\n                return <>\r\n                    <Link\r\n                        to={{ pathname: \"/owner-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ property } alt=\"home owner button icon\" />\r\n                        <span>Owner Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/events\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ edit } alt=\"edit event button icon\" />\r\n                        <span>Edit Event</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/tag-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ addSquare } alt=\"add event button icon\" />\r\n                        <span>Add Event</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/add-tag\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId,\r\n                            tagInfoId: routeLocation.state.tagInfoId\r\n                        }}}\r\n                        className=\"bottom-navbar__btn fourth\">\r\n                        <img src={ addSquare } alt=\"add tag icon\" />\r\n                        <span>Add Tag</span>\r\n                    </Link>\r\n                </>\r\n            case \"/add-tag\":\r\n                return <>\r\n                    <button ref={ cameraBtn } onClick={ directCameraClick } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\">\r\n                        <span>Use Camera</span>\r\n                    </button>\r\n                    <button ref={ uploadBtn } onClick={ uploadImages } className=\"bottom-navbar__btn quarter caps-blue border small-font\" type=\"button\" disabled={ props.loadedPhotos.length ? false : true }>\r\n                        {props.uploadInProgress\r\n                            ? <>\r\n                                <span>Uploading...</span>\r\n                                <img src={ ajaxLoaderBlue } alt=\"uploading spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <span>Upload</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <button onClick={ saveToDevice }\r\n                        className=\"bottom-navbar__btn quarter caps-blue border small-font\"\r\n                        type=\"button\"\r\n                        disabled={ (props.savingToDevice || !props.loadedPhotos.length) ? true : false }>\r\n                            {props.savingToDevice\r\n                                ? <>\r\n                                    <span>Saving...</span>\r\n                                    <img src={ ajaxLoaderBlue } alt=\"saving spinner\" />\r\n                                </>\r\n                                : <>\r\n                                    <span>Save To Device</span>\r\n                                </>\r\n                            }\r\n                    </button>\r\n                    <Link\r\n                        to={{ pathname: \"/event-tags\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId,\r\n                            tagInfoId: routeLocation.state.tagInfoId\r\n                        }}}\r\n                        className=\"bottom-navbar__btn quarter caps-blue small-font\">\r\n                            <span>Cancel</span>\r\n                    </Link>\r\n                </>\r\n            case \"/events\":\r\n                return <>\r\n                    <Link\r\n                        to={{ pathname: \"/owner-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className={\"bottom-navbar__btn toggled third \" + (!(tagInfoPath || eventsPath) ? \"active\" : \"\") }>\r\n                            <img src={ property } alt=\"home owner button icon\" />\r\n                            <span>Owner Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/tag-info\", state: {\r\n                                address: address.address,\r\n                                addressId: address.addressId // used for lookup\r\n                        }}}\r\n                        className={ \"bottom-navbar__btn toggled third \" + (!(eventsPath || tagInfoPath) ? \"active\" : \"\") }>\r\n                        <img src={ addSquare } alt=\"add event button icon\" />\r\n                        <span>Add Event</span>\r\n                    </Link>\r\n                </>\r\n            case\"/event-tags\":\r\n            case\"/tag-info\":\r\n                const eventTitle = props.location.state.eventTitle;\r\n                const tagInfoId = props.location.state.tagInfoId;\r\n                return <>\r\n                    <button\r\n                        onClick= { () => confirmDeleteEvent(eventTitle, address.addressId, tagInfoId, doneDeletingEvent) }\r\n                        ref={ syncBtn }\r\n                        className=\"bottom-navbar__btn fourth\"\r\n                        type=\"button\"\r\n                        disabled={ tagInfoId ? false : true }>\r\n                        {deletingEvent\r\n                            ? <>\r\n                                <span>Deleting...</span>\r\n                                <img src={ ajaxLoaderGray } alt=\"deleting event spinner\" />\r\n                            </>\r\n                            : <>\r\n                                <img src={ deleteIcon } alt=\"delete button icon\" />\r\n                                <span>Delete</span>\r\n                            </>\r\n                        }\r\n                    </button>\r\n                    <Link\r\n                        to={{ pathname: \"/tag-info\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId, // used for lookup\r\n                            tagInfoId: props.location.state.tagInfoId,\r\n                            eventTitle\r\n                        }}}\r\n                        className={\"bottom-navbar__btn fourth \" + (tagInfoPath ? \"active\" : \"\")}>\r\n                        <img src={ textDocument } alt=\"tag info button icon\" />\r\n                        <span>Event Info</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/event-tags\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId, // used for lookup\r\n                            tagInfoId, // unique per event\r\n                            eventTitle\r\n                        }}}\r\n                        className={\"bottom-navbar__btn fourth \" + (eventTagsPath ? \"active\" : \"\") + (tagInfoId ? \"\" : \"disabled\")}\r\n                        disabled={ tagInfoId ? false : true }>\r\n                            <img src={ photo } alt=\"events button icon\" />\r\n                            <span>Pictures</span>\r\n                    </Link>\r\n                    <Link\r\n                        to={{ pathname: \"/add-tag\", state: {\r\n                            address: address.address,\r\n                            addressId: address.addressId, // used for lookup\r\n                            tagInfoId, // unique per event\r\n                            eventTitle\r\n                        }}}\r\n                        className={\"bottom-navbar__btn fourth \"  + (tagInfoId ? \"\" : \"disabled\")}>\r\n                        <img src={ addSquare } alt=\"add tag icon\" />\r\n                        <span>Add Picture</span>\r\n                    </Link>\r\n                </>\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    const getBottomNavbarClasses = () => {\r\n        const floatingBtnPaths = [\r\n            \"/owner-info\"\r\n        ];\r\n\r\n        const floatingBtns = floatingBtnPaths.indexOf(props.location.pathname) !== -1;\r\n\r\n        if (floatingBtns) {\r\n            return \"tagging-tracker__bottom-navbar floating-btns\";\r\n        }\r\n\r\n        return \"tagging-tracker__bottom-navbar\";\r\n    }\r\n\r\n    // disabling scaling need to test on iOS\r\n    useEffect(() => {\r\n\t// \t// this modifies the layout/some css classes/styles based on if the user is using iOS/Safari\r\n        // window.addEventListener('resize', resizeAdjustHeight);\r\n        checkIOS();\r\n        // addPathClassToBody(props);\r\n        // window.removeEventListener('resize', resizeAdjustHeight);\r\n    }); // try running once on load, seeing problems when soft keyboard goes away/appears on mobile device\r\n\r\n    return(\r\n        <div className={ getBottomNavbarClasses() }>\r\n            { renderBottomNavbar(props.location) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default BottomNavbar;","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './Page404.scss';\r\n\r\nconst Page404 = (props) => {\r\n    return (\r\n        <div className=\"tagging-tracker__page-404\">\r\n            <h2>You've entered an invalid path</h2>\r\n            <p>Try the page(s) below to return to the app</p>\r\n            <Link to=\"/\">Login</Link>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Page404;","import React, { useRef, useState, useEffect } from 'react';\r\nimport './AddTag.scss';\r\nimport BottomNavbar from './../../components/bottom-navbar/BottomNavbar';\r\nimport axios from 'axios';\r\nimport { getDateTime, formatTimeStr } from './../../utils/date';\r\nimport { getTagInfoObjById } from './../events/eventUtils';\r\n\r\n/**\r\n * Brief explanation how this works it's kind of confusing since everything is a callback of a callback\r\n * The bottomNavbar starts it off by setting loadCamera to true\r\n * Then that clicks on fileInput which if a device has a camera prompts to open the camera or show file upload(pc)\r\n * Then when the fileInput changes, cameraCallback is called and the previewPhoto function is called\r\n * That actually renders it on page, then when the rendered image load, it has a callback to update image meta eg. width/height\r\n * which can only be taken from a loaded <img />\r\n * I'm going to resize the photo with canvas for the thumbnail and potentially save storage by capping files\r\n * @param {*} props \r\n */\r\n\r\n// bad quick hack\r\nlet eventId = null;\r\n\r\nconst AddTag = (props) => {\r\n    const fileInput = useRef(null);\r\n    const [loadCamera, triggerLoadCamera] = useState(false);\r\n    const [fileUpload, triggerFileUpload] = useState(false);\r\n    const [loadedPhotos, setLoadedPhotos] = useState([]);\r\n    const [savingToDevice, setSavingToDevice] = useState(false);\r\n    const [uploadInProgress, setUploadInProgress] = useState(false);\r\n\r\n    // https://hacks.mozilla.org/2011/01/how-to-develop-a-html5-image-uploader/\r\n    const scaleImage = (resolve, img) => {\r\n        // figure out canvas height based on desired resize dimensions\r\n        const imgAspectRatio = (img.width / img.height >= 1) ? 'landscape' : 'portrait';\r\n        let newImageWidth = 300;\r\n        let newImageHeight = 300;\r\n\r\n        if (imgAspectRatio === 'landscape') {\r\n            const newImageWidth = 300;\r\n            newImageHeight = ((newImageWidth * img.height) / img.width); // round?\r\n        } else {\r\n            const newImageHeight = 300;\r\n            newImageWidth = ((newImageHeight * img.width) / img.height); // round?\r\n        }\r\n        \r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.id = \"resize-canvas\";\r\n        const ctx = canvas.getContext(\"2d\");\r\n        canvas.width = newImageWidth;\r\n        canvas.height = newImageHeight;\r\n        ctx.drawImage(img, 0, 0, newImageWidth, newImageHeight);\r\n        resolve(canvas.toDataURL(\"image/png\"));\r\n        // fail case?\r\n    }\r\n\r\n    const createThumbnailSrc = (src) => {\r\n        return new Promise((resolve, reject) => {\r\n            const img = new Image();\r\n            img.src = src;\r\n\r\n            img.onload = () => {\r\n                if (img.width <= 300) {\r\n                    resolve(src);\r\n                }\r\n                scaleImage(resolve, img);\r\n            };\r\n\r\n            img.onerror = (err) => {\r\n                reject(err);\r\n            }\r\n        });\r\n    }\r\n\r\n    const saveToDevice = async () => {\r\n        setSavingToDevice(true);\r\n\r\n        const offlineStorage = props.offlineStorage;\r\n        const address = props.location.state;     \r\n\r\n        // not going to add duplicate logic here because you can delete them somewhere else\r\n        // the loaded photos are deleted after upload so duplicate issue doesn't happen unless the file is selected again\r\n        for (let i = 0; i < loadedPhotos.length; i++) {\r\n            const loadedPhoto = loadedPhotos[i];\r\n            const index = i;\r\n            const thumbnailSrc = await createThumbnailSrc(loadedPhoto.src);\r\n            const oldCanvas = document.getElementById('resize-canvas');\r\n            if (oldCanvas) {\r\n                oldCanvas.remove();\r\n            }\r\n\r\n            offlineStorage.transaction('rw', offlineStorage.tags, async () => {\r\n                if (\r\n                    await offlineStorage.tags.add({\r\n                        eventId,\r\n                        addressId: address.addressId,\r\n                        fileName: loadedPhoto.meta.name,\r\n                        src: loadedPhoto.src,\r\n                        thumbnail_src: thumbnailSrc,\r\n                        meta: loadedPhoto.meta,\r\n                        datetime: formatTimeStr(getDateTime()) // makes YYYY-MM-DD HH:MM:SS format for MySQL DateTime\r\n                    }).then((insertedId) => {\r\n                        return true;\r\n                    })\r\n                ) {\r\n                    if (index === loadedPhotos.length - 1) {\r\n                        alert('Photos saved');\r\n                        setLoadedPhotos([]);\r\n                        setSavingToDevice(false);\r\n                    }\r\n                } else {\r\n                    alert('Failed to save photos to device');\r\n                }\r\n            })\r\n            .catch(e => {\r\n                console.log('failed to save photos', e);\r\n                alert('Failed to save photos to device');\r\n            });\r\n        }\r\n    }\r\n\r\n    const uploadImages = () => {\r\n        const baseApiPath = window.location.href.indexOf('localhost') !== -1\r\n            ? process.env.REACT_APP_API_BASE_LOCAL\r\n            : process.env.REACT_APP_API_BASE;\r\n        const postUrl = baseApiPath + '/upload-tag';\r\n        \r\n        axios.post(postUrl, {\r\n            headers: { Authorization: `Bearer ${props.token}` },\r\n            images: loadedPhotos\r\n        }).then((res) => {\r\n            if (res.status === 200) {\r\n                saveToDevice(); // because don't want to bridge remote sync from upload here\r\n            } else {\r\n                if (res.status === 403) {\r\n                    alert(\"Your session has expired, please login again\");\r\n                    window.location.href = \"/login\"; // flush app state\r\n                } else {\r\n                    alert('Failed to upload');\r\n                }\r\n            }\r\n            triggerFileUpload(false);\r\n            setUploadInProgress(false);\r\n        })\r\n        .catch((err) => {\r\n            if (typeof err.response !== \"undefined\" && typeof err.response.status !== \"undefined\" && err.response.status === 403) {\r\n                alert('You have been logged out, please log back in to upload.');\r\n                window.location.href = \"/login\"; // flush app state\r\n            } else {\r\n                console.log('upload err', err);\r\n                triggerFileUpload(false);\r\n                setUploadInProgress(false);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Step 2: when file input changes, check if file/photo selected\r\n    const cameraCallback = (fileInput) => {\r\n        if (fileInput.files.length) {\r\n\t\t\tpreviewPhoto(fileInput);\r\n\t\t} else {\r\n            alert('No image selected');\r\n        }\r\n    }\r\n\r\n    // Step 3: read the photo and get src plus other data like size\r\n    const previewPhoto = (fileInput) => {\r\n        const reader = new FileReader();\r\n        const file = fileInput.files[0]; // I guess multi-select upload is special, I tried it doesn't work with current code\r\n\r\n        reader.onload = function (e) {\r\n            setLoadedPhotos(loadedPhotos.concat({\r\n                addressId: props.location.state.addressId,\r\n                fileName: file.name,\r\n                src: e.target.result,\r\n                thumbanil_src: \"\",\r\n                meta: {\r\n                    \"name\": file.name,\r\n                    \"size\": file.size\r\n                }\r\n            }));\r\n        }\r\n\r\n        reader.readAsDataURL(file);\r\n    }\r\n\r\n    // Step 4: this runs anytime the page loads but when photos are available they will get rendered as <img />\r\n    const renderPhotoPreviews = () => {\r\n        return loadedPhotos.map((loadedPhoto, index) => {\r\n            return (\r\n                <div style={{\r\n                    backgroundImage: 'url(' + loadedPhoto.src + ')'\r\n                }} key={index} className=\"tagging-tracker__address-tag\" >\r\n                    <img alt={ loadedPhoto.meta.name } src={loadedPhoto.src} onLoad={ (e) => setLoadedImageMeta(e.target, index) } />\r\n                </div>\r\n            )\r\n        })\r\n    }\r\n\r\n    // Step 5: this is a callback when the new <img />'s load to get additional meta\r\n    // the meta's collected in different stages, the file itself(previewPhoto) has the name, size\r\n    // the image that loads has the width/height\r\n    const setLoadedImageMeta = (loadedImage, loopIndex) => {\r\n        const loadedPhotosClone = loadedPhotos;\r\n\t\tloadedPhotos.filter((loadedPhoto, index) => { // eslint-disable-line\r\n            if (loopIndex === index && typeof loadedPhotos[index].meta.width === \"undefined\") {\r\n                loadedPhotosClone[index].meta['width'] = loadedImage.width;\r\n                loadedPhotosClone[index].meta['height'] = loadedImage.height;\r\n                setLoadedPhotos(loadedPhotosClone);\r\n            }\r\n        });\r\n    }\r\n\r\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\r\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\r\n        eventId = tagInfoObj ? tagInfoObj.eventId : null;\r\n    }\r\n\r\n    // set eventId so tags are saved against that in new structure not just saved under address\r\n    useEffect(() => {\r\n        if (props.offlineStorage && props.location.state.tagInfoId) {\r\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\r\n        }\r\n    }, []);\r\n\r\n    // Step 1: Click on file input when clicking on Use Camera button\r\n    useEffect(() => {\r\n        if (loadCamera) {\r\n            // handled in BottomNavbar directly\r\n        } else {\r\n            triggerLoadCamera(false);\r\n        }\r\n    }, [loadCamera]);\r\n\r\n    // callback to toggle/make Use Camera useable again\r\n    useEffect(() => {\r\n        triggerLoadCamera(false);\r\n    }, [loadedPhotos]);\r\n\r\n    useEffect(() => {\r\n        if (fileUpload && !uploadInProgress) {\r\n            setUploadInProgress(true);\r\n            uploadImages();\r\n        }\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [fileUpload, uploadInProgress]); // TODO ugly fix above, eslint disable but not trying to put the upload code in here\r\n\r\n    // TODO this is not staying eg. ugly flash\r\n    useEffect(() => {\r\n        props.setBodyClass(\"tagging-tracker__body increase-height\");\r\n    }, [props]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"tagging-tracker__add-tag move-bottom-navbar-down\">\r\n                <input type=\"file\" ref={fileInput} name=\"image\" onChange={ () => { cameraCallback(fileInput.current) } } id=\"add-tag-file-input\" />\r\n                { renderPhotoPreviews() }\r\n            </div>\r\n            <BottomNavbar\r\n                {...props}\r\n                triggerLoadCamera={triggerLoadCamera}\r\n                loadCamera={loadCamera}\r\n                triggerFileUpload={triggerFileUpload}\r\n                fileUpload={fileUpload}\r\n                saveToDevice={saveToDevice}\r\n                savingToDevice={savingToDevice}\r\n                uploadInProgress={uploadInProgress}\r\n                setUploadInProgress={setUploadInProgress}\r\n                loadedPhotos={loadedPhotos}\r\n                appOnline={props.appOnline}\r\n                token={props.token}\r\n            />\r\n        </>\r\n    );\r\n}\r\n\r\nexport default AddTag;","import React, { useState, useEffect } from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport './Events.scss';\r\nimport { getDateTime, formatTimeStr, flipDateFormat } from '../../utils/date';\r\nimport { addNewTagInfo, addNewEvent, updateTagInfoEventId } from './eventUtils';\r\nimport { deleteEvent } from '../../utils/delete';\r\n\r\nimport closeIcon from './../../assets/icons/svgs/close.svg';\r\nimport rightArrow from './../../assets/icons/svgs/chevron.svg';\r\n\r\nconst Events = (props) => {\r\n    const offlineStorage = props.offlineStorage;\r\n    const address = props.location.state;\r\n    const addressId = props.location.state.addressId;\r\n    const [events, setEvents] = useState([]);\r\n\r\n    const renderNoEvents = (\r\n        <div className=\"tagging-tracker__events-add-event\">\r\n            No Events\r\n        </div>\r\n    )\r\n\r\n    const renderEvents = (\r\n        <div className=\"tagging-tracker__events\">\r\n            {\r\n                events.reverse().map((event, id) => {\r\n                    return (\r\n                        <Link\r\n                            key={ id }\r\n                            to={{ pathname: \"/tag-info\", state: {\r\n                                addressId: event.addressId,\r\n                                address: props.location.state.address,\r\n                                tagInfoId: event.tagInfoId, // used for lookup\r\n                                eventTitle: `Event ${ event.datetime ? flipDateFormat(event.datetime.split(\" \")[0], true) : \"\" }` \r\n                            }}}\r\n                            className=\"tagging-tracker__event\">\r\n                            { props.deleteEventsMode ? <button type=\"button\" id=\"event-delete-btn\">\r\n                                <img src={ closeIcon } alt=\"delete event icon\" />\r\n                            </button> : null }\r\n                            <div id=\"event-text\">\r\n                                <span className=\"text\">Event</span>\r\n                                <span className=\"date\">{ event.datetime.split(\" \")[0] }</span>\r\n                            </div>\r\n                            <img id=\"event-view-icon\" src={ rightArrow } alt=\"open event icon\" />\r\n                        </Link>\r\n                    )\r\n                })\r\n            }\r\n        </div>\r\n    )\r\n\r\n    // check if delete event show update rendered events with remaining events\r\n    useEffect(() => {\r\n        if (offlineStorage) { // wait for offlineStorage to be ready\r\n            const remainingEvents = typeof props.location.state.remainingEvents !== \"undefined\" ?\r\n                props.location.state.remainingEvents : null;\r\n            if (remainingEvents) {\r\n                setEvents(remainingEvents);\r\n            }\r\n        }\r\n    }, []);\r\n\r\n    // check set any events\r\n    useEffect(() => {\r\n        if (offlineStorage) { // wait for offlineStorage to be ready\r\n            offlineStorage.events.where(\"addressId\").equals(addressId).toArray().then((events) => {\r\n                setEvents(events);\r\n            });\r\n        }\r\n    }, [offlineStorage]);\r\n\r\n    return ( events.length ? renderEvents : renderNoEvents )\r\n}\r\n\r\nexport default Events;","import React, { useState, useEffect } from 'react';\r\nimport { useHistory } from 'react-router-dom';\r\nimport './EventTags.scss';\r\nimport './../view-address/ViewAddress.scss';\r\nimport { getImagePreviewAspectRatioClass } from './../../utils/image';\r\nimport ajaxLoaderGray from './../../assets/gifs/ajax-loader--gray.gif';\r\nimport { flipDateFormat } from './../../utils/date';\r\nimport { getTagInfoObjById } from './../events/eventUtils';\r\n\r\nconst EventTags = (props) => {\r\n    const history = useHistory();\r\n    const [localImages, setLocalImages] = useState(null);\r\n    const [eventId, setEventId] = useState(null);\r\n\r\n    if (typeof props.location.state === \"undefined\") {\r\n        history.push(\"/addresses\");\r\n    }\r\n\r\n    const renderDateRow = ( dispDate ) => {\r\n        return null;\r\n    }\r\n\r\n    const getEventId = async ( offlineStorage, tagInfoId ) => {\r\n        const tagInfoObj = await getTagInfoObjById(offlineStorage, tagInfoId);\r\n        const eventId = tagInfoObj ? tagInfoObj.eventId : null;\r\n\r\n        if (eventId) {\r\n            setEventId(eventId);\r\n        }\r\n    }\r\n\r\n    const renderTags = () => {\r\n        const db = props.offlineStorage;\r\n        const tagInfoId = props.location.state.tagInfoId;\r\n\r\n        if (db && eventId && !localImages) {\r\n            db.open().then(function (db) {\r\n                db.tags.toArray().then((tags) => {\r\n                    !tags.length\r\n                        ? setLocalImages({})\r\n                        :  db.tags\r\n                        .where(\"eventId\").equals(eventId)\r\n                        .toArray().then((tags) => {\r\n                            // sort tags by descending date\r\n                            // straight outta SO: https://stackoverflow.com/questions/10123953/how-to-sort-an-array-by-a-date-property\r\n                            tags.sort((a, b) => {\r\n                                return new Date(b.datetime) - new Date(a.datetime);\r\n                            });\r\n                            setLocalImages(tags);\r\n                        });\r\n                });\r\n            }).catch (function (err) {\r\n                // handle this failure correctly\r\n                alert('failed to open local storage');\r\n            });\r\n        }\r\n        \r\n        if (localImages && Object.keys(localImages).length) {\r\n            // I was contemplating where to do this but the tags have to get grouped by date\r\n            const tagsGroupedByDate = {};\r\n            \r\n            localImages.forEach((image) => {\r\n                if (image.datetime in tagsGroupedByDate) {\r\n                    tagsGroupedByDate[image.datetime].push(image);\r\n                } else {\r\n                    tagsGroupedByDate[image.datetime] = [image];\r\n                }\r\n            });\r\n\r\n            return Object.keys(tagsGroupedByDate).map((date, index) => {\r\n                const groupDate = date.indexOf(\"T\") !== -1 ? date.split(\"T\")[0] : date.split(\" \")[0];\r\n\r\n                return <React.Fragment key={ index }>\r\n                    { renderDateRow(groupDate) }\r\n                    { tagsGroupedByDate[date].map((image, subIndex) => {\r\n                        return <div\r\n                            key={ subIndex }\r\n                            style={{\r\n                                backgroundImage: `url(${image.thumbnail_src})`\r\n                            }}\r\n                            alt=\"address thumbnail\"\r\n                            className={ \"address__tag-image \" + getImagePreviewAspectRatioClass(localImages[index]) } />\r\n                    })}\r\n                </React.Fragment>\r\n            });\r\n        } else {\r\n            return(localImages && Object(localImages).length)\r\n                ? <div className=\"tagging-tracker__view-address-loading css-delayed-fade-in\">\r\n                    <span>Loading tags...</span>\r\n                    <img src={ ajaxLoaderGray } alt=\"loading tags spinner\" />\r\n                </div>\r\n                : <div className=\"tagging-tracker__view-address-no-tags\">\r\n                    <h4>No Tags</h4>\r\n                </div>;\r\n        }\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (props.offlineStorage && props.location.state.tagInfoId) {\r\n            getEventId(props.offlineStorage, props.location.state.tagInfoId);\r\n        }\r\n    }, []);\r\n\r\n    return(\r\n        <div className=\"tagging-tracker__event-tags tagging-tracker__view-address\">\r\n            { renderTags() }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default EventTags;","import React, { useState, useEffect } from 'react';\r\nimport { BrowserRouter as Router, Route, Switch, Redirect } from 'react-router-dom';\r\nimport './App.scss';\r\nimport Dexie from 'dexie';\r\nimport axios from 'axios';\r\n\r\n// misc utils\r\nimport { getDateTime } from './utils/date';\r\n\r\n// components and pages\r\nimport Navbar from './components/navbar/Navbar';\r\nimport Login from './components/login/Login';\r\nimport Addresses from './components/addresses/Addresses';\r\nimport ViewAddress from './components/view-address/ViewAddress';\r\nimport TagInfo from './components/tag-info/TagInfo';\r\nimport OwnerInfo from './components/owner-info/OwnerInfo';\r\nimport BottomNavbar from './components/bottom-navbar/BottomNavbar';\r\nimport Page404 from './pages/page404/Page404';\r\nimport AddTag from './components/add-tag/AddTag';\r\nimport DeleteTag from './components/edit-tags/EditTags';\r\nimport Events from './components/events/Events';\r\nimport EventTags from './components/event-tags/EventTags';\r\n\r\nconst App = () => {\r\n\tconst [token, setToken] = useState(\"\");\r\n\tconst [searchedAddress, updateSearchedAddress] = useState(\"\");\r\n\tconst [showAddressModal, setShowAddressModal] = useState(false);\r\n\tconst [appOnline, setAppOnline] = useState(true);\r\n\tconst [offlineStorage, setOfflineStorage] = useState(null);\r\n\tconst [modifyOwnerInfo, toggleModifyOwnerInfo] = useState(false);\r\n\tconst [modifyTagInfo, toggleModifyTagInfo] = useState(false);\r\n\tconst [bodyClass, setBodyClass] = useState(\"tagging-tracker__body\"); // this will be removed when UI is updated, it's for AddTag BottomNavbar\r\n\tconst [syncApp, setSyncApp] = useState(false);\r\n\tconst [loggingOut, updateLoggingOut] = useState(false);\r\n\tconst [deletedAddresses, setDeletedAddresses] = useState([]); // I only later realized you can have a whole state object vs individual lines like this\r\n\tconst [deleteEventsMode, setDeleteEventsMode] = useState(false);\r\n\tconst [deletingEvent, setDeletingEvent] = useState(false);\r\n\r\n\t/**\r\n\t  * if deploying to a example.com/target with subdirectories, baseName should be updated below\r\n\t  * otherwise leave it blank\r\n\t  * it should match what's after the example.com/ of the build-dev domain in package.json\r\n\t  * example: example.com/tagging-tracker -> tagging-tracker\r\n\t  * example: example.com/sub-folder/tagging-tracker -> sub-folder/tagging-tracker\r\n\t  * make sure package.json's build dev has the example.com/ path\r\n\t  * \r\n\t  * update: for the package.json homepage path I had to set the /path-from-domain\r\n\t  * for the software updater to work, update the .env path for the BASE path which is used for cache sync\r\n\t  */\r\n\tconst baseName = \"\";\r\n\r\n\tconst searchAddress = (searchStr) => {\r\n\t\tupdateSearchedAddress(searchStr);\r\n\t}\r\n\r\n\tconst toggleAddressModal = (show) => {\r\n\t\tsetShowAddressModal(show);\r\n\t}\r\n\r\n\tconst clearSearchedAddress = () => {\r\n\t\tupdateSearchedAddress(\"\");\r\n\t}\r\n\r\n\tconst updateToken = (token) => {\r\n\t\tsetToken(token);\r\n\t}\r\n\r\n\tconst updateAppOnlineState = (event) => {\r\n\t\tconst online = event.type === \"online\";\r\n\t\tif (appOnline !== online) {\r\n\t\t\tsetAppOnline(!appOnline);\r\n\t\t}\r\n\t}\r\n\r\n\tconst checkOnlineStatus = () => {\r\n\t\twindow.addEventListener('online', updateAppOnlineState);\r\n\t\twindow.addEventListener('offline', updateAppOnlineState);\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('online', updateAppOnlineState);\r\n\t\t\twindow.removeEventListener('offline', updateAppOnlineState);\r\n\t\t};\r\n\t}\r\n\r\n\tconst setupOfflineStorage = () => {\r\n\t\tconst db = new Dexie(\"LocalImageDatabase\");\r\n\t\tdb.version(4).stores({\r\n\t\t\taddresses: \"++id,address,lat,lng,created,updated\",\r\n\t\t\tevents: \"++,addressId,tagInfoId,tagIds,datetime\",\r\n\t\t\ttags: \"++,fileName,addressId,eventId,meta,datetime,src,thumbnail_src\",\r\n\t\t\townerInfo: \"++,addressId,formData\",\r\n\t\t\ttagInfo: \"++,addressId,eventId,formData\"\r\n\t\t});\r\n\t\tsetOfflineStorage(db);\r\n\t};\r\n\r\n\t// this is for making sure the remote side is not empty eg. in the middle of a build\r\n\t// this does throw an Uncaught promise error, haven't figured out why but it doesn't break code\r\n\t// does its job of preventing overwriting client code with nothing\r\n\tconst checkRemoteNotEmpty = () => {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tconst frontEndBasePath = window.location.href.indexOf('localhost') === -1\r\n\t\t\t\t? process.env.REACT_APP_BASE\r\n\t\t\t\t: false;\r\n\r\n\t\t\tif (!frontEndBasePath) {\r\n\t\t\t\tresolve(false);\r\n\t\t\t} else {\r\n\t\t\t\taxios.get(frontEndBasePath + '/?' + Date.now()) // this is just \"cache busting\" as the PWA caches requests\r\n\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\tif (response.status === 200 && response.data) {\r\n\t\t\t\t\t\t\tresolve(true);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve(false); // case of 403, 404\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\tconsole.log('remote cache clear test', error);\r\n\t\t\t\t\t\treject(new Error('no content'));\r\n\t\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tconst checkForNewVersion = async () => {\r\n\t\t// https://stackoverflow.com/questions/45467842/how-to-clear-cache-of-service-worker\r\n\t\t// using the caches.delete() method\r\n\t\t// check if checked within 5 minutes\r\n\t\t// window.localStorage is primarily used here to avoid confusion from\r\n\t\t// treating Dexie(IndexedDB) as localStorage by name\r\n\t\t// also using localStorage because App re-renders and wipes self state\r\n\t\t// I didn't think this needed to be in Dexie\r\n\t\tconst verChecked = window.localStorage.getItem('verChecked');\r\n\t\tif (!verChecked) {\r\n\t\t\twindow.localStorage.setItem('verChecked', Date.now());\r\n\t\t} else if (Date.now() - verChecked > 300000) { // 5 minutes\r\n\t\t\tconst hasRemoteContent = await checkRemoteNotEmpty();\r\n\t\t\tif (!hasRemoteContent || !window.caches) return; // if no remote code, don't pull down or no cache\r\n\t\t\tcaches.keys().then(function(names) {\r\n\t\t\t\tfor (let name of names)\r\n\t\t\t\t\tcaches.delete(name);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst updateSoftware = () => {\r\n\t\twindow.localStorage.setItem('verChecked', Date.now() - 360000); // 6 mins in the past\r\n\t\tcheckForNewVersion();\r\n\t\twindow.location.reload();\r\n\t}\r\n\r\n\tuseEffect(() => {\r\n\t\tcheckOnlineStatus();\r\n\r\n\t\tif (!offlineStorage) {\r\n\t\t\tsetupOfflineStorage();\r\n\t\t}\r\n\r\n\t\tcheckForNewVersion();\r\n\t});\r\n\r\n\treturn (\r\n\t\t<div className=\"tagging-tracker\">\r\n\t\t\t<Router basename={ baseName }>\r\n\t\t\t\t<Route component={ (props) =>\r\n\t\t\t\t\t<Navbar {...props}\r\n\t\t\t\t\t\tbaseDir={ baseName }\r\n\t\t\t\t\t\tsearchAddress={searchAddress}\r\n\t\t\t\t\t\tsearchedAddress={searchedAddress}\r\n\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\r\n\t\t\t\t\t\tcheckOnlineStatus={checkOnlineStatus}\r\n\t\t\t\t\t\ttoggleModifyOwnerInfo={toggleModifyOwnerInfo}\r\n\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\r\n\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\r\n\t\t\t\t\t\ttoggleModifyTagInfo={toggleModifyTagInfo}\r\n\t\t\t\t\t\tupdateSoftware={updateSoftware}\r\n\t\t\t\t\t\tdeletedAddresses={deletedAddresses}\r\n\t\t\t\t\t\tsetDeletedAddresses={setDeletedAddresses}\r\n\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\tdeleteEventsMode={deleteEventsMode}\r\n\t\t\t\t\t\tsetDeleteEventsMode={setDeleteEventsMode} />\r\n\t\t\t\t}/> {/* put this break here since it confused me having it against the line before */}\r\n\t\t\t\t<div className={ bodyClass }>\r\n\t\t\t\t\t<Switch>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\texact\r\n\t\t\t\t\t\t\tpath=\"/login\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttoken\r\n\t\t\t\t\t\t\t\t\t? <Redirect to=\"/addresses\" />\r\n\t\t\t\t\t\t\t\t\t: <Login {...props} updateToken={updateToken} token={token} />\r\n\t\t\t\t\t\t} />\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath={\"/view-address\"}\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t? <ViewAddress\r\n\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/owner-info\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <OwnerInfo\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tmodifyOwnerInfo={modifyOwnerInfo}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/tag-info\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <TagInfo\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tmodifyTagInfo={modifyTagInfo}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/add-tag\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <AddTag\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\t\t\t\tsetBodyClass={setBodyClass}\r\n\t\t\t\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\t\t\t\tappOnline={appOnline}\r\n\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/edit-tags\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <DeleteTag\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/events\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <Events\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\t\t\t\tdeleteEventsMode={deleteEventsMode}\r\n\t\t\t\t\t\t\t\t\t\tdeletingEvent={deletingEvent}\r\n\t\t\t\t\t\t\t\t\t\tsetDeletingEvent={setDeletingEvent} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath=\"/event-tags\"\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue\r\n\t\t\t\t\t\t\t\t\t? <EventTags\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> }/>\r\n\t\t\t\t\t\t<Route\r\n\t\t\t\t\t\t\tpath={[\"/\",\"/addresses\"]}\r\n\t\t\t\t\t\t\tcomponent={ (props) =>\r\n\t\t\t\t\t\t\t\ttrue \r\n\t\t\t\t\t\t\t\t\t? <Addresses\r\n\t\t\t\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\t\t\t\tsearchedAddress={searchedAddress}\r\n\t\t\t\t\t\t\t\t\t\tsetShowAddressModal={setShowAddressModal}\r\n\t\t\t\t\t\t\t\t\t\tshowAddressModal={showAddressModal}\r\n\t\t\t\t\t\t\t\t\t\ttoggleAddressModal={toggleAddressModal}\r\n\t\t\t\t\t\t\t\t\t\tclearSearchAddress={clearSearchedAddress}\r\n\t\t\t\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\t\t\t\tgetDateTime={getDateTime} />\r\n\t\t\t\t\t\t\t\t\t: <Redirect to=\"/\"/> } />\r\n\t\t\t\t\t\t<Route>\r\n\t\t\t\t\t\t\t<Page404 />\r\n\t\t\t\t\t\t</Route>\r\n\t\t\t\t\t</Switch>\r\n\t\t\t\t</div>\r\n\t\t\t\t{/* The explanation here is the AddTag needs to keep its own state so it doesn't\r\n\t\t\t\t\tre-render while adding more images since the initial bridge between bottomNavbar\r\n\t\t\t\t\tand AddTag body was causing the entire app to re-render */}\r\n\t\t\t\t<Route component={ (props) =>\r\n\t\t\t\t\t(props.location.pathname !== \"/login\" && props.location.pathname !== \"/add-tag\")\r\n\t\t\t\t\t\t? <BottomNavbar\r\n\t\t\t\t\t\t\t{...props}\r\n\t\t\t\t\t\t\tbaseDir={ baseName }\r\n\t\t\t\t\t\t\tappOnline={appOnline}\r\n\t\t\t\t\t\t\ttoken={token}\r\n\t\t\t\t\t\t\tsyncApp={syncApp}\r\n\t\t\t\t\t\t\tsetSyncApp={setSyncApp}\r\n\t\t\t\t\t\t\tofflineStorage={offlineStorage}\r\n\t\t\t\t\t\t\tloggingOut={loggingOut}\r\n\t\t\t\t\t\t\tupdateLoggingOut={updateLoggingOut}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t: null\r\n\t\t\t\t\t} />\r\n\t\t\t</Router>\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\nexport default App;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport function register(config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl, config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl, config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' }\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './css-reset.css';\r\nimport './index.scss';\r\nimport App from './App';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n"],"sourceRoot":""}