(this["webpackJsonptagging-tracker-pwa"]=this["webpackJsonptagging-tracker-pwa"]||[]).push([[0],[,,,,,,,,,,function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zg4OPn5+WNjY56enjw8PFVVVd7e3rq6uklJSZOTk4eHh+np6a6urtLS0nBwcHt7ewAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,,,,function(e,t,a){e.exports=a.p+"static/media/property.8673af4c.svg"},function(e,t,a){e.exports=a.p+"static/media/text-document.e93f329b.svg"},function(e,t){e.exports="data:image/gif;base64,R0lGODlhEAAQAPQAAP///xuJ/fj7/U2i/ZDF/SCL/Tya/drr/bHW/S6T/YS//Xa3/eby/aLP/cvk/Vuq/Wew/QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH+GkNyZWF0ZWQgd2l0aCBhamF4bG9hZC5pbmZvACH5BAAKAAAAIf8LTkVUU0NBUEUyLjADAQAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAAKAAEALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkEAAoAAgAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkEAAoAAwAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAAKAAQALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAAKAAUALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA=="},,,,,,,,,,,,,,function(e,t,a){e.exports=a.p+"static/media/chevron-blue.f48ced71.svg"},,,function(e,t,a){e.exports=a.p+"static/media/tagging-tracker-logo.4295bb0d.PNG"},function(e,t,a){e.exports=a.p+"static/media/chevron.8417a1be.svg"},function(e,t,a){e.exports=a.p+"static/media/upload.d4af3f99.svg"},function(e,t,a){e.exports=a.p+"static/media/switch.e4b4aac4.svg"},function(e,t,a){e.exports=a.p+"static/media/add-square.00e36f36.svg"},function(e,t,a){e.exports=a.p+"static/media/delete.665926e2.svg"},function(e,t,a){e.exports=a.p+"static/media/close.db093ba0.svg"},function(e,t,a){e.exports=a(85)},,,,,function(e,t,a){},function(e,t,a){},,function(e,t,a){},,,,,,,,,,,,,,,,,,,function(e,t,a){},,,,,function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){},function(e,t,a){"use strict";a.r(t);var n,r,o=a(0),s=a.n(o),c=a(32),i=a.n(c),l=(a(49),a(50),a(1)),d=a.n(l),u=a(2),f=a(3),g=a(11),m=(a(52),a(33)),p=a(8),A=a.n(p),h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_API_BASE:"https://api.byx1a2gixtvvnjwxde5y.com",REACT_APP_API_BASE_LOCAL:"http://localhost:5000",REACT_APP_BASE:"https://taggingtracker.org"}).TZ="America/Chicago";var t=new Date,a=("0"+t.getDate()).slice(-2),n=("0"+(t.getMonth()+1)).slice(-2),r=t.getFullYear(),o=t.getHours(),s=t.getMinutes(),c=t.getSeconds();return"YYYY-MM-DD"===e?"".concat(r,"-").concat(n,"-").concat(a):"MM-DD-YYYY"===e?"".concat(n,"-").concat(a,"-").concat(r):"".concat(r,"-").concat(n,"-").concat(a," ").concat(o,":").concat(s,":").concat(c)},b=(a(71),a(34)),w=a.n(b),v=function(e){var t=Object(o.useRef)(null),a=Object(o.useState)(!1),n=Object(u.a)(a,2),r=n[0],c=n[1],i=function(){e.toggleModifyOwnerInfo(!e.modifyOwnerInfo)},l=function(){e.toggleModifyTagInfo(!e.modifyTagInfo)},d=function(){c(!r)};return Object(o.useEffect)((function(){!e.showAddressModal&&"/addresses"===e.location.pathname&&t.current.value.length>0&&t.current.focus(),e.checkOnlineStatus()})),s.a.createElement("div",{className:"tagging-tracker__navbar"},function(a){var n;switch(e.baseDir?a.pathname.replace(e.baseDir+"/",""):a.pathname){case"/":case"/addresses":return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"tagging-tracker__navbar-top addresses"},s.a.createElement("button",{className:"add",onClick:function(){e.toggleAddressModal(!0)}}),s.a.createElement("h2",null,"Addresses"),s.a.createElement("div",{className:"navbar-top__settings"},s.a.createElement("button",{className:"gear-icon",type:"button",onClick:d}),r?s.a.createElement("div",{className:"navbar-top__settings-menu"},s.a.createElement("button",{onClick:e.updateSoftware,type:"button"},"Update Software")):null)),s.a.createElement("input",{type:"text",value:e.searchedAddress,placeholder:"search",ref:t,onChange:function(t){var a;a=t.target.value,e.searchAddress(a)}}));case"/view-address":case"/edit-tags":case"/add-tag":case"/tag-info":case"/owner-info":return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"tagging-tracker__navbar-top view-address edit-tags add-tags"},s.a.createElement(f.b,{to:{pathname:(n=a.pathname,"/tag-info"===n||"/owner-info"===n||"/edit-tags"===n||"/add-tag"===n?"/view-address":"/addresses"),state:(a.pathname,{clearSearch:!0,address:e.location.state.address,addressId:e.location.state.addressId})},className:"manage-address__back"},s.a.createElement("img",{src:w.a,alt:"back arrow"}),s.a.createElement("h4",null,function(e,t){if("/tag-info"===e||"owner-info"===e||"/add-tag"===e||"/edit-tags"===e){var a=t.substring(0,10);return t.length>10&&(a+="..."),a}return"Addresses"}(a.pathname,e.location.state.address))),s.a.createElement("h2",{className:"manage-address__name"},function(e,t){return"/tag-info"===e?"Tag Information":"/owner-info"===e?"Owner Information":t}(a.pathname,e.location.state.address)),function(){var t=e.location.pathname,a=-1!==t.indexOf("edit"),n=-1!==t.indexOf("add-tag");return"/owner-info"===t?s.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:i},e.modifyOwnerInfo?"SAVE":"EDIT"):"/tag-info"===t?s.a.createElement("button",{type:"button",className:"manage-address__edit-cancel",onClick:l},e.modifyTagInfo?"SAVE":"EDIT"):s.a.createElement(f.b,{to:{pathname:a?"view-address":"/edit-tags",state:{address:e.location.state.address,addressId:e.location.state.addressId}},className:"manage-address__edit-cancel"},n?"":a?"Cancel":"Delete")}()));default:return""}}(e.location))},y=(a(76),a(37)),E=a.n(y),k=function(e){var t=Object(o.useRef)(null),a=Object(o.useRef)(null),n=Object(o.useRef)(null),r=Object(g.g)(),c=Object(o.useState)(!1),i=Object(u.a)(c,2),l=i[0],d=i[1];return Object(o.useEffect)((function(){e.token&&r.push("/addresses")})),s.a.createElement("div",{className:"tagging-tracker__login"},s.a.createElement("img",{alt:"tagging tracker logo",className:"tagging-tracker__login-logo",src:E.a}),s.a.createElement("div",{className:"tagging-tracker__login-fields"},s.a.createElement("input",{type:"text",name:"username",placeholder:"username",ref:t}),s.a.createElement("input",{type:"password",name:"password",placeholder:"password",ref:a}),s.a.createElement("button",{type:"button",onClick:function(){var n=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/login-user",r=t.current.value,o=a.current.value;r&&o?(d(!0),A.a.post(n,{username:r,password:o}).then((function(t){"undefined"!==typeof t.data.token&&t.data.token&&e.updateToken(t.data.token)})).catch((function(e){alert("failed to login"),d(!1)}))):alert("Please fill in both username and password to login")},ref:n,disabled:!!l},"Login")))},I=(a(77),a(38)),O=a.n(I),x=function(e){var t=Object(o.useRef)(null),a=Object(o.useRef)(null),n=Object(o.useRef)(null),r=Object(o.useState)(!1),c=Object(u.a)(r,2),i=c[0],l=c[1],g=Object(o.useState)([]),m=Object(u.a)(g,1)[0],p=Object(o.useState)(null),A=Object(u.a)(p,2),h=A[0],b=A[1],w=function(){var a=t.current.value;e.offlineStorage.open().then((function(e){e.addresses.toArray().then((function(t){t.length?e.addresses.where("address").equals(a).toArray().then((function(e){e.length?alert("Address exists"):v(a)})):v(a)}))})).catch((function(e){alert("failed to open local storage")}))},v=function(t){var a;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=e.offlineStorage,t){n.next=4;break}return alert("Please enter an address"),n.abrupt("return");case 4:l(!0),a.transaction("rw",a.addresses,(function(){var n;return d.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,d.a.awrap(a.addresses.add({address:t,lat:"0.0",lng:"0.0",created:e.getDateTime(),updated:e.getDateTime()}).then((function(e){return n=e,!0})));case 2:if(!r.sent){r.next=8;break}b(m.concat({address:t,addressId:n})),l(!1),e.setShowAddressModal(!1),r.next=9;break;case 8:alert("Failed to save address");case 9:case"end":return r.stop()}}))})).catch((function(e){alert("Failed to save address")}));case 6:case"end":return n.stop()}}))};return Object(o.useEffect)((function(){e.showAddressModal&&t.current.focus(),"undefined"!==typeof e.location.state&&"undefined"!==typeof e.location.state.clearSearch&&(delete e.location.state.clearSearch,e.clearSearchAddress()),m&&l(!1)}),[e,m]),Object(o.useEffect)((function(){e.searchedAddress.length?function(t){var a=e.offlineStorage;if(a){var n,r=new RegExp(t,"i");a.addresses.filter((function(e){return r.test(e.address)})).toArray().then((function(e){e.length?n=e.map((function(e){return{address:e.address,addressId:e.id}})):a.tagInfo.filter((function(e){return r.test(e.tagText)})).toArray().then((function(e){n=e.map((function(e){return{address:a.addresses.where("id").equals(e.addressId).toArray().then((function(e){return e[0].id})),addressId:e.addressId}}))})),b(n)}))}}(e.searchedAddress):e.offlineStorage&&!m.length&&e.offlineStorage&&e.offlineStorage.addresses.toArray().then((function(e){var t=e.splice(0,15).map((function(e){return{address:e.address,addressId:e.id}}));b(t)}))})),s.a.createElement("div",{className:"tagging-tracker__addresses"},h?h.map((function(e,t){return s.a.createElement(f.b,{key:t,to:{pathname:"/view-address",state:{address:e.address,addressId:e.addressId}},className:"tagging-tracker__address"},s.a.createElement("h4",null,e.address),s.a.createElement("img",{src:O.a,alt:"right arrow"}))})):"",e.showAddressModal?s.a.createElement("div",{className:"tagging-tracker__address-input-modal"},s.a.createElement("h3",null,"Create New Address"),s.a.createElement("p",null,"Please enter a new address that you want to create"),s.a.createElement("input",{type:"text",ref:t}),s.a.createElement("div",{className:"tagging-tracker__address-input-modal-btns"},s.a.createElement("button",{type:"button",ref:a,onClick:function(){e.toggleAddressModal(!1)}},"CANCEL"),s.a.createElement("button",{type:"button",ref:n,onClick:w,disabled:!!i},"CREATE"))):null)},j=(a(78),function(e){if(Object.keys(e.meta).length&&"undefined"!==typeof e.meta.width){var t=e.meta;return t.width>=t.height?"landscape":"portrait"}return""}),C=a(10),S=a.n(C),_=function(e){var t=Object(g.g)(),a=Object(o.useState)(null),n=Object(u.a)(a,2),r=n[0],c=n[1];"undefined"===typeof e.location.state&&t.push("/addresses");return s.a.createElement("div",{className:"tagging-tracker__view-address"},function(){var t=e.offlineStorage;return t&&!r&&t.open().then((function(t){t.tags.toArray().then((function(a){a.length?t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){c(e)})):c([])}))})).catch((function(e){alert("failed to open local storage")})),Array.isArray(r)?r.map((function(e,t){return s.a.createElement("div",{key:t,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",className:"address__tag-image "+j(r[t])})})):s.a.createElement("div",{className:"tagging-tracker__view-address-loading css-delayed-fade-in"},s.a.createElement("span",null,"Loading tags..."),s.a.createElement("img",{src:S.a,alt:"loading tags spinner"}))}())},N=(a(79),{"Date of picture:":{type:"date"},"Date of abatement:":{type:"date"},"Number of tags:":{type:"number"},"Tag text:":{type:"input"},"Small tag text:":{type:"input"},"Square footage covered:":{type:"number"},"Racial or hate tone?":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Gang related":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Crossed out tag":{type:"radio",options:{yes:"Yes",no:"No",other:"Other"}},"Type of property":{type:"radio",options:{commercial:"Commercial",residential:"Residential",public:"Public"}},"Vacant property":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Land bank property":{type:"radio",options:{yes:"Yes",no:"No",other:"unknown"}},"Surface:":{type:"checkbox",options:{brick:"Brick or Stone",concrete:"Concrete",wood:"Wood",glass:"Glass",painted:"Painted",others:"other"}},"Surface other:":{type:"input"},"Need other code enforcement?":{type:"checkbox",options:{buildingDisrepair:"Building disrepair",weeds:"Weeds",trash:"Trash",illegalDumping:"Illegal dumping",others:"other"}},"Other code enforcement:":{type:"input"}}),D=function(e){var t=Object(o.useState)(null),a=Object(u.a)(t,2),n=a[0],r=a[1],c={"option-0":"dateOfPicture","option-1":"dateOfAbatement","option-2":"numberOfTags","option-3":"tagText","option-4":"smallTagText","option-5":"squareFootageCovered","option-6-0":"racialOrHateTone","option-6-1":"racialOrHateTone","option-6-2":"racialOrHateTone","option-7-0":"gangRelated","option-7-1":"gangRelated","option-7-2":"gangRelated","option-8-0":"crossedOutTag","option-8-1":"crossedOutTag","option-8-2":"crossedOutTag","option-9-0":"typeOfProperty","option-9-1":"typeOfProperty","option-9-2":"typeOfProperty","option-10-0":"vacantProperty","option-10-1":"vacantProperty","option-10-2":"vacantProperty","option-11-0":"landBankProperty","option-11-1":"landBankProperty","option-11-2":"landBankProperty","option-12-0":"surface","option-12-1":"surface","option-12-2":"surface","option-12-3":"surface","option-12-4":"surface","option-12-5":"surface","option-13-0":"otherSurface","option-14-0":"needOtherCodeEnforcement","option-14-1":"needOtherCodeEnforcement","option-14-2":"needOtherCodeEnforcement","option-14-3":"needOtherCodeEnforcement","option-14-4":"needOtherCodeEnforcement","option-15-0":"otherCodeEnforcement"},i=Object(o.useRef)(Object.keys({"Date of picture:":"","Date of abatement:":"","Number of tags:":"","Tag text:":"","Small tag text:":"","Square footage covered:":"","Racial or hate tone?":"","Gang related":"","Crossed out tag":"","Type of property":"","Vacant property":"","Land bank property":"","Surface:":"","Surface other:":"","Need other code enforcement?":"","Other code enforcement:":""}).map((function(e){var t=N[e].type;if("input"===t||"number"===t||"date"===t)return Object(o.createRef)();var a=N[e].options;return{subRefs:Object.keys(a).map((function(e){return Object(o.createRef)()}))}}))),l=!0,f=function(){var t=e.offlineStorage,a={};i.current.forEach((function(e){var t="";"undefined"!==typeof e.current&&"undefined"!==typeof e.current.type&&(t=e.current.type),"undefined"!==typeof e.subRefs&&Array.isArray(e.subRefs)?e.subRefs.forEach((function(e){a[e.current.id]=e.current.checked})):a[e.current.name]="text"===t||"number"===t||"date"===t?e.current.value:e.current.checked})),l&&(l=!1,t.transaction("rw",t.tagInfo,(function(){return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d.a.awrap(t.tagInfo.put({addressId:e.location.state.addressId,formData:a},e.location.state.addressId).then((function(e){return!0})));case 2:if(!n.sent){n.next=7;break}l=!0,r(a),n.next=8;break;case 7:alert("Failed to update tag information");case 8:case"end":return n.stop()}}))})).catch((function(e){alert("Failed to update tag information"),console.log("tag info",e)})))};return Object(o.useEffect)((function(){if(!n){var t=e.location.state.addressId,a=e.offlineStorage;t&&a&&a.tagInfo.get(t,(function(e){e&&r(e.formData)})).catch((function(e){alert("failed to load tagInfo"),console.log("tag info",e)}))}}),[e,n]),s.a.createElement("div",{className:"tagging-tracker__tag-info"},Object.keys(N).map((function(t,a){return s.a.createElement("div",{key:a,className:"tag-info-field-row"+("checkbox"===N[t].type?" checkbox":" box")},s.a.createElement("span",{className:(r=N[t].type,"radio"===r?"option-group-label":"checkbox"===r?"full":"input-label")},t),function(t,a,r){var o=t.type;if("input"===o)return c["option-".concat(a)]=null,s.a.createElement("input",{defaultValue:n?n["option-".concat(a)]:"",name:"option-".concat(a),onBlur:f,ref:i.current[a],className:"grow",type:"text",disabled:!e.modifyTagInfo});if("number"===o)return c["option-".concat(a)]=null,s.a.createElement("input",{defaultValue:n?n["option-".concat(a)]:"",name:"option-".concat(a),placeholder:"0",onBlur:f,ref:i.current[a],className:"grow",type:"number",min:"0",disabled:!e.modifyTagInfo});if("date"===o)return s.a.createElement("input",{defaultValue:n?n["option-".concat(a)]:"",name:"option-".concat(a),onBlur:f,ref:i.current[a],className:"grow",type:"date",min:h("MM-DD-YYYY"),disabled:!e.modifyTagInfo});if("radio"!==o&&"checkbox"!==o)return"[unknown field type]";var l=Object.keys(t.options);return l.length?"checkbox"===o?s.a.createElement("div",{className:"padding-left"},l.map((function(r,c){return s.a.createElement("span",{key:c,className:"option-group"},s.a.createElement("input",{checked:!!n&&n["option-".concat(a,"-").concat(c)],onChange:f,ref:i.current[a].subRefs[c],id:"option-".concat(a,"-").concat(c),name:"option-".concat(a,"-").concat(c),type:o,disabled:!e.modifyTagInfo}),s.a.createElement("label",{htmlFor:"option-".concat(a,"-").concat(c)},t.options[r]))}))):l.map((function(r,l){return s.a.createElement("span",{key:l,className:"option-group"},s.a.createElement("input",{checked:!!n&&n["option-".concat(a,"-").concat(l)],onChange:f,id:"option-".concat(a,"-").concat(l),name:c["option-".concat(a,"-").concat(l)],ref:i.current[a].subRefs[l],type:o,disabled:!e.modifyTagInfo}),s.a.createElement("label",{htmlFor:"option-".concat(a,"-").concat(l)},t.options[r]))})):void 0}(N[t],a));var r})))},B=(a(80),function(e){var t=Object(o.useState)(null),a=Object(u.a)(t,2),n=a[0],r=a[1],c=["Name","Phone","Email","Tenant Name","Tenant Contact Number","Waiver Completed","Need To Follow Up",{"Building Survey":["Would you continue service if you had to pay for it?"]}],i=["name","phone","email","tenantName","tenantPhoneNumber","waiverCompleted","needFollowUp","buildingSurveyQuestionAnswer"],l=Object(o.useRef)(c.map((function(){return Object(o.createRef)()}))),f=!0,g=function(t){var a=e.offlineStorage,n={addressId:e.location.state.addressId,formData:{}};t&&l.current.forEach((function(e,t){n.formData[i[t]]=e.current.value})),f&&(f=!1,a.transaction("rw",a.ownerInfo,(function(){return d.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.awrap(a.ownerInfo.put({addressId:n.addressId,formData:{name:n.formData.name,phone:n.formData.phone,email:n.formData.email,tenantName:n.formData.tenantName,tenantPhoneNumber:n.formData.tenantPhoneNumber,waiverCompleted:n.formData.waiverCompleted,needFollowUp:n.formData.needFollowUp,buildingSurveyQuestionAnswer:n.formData.buildingSurveyQuestionAnswer}},n.addressId).then((function(){return!0})));case 2:if(!e.sent){e.next=7;break}f=!0,r(n),e.next=8;break;case 7:alert("Failed to update owner information");case 8:case"end":return e.stop()}}))})).catch((function(e){alert("Failed to update owner information"),console.log("owner info",e)})))};return Object(o.useEffect)((function(){!function(){var t,a;d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(t=e.location.state.addressId,a=e.offlineStorage,!t||!a){n.next=5;break}return n.next=5,d.a.awrap(a.ownerInfo.get(t,(function(e){r(e)})).catch((function(e){alert("failed to open local storage")})));case 5:case"end":return n.stop()}}))}()}),[e,n]),s.a.createElement("div",{className:"tagging-tracker__owner-info"},s.a.createElement("div",{className:"tagging-tracker__owner-info-form"},c.map((function(t,a){return"string"===typeof t?s.a.createElement("div",{key:a,className:"owner-info-form__row"},s.a.createElement("span",null,t,":"),s.a.createElement("input",{defaultValue:n?n.formData[i[a]]:"",onBlur:function(e){return g(e.target.value)},ref:l.current[a],type:"text",readOnly:!e.modifyOwnerInfo})):s.a.createElement("div",{className:"owner-info-form__row group",key:a},s.a.createElement("div",{className:"owner-info-form__row white"},s.a.createElement("span",null,Object.keys(t),":")),Object.keys(t).map((function(r,o){return s.a.createElement("div",{key:o,className:"owner-info-form__sub-row"},s.a.createElement("span",null,t[r]),s.a.createElement("input",{defaultValue:n?n.formData[i[a]]:"",id:"target-me",onChange:g,ref:l.current[a],type:"text",className:"full",readOnly:!e.modifyOwnerInfo}))})))}))))}),F=(a(81),a(39)),Q=a.n(F),R=a(40),T=a.n(R),P=a(18),Y=a.n(P),L=a(19),U=a.n(L),M=a(41),q=a.n(M),K=a(42),W=a.n(K),V=a(20),G=a.n(V),H=function(e){return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.addresses.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync addresses err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},J=function(e){return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tags.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tags err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},Z=function(e){return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.ownerInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync ownerInfo err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},z=function(e){return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){e.tagInfo.toArray().then((function(e){e.length?t(e):t(!1)})).catch((function(e){console.log("sync tagInfos err",e),t(!1)}))})));case 1:case"end":return t.stop()}}))},X=function(e){var t,a;return d.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return t=e.offlineStorage,a={},n.abrupt("return",new Promise((function(n){t.addresses.count().then((function(r){var o,s,c,i,l;return d.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:if(!(r>0)){u.next=22;break}return u.next=3,d.a.awrap(H(t));case 3:return o=u.sent,u.next=6,d.a.awrap(J(t));case 6:return s=u.sent,u.next=9,d.a.awrap(Z(t));case 9:return c=u.sent,u.next=12,d.a.awrap(z(t));case 12:i=u.sent,l=e.deletedAddresses,o&&(a.addresses=o),s&&(a.tags=s),c&&(a.ownerInfo=c),i&&(a.tagInfo=i),l&&(a.deletedAddresses=l),n(a),u.next=23;break;case 22:n(a);case 23:case"end":return u.stop()}}))})).catch((function(e){console.timeLog("sync bundle data err",e),n(!1)}))})));case 3:case"end":return n.stop()}}))},$=function(e){var t;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d.a.awrap(X(e));case 2:return t=a.sent,a.abrupt("return",new Promise((function(a){if(0!==Object.keys(t).length&&t||e.deletedAddresses.length){var n=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-up";A.a.post(n,{headers:{Authorization:"Bearer ".concat(e.token)},bundledData:t}).then((function(e){201===e.status?a(!0):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):a(!1)})).catch((function(e){console.log("sync err",e),console.log(e.response),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&a({msg:403}),a(!1)}))}else a({msg:"No data to sync"})})));case 4:case"end":return a.stop()}}))},ee=function(e){return new Promise((function(t){var a=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/sync-down";A.a.post(a,{headers:{Authorization:"Bearer ".concat(e.token)}}).then((function(e){200===e.status?t(e.data):403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):t(!1)})).catch((function(e){console.log("sync err",e),"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status&&t({msg:403}),t(!1)}))}))},te=function(e){var t;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(t=e.offlineStorage){a.next=3;break}return a.abrupt("return");case 3:return a.abrupt("return",new Promise((function(a){t.addresses.count().then((function(t){e.deletedAddresses.length||t>0?a(!1):a(!0)})).catch((function(e){console.log("sync addresses err",e),a(!0)}))})));case 4:case"end":return a.stop()}}))},ae=function(e){var t;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,d.a.awrap(te(e));case 2:if(!a.sent){a.next=15;break}return a.next=6,d.a.awrap(ee(e));case 6:if(!(t=a.sent)){a.next=12;break}return ce(e,t),a.abrupt("return",!0);case 12:return a.abrupt("return",{msg:"No data to sync"});case 13:a.next=18;break;case 15:return a.next=17,d.a.awrap($(e));case 17:return a.abrupt("return",a.sent);case 18:case"end":return a.stop()}}))},ne=function(e,t){var a=e.offlineStorage;return new Promise((function(e){t.addresses||e(!0),t.addresses.forEach((function(n,r){a.transaction("rw",a.addresses,(function(){a.addresses.add({address:n.address,lat:n.lat,lng:n.lng,created:n.created,updated:n.updated}).then((function(e){return!0}))?r===t.addresses.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},re=function(e,t){var a=e.offlineStorage;return new Promise((function(e){t.tags||e(!0),t.tags.forEach((function(n,r){a.transaction("rw",a.tags,(function(){var o=JSON.parse(n.meta);a.tags.add({addressId:n.address_id,fileName:o.name,thumbnail_src:n.thumbnail_src,meta:o}).then((function(e){return!0}))?r===t.tags.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},oe=function(e,t){var a=e.offlineStorage;return new Promise((function(e){t.ownerInfo||e(!0),t.ownerInfo.forEach((function(n,r){a.transaction("rw",a.ownerInfo,(function(){a.ownerInfo.add({addressId:n.address_id,formData:JSON.parse(n.form_data)}).then((function(e){return!0}))?r===t.ownerInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},se=function(e,t){var a=e.offlineStorage;return new Promise((function(e){t.tagInfo||e(!0),t.tagInfo.forEach((function(n,r){a.transaction("rw",a.tagInfo,(function(){a.tagInfo.add({addressId:n.address_id,formData:JSON.parse(n.form_data)}).then((function(e){return!0}))?r===t.tagInfo.length-1&&e(!0):e(!1)})).catch((function(t){e(!1)}))}))}))},ce=function(e,t){return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return!0,a.next=3,d.a.awrap(ne(e,t));case 3:return a.sent,a.next=6,d.a.awrap(re(e,t));case 6:return a.sent,a.next=9,d.a.awrap(oe(e,t));case 9:return a.sent,a.next=12,d.a.awrap(se(e,t));case 12:if(!a.sent){a.next=17;break}return a.abrupt("return",!0);case 17:return a.abrupt("return",!1);case 18:case"end":return a.stop()}}))},ie=function(e){return new Promise((function(t){e.delete().then((function(){t(!0)})).catch((function(e){t(!1)}))}))},le=function(){document.querySelector(".tagging-tracker").style.height=window.innerHeight+"px"},de=function(e,t,a){var n,r=e.offlineStorage,o=t.addressId,s=function(){clearTimeout(n),alert("Address deleted! Redirecting..."),a(t)},c=function(e){var t=e.tagInfo.where("addressId").equals(o);t.count().then((function(a){a?t.delete().then((function(){console.log("tag info deleted"),i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tags",e)})):i(e)})).catch((function(e){alert("Failed to delete tag info"),console.log("delete tag info",e)}))},i=function(e){var t=e.tags.where("addressId").equals(o);t.count().then((function(a){a?t.delete().then((function(){console.log("tags deleted"),l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)})):l(e)})).catch((function(e){alert("Failed to delete tags"),console.log("delete tags",e)}))},l=function(e){var t=e.addresses.where("id").equals(o);t.count().then((function(e){e?t.delete().then((function(){console.log("address deleted"),s()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)})):s()})).catch((function(e){alert("Failed to delete address"),console.log("delete address",e)}))};r?r.open().then((function(e){!function(e){var t=e.ownerInfo.where("addressId").equals(o);t.count().then((function(a){a?t.delete().then((function(){console.log("owner info deleted"),c(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)})):c(e)})).catch((function(e){alert("Failed to delete owner info"),console.log("delete owner info",e)}))}(e),n=setTimeout((function(){alert("Failed to delete address or taking longer than usual"),a()}),6e4)})).catch((function(e){alert("failed to open local storage",e),a()})):(alert("Failed to delete address"),a())},ue=function(e){var t=Object(o.useRef)(null),a=Object(o.useRef)(null),n=Object(o.useRef)(null),r=Object(o.useRef)(null),c=Object(g.g)(),i=Object(o.useState)(!1),l=Object(u.a)(i,2),m=l[0],p=l[1],A=function(){return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return e.updateLoggingOut(!0),t.next=3,d.a.awrap(ie(e.offlineStorage));case 3:t.sent||alert("failed to clear local data"),window.location.href="/";case 6:case"end":return t.stop()}}))},h=function(){e.saveToDevice()},b=function(){var t;return d.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(e.appOnline){a.next=3;break}return alert("Unable to sync, you are offline"),a.abrupt("return");case 3:if(e.token){a.next=7;break}return alert("Please login to sync"),c.push("/login"),a.abrupt("return");case 7:if(e.syncApp){a.next=14;break}return e.setSyncApp(!0),a.next=11,d.a.awrap(ae(e));case 11:t=a.sent,Object.keys(t).length?"undefined"!==t.msg&&(403===t.msg?alert("You have been logged out, please login to sync"):alert(t.msg)):t||alert("Failed to sync"),e.setSyncApp(!1);case 14:case"end":return a.stop()}}))},w=function(){e.appOnline?e.token?e.triggerFileUpload(!0):window.confirm("You need to be logged in to upload. Login or use save to device to keep selected files. Pressing OK will redirect you to the login page.")&&c.push("/login"):alert("Unable to upload, you are offline")},v=function(){document.getElementById("add-tag-file-input").click()},y=function(t){if(p(!1),Object.keys(t).length){var a=e.deletedAddresses;a.push(t.address),e.setDeletedAddresses(a)}c.push("/addresses")};return Object(o.useEffect)((function(){window.addEventListener("resize",le),/(iPhone|iPod|iPhone Simulator|iPod Simulator|iPad|iPad Simulator|Macintosh)/g.test(navigator.userAgent)&&document.querySelector(".tagging-tracker__bottom-navbar").classList.add("iOS"),function(e){var t=e.location.pathname;"/addresses"===t&&"/"===t||(document.querySelector(".tagging-tracker__body").style.maxHeight=window.innerHeight-52+"px")}(e),window.removeEventListener("resize",le)})),s.a.createElement("div",{className:-1!==["/owner-info","/tag-info"].indexOf(e.location.pathname)?"tagging-tracker__bottom-navbar floating-btns":"tagging-tracker__bottom-navbar"},function(o){var c=e.location.state;switch(e.baseDir?o.pathname.replace(e.baseDir+"/",""):o.pathname){case"/":case"/addresses":return s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{onClick:b,ref:t,className:"bottom-navbar__btn half sync",type:"button",disabled:!e.appOnline},e.syncApp?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Syncing..."),s.a.createElement("img",{src:S.a,alt:"syncing spinner"})):s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{src:Q.a,alt:"sync button icon"}),s.a.createElement("span",null,"Sync"))),s.a.createElement("button",{ref:a,onClick:A,className:"bottom-navbar__btn half",type:"button"},e.loggingOut?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Logging out..."),s.a.createElement("img",{src:S.a,alt:"logging out spinner"})):s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{src:T.a,alt:"logout button icon"}),s.a.createElement("span",null,"Logout"))));case"/view-address":case"/edit-tags":return s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{onClick:function(){return t=c,void(window.confirm("Delete "+t.address+" ?")&&(p(!0),de(e,t,y)));var t},className:"bottom-navbar__btn fourth",disabled:!!m},m?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Deleting..."),s.a.createElement("img",{src:S.a,alt:"deleting address spinner"})):s.a.createElement(s.a.Fragment,null,s.a.createElement("img",{src:W.a,alt:"home owner button icon"}),s.a.createElement("span",null,"Delete"))),s.a.createElement(f.b,{to:{pathname:"/owner-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},s.a.createElement("img",{src:Y.a,alt:"home owner button icon"}),s.a.createElement("span",null,"Owner Info")),s.a.createElement(f.b,{to:{pathname:"/tag-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},s.a.createElement("img",{src:U.a,alt:"tag info button icon"}),s.a.createElement("span",null,"Tag Info")),s.a.createElement(f.b,{to:{pathname:"/add-tag",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn fourth"},s.a.createElement("img",{src:q.a,alt:"add tag icon"}),s.a.createElement("span",null,"Add Tag")));case"/add-tag":return s.a.createElement(s.a.Fragment,null,s.a.createElement("button",{ref:n,onClick:v,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button"},s.a.createElement("span",null,"Use Camera")),s.a.createElement("button",{ref:r,onClick:w,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!e.loadedPhotos.length},e.uploadInProgress?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Uploading..."),s.a.createElement("img",{src:G.a,alt:"uploading spinner"})):s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Upload"))),s.a.createElement("button",{onClick:h,className:"bottom-navbar__btn quarter caps-blue border small-font",type:"button",disabled:!!e.savingToDevice},e.savingToDevice?s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Saving..."),s.a.createElement("img",{src:G.a,alt:"saving spinner"})):s.a.createElement(s.a.Fragment,null,s.a.createElement("span",null,"Save To Device"))),s.a.createElement(f.b,{to:{pathname:"/view-address",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn quarter caps-blue small-font"},s.a.createElement("span",null,"Cancel")));case"/tag-info":case"/owner-info":var i="/tag-info"===e.location.pathname;return s.a.createElement(s.a.Fragment,null,s.a.createElement(f.b,{to:{pathname:"/owner-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn toggled "+(i?"":"active")},s.a.createElement("img",{src:Y.a,alt:"home owner button icon"}),s.a.createElement("span",null,"Owner Info")),s.a.createElement(f.b,{to:{pathname:"/tag-info",state:{address:c.address,addressId:c.addressId}},className:"bottom-navbar__btn toggled "+(i?"active":"")},s.a.createElement("img",{src:U.a,alt:"tag info button icon"}),s.a.createElement("span",null,"Tag Info")));default:return null}}(e.location))},fe=(a(82),function(e){return s.a.createElement("div",{className:"tagging-tracker__page-404"},s.a.createElement("h2",null,"You've entered an invalid path"),s.a.createElement("p",null,"Try the page(s) below to return to the app"),s.a.createElement(f.b,{to:"/"},"Login"))}),ge=(a(83),function(e){var t=Object(o.useRef)(null),a=Object(o.useState)(!1),n=Object(u.a)(a,2),r=n[0],c=n[1],i=Object(o.useState)(!1),l=Object(u.a)(i,2),f=l[0],g=l[1],m=Object(o.useState)([]),p=Object(u.a)(m,2),h=p[0],b=p[1],w=Object(o.useState)(!1),v=Object(u.a)(w,2),y=v[0],E=v[1],k=Object(o.useState)(!1),I=Object(u.a)(k,2),O=I[0],x=I[1],j=function(e){return new Promise((function(t,a){var n=new Image;n.src=e,n.onload=function(){n.width<=300&&t(e),function(e,t){var a=300,n=300;if("landscape"===(t.width/t.height>=1?"landscape":"portrait")){n=300*t.height/t.width}else{a=300*t.width/t.height}var r=document.createElement("canvas");r.id="resize-canvas";var o=r.getContext("2d");r.width=a,r.height=n,o.drawImage(t,0,0,a,n),e(r.toDataURL("image/png"))}(t,n)},n.onerror=function(e){a(e)}}))},C=function(){var t,a,n,r;return d.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:E(!0),t=e.offlineStorage,a=e.location.state,n=function(e){var n,r,o,s;return d.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return n=h[e],r=e,c.next=4,d.a.awrap(j(n.src));case 4:o=c.sent,(s=document.getElementById("resize-canvas"))&&s.remove(),t.transaction("rw",t.tags,(function(){return d.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.awrap(t.tags.add({addressId:a.addressId,fileName:n.meta.name,src:n.src,thumbnail_src:o,meta:n.meta,timestamp:Date.now()}).then((function(e){return!0})));case 2:if(!e.sent){e.next=6;break}r===h.length-1&&(alert("Photos saved"),b([]),E(!1)),e.next=7;break;case 6:alert("Failed to save photos to device");case 7:case"end":return e.stop()}}))})).catch((function(e){console.log("failed to save photos",e),alert("Failed to save photos to device")}));case 8:case"end":return c.stop()}}))},r=0;case 5:if(!(r<h.length)){o.next=11;break}return o.next=8,d.a.awrap(n(r));case 8:r++,o.next=5;break;case 11:case"end":return o.stop()}}))},S=function(t){var a=new FileReader,n=t.files[0];a.onload=function(t){b(h.concat({addressId:e.location.state.addressId,fileName:n.name,src:t.target.result,thumbanil_src:"",meta:{name:n.name,size:n.size}}))},a.readAsDataURL(n)},_=function(e,t){var a=h;h.filter((function(n,r){t===r&&"undefined"===typeof h[r].meta.width&&(a[r].meta.width=e.width,a[r].meta.height=e.height,b(a))}))};return Object(o.useEffect)((function(){r||c(!1)}),[r]),Object(o.useEffect)((function(){c(!1)}),[h]),Object(o.useEffect)((function(){f&&!O&&(x(!0),function(){var t=(-1!==window.location.href.indexOf("localhost")?"http://localhost:5000":"https://api.byx1a2gixtvvnjwxde5y.com")+"/upload-tag";A.a.post(t,{headers:{Authorization:"Bearer ".concat(e.token)},images:h}).then((function(e){200===e.status?C():403===e.status?(alert("Your session has expired, please login again"),window.location.href="/login"):alert("Failed to upload"),g(!1),x(!1)})).catch((function(e){"undefined"!==typeof e.response&&"undefined"!==typeof e.response.status&&403===e.response.status?(alert("You have been logged out, please log back in to upload."),window.location.href="/login"):(console.log("upload err",e),g(!1),x(!1))}))}())}),[f,O]),Object(o.useEffect)((function(){e.setBodyClass("tagging-tracker__body increase-height")}),[e]),s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"tagging-tracker__add-tag move-bottom-navbar-down"},s.a.createElement("input",{type:"file",ref:t,name:"image",onChange:function(){!function(e){e.files.length?S(e):alert("No image selected")}(t.current)},id:"add-tag-file-input"}),h.map((function(e,t){return s.a.createElement("div",{style:{backgroundImage:"url("+e.src+")"},key:t,className:"tagging-tracker__address-tag"},s.a.createElement("img",{alt:e.meta.name,src:e.src,onLoad:function(e){return _(e.target,t)}}))}))),s.a.createElement(ue,Object.assign({},e,{triggerLoadCamera:c,loadCamera:r,triggerFileUpload:g,fileUpload:f,saveToDevice:C,savingToDevice:y,uploadInProgress:O,setUploadInProgress:x,loadedPhotos:h,appOnline:e.appOnline,token:e.token})))}),me=(a(84),a(43)),pe=a.n(me),Ae=function(e){var t=e.offlineStorage,a=Object(g.g)(),c=Object(o.useState)(null),i=Object(u.a)(c,2),l=i[0],d=i[1],f=Object(o.useState)(!1),m=Object(u.a)(f,2),p=m[0],A=m[1],h=Object(o.useState)(!1),b=Object(u.a)(h,2),w=(b[0],b[1]);"undefined"===typeof e.location.state&&a.push("/addresses");var v,y,E;return Object(o.useEffect)((function(){n&&(n="",r=null),A(!1)}),[l]),s.a.createElement("div",{className:"tagging-tracker__edit-tags tagging-tracker__view-address"},(t&&!l&&t.open().then((function(t){t.tags.toArray().then((function(a){a.length?t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){d(e)})):d([])}))})).catch((function(e){alert("failed to open local storage")})),Array.isArray(l)?l.map((function(e,t){return s.a.createElement("div",{key:t,style:{backgroundImage:"url(".concat(e.thumbnail_src,")")},alt:"address thumbnail",onClick:function(){var t,a;t=e.meta.name,a=e.timestamp,n=t,r=a,A(!0)},className:"address__tag-image delete "+j(l[t])},s.a.createElement("div",{style:{backgroundImage:"url(".concat(pe.a,")")},className:"tagging-tracker__edit-tags-close-btn"}))})):s.a.createElement("div",{className:"tagging-tracker__edit-tags-loading css-delayed-fade-in"},s.a.createElement("span",null,"Loading tags..."),s.a.createElement("img",{src:S.a,alt:"loading tags spinner"}))),(v=e.location.state.addressId,y=n,E=r,s.a.createElement("div",{className:"tagging-tracker__edit-tags-delete-prompt"+(p?"":" hidden")},s.a.createElement("h4",null,"Delete Tag ",y),s.a.createElement("p",null,"This will delete all information and photos of the tag"),s.a.createElement("div",{className:"edit-tags-delete-prompt__delete-btns"},s.a.createElement("button",{onClick:function(){!function(a,n,r){t.transaction("rw",t.tags,(function(){t.tags.where("addressId").equals(a).toArray().then((function(a){a.some((function(a){r||a.fileName!==n?a.timestamp&&r===a.timestamp&&t.tags.where("timestamp").equals(r).delete().then((function(a){a&&t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){d(e)}))})):t.tags.where("fileName").equals(n).delete().then((function(a){a&&t.tags.where("addressId").equals(e.location.state.addressId).toArray().then((function(e){d(e)}))}))}))})).catch((function(e){return console.log("deleted tag",e),!1}))?w(!0):alert("Failed to delete tag")})).catch((function(e){alert("Failed to delete tag"),console.log("delete tag",e)}))}(v,y,E)},className:"delete-btns__delete",type:"button"},"Delete"),s.a.createElement("button",{onClick:function(){A(!1)},className:"delete-btns__cancel",type:"button"},"Cancel")))))},he=function(){var e=Object(o.useState)(""),t=Object(u.a)(e,2),a=t[0],n=t[1],r=Object(o.useState)(""),c=Object(u.a)(r,2),i=c[0],l=c[1],p=Object(o.useState)(!1),b=Object(u.a)(p,2),w=b[0],y=b[1],E=Object(o.useState)(!0),I=Object(u.a)(E,2),O=I[0],j=I[1],C=Object(o.useState)(null),S=Object(u.a)(C,2),N=S[0],F=S[1],Q=Object(o.useState)(!1),R=Object(u.a)(Q,2),T=R[0],P=R[1],Y=Object(o.useState)(!1),L=Object(u.a)(Y,2),U=L[0],M=L[1],q=Object(o.useState)("tagging-tracker__body"),K=Object(u.a)(q,2),W=K[0],V=K[1],G=Object(o.useState)(!1),H=Object(u.a)(G,2),J=H[0],Z=H[1],z=Object(o.useState)(!1),X=Object(u.a)(z,2),$=X[0],ee=X[1],te=Object(o.useState)([]),ae=Object(u.a)(te,2),ne=ae[0],re=ae[1],oe=function(e){l(e)},se=function(e){y(e)},ce=function(){l("")},ie=function(e){n(e)},le=function(e){var t="online"===e.type;O!==t&&j(!O)},de=function(){return window.addEventListener("online",le),window.addEventListener("offline",le),function(){window.removeEventListener("online",le),window.removeEventListener("offline",le)}},me=function(){var e;return d.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=window.localStorage.getItem("verChecked")){t.next=5;break}window.localStorage.setItem("verChecked",Date.now()),t.next=12;break;case 5:if(!(Date.now()-e>3e5)){t.next=12;break}return t.next=8,d.a.awrap(new Promise((function(e,t){var a=-1===window.location.href.indexOf("localhost")&&"https://taggingtracker.org";a?A.a.get(a+"/?"+Date.now()).then((function(t){200===t.status&&t.data?e(!0):e(!1)})).catch((function(e){console.log("remote cache clear test",e),t(new Error("no content"))})):e(!1)})));case 8:if(t.sent&&window.caches){t.next=11;break}return t.abrupt("return");case 11:caches.keys().then((function(e){var t=!0,a=!1,n=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;caches.delete(s)}}catch(c){a=!0,n=c}finally{try{t||null==o.return||o.return()}finally{if(a)throw n}}}));case 12:case"end":return t.stop()}}))},pe=function(){window.localStorage.setItem("verChecked",Date.now()-36e4),me(),window.location.reload()};return Object(o.useEffect)((function(){de(),N||function(){var e=new m.a("LocalImageDatabase");e.version(1).stores({addresses:"++id,address,lat,lng,created,updated",tags:"++,fileName,addressId,meta,timestamp",ownerInfo:"++,addressId,formData",tagInfo:"++,addressId,formData"}),F(e)}(),me()})),s.a.createElement("div",{className:"tagging-tracker"},s.a.createElement(f.a,{basename:""},s.a.createElement(g.b,{component:function(e){return s.a.createElement(v,Object.assign({},e,{baseDir:"",searchAddress:oe,searchedAddress:i,toggleAddressModal:se,checkOnlineStatus:de,toggleModifyOwnerInfo:P,modifyOwnerInfo:T,modifyTagInfo:U,toggleModifyTagInfo:M,updateSoftware:pe}))}}),s.a.createElement("div",{className:W},s.a.createElement(g.d,null,s.a.createElement(g.b,{exact:!0,path:"/login",component:function(e){return a?s.a.createElement(g.a,{to:"/addresses"}):s.a.createElement(k,Object.assign({},e,{updateToken:ie,token:a}))}}),s.a.createElement(g.b,{path:"/view-address",component:function(e){return s.a.createElement(_,Object.assign({},e,{offlineStorage:N}))}}),s.a.createElement(g.b,{path:"/owner-info",component:function(e){return s.a.createElement(B,Object.assign({},e,{modifyOwnerInfo:T,offlineStorage:N}))}}),s.a.createElement(g.b,{path:"/tag-info",component:function(e){return s.a.createElement(D,Object.assign({},e,{modifyTagInfo:U,offlineStorage:N}))}}),s.a.createElement(g.b,{path:"/add-tag",component:function(e){return s.a.createElement(ge,Object.assign({},e,{offlineStorage:N,setBodyClass:V,token:a,appOnline:O}))}}),"}/>",s.a.createElement(g.b,{path:"/edit-tags",component:function(e){return s.a.createElement(Ae,Object.assign({},e,{offlineStorage:N}))}}),s.a.createElement(g.b,{path:["/","/addresses"],component:function(e){return s.a.createElement(x,Object.assign({},e,{searchedAddress:i,setShowAddressModal:y,showAddressModal:w,toggleAddressModal:se,clearSearchAddress:ce,token:a,offlineStorage:N,getDateTime:h}))}}),s.a.createElement(g.b,null,s.a.createElement(fe,null)))),s.a.createElement(g.b,{component:function(e){return"/login"!==e.location.pathname&&"/add-tag"!==e.location.pathname?s.a.createElement(ue,Object.assign({},e,{baseDir:"",appOnline:O,token:a,syncApp:J,setSyncApp:Z,offlineStorage:N,loggingOut:$,updateLoggingOut:ee,deletedAddresses:ne,setDeletedAddresses:re})):null}})))},be=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function we(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}i.a.render(s.a.createElement(he,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("","/service-worker.js");be?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):we(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):we(t,e)}))}}()}],[[44,1,2]]]);
//# sourceMappingURL=main.9837ab55.chunk.js.map